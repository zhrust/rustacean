<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>be Rustaceans</title>
    <meta name="robots" content="noindex" />


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="å¦‚ä½•æˆä¸ºä¸€ååˆæ ¼çš„ Rustacean ? è‚¯å®šæœ‰ä¸ªè¿‡ç¨‹, è¿™å„¿è®°å½•äº†ç§äººè¿™ä¸ªè½¬åŒ–è¿‡ç¨‹...">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="theme/style.css">


</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');
            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }
            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded "><a href="abt/index.html"><strong aria-hidden="true">1.</strong> æˆä¸º Rustacean</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="abt/gh-pages.html"><strong aria-hidden="true">1.1.</strong> gh-pages</a></li><li class="chapter-item "><a href="abt/zhrust.html"><strong aria-hidden="true">1.2.</strong> zhrust</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">è‡ªå­¦ç»ƒä¹ </li><li class="spacer"></li><li class="chapter-item expanded "><a href="101/index.html"><strong aria-hidden="true">2.</strong> Rust å­¦ä¹ </a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="101/chatgpt101.html"><strong aria-hidden="true">2.1.</strong> ä¼´å­¦ChatGPT</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="101/chat_dyn101.html"><strong aria-hidden="true">2.1.1.</strong> dyn åˆæ­¥</a></li></ol></li><li class="chapter-item "><a href="101/idioms.html"><strong aria-hidden="true">2.2.</strong> idioms</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="101/idiom325_create_a_queue.html"><strong aria-hidden="true">2.2.1.</strong> idiom#325:æ„é€ é˜Ÿåˆ—</a></li></ol></li><li class="chapter-item "><a href="101/quiz.html"><strong aria-hidden="true">2.3.</strong> Quiz.rs</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="101/quiz_1.html"><strong aria-hidden="true">2.3.1.</strong> Quiz#1</a></li></ol></li><li class="chapter-item "><a href="101/exercism.html"><strong aria-hidden="true">2.4.</strong> Exercism</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="101/ex42all-your-base.html"><strong aria-hidden="true">2.4.1.</strong> 42:all-your-base</a></li><li class="chapter-item "><a href="101/ex43Allergies.html"><strong aria-hidden="true">2.4.2.</strong> 43:Allergies</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">å®è·µğŸŒšğŸŒ˜ğŸŒ—ğŸŒ–ğŸŒ</li><li class="spacer"></li><li class="chapter-item expanded "><a href="dev/index.html"><strong aria-hidden="true">3.</strong> Rust å¼€å‘</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/dama-projects.html"><strong aria-hidden="true">3.1.</strong> å°ä½œå“</a></li><li class="chapter-item "><a href="dev/tui4cli.html"><strong aria-hidden="true">3.2.</strong> TUI</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/cli_nnera.html"><strong aria-hidden="true">3.2.1.</strong> ğŸŒ– NNera</a></li><li class="chapter-item "><a href="dev/cli_ferris_art.html"><strong aria-hidden="true">3.2.2.</strong> ğŸŒ Ferrisè‰ºæœ¯</a></li><li class="chapter-item "><a href="dev/cli_bxmr.html"><strong aria-hidden="true">3.2.3.</strong> ğŸŒ BXMr</a></li><li class="chapter-item "><a href="dev/cli_rss4mdbook.html"><strong aria-hidden="true">3.2.4.</strong> ğŸŒ RSS4mdbook</a></li><li class="chapter-item "><a href="dev/cli_yuzu.html"><strong aria-hidden="true">3.2.5.</strong> ğŸŒš Yuzu</a></li></ol></li><li class="chapter-item "><a href="dev/web4async.html"><strong aria-hidden="true">3.3.</strong> å¼‚æ­¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/tokio.html"><strong aria-hidden="true">3.3.1.</strong> Tokio</a></li><li class="chapter-item "><a href="dev/graphql.html"><strong aria-hidden="true">3.3.2.</strong> GraphQL</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.4.</strong> TTD</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/rust-unit-test-everything-wanted-know.html"><strong aria-hidden="true">3.4.1.</strong> Rust å•å…ƒæµ‹è¯•å¾—çŸ¥é“çš„ä¸€åˆ‡</a></li><li class="chapter-item "><a href="dev/debug_rust_with_codelldb.html"><strong aria-hidden="true">3.4.2.</strong> CodeLLDB</a></li></ol></li><li class="chapter-item "><a href="dev/gui4web.html"><strong aria-hidden="true">3.5.</strong> GUI</a></li><li class="chapter-item "><a href="dev/embedded_rs.html"><strong aria-hidden="true">3.6.</strong> åµŒå…¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/emb_rp2040pico.html"><strong aria-hidden="true">3.6.1.</strong> Pico</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.7.</strong> CI/CD</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/cross-compiling.html"><strong aria-hidden="true">3.7.1.</strong> äº¤å‰ç¼–è¯‘?</a></li></ol></li><li class="chapter-item "><a href="dev/20-things-ive-learned-in-my-20-years-as-a-software-engineer.html"><strong aria-hidden="true">3.8.</strong> 20å¹´æ¥ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆå­¦åˆ°çš„10ä»¶äº‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/concepts-i-wish-i-learned-earlier.html"><strong aria-hidden="true">3.8.1.</strong> å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.9.</strong> å®ç”¨å·¥å…·æ¨è...</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/cli_btm.html"><strong aria-hidden="true">3.9.1.</strong> Bottom</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">å·¥ç¨‹ç»éªŒ</li><li class="spacer"></li><li class="chapter-item expanded "><a href="tip/index.html"><strong aria-hidden="true">4.</strong> Rust æŠ€èƒ½</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="tip/awesome4rs.html"><strong aria-hidden="true">4.1.</strong> Awesome.rs</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="tip/aw4rs_handlebars.html"><strong aria-hidden="true">4.1.1.</strong> Handlebars</a></li><li class="chapter-item "><a href="tip/tracing.html"><strong aria-hidden="true">4.1.2.</strong> tracing åˆæ­¥</a></li><li class="chapter-item "><a href="tip/open_big_file_speed.html"><strong aria-hidden="true">4.1.3.</strong> æ–‡ä»¶åŠ é€Ÿæ‰“å¼€</a></li></ol></li><li class="chapter-item "><a href="tip/rust_min_bug_patterns.html"><strong aria-hidden="true">4.2.</strong> BMP:æœ€å°bugæ¨¡å¼</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="tip/manag_growing_proj_with_crates_modules.html"><strong aria-hidden="true">4.2.1.</strong> Crateä¸­åˆç†åˆ’åˆ†ç›®å½•</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">4.3.</strong> anti-OOP</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="tip/default-params.html"><strong aria-hidden="true">4.3.1.</strong> OOP:Rust å’Œé»˜è®¤å‚æ•°</a></li><li class="chapter-item "><a href="tip/oop-1-encapsulation.html"><strong aria-hidden="true">4.3.2.</strong> Rust è¶…è¶ŠOOP,ç¬¬1éƒ¨åˆ†</a></li><li class="chapter-item "><a href="tip/oop-2-polymorphism.html"><strong aria-hidden="true">4.3.3.</strong> Rust è¶…è¶ŠOOP,ç¬¬2éƒ¨åˆ†</a></li></ol></li><li class="chapter-item "><a href="tip/rust6fun-operator-overloading.html"><strong aria-hidden="true">4.4.</strong> è¿ç®—ç¬¦é‡è½½å…­ä»¶è¶£äº‹</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">ç¬”è®°å—¯å“¼</li><li class="spacer"></li><li class="chapter-item expanded "><a href="log/index.html"><strong aria-hidden="true">5.</strong> ç¬”è®°</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="log/rust101logging.html"><strong aria-hidden="true">5.1.</strong> Rust è¯¾ç¨‹ç¬”è®°</a></li><li class="chapter-item "><a href="log/rust-s-ugly-syntax.html"><strong aria-hidden="true">5.2.</strong> Rust ä¸‘å¥æ³•</a></li><li class="chapter-item "><a href="log/graph-rust-move-copy-borrow.html"><strong aria-hidden="true">5.3.</strong> å›¾å½¢æè¿° Rust ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨</a></li><li class="chapter-item "><div><strong aria-hidden="true">5.4.</strong> Choaså—¯å“¼</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="log/c101.html"><strong aria-hidden="true">5.4.1.</strong> 0åŸºç¡€å…¥é—¨C?</a></li><li class="spacer"></li></ol></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">be Rustaceans</h1>

                <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/zhrust/rustacean/tree/main/src" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <main>
                    <h1 id="æœ‰å…³å¦‚ä½•æˆä¸º-rustacean"><a class="header" href="#æœ‰å…³å¦‚ä½•æˆä¸º-rustacean">æœ‰å…³&quot;å¦‚ä½•æˆä¸º Rustacean&quot;...</a></h1>
<blockquote>
<p>as Zoom.Quiet</p>
</blockquote>
<h2 id="background"><a class="header" href="#background">background</a></h2>
<ul>
<li>è‡ªå­¦ä½¿ç”¨ Python ç¬¬21å¹´,</li>
<li>çœ‹ç€ Perl7 æ¶ˆå¤±,</li>
<li>çœ‹ç€ Golang çªç„¶å˜æˆ G+,</li>
<li>çœ‹ç€ Rust çªç„¶å˜æˆæ˜¾å­¦,</li>
<li>å¿ä¸ä½äº†...</li>
</ul>
<h2 id="goal"><a class="header" href="#goal">goal</a></h2>
<p>å……åˆ†å¤ç”¨ä»¥å¾€å„ç§æŠ€æœ¯æ ˆçš„è‡ªå­¦ç»éªŒ,
å°½å¯èƒ½åˆç†å’Œæ•ˆç‡çš„å®Œæˆ Pythoneer -&gt; Rustacean çš„è½¬åŒ–;
æˆ–æ˜¯å¤–æŒ‚?</p>
<p>åˆé€‚çš„æ—¶å€™æ³¨å†Œåˆ°: <a href="https://rustaceans.org/">Rustaceans</a></p>
<h2 id="trace"><a class="header" href="#trace">trace</a></h2>
<ul>
<li>...</li>
<li>230225 mdbook è¿½åŠ  RRS å¤±è´¥, ä¸è¿‡, æ ¹æ®å…¶å®ƒå…¬å¼€å›¾ä¹¦é¡¹ç›®çš„é…ç½®, å°†èœå•æŠ˜å äº†...</li>
<li>230101 é”ˆå‘¨åˆŠå¼€å§‹è¿è½½: <a href="https://weekly.rs.101.so/2023/RR23W1.html#%E6%96%87%E7%AB%A0%E5%97%AF%E5%93%BC">RR23W1 - Weekly for China Rustaceans</a></li>
<li>221111 æœ€ç»ˆä»¥ rs.101.so ~ å¦‚æ­¤åŸºç¡€çš„ Rust , åŸŸåå‘å¸ƒ</li>
<li>221022 ä»“åº“åˆ›å»º</li>
<li>220918 ç¡®å®šè‚¯å®šå·²ç»æ˜ç¡®å¼€å§‹è½¬åŒ–è¿›ç¨‹</li>
</ul>
<h2 id="refer"><a class="header" href="#refer">refer.</a></h2>
<ul>
<li>å¤§å¦ˆ:
<ul>
<li>ä¸»ç´¢å¼•: <a href="https://zoomquiet.io/">mapping -&gt; ZoomQuiet.io {by gen4dot2htm.py vv.190718 at:190911 18:07:32,877571}</a></li>
</ul>
</li>
<li><a href="https://jsfiddle.net/Diggsey/3pdgh52r/embedded/result/">Animated Ferris - JSFiddle</a></li>
</ul>
<h2 id="logging"><a class="header" href="#logging">logging</a></h2>
<ul>
<li>...</li>
<li>221111 ZQ å°è¯• .rs åŸŸåå¤±è´¥</li>
<li>221101 ZQ init.</li>
</ul>
<pre><code>           _~`--~_
       \/ /  ^ â†’  \ ()
         '_   â•   _'
         \ '-----' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gh-pages"><a class="header" href="#gh-pages">gh-pages</a></h1>
<blockquote>
<p>å…è´¹ä½¿ç”¨çš„æˆæœ¬</p>
</blockquote>
<h2 id="background-1"><a class="header" href="#background-1">background</a></h2>
<blockquote>
<p>æ— å¥ˆèƒŒæ™¯</p>
</blockquote>
<p>å‡¡æ˜¯å¯ä»¥ç¼–è¯‘ä¸º é™æ€ç½‘ç«™ çš„, éƒ½å¯ä»¥é€šè¿‡ gh-pages/GitHub-Pages æœåŠ¡æ¥è¿›è¡Œå…è´¹å‘å¸ƒ;</p>
<h2 id="goal-1"><a class="header" href="#goal-1">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
æœ¬åœ°ç¼–è¯‘å¥½, å˜¦ git push ,ä¸€åˆ‡å°±å¯ä»¥è‡ªåŠ¨å®Œæˆå‘å¸ƒ</li>
<li><input disabled="" type="checkbox" checked=""/>
è€Œä¸”å‘å¸ƒåˆ°æŒ‡å®šåŸŸå</li>
</ul>
<h2 id="trace-1"><a class="header" href="#trace-1">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<ul>
<li>é‡‡è´­ cn.rust, china.rust åŸŸå</li>
<li>å„ç§å°è¯•, ç»“æœå…³é”®ç½‘ç»œæœåŠ¡éƒ½ä¸è§£æ .rust è¿™ä¸ªæ ¹åŸŸå</li>
<li>...</li>
</ul>
<h2 id="refer-1"><a class="header" href="#refer-1">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://docs.github.com/cn/pages/configuring-a-custom-domain-for-your-github-pages-site/troubleshooting-custom-domains-and-github-pages">éªŒè¯ GitHub Pages çš„è‡ªå®šä¹‰åŸŸ - GitHub Docs</a></li>
</ul>
<h2 id="logging-1"><a class="header" href="#logging-1">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>221023 ZQ init.</li>
</ul>
<pre><code>       _~^+~~_
   \/ /  * â˜‰  \ \/
     '_   âˆ§   _'
     \ '--+--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="zhrust"><a class="header" href="#zhrust">zhRust</a></h1>
<blockquote>
<p>cn.rust åŸŸå</p>
</blockquote>
<h2 id="background-2"><a class="header" href="#background-2">background</a></h2>
<blockquote>
<p>åæ­£è¨€é¡º</p>
</blockquote>
<p>ï¼²ust å‘å¸ƒæ—¶é—´ä¸çŸ­äº†,
rust ç›¸å…³ä¸­æ–‡ç¤¾åŒºæ¯”å½“å¹´ Python çš„å¤šä¸å°‘,
æ‰€ä»¥, 2022å¹´æœªå¾ˆéš¾æ‰¾åˆ°ç®€çŸ­å¥½è®°çš„åŸŸåå¯ä»¥æ³¨å†Œäº†</p>
<h2 id="goal-2"><a class="header" href="#goal-2">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>ä½†æ˜¯, æ€»æ˜¯è¦æœ‰ä¸€ä¸ª Rust æ–¹å‘çš„æŒç»­è¾“å‡ºåŸŸå, 
è¦æ±‚ä»æ¥ä¸å˜</p>
<ul>
<li>rust,rustacean ç›¸å…³</li>
<li>è¶ŠçŸ­è¶Šå¥½</li>
<li>è¶Šä¾¿å®œè¶Šå¥½</li>
<li>...</li>
</ul>
<h2 id="trace-2"><a class="header" href="#trace-2">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<ul>
<li>åŸå…ˆæœ‰ 101.camp,101.so æ‰€ä»¥å°è¯• rust.so, å·²ç»æ²¡æœ‰</li>
<li>åˆå°è¯• rustacean.so è¿˜æœ‰,åªæ˜¯è´µè€Œä¸”åˆé•¿...</li>
<li>é‚£ä¹ˆ åœ¨ namecheap.com å†æŒ–æ˜ä¸€ä¸‹, æ²¡æƒ³åˆ°
<ul>
<li>.rust ç«Ÿç„¶æœ‰è¿™ä¸ªæ ¹åŸŸå</li>
<li>ç«‹å³å…ˆæ³¨å†Œ cn.rust ä»¥åŠ china.rust</li>
</ul>
</li>
<li>å¯æƒœå‡ å¤©è¿‡å» dig æŒ‡ä»¤ä¾ç„¶æŸ¥ä¸åˆ°è®°å½•,çœ‹æ¥ <code>.rust</code> è¿˜æ˜¯ä¸€ä¸ªé¢„å¤‡æ ¹åŸŸå,è‡³å°‘ä¸­å›½æ ¹è¿˜ä¸è¯†åˆ«..
<ul>
<li>åªèƒ½æ¢å¤ä½¿ç”¨ <code>rs.101.so</code> è¿™ä¸ªåŸŸå</li>
<li>å¦å¤–å°† <code>weekly.rs.101.so</code> ä¹Ÿå‘å¸ƒå‡ºæ¥å¼€å§‹åšæŒå…³æ³¨æ¯å‘¨ç¤¾åŒºå…³é”®å˜åŒ–...</li>
</ul>
</li>
</ul>
<h2 id="refer-2"><a class="header" href="#refer-2">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://github.com/zhrust">cn|china.rust</a></li>
<li>...</li>
</ul>
<h2 id="logging-2"><a class="header" href="#logging-2">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>230101 ZQ å˜æ›´åŸŸåæŒ‡å‘</li>
<li>221230 ZQ init.
<ul>
<li>è¿ç§» utterances ğŸ”® è¯„æ³¨åˆ° https://github.com/zhrust/comments</li>
</ul>
</li>
</ul>
<pre><code>        _~âˆ½+^~_
    () /  o *  \ \/
      '_   ğŸ‚   _'
      | '--+--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å­¦ä¹ "><a class="header" href="#å­¦ä¹ ">å­¦ä¹ </a></h1>
<blockquote>
<p>learnning ...</p>
</blockquote>
<h2 id="background-3"><a class="header" href="#background-3">background</a></h2>
<blockquote>
<p>å¯èƒ½èƒŒæ™¯</p>
</blockquote>
<p>å’Œå…¶å®ƒè¯­è¨€ä¸åŒ, Rust æœ‰å¤ªå¤šå…¬å¼€çš„ç§˜å¯†,å¦‚æœä¸èƒ½å¿«é€Ÿå…ˆä¹ æƒ¯ä¸€æ‰¹,
å¾ˆéš¾å†™å‡ºå¯ä»¥è¿è¡Œçš„è½¯ä»¶æ¥...</p>
<h2 id="goal-3"><a class="header" href="#goal-3">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>æœ€å¸¸ç”¨çš„é‚£ 20% Rust å¸¸è¯†...ä»¥ä¾¿è§£å†³ 80% åº”ç”¨åœºæ™¯</p>
<h2 id="trace-3"><a class="header" href="#trace-3">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬æ¦‚å¿µ
<ul>
<li><input disabled="" type="checkbox"/>
æ‰€æœ‰æƒ/å€Ÿç”¨/ä½œç”¨åŸŸ</li>
<li><input disabled="" type="checkbox"/>
Option</li>
<li><input disabled="" type="checkbox"/>
Box</li>
<li><input disabled="" type="checkbox"/>
...</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
æ ¸å¿ƒæ•°æ®ç»“æ„,åŠå…¶å¸¸ç”¨æ“ä½œ</li>
<li><input disabled="" type="checkbox"/>
æ¨èå·¥ç¨‹ç»“æ„ ~&gt; <a href="https://www.sheshbabu.com/posts/rust-module-system/">Clear explanation of Rustâ€™s module system</a>
<ul>
<li><input disabled="" type="checkbox"/>
crate ä»¥åŠå†…éƒ¨æ¨¡å—ç®¡ç†</li>
<li><input disabled="" type="checkbox" checked=""/>
logging
<ul>
<li>tracing = &quot;0.1&quot;</li>
<li>clia-tracing-config = &quot;0.2&quot;</li>
</ul>
</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
å®ç”¨å¼€å‘/è°ƒè¯•æµç¨‹
<ul>
<li><input disabled="" type="checkbox"/>
MVP/ CLI å·¥ç¨‹</li>
<li><input disabled="" type="checkbox"/>
MVP/ web å·¥ç¨‹</li>
<li><input disabled="" type="checkbox"/>
MVP/ å¾®æœåŠ¡</li>
<li><input disabled="" type="checkbox"/>
MVP/ ç³»ç»ŸæœåŠ¡</li>
<li><input disabled="" type="checkbox"/>
...</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
å®æ•ˆ TDD æµç¨‹</li>
<li><input disabled="" type="checkbox"/>
åº•å±‚è°ƒè¯•æŠ€å·§: gdb ...</li>
</ul>
<h2 id="refer-3"><a class="header" href="#refer-3">refer.</a></h2>
<blockquote>
<p>å„ç§å‚è€ƒ</p>
</blockquote>
<p>å¿…åˆ·ç»ƒä¹ :</p>
<ul>
<li><a href="https://github.com/rust-lang/rustlings">GitHub - rust-lang/rustlings: Small exercises to get you used to reading and writing Rust code!</a> ~ å®˜æ–¹å¤§ä½¬äº²è‡ªç¼–æ’°çš„...å½¢å¼ä¸Šä¹Ÿå……åˆ†åˆ©ç”¨äº† Cargo å·¥å…·é“¾, éå¸¸çš„é”ˆ...</li>
<li><a href="https://dtolnay.github.io/rust-quiz/1">Rust Quiz #1</a></li>
<li><a href="https://exercism.org/tracks/rust">Rust on Exercism</a></li>
<li>...</li>
</ul>
<h3 id="è‡ªé”ˆè·¯å¾„"><a class="header" href="#è‡ªé”ˆè·¯å¾„">è‡ªé”ˆè·¯å¾„</a></h3>
<ul>
<li><a href="https://www.reddit.com/r/rust/comments/11dofu8/i_wanna_be_a_crab/">I wanna be a crab. : rust</a></li>
<li><a href="https://gist.github.com/noxasaxon/7bf5ebf930e281529161e51cd221cf8a">Learn Rust!</a></li>
<li><a href="https://www.freecodecamp.org/news/author/shaun/">Learn Rust Programming Course â€“ Interactive Rust Language Tutorial on Replit</a></li>
<li><a href="https://www.manning.com/books/learn-rust-in-a-month-of-lunches">Learn Rust in a Month of Lunches</a></li>
<li>...</li>
<li><a href="https://www.freecodecamp.org/news/edge-cloud-microservices-with-wasmedge-and-rust/">Michael Yuan - è¢é’§æ¶›</a> ~ å¤©ä½“ç‰©ç†å­¦åšå£«, æ—©æœŸ JBoss æˆå‘˜, WEB3 ä¸“å®¶...
<ul>
<li><a href="https://www.freecodecamp.org/news/author/michael/">The Top 8 Things I Learned From 4000 Rust Developers</a></li>
<li><a href="https://www.freecodecamp.org/news/learn-rust-with-github-actions/">How to Learn Rust Without Installing Any Software</a> ~ ç™½å«–ä¸“å®¶...
<ul>
<li><a href="https://www.freecodecamp.org/news/learn-programming-in-your-browser-the-right-way/">GitHub Codespaces â€“ How to Code Right in Your Browser with Your Own Cloud Dev Environment</a></li>
</ul>
</li>
<li><a href="https://www.freecodecamp.org/news/create-a-serverless-meme-as-a-service/">How to Create a Serverless Meme-as-a-Service</a></li>
<li><a href="https://www.freecodecamp.org/news/edge-cloud-microservices-with-wasmedge-and-rust/">Edge Cloud Microservices â€“ How to Build High Performance &amp; Secure Apps with WasmEdge and Rust</a></li>
<li>WASM/
<ul>
<li><a href="https://www.freecodecamp.org/news/rust-webassembly-serverless-tencent-cloud/">How to use Rust + WebAssembly to Perform Serverless Machine Learning and Data Visualization in the Cloud</a></li>
<li><a href="https://www.freecodecamp.org/news/build-a-personal-dev-server-on-a-5-dollar-raspberry-pi/">How to Build a Personal Dev Server on a $5 Raspberry Pi</a></li>
</ul>
</li>
</ul>
</li>
<li>...</li>
</ul>
<h3 id="rustcc"><a class="header" href="#rustcc">rustCC</a></h3>
<blockquote>
<p>ä¸­æ–‡ç¤¾åŒº:</p>
</blockquote>
<ul>
<li><a href="https://lab.cs.tsinghua.edu.cn/rust/">ç¨‹åºè®¾è®¡è®­ç»ƒï¼ˆRustï¼‰</a> ~2021-2022 å¹´å¤å­£å­¦æœŸèµ·æ¸…åå¤§å­¦è®¡ç®—æœºç³»å¼€è®¾çš„ã€Šç¨‹åºè®¾è®¡è®­ç»ƒï¼ˆRustï¼‰ã€‹</li>
<li><a href="https://prev.rust-lang.org/zh-CN/documentation.html">Rust è¯­è¨€æ–‡æ¡£ Â· Rust ç¨‹åºè®¾è®¡è¯­è¨€</a>
<ul>
<li><a href="https://rustwiki.org/docs/">Rust ä¸­æ–‡æ–‡æ¡£ | Rust æ–‡æ¡£ç½‘</a></li>
<li><a href="https://rustwiki.org/wiki/translate/rust-translation-guide/#tong-yi-fan-yi-zhu-yu-he-gu-ding-yong-yu">Rust æ–‡æ¡£ç¿»è¯‘æŒ‡å¼• | Rust æ–‡æ¡£ç½‘</a></li>
<li><a href="https://prev.rust-lang.org/zh-CN/faq.html#lifetimes">å¸¸è§é—®é¢˜è§£ç­” Â· Rust ç¨‹åºè®¾è®¡è¯­è¨€</a></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h3 id="youtube"><a class="header" href="#youtube">Youtube</a></h3>
<blockquote>
<p>çœŸçš„æ˜¯ä»€ä¹ˆéƒ½æœ‰</p>
</blockquote>
<ul>
<li>å„ç§åŠè§£:
<ul>
<li><a href="https://www.youtube.com/watch?v=sDtQaO5_SOw">Rust Linz, June 2021 - Tim McNamara - How to learn Rust - YouTube</a></li>
</ul>
</li>
<li>110+<a href="https://www.youtube.com/playlist?list=PL3azK8C0kje1DUJbaOqce19j3R_-tIc4_">Rust ç¼–ç¨‹è¯­è¨€å…¥é—¨æ•™ç¨‹ [2021] - YouTube</a>
<ul>
<li>94+ <a href="https://www.youtube.com/playlist?list=PLVhhUNGAUIQScqB26DdUq4n1Y2n3auM7X">Rust - YouTube</a>
<ul>
<li>ä¸“é¢˜:<a href="https://www.youtube.com/watch?v=xhU8KDzL0vA&amp;list=PLVhhUNGAUIQRR7JheZsDaxF_Cd5Pf5slw">rusqlite - YouTube</a></li>
<li><a href="http://ogcrazcalm.blogspot.com/2015/11/sql-cheat-sheet.html">SQL Cheat Sheet | Crazcalm</a></li>
<li><a href="https://rust-lang-nursery.github.io/rust-cookbook/database/sqlite.html#insert-and-select-data">SQLite - Rust Cookbook</a></li>
<li><a href="https://crates.io/crates/rusqlite">rusqlite - crates.io: Rust Package Registry</a></li>
<li><a href="https://doc.rust-lang.org/std/fs/struct.File.html#examples">File in std::fs - Rust</a></li>
</ul>
</li>
<li>42+<a href="https://www.youtube.com/playlist?list=PLVvjrrRCBy2JSHf9tGxGKJ-bYAN_uDCUL">RUST PROGRAMMING TUTORIALS - YouTube</a></li>
<li>44+<a href="https://www.youtube.com/playlist?list=PLJbE2Yu2zumDF6BX6_RdPisRVHgzV02NW">Intro to Rust - YouTube</a></li>
<li>14+<a href="https://www.youtube.com/playlist?list=PLKkEWK6xRmes17LQUEA5bNjYISuCEOTXx">Rust For Starters - YouTube</a></li>
</ul>
</li>
<li>44+<a href="https://www.youtube.com/playlist?list=PLai5B987bZ9CoVR-QEIN9foz4QCJ0H2Y8">The Rust Lang Book - YouTube</a></li>
<li>25+<a href="https://www.youtube.com/playlist?list=PLJbE2Yu2zumDD5vy2BuSHvFZU0a6RDmgb">Rust Projects - YouTube</a>
<ul>
<li>24+<a href="https://www.youtube.com/playlist?list=PL5dTjWUk_cPYuhHm9_QImW7_u4lr5d6zO">50 RUST Projects - YouTube</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/@jonhoo">Jon Gjengset - YouTube</a>
<ul>
<li>14+ <a href="https://www.youtube.com/playlist?list=PLqbS7AVVErFiWDOAVrPt7aYmnuuOLYvOa">Crust of Rust - YouTube</a></li>
<li>14+ <a href="https://www.youtube.com/playlist?list=PLqbS7AVVErFgY2faCIYjJZv_RluGkTlKt">Rust live-coding - YouTube</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/playlist?list=PLZaoyhMXgBzoM9bfb5pyUOT3zjnaDdSEP">Rust Talks - YouTube</a>
<ul>
<li>å„ç§ç•…æƒ³...</li>
<li><a href="https://www.youtube.com/playlist?list=PLnhCUtqrIE-zgfmf6hn6fLwhfR_hDSG9T">Contributing to Rustc - YouTube</a> ~ ç‰›äººç›´æ’­å¦‚ä½•ä¸º Rust ç¼–è¯‘å™¨è´¡çŒ®ç‰¹æ€§...</li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch?v=_jMSrMex6R0&amp;list=PLFjq8z-aGyQ6t_LGp7wqHsHTYO-pDDx84">Rust - YouTube</a>
<ul>
<li>å„ç§å‰æ™¯åˆ†æ</li>
<li><a href="https://www.youtube.com/watch?v=qjwWF6K-7uE&amp;list=PLFjq8z-aGyQ78CQu1G3C5CT9ieiNpsnbJ">WebAssembly - YouTube</a> ~ å„ç§å®ç°åº”ç”¨</li>
</ul>
</li>
<li>...</li>
</ul>
<h3 id="free-books"><a class="header" href="#free-books">free Books</a></h3>
<blockquote>
<p>è¿™ä¸ªä¸–ç•Œä¸Šå…è´¹å¥½èµ„æºå¤ªå¤šäº†...</p>
</blockquote>
<p><a href="https://github.com/EbookFoundation/free-programming-books/blob/main/books/free-programming-books-langs.md#rust">free-programming-books/free-programming-books-langs.md at main Â· EbookFoundation/free-programming-books</a></p>
<ul>
<li><a href="https://prev.rust-lang.org/zh-CN/documentation.html">Rust è¯­è¨€æ–‡æ¡£ Â· Rust ç¨‹åºè®¾è®¡è¯­è¨€</a></li>
<li><a href="https://github.com/rust-lang-cn/rustdoc-cn/fork">Rust ä¸­æ–‡æ–‡æ¡£ | Rust æ–‡æ¡£ç½‘</a></li>
<li><a href="https://tourofrust.com/11_zh-cn.html">Rust è¯­è¨€ä¹‹æ—… - Let's go on an adventure!</a></li>
<li><a href="https://learnxinyminutes.com/docs/zh-cn/rust-cn/">Yåˆ†é’Ÿé€ŸæˆX ~ å…¶ä¸­ X=Rust</a>
<ul>
<li><a href="https://wangchujiang.com/rust-cn-document-for-docker/quick-reference/docs/rust.html">Rust å¤‡å¿˜æ¸…å• &amp; rust cheatsheet &amp; Quick Reference</a></li>
</ul>
</li>
<li><a href="https://github.com/sger/RustBooks#advanced-books">sger/RustBooks: List of Rust books</a>
<ul>
<li><a href="http://llogiq.github.io/2015/07/15/profiling.html">ctjhoa/rust-learning: A bunch of links to blog posts, articles, videos, etc for learning Rust</a></li>
<li><a href="https://rust-unofficial.github.io/too-many-lists/first.html">Introduction - Learning Rust With Entirely Too Many Linked Lists</a></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h2 id="logging-3"><a class="header" href="#logging-3">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>221214 ZQ init.</li>
</ul>
<pre><code>            _~`|-~_
        \) /  O =  \ ()
          '_   â¡   _'
          | '-----' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ä¼´å­¦chatgpt"><a class="header" href="#ä¼´å­¦chatgpt">ä¼´å­¦ChatGPT</a></h1>
<blockquote>
<p>chatting for debugging ...</p>
</blockquote>
<h2 id="background-4"><a class="header" href="#background-4">background</a></h2>
<p>é€šè¿‡ç½‘ç»œä¸­å„ç§å…è´¹æ•™ç¨‹/å›¾ä¹¦å­¦ä¹ æ—¶,
ä½œè€…æ–‡å­—èƒŒåçš„æ€è€ƒè¿‡ç¨‹æ— æ³•äº¤æµ...</p>
<h2 id="goal-4"><a class="header" href="#goal-4">goal</a></h2>
<p>åˆç†ä½¿ç”¨ ChatGPT è¿›è¡Œæç¤ºå·¥ç¨‹style å­¦ä¹ </p>
<h2 id="trace-4"><a class="header" href="#trace-4">trace</a></h2>
<blockquote>
<p>è®°å½•å„ç§èˆ’æœçš„å§¿åŠ¿:</p>
</blockquote>
<h3 id="cli-æµ‹è¯•å§¿åŠ¿"><a class="header" href="#cli-æµ‹è¯•å§¿åŠ¿">CLI æµ‹è¯•å§¿åŠ¿</a></h3>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>se assert_cmd::Command;
use predicates::prelude::*;
use std::fs;

type TestResult = Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt;;

#[test]
fn dies_no_args() -&gt; TestResult {
    let mut cmd = Command::cargo_bin(&quot;echor&quot;)?; 
    cmd.assert()
        .failure()
        .stderr(predicate::str::contains(&quot;USAGE&quot;));
    Ok(()) 
}

#[test]
fn hello1() -&gt; TestResult {
    let expected = fs::read_to_string(&quot;tests/expected/hello1.txt&quot;)?;
    let mut cmd = Command::cargo_bin(&quot;echor&quot;)?;
    cmd.arg(&quot;Hello there&quot;).assert().success().stdout(expected);
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>Q:</p>
</blockquote>
<p>ä»¥ä¸Šä»£ç ä¸­, ä¸ºä»€ä¹ˆè¦ä¸“é—¨å®šä¹‰ TestResult ç±»å‹?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>åœ¨ Rust ä¸­ï¼Œæµ‹è¯•å‡½æ•°å¿…é¡»è¿”å› Result&lt;(), Box<dyn std::error::Error>&gt; ç±»å‹ã€‚è¿™æ˜¯å› ä¸ºæµ‹è¯•æ¡†æ¶éœ€è¦å¤„ç†æµ‹è¯•å‡½æ•°ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¹¶å°†è¿™äº›é”™è¯¯è½¬æ¢ä¸ºæµ‹è¯•ç»“æœã€‚å¦‚æœæµ‹è¯•å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„é”™è¯¯ç±»å‹ï¼Œæµ‹è¯•æ¡†æ¶æ— æ³•å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Result ç±»å‹ã€‚TestResult ç±»å‹åªæ˜¯ä¸ºäº†æ›´æ¸…æ™°åœ°è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‡½æ•°è¿”å›çš„ç»“æœç±»å‹ï¼Œå¹¶æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>Result&lt;(), Box<dyn std::error::Error>&gt; è¿™ä¸€ç±»å‹, å…·ä½“æœ‰ä»€ä¹ˆè¦æ±‚?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>Result&lt;(), Box<dyn std::error::Error>&gt; æ˜¯ Rust ä¸­æµ‹è¯•å‡½æ•°çš„æ ‡å‡†è¿”å›ç±»å‹ã€‚å…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¿”å›ç±»å‹ä¸º Resultï¼Œè¡¨ç¤ºæµ‹è¯•å‡½æ•°å¯ä»¥è¿”å›æˆåŠŸæˆ–å¤±è´¥çš„ç»“æœã€‚</li>
<li>() è¡¨ç¤ºæµ‹è¯•å‡½æ•°ä¸è¿”å›ä»»ä½•å€¼ï¼Œå› ä¸ºæµ‹è¯•å‡½æ•°çš„ç›®çš„æ˜¯éªŒè¯ä»£ç çš„è¡Œä¸ºæ˜¯å¦æ­£ç¡®ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæœ‰ç”¨çš„è¾“å‡ºã€‚</li>
<li>Box<dyn std::error::Error> è¡¨ç¤ºæµ‹è¯•å‡½æ•°è¿”å›çš„é”™è¯¯ç±»å‹å¯ä»¥æ˜¯ä»»ä½•å®ç°äº† std::error::Error trait çš„ç±»å‹ï¼Œè€Œä¸”è¿™ä¸ªç±»å‹è¢«åŒ…è£…åœ¨ Box ä¸­ã€‚è¿™æ˜¯å› ä¸ºæµ‹è¯•æ¡†æ¶éœ€è¦èƒ½å¤Ÿå¤„ç†å„ç§å¯èƒ½çš„é”™è¯¯ç±»å‹ï¼ŒåŒ…æ‹¬ç¼–è¯‘é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯ç­‰ç­‰ã€‚ä½¿ç”¨ Box<dyn std::error::Error> å¯ä»¥ä½¿æµ‹è¯•å‡½æ•°è¿”å›ä»»ä½•å®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿåœ¨æµ‹è¯•æ¡†æ¶ä¸­æ–¹ä¾¿åœ°å¤„ç†è¿™äº›é”™è¯¯ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼ŒResult&lt;(), Box<dyn std::error::Error>&gt; è¡¨ç¤ºæµ‹è¯•å‡½æ•°å¯ä»¥è¿”å›æˆåŠŸæˆ–å¤±è´¥çš„ç»“æœï¼Œä¸è¿”å›ä»»ä½•å€¼ï¼Œä½†æ˜¯å¯ä»¥è¿”å›ä»»ä½•å®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>ä»»ä½•å®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹ ä¸€èˆ¬æœ‰ä»€ä¹ˆç±»å‹åŒ…å«è¿™ç§ trait? èƒ½ä¸¾ä¾‹è¯´æ˜å˜›?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>ä»»ä½•å®ç°äº† std::error::Error trait çš„ç±»å‹éƒ½å¯ä»¥ä½œä¸ºæµ‹è¯•å‡½æ•°è¿”å›çš„é”™è¯¯ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œæ ‡å‡†åº“ä¸­çš„å¾ˆå¤šé”™è¯¯ç±»å‹éƒ½å®ç°äº† std::error::Error traitï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>std::io::Errorï¼šè¡¨ç¤º I/O æ“ä½œä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¦‚æ–‡ä»¶è¯»å†™é”™è¯¯ã€ç½‘ç»œé€šä¿¡é”™è¯¯ç­‰ã€‚</li>
<li>std::num::ParseIntErrorï¼šè¡¨ç¤ºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ—¶å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¦‚å­—ç¬¦ä¸²ä¸ç¬¦åˆæ•°å­—æ ¼å¼ç­‰ã€‚</li>
<li>std::env::VarErrorï¼šè¡¨ç¤ºè·å–ç¯å¢ƒå˜é‡æ—¶å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¦‚ç¯å¢ƒå˜é‡ä¸å­˜åœ¨ç­‰ã€‚</li>
<li>serde_json::Errorï¼šè¡¨ç¤ºå¤„ç† JSON æ•°æ®æ—¶å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¦‚ JSON æ•°æ®æ ¼å¼é”™è¯¯ç­‰ã€‚</li>
</ul>
<p>è¿™äº›ç±»å‹éƒ½å®ç°äº† std::error::Error traitï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæµ‹è¯•å‡½æ•°è¿”å›çš„é”™è¯¯ç±»å‹ã€‚åœ¨æµ‹è¯•å‡½æ•°ä¸­ï¼Œå¦‚æœæŸä¸ªæ“ä½œå‡ºç°äº†è¿™äº›é”™è¯¯ï¼Œå¯ä»¥å°†é”™è¯¯åŒ…è£…æˆ Box<dyn std::error::Error> ç±»å‹è¿”å›ï¼Œè¿™æ ·æµ‹è¯•æ¡†æ¶å°±å¯ä»¥å¤„ç†è¿™äº›é”™è¯¯å¹¶å°†å…¶è§†ä¸ºæµ‹è¯•å¤±è´¥ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>å¦‚æœè¦ä¸ºè‡ªå®šä¹‰æ–°æ•°æ®ç±»å‹è¿½åŠ è¿™ç§ trait æœ‰å“ªäº›å¯è¡Œæ–¹æ¡ˆ? ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>å¦‚æœè¦ä¸ºè‡ªå®šä¹‰çš„æ–°æ•°æ®ç±»å‹è¿½åŠ  std::error::Error traitï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯è¡Œçš„æ–¹æ¡ˆï¼š</p>
<ul>
<li>å®ç° std::error::Error traitï¼šåœ¨æ–°æ•°æ®ç±»å‹çš„å®ç°ä»£ç ä¸­æ‰‹åŠ¨å®ç° std::error::Error traitï¼ŒåŒ…æ‹¬å®ç° description æ–¹æ³•å’Œ source æ–¹æ³•ã€‚è¿™æ ·å°±å¯ä»¥å°†æ–°æ•°æ®ç±»å‹ä½œä¸ºæµ‹è¯•å‡½æ•°çš„é”™è¯¯ç±»å‹è¿”å›ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021">use std::error::Error;

#[derive(Debug)]
struct MyError {
    message: String,
}

impl std::fmt::Display for MyError {
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        write!(f, &quot;{}&quot;, self.message)
    }
}

impl Error for MyError {
    fn description(&amp;self) -&gt; &amp;str {
        &amp;self.message
    }

    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn Error + 'static)&gt; {
        None
    }
}

fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let result = Err(MyError {
        message: &quot;An error occurred&quot;.to_owned(),
    });
    result.map_err(Box::new)?;
    Ok(())
}</code></pre></pre>
<ul>
<li>ä½¿ç”¨ thiserror crateï¼šthiserror æ˜¯ä¸€ä¸ª Rust crateï¼Œå®ƒæä¾›äº†ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥å®ç° std::error::Error traitã€‚ä½¿ç”¨ thiserror crate å¯ä»¥é€šè¿‡å®æ¥è‡ªåŠ¨ç”Ÿæˆé”™è¯¯ç±»å‹çš„å®ç°ä»£ç ï¼ŒåŒ…æ‹¬å®ç° std::error::Error traitã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021">use std::error::Error;
use thiserror::Error;

#[derive(Debug, Error)]
#[error(&quot;An error occurred: {message}&quot;)]
struct MyError {
    message: String,
}

fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let result = Err(MyError {
        message: &quot;An error occurred&quot;.to_owned(),
    });
    result.map_err(Box::new)?;
    Ok(())
}
</code></pre></pre>
<p>... åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ thiserror crate å®šä¹‰äº†ä¸€ä¸ª MyError ç±»å‹ï¼Œé€šè¿‡ #[derive(Error)] å®è‡ªåŠ¨ç”Ÿæˆäº†å®ç° std::error::Error trait çš„ä»£ç ã€‚æ­¤æ—¶ï¼ŒMyError ç±»å‹å°±å¯ä»¥ä½œä¸ºæµ‹è¯•å‡½æ•°çš„é”™è¯¯ç±»å‹è¿”å›äº†ã€‚</p>
<p>æ— è®ºä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œä¸€æ—¦ä¸ºæ–°æ•°æ®ç±»å‹è¿½åŠ äº† std::error::Error traitï¼Œå°±å¯ä»¥å°†å…¶ä½œä¸ºæµ‹è¯•å‡½æ•°çš„é”™è¯¯ç±»å‹è¿”å›äº†ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ç±»å‹è¿›è¡Œæµ‹è¯•çš„ç¤ºä¾‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::error::Error;

#[derive(Debug)]
struct MyError {
    message: String,
}

impl std::fmt::Display for MyError {
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        write!(f, &quot;{}&quot;, self.message)
    }
}

impl Error for MyError {
    fn description(&amp;self) -&gt; &amp;str {
        &amp;self.message
    }

    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn Error + 'static)&gt; {
        None
    }
}

fn foo() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    Err(MyError {
        message: &quot;An error occurred&quot;.to_owned(),
    })
}

#[test]
fn test_foo() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let result = foo();
    assert!(result.is_err());
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<h3 id="crate-æ€è·¯"><a class="header" href="#crate-æ€è·¯">crate æ€è·¯</a></h3>
<blockquote>
<p>Q:</p>
</blockquote>
<p>å¦‚ä½•å°†ä¸€ä¸ª CLI å·¥å…·é¡¹ç›®å‘å¸ƒä¸ºä¸€ä¸ª crate? è¦è¿›è¡Œå“ªäº›æ”¹é€ ? ä»¥åŠè¦æ³¨æ„ä»€ä¹ˆ?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>è¦å°†ä¸€ä¸ª CLI å·¥å…·é¡¹ç›®å‘å¸ƒä¸ºä¸€ä¸ª crateï¼Œä½ éœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>å°†ä½ çš„ CLI å·¥å…·é¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªåº“ã€‚åœ¨ Rust ä¸­ï¼Œåº“æ–‡ä»¶é€šå¸¸ä»¥ lib.rs æ–‡ä»¶ä¸ºå…¥å£ç‚¹ï¼Œå¹¶å°† CLI ä»£ç é‡æ„ä¸ºå‡½æ•°æˆ–ç»“æ„ä½“æ–¹æ³•ã€‚è¿™æ ·å¯ä»¥å°†ä½ çš„ä»£ç è§£è€¦ï¼Œå¹¶ä½¿å…¶æ›´æ˜“äºæµ‹è¯•å’Œé‡ç”¨ã€‚</li>
<li>åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª Cargo.toml æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
<ul>
<li>åŒ…çš„åç§°ã€ç‰ˆæœ¬å·å’Œä½œè€…ä¿¡æ¯ã€‚</li>
<li>é¡¹ç›®çš„æè¿°ä¿¡æ¯ã€‚</li>
<li>é¡¹ç›®çš„ä¾èµ–é¡¹å’Œå…¶ç‰ˆæœ¬è¦æ±‚ã€‚</li>
<li>åŒ…çš„ç±»å‹ï¼Œä¾‹å¦‚åº“æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li>åŒ…çš„è®¸å¯è¯ç±»å‹ã€‚</li>
</ul>
</li>
<li>å°†ä½ çš„ä»£ç ä¸Šä¼ åˆ° crates.ioã€‚é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª crates.io å¸æˆ·ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ cargo login å‘½ä»¤ç™»å½•å¹¶ä¸Šä¼ ä½ çš„ä»£ç ã€‚åœ¨ä¸Šä¼ å‰ï¼Œç¡®ä¿ä½ çš„ä»£ç å·²ç»å®Œæˆäº†æµ‹è¯•ï¼Œå¹¶ä¸”åŒ…å«äº†åˆé€‚çš„æ–‡æ¡£å’Œè®¸å¯è¯ä¿¡æ¯ã€‚</li>
<li>ç»™ä½ çš„ crate æ·»åŠ æ–‡æ¡£ã€‚Rust ç¤¾åŒºéå¸¸æ³¨é‡ä»£ç æ–‡æ¡£ï¼Œå› æ­¤ä½ éœ€è¦ç¡®ä¿ä½ çš„ crate åŒ…å«äº†é€‚å½“çš„æ–‡æ¡£å’Œæ³¨é‡Šã€‚ä½ å¯ä»¥ä½¿ç”¨ Rust å†…ç½®çš„æ–‡æ¡£å·¥å…·æ¥ç”Ÿæˆæ–‡æ¡£ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ° crates.ioã€‚</li>
<li>æ›´æ–°ä½ çš„é¡¹ç›®æ–‡æ¡£å’Œ READMEã€‚åœ¨å°†ä½ çš„ crate å‘å¸ƒåˆ° crates.io åï¼Œä½ éœ€è¦æ›´æ–°ä½ çš„é¡¹ç›®æ–‡æ¡£å’Œ README æ–‡ä»¶ï¼Œä»¥ä¾¿å…¶ä»–å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä½ çš„ crateã€‚</li>
</ul>
<p>åœ¨å‘å¸ƒä½ çš„ crate å‰ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>ä½ éœ€è¦ç¡®ä¿ä½ çš„ä»£ç è´¨é‡å’Œå¯é æ€§ã€‚è¿™åŒ…æ‹¬ç¡®ä¿ä½ çš„ä»£ç é€šè¿‡äº†å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œå¹¶å°½å¯èƒ½é¿å…ä½¿ç”¨æœªç»æµ‹è¯•çš„ä¾èµ–é¡¹ã€‚</li>
<li>ä½ éœ€è¦ç¡®ä¿ä½ çš„ä»£ç ç¬¦åˆ Rust ç¤¾åŒºçš„ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µã€‚</li>
<li>ä½ éœ€è¦ç¡®ä¿ä½ çš„ crate åŒ…å«äº†é€‚å½“çš„è®¸å¯è¯ä¿¡æ¯ï¼Œå¹¶ç¡®ä¿ä½ æœ‰æƒå‘å¸ƒä½ çš„ä»£ç ã€‚</li>
<li>ä½ éœ€è¦ç¡®ä¿ä½ çš„ crate åŒ…å«äº†åˆé€‚çš„æ–‡æ¡£å’Œæ³¨é‡Šï¼Œä»¥ä¾¿å…¶ä»–å¼€å‘è€…å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ä½ çš„ä»£ç ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œå°†ä¸€ä¸ª CLI å·¥å…·é¡¹ç›®å‘å¸ƒä¸ºä¸€ä¸ª crate éœ€è¦å¯¹ä»£ç è¿›è¡Œä¸€äº›æ”¹é€ ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¯é æ€§ï¼Œå¹¶ä¸”éµå¾ª Rust ç¤¾åŒºçš„æœ€ä½³å®è·µå’Œè§„èŒƒã€‚å‘å¸ƒå‰ï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„ä»£ç åŒ…å«äº†é€‚å½“çš„æ–‡æ¡£å’Œè®¸å¯è¯ä¿¡æ¯ï¼Œå¹¶æ›´æ–°ä½ çš„é¡¹ç›®æ–‡æ¡£å’Œ README æ–‡ä»¶ã€‚</p>
<h3 id="toml-ä½œä¸ºé…ç½®"><a class="header" href="#toml-ä½œä¸ºé…ç½®">.toml ä½œä¸ºé…ç½®</a></h3>
<blockquote>
<p>Q:</p>
</blockquote>
<p>rudt ä¸­è¯»å†™ .toml æ–‡ä»¶, æœ€æ¨èçš„ create æ˜¯å“ªä¸ª? å¦‚ä½•ä½¿ç”¨?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>å¦‚æœä½ éœ€è¦åœ¨ Rust ä¸­è¯»å†™ TOML æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ toml crateã€‚è¿™ä¸ª crate å¯ä»¥åœ¨ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="language-toml">[dependencies]
toml = &quot;0.5.8&quot;
</code></pre>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ toml crate è¯»å–ä¸€ä¸ªåä¸º &quot;config.toml&quot; çš„ TOML æ–‡ä»¶ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::fs;
use toml::Value;

fn main() {
    // è¯»å–æ–‡ä»¶
    let contents = fs::read_to_string(&quot;config.toml&quot;)
        .expect(&quot;Something went wrong reading the file&quot;);

    // è§£æ TOML
    let parsed_toml: Value = toml::from_str(&amp;contents).unwrap();

    // è®¿é—®å€¼
    let title = parsed_toml[&quot;title&quot;].as_str().unwrap();
    let subtitle = parsed_toml[&quot;subtitle&quot;].as_str().unwrap();

    println!(&quot;{}: {}&quot;, title, subtitle);
}</code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ fs::read_to_string å‡½æ•°è¯»å– TOML æ–‡ä»¶çš„å†…å®¹ã€‚ç„¶åï¼Œä½¿ç”¨ toml::from_str å‡½æ•°å°†å†…å®¹è§£æä¸º toml::Value ç±»å‹çš„å€¼ã€‚æ¥ä¸‹æ¥ï¼Œå¯ä»¥è®¿é—®è§£æåçš„ TOML å€¼ï¼Œä¾‹å¦‚ parsed_toml[&quot;title&quot;].as_str().unwrap() ç”¨äºè·å– TOML æ–‡ä»¶ä¸­çš„ &quot;title&quot; å€¼ã€‚æœ€åï¼Œå°†è¿™äº›å€¼æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p>
<p>å¦‚æœä½ éœ€è¦å°†æ•°æ®å†™å…¥ TOML æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ toml crate çš„ to_string å‡½æ•°å°† toml::Value ç±»å‹çš„å€¼è½¬æ¢ä¸º TOML æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨ fs::write å‡½æ•°å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ toml crate å†™å…¥ä¸€ä¸ªåä¸º &quot;config.toml&quot; çš„ TOML æ–‡ä»¶ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::fs;
use toml::Value;

fn main() {
    // åˆ›å»ºä¸€ä¸ª `toml::Value` ç±»å‹çš„å€¼
    let mut toml_value = Value::new();
    toml_value[&quot;title&quot;] = &quot;My Title&quot;.into();
    toml_value[&quot;subtitle&quot;] = &quot;My Subtitle&quot;.into();

    // å°†å€¼è½¬æ¢ä¸º TOML æ ¼å¼çš„å­—ç¬¦ä¸²
    let toml_str = toml::to_string(&amp;toml_value).unwrap();

    // å†™å…¥æ–‡ä»¶
    fs::write(&quot;config.toml&quot;, toml_str).expect(&quot;Something went wrong writing the file&quot;);
}
</code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª toml::Value ç±»å‹çš„å€¼ï¼Œè¯¥å€¼åŒ…å«è¦å†™å…¥ TOML æ–‡ä»¶çš„æ•°æ®ã€‚ç„¶åï¼Œä½¿ç”¨ toml::to_string å‡½æ•°å°†è¯¥å€¼è½¬æ¢ä¸º TOML æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚æœ€åï¼Œä½¿ç”¨ fs::write å‡½æ•°å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ã€‚</p>
<h3 id="å±•å¼€-bufreader"><a class="header" href="#å±•å¼€-bufreader">å±•å¼€ BufReader</a></h3>
<blockquote>
<p>Q:</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;

fn main() -&gt; std::io::Result&lt;()&gt; {
    let f = File::open(&quot;log.txt&quot;)?;
    let mut reader = BufReader::new(f);

    let mut line = String::new();
    let len = reader.read_line(&amp;mut line)?;
    println!(&quot;First line is {} bytes long&quot;, len);
    Ok(())
}</code></pre></pre>
<p>å¦‚ä½•å°†è¿™æ®µä»£ç ä¿®æ”¹ä¸ºå¾ªç¯å°†æŒ‡å®šæ–‡ä»¶æ‰€æœ‰è¡Œå†…å®¹é€ä¸€è¾“å‡º?</p>
<blockquote>
<p>PS: ä» <a href="https://doc.rust-lang.org/1.39.0/std/io/struct.BufReader.html#examples">std::io::BufReader - Rust</a> æŠ„çš„</p>
</blockquote>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>è¦å¾ªç¯è¾“å‡ºæ–‡ä»¶çš„æ‰€æœ‰è¡Œå†…å®¹ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä½¿ç”¨BufReaderçš„read_lineæ–¹æ³•ã€‚æ¯æ¬¡è¿­ä»£æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè¯»å–æ–‡ä»¶ä¸­çš„ä¸€è¡Œï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç»™å®šçš„å­—ç¬¦ä¸²å˜é‡ä¸­ã€‚å½“æ²¡æœ‰æ›´å¤šçš„è¡Œå¯ä»¥è¯»å–æ—¶ï¼Œè¯¥æ–¹æ³•å°†è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º0çš„ç»“æœï¼Œè¿™æ˜¯è·³å‡ºå¾ªç¯çš„ä¿¡å·ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¿®æ”¹åçš„ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;

fn main() -&gt; std::io::Result&lt;()&gt; {
    let f = File::open(&quot;log.txt&quot;)?;
    let reader = BufReader::new(f);

    for line in reader.lines() {
        println!(&quot;{}&quot;, line?);
    }
    Ok(())
}</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†reader.lines()æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªstd::io::Linesè¿­ä»£å™¨ã€‚æ¯æ¬¡è¿­ä»£æ—¶ï¼Œè¯¥è¿­ä»£å™¨éƒ½ä¼šè¯»å–æ–‡ä»¶ä¸­çš„ä¸€è¡Œï¼Œå¹¶å°†å…¶åŒ…è£…åœ¨ä¸€ä¸ªstd::io::Result<String>ä¸­è¿”å›ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨?æ“ä½œç¬¦æ¥è§£åŒ…è¿™ä¸ªç»“æœï¼Œå¦‚æœè¯»å–å¤±è´¥ï¼Œå®ƒä¼šå°†é”™è¯¯ä¼ æ’­åˆ°mainå‡½æ•°çš„è°ƒç”¨æ–¹ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€è¡Œè¯»å–æ–‡ä»¶å¹¶å°†æ¯ä¸€è¡Œå†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p>
<blockquote>
<p>Q:
std::io::prelude æ˜¯ä»€ä¹ˆåº“? å¼•ç”¨äº†ä»€ä¹ˆè¿›æ¥? ç”¨åœ¨å“ªå„¿äº†?</p>
</blockquote>
<blockquote>
<p>GPT:</p>
</blockquote>
<p><code>std::io::prelude</code> æ˜¯ä¸€ä¸ªæ¨¡å—ï¼ŒåŒ…å«äº†ä¸€äº›å¸¸è§çš„ I/O trait å’Œç±»å‹çš„é¢„å®šä¹‰å¯¼å…¥ã€‚è¿™äº›é¢„å®šä¹‰å¯¼å…¥ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°ä½¿ç”¨ Rust æ ‡å‡†åº“ä¸­çš„ I/O åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†å¤§é‡çš„ä»£ç é‡å¤ã€‚</p>
<p>åœ¨ Rust ä»£ç ä¸­ï¼Œé€šè¿‡å¼•å…¥std::io::preludeæ¨¡å—æ¥ä½¿ç”¨é¢„å®šä¹‰å¯¼å…¥ï¼Œé€šå¸¸ä¼šå‡ºç°åœ¨å¤„ç† I/O ç›¸å…³æ“ä½œçš„ä»£ç ä¸­ã€‚è¿™ä¸ªæ¨¡å—åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ª trait çš„é¢„å®šä¹‰å¯¼å…¥ï¼š</p>
<ul>
<li>Read: ç”¨äºè¯»å–æ•°æ®çš„ traitã€‚</li>
<li>BufRead: ç”¨äºè¯»å–ç¼“å†²åŒºçš„ traitã€‚</li>
<li>Write: ç”¨äºå†™å…¥æ•°æ®çš„ traitã€‚</li>
</ul>
<p>è¿™äº› trait éƒ½è¢«ç”¨äºåœ¨ Rust ä¸­è¿›è¡Œ I/O æ“ä½œï¼Œå› æ­¤å®ƒä»¬ç»å¸¸ä¼šè¢«å…¶ä»–çš„ I/O æ¨¡å—æˆ–åº“ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢æä¾›çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†std::io::preludeæ¥å¯¼å…¥Read traitï¼Œä»è€Œä½¿ç”¨BufReaderçš„read_lineæ–¹æ³•è¯»å–æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹ã€‚</p>
<blockquote>
<p>A: 
å¦‚ä½•å¯¹å¾ªç¯ä¸­çš„ line è¿›è¡Œç±»ä¼¼ contains çš„åˆ¤å®šå‘¢?</p>
</blockquote>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>è¦å¯¹è¯»å–çš„æ¯ä¸€è¡Œå†…å®¹è¿›è¡ŒåŒ…å«ï¼ˆcontainsï¼‰çš„åˆ¤å®šï¼Œæ‚¨å¯ä»¥åœ¨forå¾ªç¯å†…ä½¿ç”¨ifè¯­å¥ï¼Œå¯¹æ¯ä¸€è¡Œè¿›è¡Œæ£€æŸ¥ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;

fn main() -&gt; std::io::Result&lt;()&gt; {
    let f = File::open(&quot;log.txt&quot;)?;
    let reader = BufReader::new(f);

    for line in reader.lines() {
        let line_content = line?;
        if line_content.contains(&quot;Error&quot;) {
            println!(&quot;{}&quot;, line_content);
        }
    }
    Ok(())
}</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨containsæ–¹æ³•æ£€æŸ¥æ¯ä¸€è¡Œå†…å®¹æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²&quot;Error&quot;ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°†è¯¥è¡Œå†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†è·³è¿‡è¯¥è¡Œå¹¶ç»§ç»­è¯»å–æ–‡ä»¶çš„ä¸‹ä¸€è¡Œã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>å¯¹åº”ä»£ç ä¿®æ”¹ä¸º:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    let f = File::open(&amp;args.path)
        .expect(&quot;could NOT read the file&quot;);
    let reader = BufReader::new(f);

    let mut line = String::new();
    for line in reader.lines() {
            let line_content = line?;
            if line_content.contains(&quot;Error&quot;) {
                println!(&quot;{}&quot;, line_content);
            }
        }
<span class="boring">}</span></code></pre></pre>
<p>ä½†æ˜¯æŠ¥é”™:</p>
<pre><code>error[E0277]: the `?` operator can only be used in a function that returns `Result` or `Option` (or another type that implements `FromResidual`)
  --&gt; src/main.rs:66:36
   |
24 | fn main() {
   | --------- this function should return `Result` or `Option` to accept `?`
...
66 |             let line_content = line?;
   |                                    ^ cannot use the `?` operator in a function that returns `()`
   |
   = help: the trait `FromResidual&lt;Result&lt;Infallible, std::io::Error&gt;&gt;` is not implemented for `()`

For more information about this error, try `rustc --explain E0277`.
</code></pre>
<p>åº”è¯¥å¦‚ä½•è§£å†³?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>è¯¥é”™è¯¯æ˜¯å› ä¸ºåœ¨mainå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨å¾ªç¯ä¸­ä½¿ç”¨?æ“ä½œç¬¦ã€‚?æ“ä½œç¬¦åªèƒ½ç”¨äºè¿”å›Resultæˆ–Optionçš„å‡½æ•°æˆ–æ–¹æ³•ä¸­ï¼Œå®ƒä¼šåœ¨å‘ç”Ÿé”™è¯¯æ—¶è‡ªåŠ¨å°†é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<p>åœ¨mainå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å¤„ç†é”™è¯¯å¹¶å†³å®šå¦‚ä½•å¤„ç†å®ƒä»¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†é”™è¯¯æ‰“å°åˆ°æ§åˆ¶å°ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;
use std::env;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();
    if args.len() != 2 {
        println!(&quot;Usage: {} &lt;path_to_file&gt;&quot;, args[0]);
        return;
    }

    let f = File::open(&amp;args[1]).expect(&quot;Could not read file&quot;);
    let reader = BufReader::new(f);

    for line in reader.lines() {
        if let Ok(line_content) = line {
            if line_content.contains(&quot;Error&quot;) {
                println!(&quot;{}&quot;, line_content);
            }
        } else {
            eprintln!(&quot;Error while reading file&quot;);
            return;
        }
    }
}</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨if letè¯­å¥æ£€æŸ¥è¯»å–æ¯ä¸€è¡Œæ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸï¼Œæˆ‘ä»¬æ£€æŸ¥è¡Œå†…å®¹æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²&quot;Error&quot;ï¼Œå¦‚æœæ˜¯åˆ™å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚å¦‚æœè¯»å–è¡Œæ—¶å‘ç”Ÿé”™è¯¯ï¼Œæˆ‘ä»¬å°†é”™è¯¯æ‰“å°åˆ°æ ‡å‡†é”™è¯¯æµï¼ˆstderrï¼‰ï¼Œå¹¶é€€å‡ºç¨‹åºã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>çœ‹èµ·æ¥è¿™é‡Œæœ‰å¤šå±‚ if ä¸æ˜¯å¾ˆ rusty, æœ‰å…¶å®ƒæ–¹æ¡ˆæ¥è¾¾æˆç›¸åŒæ•ˆæœå˜›?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>æ‚¨å¯ä»¥ä½¿ç”¨matchè¯­å¥æ¥ä»£æ›¿åµŒå¥—çš„if letè¯­å¥ï¼Œä»¥é¿å…å¤šå±‚åµŒå¥—å’Œæé«˜ä»£ç å¯è¯»æ€§ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨matchè¯­å¥é‡å†™çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;
use std::env;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();
    if args.len() != 2 {
        println!(&quot;Usage: {} &lt;path_to_file&gt;&quot;, args[0]);
        return;
    }

    let f = File::open(&amp;args[1]).expect(&quot;Could not read file&quot;);
    let reader = BufReader::new(f);

    for line in reader.lines() {
        match line {
            Ok(line_content) =&gt; {
                if line_content.contains(&quot;Error&quot;) {
                    println!(&quot;{}&quot;, line_content);
                }
            }
            Err(_) =&gt; {
                eprintln!(&quot;Error while reading file&quot;);
                return;
            }
        }
    }
}</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨matchè¯­å¥åŒ¹é…lineçš„å€¼ã€‚å¦‚æœè¯»å–è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬ä½¿ç”¨Ok(line_content)åˆ†æ”¯æ¥å¤„ç†è¡Œå†…å®¹ï¼Œå¦‚æœè¡Œå†…å®¹åŒ…å«å­—ç¬¦ä¸²&quot;Error&quot;ï¼Œåˆ™å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚å¦‚æœè¯»å–è¡Œæ—¶å‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬ä½¿ç”¨Err(_)åˆ†æ”¯æ¥å¤„ç†é”™è¯¯ï¼Œå¹¶å°†é”™è¯¯æ‰“å°åˆ°æ ‡å‡†é”™è¯¯æµï¼ˆstderrï¼‰ï¼Œå¹¶é€€å‡ºç¨‹åºã€‚</p>
<p>ç›¸æ¯”ä½¿ç”¨åµŒå¥—çš„if letè¯­å¥ï¼Œmatchè¯­å¥æ›´åŠ æ¸…æ™°å’Œç®€æ´ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>æ²¡é”™, match çœ‹èµ·æ¥ä¼˜é›…å¤šäº†, ä¸è¿‡, è¿˜æœ‰å…¶å®ƒæ–¹æ¡ˆå˜›?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>æ˜¯çš„ï¼Œé™¤äº†ä½¿ç”¨matchè¯­å¥ï¼Œè¿˜æœ‰ä¸€ç§æ›´ç®€æ´çš„æ–¹æ³•æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚å¯ä»¥ä½¿ç”¨filter_mapæ–¹æ³•å’Œstd::result::Result::okå‡½æ•°æ¥è¿‡æ»¤è¡Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºå¯é€‰çš„å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨forå¾ªç¯è¿­ä»£è¿™äº›å­—ç¬¦ä¸²å¹¶å°†å®ƒä»¬æ‰“å°å‡ºæ¥ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨filter_mapå’Œstd::result::Result::okå‡½æ•°çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;
use std::env;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();
    if args.len() != 2 {
        println!(&quot;Usage: {} &lt;path_to_file&gt;&quot;, args[0]);
        return;
    }

    let f = File::open(&amp;args[1]).expect(&quot;Could not read file&quot;);
    let reader = BufReader::new(f);

    for line in reader.lines().filter_map(Result::ok).filter(|line| line.contains(&quot;Error&quot;)) {
        println!(&quot;{}&quot;, line);
    }
}
</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨filter_mapæ–¹æ³•æ¥è¿‡æ»¤æ‰é‚£äº›è¯»å–è¡Œæ—¶è¿”å›é”™è¯¯çš„è¡Œï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¯é€‰çš„å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨filteræ–¹æ³•æ¥è¿‡æ»¤æ‰é‚£äº›ä¸åŒ…å«å­—ç¬¦ä¸²&quot;Error&quot;çš„è¡Œã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨forå¾ªç¯è¿­ä»£è¿™äº›å­—ç¬¦ä¸²ï¼Œå¹¶å°†å®ƒä»¬æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p>
<p>ç›¸æ¯”ä½¿ç”¨matchè¯­å¥å’ŒåµŒå¥—çš„if letè¯­å¥ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ ç®€æ´å’Œä¼˜é›…ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„æ–¹æ¡ˆå˜›?</p>
<blockquote>
<p>GPT:
å½“ç„¶ï¼ŒRust çš„æ ‡å‡†åº“æä¾›äº†éå¸¸å¼ºå¤§çš„è¿­ä»£å™¨å’Œå‡½æ•°å¼ç¼–ç¨‹å·¥å…·ç®±ï¼Œå¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´å’Œä¼˜é›…ã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨filteræ–¹æ³•å’Œé—­åŒ…æ¥è¿‡æ»¤æ‰ä¸åŒ…å«&quot;Error&quot;çš„è¡Œï¼Œç„¶åä½¿ç”¨mapæ–¹æ³•å’Œunwrapå‡½æ•°å°†å¯é€‰çš„è¡Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚è¿™æ˜¯ä»£ç çš„ç¤ºä¾‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::prelude::*;
use std::io::BufReader;
use std::fs::File;
use std::env;

fn main() {
    let args: Vec&lt;String&gt; = env::args().collect();
    if args.len() != 2 {
        println!(&quot;Usage: {} &lt;path_to_file&gt;&quot;, args[0]);
        return;
    }

    let f = File::open(&amp;args[1]).expect(&quot;Could not read file&quot;);
    let reader = BufReader::new(f);

    reader.lines()
          .filter(|line| line.as_ref().map(|s| s.contains(&quot;Error&quot;)).unwrap_or(false))
          .map(|line| line.unwrap())
          .for_each(|line| println!(&quot;{}&quot;, line));
}</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨filteræ–¹æ³•æ¥è¿‡æ»¤æ‰é‚£äº›ä¸åŒ…å«å­—ç¬¦ä¸²&quot;Error&quot;çš„è¡Œã€‚ç”±äºlinesæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«Result&lt;Option<String>&gt;çš„è¿­ä»£å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é—­åŒ…ä¸­ä½¿ç”¨as_refæ–¹æ³•æ¥å°†Result&lt;Option<String>&gt;è½¬æ¢ä¸ºOption&lt;&amp;String&gt;ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨mapæ–¹æ³•å’Œunwrapå‡½æ•°æ¥å°†å¯é€‰çš„è¡Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚</p>
<p>ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»£ç è¿›ä¸€æ­¥ç®€åŒ–ï¼Œå¹¶æ›´åŠ æ¸…æ™°åœ°è¡¨è¾¾æˆ‘ä»¬çš„æ„å›¾ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>æ²¡é”™, è¿™æ ·åˆç®€æ´,åˆæ•´é½,è€Œä¸”æ„ä¹‰æ˜ç¡®;
çœ‹èµ·æ¥ è¿­ä»£å™¨å’Œå‡½æ•°å¼å·¥å…·æœ‰å¾ˆå¤š, ç±»ä¼¼ filter å’Œ map çš„å†…ç½®å·¥å…·è¿˜æœ‰å“ªäº›? åˆ†åˆ«æœ‰ä»€ä¹ˆä¼˜é›…çš„å®ç”¨æ¡ˆä¾‹?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>Rust çš„æ ‡å‡†åº“æä¾›äº†ä¸°å¯Œçš„è¿­ä»£å™¨å’Œå‡½æ•°å¼ç¼–ç¨‹å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>mapï¼šå°†ä¸€ä¸ªè¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„å…ƒç´ ï¼Œé€šå¸¸ç”¨äºæ•°æ®ç±»å‹è½¬æ¢å’Œè®¡ç®—ã€‚
<ul>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3, 4, 5];
let squares: Vec&lt;i32&gt; = numbers.iter().map(|n| n * n).collect();
// squares is [1, 4, 9, 16, 25]
<span class="boring">}</span></code></pre></pre>
<ul>
<li>filterï¼šæ ¹æ®æŸä¸ªæ¡ä»¶è¿‡æ»¤å‡ºè¿­ä»£å™¨ä¸­çš„å…ƒç´ ï¼Œé€šå¸¸ç”¨äºæ•°æ®è¿‡æ»¤å’Œç­›é€‰ã€‚
<ul>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3, 4, 5];
let evens: Vec&lt;i32&gt; = numbers.iter().filter(|n| n % 2 == 0).collect();
// evens is [2, 4]
<span class="boring">}</span></code></pre></pre>
<ul>
<li>foldï¼šä½¿ç”¨æŸç§ç´¯åŠ å™¨ï¼ˆåˆå§‹å€¼ï¼‰å’Œä¸€ä¸ªé—­åŒ…æ¥èšåˆè¿­ä»£å™¨ä¸­çš„å…ƒç´ ï¼Œé€šå¸¸ç”¨äºæ±‚å’Œã€å¹³å‡å€¼å’Œå­—ç¬¦ä¸²æ‹¼æ¥ç­‰æ“ä½œã€‚
<ul>
<li>ç¤ºä¾‹ï¼šè®¡ç®—ä¸€ä¸ªæ•°å­—å‘é‡ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3, 4, 5];
let sum: i32 = numbers.iter().fold(0, |acc, n| acc + n);
// sum is 15
<span class="boring">}</span></code></pre></pre>
<ul>
<li>flat_mapï¼šå°†ä¸€ä¸ªè¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç„¶åå°†æ‰€æœ‰çš„è¿­ä»£å™¨åˆå¹¶ä¸ºä¸€ä¸ªè¿­ä»£å™¨ã€‚
<ul>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let words = vec![&quot;hello world&quot;, &quot;foo bar&quot;, &quot;baz qux&quot;];
let letters: Vec&lt;char&gt; = words.iter().flat_map(|s| s.chars()).collect();
// letters is ['h', 'e', 'l', 'l', 'o', ' ', 'w', 'o', 'r', 'l', 'd', 'f', 'o', 'o', ' ', 'b', 'a', 'r', 'b', 'a', 'z', ' ', 'q', 'u', 'x']
<span class="boring">}</span></code></pre></pre>
<ul>
<li>any å’Œ allï¼šæ£€æŸ¥è¿­ä»£å™¨ä¸­æ˜¯å¦å­˜åœ¨ä»»æ„å…ƒç´ æˆ–æ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³æŸä¸ªæ¡ä»¶ã€‚
<ul>
<li>ç¤ºä¾‹ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3, 4, 5];
let any_odd = numbers.iter().any(|n| n % 2 == 1);
let all_even = numbers.iter().all(|n| n % 2 == 0);
// any_odd is true, all_even is false
<span class="boring">}</span></code></pre></pre>
<ul>
<li>enumerate: æšä¸¾è¿­ä»£å™¨ä¸­çš„å…ƒç´ ï¼Œå¹¶å°†å…ƒç´ ç´¢å¼•å’Œå€¼ç»„æˆä¸€ä¸ªå…ƒç»„è¿”å›ã€‚
<ul>
<li>ç¤ºä¾‹ï¼šéå†ä¸€ä¸ªå­—ç¬¦ä¸²å‘é‡å¹¶æ‰“å°æ¯ä¸ªå…ƒç´ çš„ç´¢å¼•å’Œå€¼ã€‚</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let v = vec![&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;];
for (i, s) in v.iter().enumerate() {
    println!(&quot;{}: {}&quot;, i, s);
}

<span class="boring">}</span></code></pre></pre>
<ul>
<li>zipï¼šå°†ä¸¤ä¸ªè¿­ä»£å™¨åˆå¹¶ä¸ºä¸€ä¸ªå…ƒç´ å¯¹çš„è¿­ä»£å™¨ã€‚
<ul>
<li>ç¤ºä¾‹ï¼šä»ä¸¤ä¸ªå‘é‡ä¸­å–å‡ºå¯¹åº”ä½ç½®çš„å…ƒç´ å¹¶ç»„æˆä¸€ä¸ªæ–°çš„å‘é‡</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3];
let letters = vec!['a', 'b', 'c'];
let pairs: Vec&lt;(i32, char)&gt; = numbers.iter().zip(letters.iter()).collect();
// pairs is [(1, 'a'), (2, 'b'), (3, 'c')]

<span class="boring">}</span></code></pre></pre>
<p>å½“ä½¿ç”¨è¿­ä»£å™¨å¤„ç†æ•°æ®æ—¶ï¼Œæœ‰æ—¶éœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†æ®µå¤„ç†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ take å’Œ skip æ–¹æ³•ã€‚</p>
<ul>
<li>takeï¼šä»ä¸€ä¸ªé›†åˆä¸­å–å‡ºå‰å‡ ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼Œä»ä¸€ä¸ªåŒ…å«æ‰€æœ‰äººçš„å‘é‡ä¸­å–å‡ºå‰ 10 ä¸ªäººã€‚
<ul>
<li>take(n) æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼Œå®ƒåªåŒ…å«åŸå§‹è¿­ä»£å™¨çš„å‰ n ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3, 4, 5];
let first_three = numbers.iter().take(3);
for number in first_three {
    println!(&quot;{}&quot;, number);
}
// è¾“å‡º:
// 1
// 2
// 3
<span class="boring">}</span></code></pre></pre>
<ul>
<li>skipï¼šè·³è¿‡ä¸€ä¸ªé›†åˆä¸­çš„å‰å‡ ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼Œä»ä¸€ä¸ªåŒ…å«æ‰€æœ‰äººçš„å‘é‡ä¸­è·³è¿‡å‰ 10 ä¸ªäººï¼Œç„¶åè¿”å›å‰©ä½™çš„æ‰€æœ‰äººã€‚
<ul>
<li>skip(n) æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼Œå®ƒè·³è¿‡åŸå§‹è¿­ä»£å™¨çš„å‰ n ä¸ªå…ƒç´ ï¼Œç„¶åè¿­ä»£å…¶ä½™çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers = vec![1, 2, 3, 4, 5];
let last_two = numbers.iter().skip(3);
for number in last_two {
    println!(&quot;{}&quot;, number);
}
// è¾“å‡º:
// 4
// 5

<span class="boring">}</span></code></pre></pre>
<ul>
<li>chainï¼šå°†ä¸¤ä¸ªé›†åˆè¿æ¥åœ¨ä¸€èµ·ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„é›†åˆã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç”·æ€§çš„å‘é‡å’Œä¸€ä¸ªåŒ…å«æ‰€æœ‰å¥³æ€§çš„å‘é‡è¿æ¥åœ¨ä¸€èµ·ï¼Œç„¶åè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰äººçš„å‘é‡ã€‚
<ul>
<li>å¦ä¸€ä¸ªå¸¸è§çš„è¿­ä»£å™¨æ–¹æ³•æ˜¯ chain æ–¹æ³•ã€‚å®ƒæ¥æ”¶å¦ä¸€ä¸ªè¿­ä»£å™¨ä½œä¸ºå‚æ•°ï¼Œå°†å…¶æ·»åŠ åˆ°å½“å‰è¿­ä»£å™¨çš„æœ«å°¾ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let numbers1 = vec![1, 2, 3];
let numbers2 = vec![4, 5, 6];
let all_numbers = numbers1.iter().chain(numbers2.iter());
for number in all_numbers {
    println!(&quot;{}&quot;, number);
}
// è¾“å‡º:
// 1
// 2
// 3
// 4
// 5
// 6

<span class="boring">}</span></code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸¤ä¸ªå‘é‡ numbers1 å’Œ numbers2ï¼Œç„¶åå°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ all_numbersã€‚æœ€åï¼Œæˆ‘ä»¬éå† all_numbers å¹¶è¾“å‡ºå…¶ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<p>è¿™äº›æ˜¯ Rust ä¸­ä¸€äº›å¸¸è§çš„è¿­ä»£å™¨æ–¹æ³•å’Œå‡½æ•°å¼å·¥å…·ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥é€‰æ‹©ä½¿ç”¨å®ƒä»¬ã€‚åœ¨ Rust ä¸­ï¼Œè¿­ä»£å™¨å’Œå‡½æ•°å¼ç¼–ç¨‹è¢«å¹¿æ³›åº”ç”¨äºå„ç§åœºæ™¯ï¼Œä¾‹å¦‚å¤„ç†é›†åˆã€è¿‡æ»¤å’Œæ’åºæ•°æ®ã€å¤„ç†æ–‡æœ¬ç­‰ç­‰ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæ‚¨å¯ä»¥ç¼–å†™æ›´åŠ ç®€æ´ã€ä¼˜é›…ã€é«˜æ•ˆå’Œå®‰å…¨çš„ä»£ç ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>å‘ç°è¿˜æœ‰ try_fold ä¹‹ç±»å¸¦æœ‰ try_ çš„è¿­ä»£å™¨,ä¸€èˆ¬æ˜¯ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ä¸­çš„?</p>
<blockquote>
<p>GPT:</p>
</blockquote>
<p>try_fold æ–¹æ³•æ˜¯ä¸€ä¸ªå¸¦æœ‰ try_ å‰ç¼€çš„è¿­ä»£å™¨æ–¹æ³•ï¼Œå®ƒç±»ä¼¼äº fold æ–¹æ³•ï¼Œä½†æ˜¯å®ƒå…è®¸åœ¨è¿­ä»£å™¨å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå¹¶å°†é”™è¯¯ä¼ é€’ç»™è°ƒç”¨æ–¹è¿›è¡Œå¤„ç†ã€‚try_fold æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯é€šå¸¸æ˜¯å¤„ç†å¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œçš„è¿­ä»£å™¨å…ƒç´ åºåˆ—ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚æˆ–æ–‡ä»¶ I/O æ“ä½œã€‚</p>
<p>try_fold æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªåˆå§‹ç´¯åŠ å™¨å’Œä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…å°†å½“å‰ç´¯åŠ å™¨çš„å€¼å’Œè¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª Result å€¼ã€‚å¦‚æœé—­åŒ…è¿”å›ä¸€ä¸ª Ok å€¼ï¼Œåˆ™ try_fold æ–¹æ³•ä¼šç»§ç»­è¿­ä»£ã€‚å¦‚æœé—­åŒ…è¿”å›ä¸€ä¸ª Err å€¼ï¼Œåˆ™ try_fold æ–¹æ³•ä¼šç«‹å³åœæ­¢è¿­ä»£å¹¶å°†é”™è¯¯ä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ try_fold æ–¹æ³•æ¥è®¡ç®—å‘é‡ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ Result&lt;i32, String&gt; ç±»å‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
    let vec = vec![Ok(1), Ok(2), Err(&quot;failed&quot;.to_string()), Ok(3)];
    let sum = vec
        .into_iter()
        .try_fold(0, |acc, x| x.map(|n| acc + n));
    match sum {
        Ok(result) =&gt; println!(&quot;Sum is {}&quot;, result),
        Err(error) =&gt; println!(&quot;Error: {}&quot;, error),
    }
}</code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå‘é‡ vecï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ª Ok å€¼å’Œä¸€ä¸ª Err å€¼ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ into_iter æ–¹æ³•å°†å‘é‡è½¬æ¢ä¸ºè¿­ä»£å™¨ï¼Œä½¿ç”¨ try_fold æ–¹æ³•æ¥è®¡ç®—æ‰€æœ‰å…ƒç´ çš„å’Œï¼Œå…¶ä¸­ä½¿ç”¨ map æ–¹æ³•å°† Ok å€¼æ˜ å°„åˆ°å®ƒä»¬çš„æ•´æ•°å€¼ï¼Œå¹¶å¿½ç•¥ Err å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ match æ¥å¤„ç†å¯èƒ½çš„é”™è¯¯å’Œç»“æœã€‚</p>
<h2 id="refer-4"><a class="header" href="#refer-4">refer.</a></h2>
<blockquote>
<p>å…¶å®å®˜æ–¹çš„æ–‡æ¡£åƒé€, åŸºæœ¬å¯ä»¥å¹³è¶Ÿ 80% çš„æ—¥å¸¸å¼€å‘äº†...</p>
</blockquote>
<ul>
<li>ğŸŒğŸ¦€ <a href="https://github.com/sigoden/aichat" title="sigoden/aichat: Chat with ChatGPT-3.5 in the terminal.">sigoden/aichat: Chat with ChatGPT-3.5 in the terminal.</a>
<ul>
<li><a href="https://github.com/f/awesome-chatgpt-prompts">f/awesome-chatgpt-prompts: This repo includes ChatGPT prompt curation to use ChatGPT better.</a> ~ æç¤ºå·¥ç¨‹å¸ˆæŠ€å·§...</li>
<li>...</li>
</ul>
</li>
<li>std::
<ul>
<li><a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#">Iterator in std::iter - Rust</a></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h2 id="logging-4"><a class="header" href="#logging-4">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230224 ZQ init.</li>
</ul>
<pre><code>          _~^~`~_
      () /  - â—¶  \ \/
        '_   â   _'
        &gt; '--+--' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dynåŠ¨é™æ€å¤šæ€åˆæ­¥"><a class="header" href="#dynåŠ¨é™æ€å¤šæ€åˆæ­¥">dyn:åŠ¨/é™æ€å¤šæ€åˆæ­¥</a></h1>
<blockquote>
<p>å­¦ä¼´ChatGPT, chatting for debugging ...</p>
</blockquote>
<h2 id="background-5"><a class="header" href="#background-5">background</a></h2>
<blockquote>
<p>Rust ä¸­æ–‡ç¤¾åŒºä¸­çš„è®¨è®º...</p>
</blockquote>
<p><img src="https://ipic.zoomquiet.top/2023-02-28-%E9%A3%9E%E4%B9%A620230228-150444.jpg" alt="è¿™ç§ç”¨if letå°±ä¼šæŠ¥é”™ï¼Œå¿…é¡»åˆ†å¼€å†™å—" /></p>
<h2 id="goal-5"><a class="header" href="#goal-5">goal</a></h2>
<p>åˆç†å®Œæˆè°ƒè¯•...</p>
<h2 id="trace-5"><a class="header" href="#trace-5">trace</a></h2>
<p>æœ‰åŒå­¦å»ºè®®:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if let Ok(exists) = conn.exists::&lt;bool, _&gt;(key).await {
    unimplemented!()
}
<span class="boring">}</span></code></pre></pre>
<p>äºæ˜¯å¼€å§‹æ¢é—®:</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>if let Ok(exists) = conn.exists::&lt;bool, _&gt;(key).await {
}
è¿™å¥ä»£ç ä»€ä¹ˆæ„æ€?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>è¿™å¥ä»£ç æ˜¯Rustè¯­è¨€çš„ä»£ç ï¼Œç”¨äºåœ¨Redisæ•°æ®åº“ä¸­æ£€æŸ¥æŒ‡å®šé”®æ˜¯å¦å­˜åœ¨ï¼Œå¹¶å¼‚æ­¥åœ°è¿”å›ä¸€ä¸ªç»“æœã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç é¦–å…ˆè°ƒç”¨ä¸€ä¸ªRedisè¿æ¥å¯¹è±¡ï¼ˆconnï¼‰ä¸Šçš„existsæ–¹æ³•æ¥æ£€æŸ¥ç»™å®šçš„keyæ˜¯å¦å­˜åœ¨ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªResult&lt;bool, _&gt;ç±»å‹çš„ç»“æœï¼Œå…¶ä¸­Okè¡¨ç¤ºæ£€æŸ¥æ“ä½œæˆåŠŸï¼Œexistsè¡¨ç¤ºæŒ‡å®šçš„keyå­˜åœ¨ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼ˆ_è¡¨ç¤ºä»»æ„çš„é”™è¯¯ç±»å‹ï¼‰ã€‚</p>
<p>ç„¶åï¼Œè¿™æ®µä»£ç ä½¿ç”¨if letè¯­æ³•ï¼Œå°†è¿”å›çš„ç»“æœç»‘å®šåˆ°ä¸€ä¸ªåä¸ºexistsçš„å˜é‡ä¸Šã€‚å¦‚æœexistsæ˜¯Okç±»å‹ï¼Œåˆ™æ„å‘³ç€æ£€æŸ¥æ“ä½œæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥ç»§ç»­æ‰§è¡Œifä»£ç å—ä¸­çš„é€»è¾‘æ¥å¤„ç†keyå­˜åœ¨çš„æƒ…å†µã€‚åä¹‹ï¼Œå¦‚æœexistsæ˜¯Errç±»å‹ï¼Œåˆ™æ„å‘³ç€æ£€æŸ¥æ“ä½œå¤±è´¥ï¼Œå¹¶ä¸”éœ€è¦åœ¨elseä»£ç å—ä¸­å¤„ç†é”™è¯¯æƒ…å†µã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>ä¸€èˆ¬åœ¨ else ä¸­å¦‚å¦‚ä½•å¤„ç†é”™è¯¯?
å¦‚æœ exists æ˜¯ Ok , è¿™æ—¶ é‚£ä¸ª key æ˜¯å¦‚ä½•è¿›å…¥ if ä»£ç å—è¿›è¡Œå¤„ç†çš„?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>åœ¨ else ä¸­ï¼Œä¸€èˆ¬ä¼šå¤„ç†æ£€æŸ¥æ“ä½œå¤±è´¥çš„æƒ…å†µï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ã€è¿”å›é”™è¯¯ä¿¡æ¯ç­‰ã€‚å…·ä½“å¦‚ä½•å¤„ç†é”™è¯¯ï¼Œå–å†³äºä»£ç çš„è®¾è®¡å’Œä¸šåŠ¡éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†åœ¨ else ä¸­å¦‚ä½•è®°å½•é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if let Ok(exists) = conn.exists::&lt;bool, _&gt;(key).await {
    if exists {
        // å¦‚æœ key å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„é€»è¾‘
    } else {
        // å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„é€»è¾‘
    }
} else {
    // å¦‚æœæ£€æŸ¥æ“ä½œå¤±è´¥ï¼Œåˆ™è®°å½•é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯
    eprintln!(&quot;Failed to check if key exists: {:?}&quot;, key);
    return Err(MyError::RedisError);
}
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>Q:</p>
</blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœæ£€æŸ¥æ“ä½œæˆåŠŸï¼Œåˆ™æ ¹æ® exists çš„å€¼åˆ†åˆ«æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚å¦‚æœæ£€æŸ¥æ“ä½œå¤±è´¥ï¼Œåˆ™ä½¿ç”¨ else ä»£ç å—æ¥è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ï¼ˆMyError::RedisErrorï¼‰ã€‚</p>
<p>å¦‚æœ exists æ˜¯ Okï¼Œåˆ™è¡¨ç¤ºæ£€æŸ¥æ“ä½œæˆåŠŸï¼Œexists å˜é‡å°†åŒ…å«ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºç»™å®šçš„ key æ˜¯å¦å­˜åœ¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¨‹åºå°†è¿›å…¥ if ä»£ç å—ï¼Œæ ¹æ® exists çš„å€¼æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ exists ä¸º trueï¼Œåˆ™è¡¨ç¤º key å­˜åœ¨ï¼Œç¨‹åºå°†æ‰§è¡Œç›¸åº”çš„é€»è¾‘æ¥å¤„ç† key å­˜åœ¨çš„æƒ…å†µã€‚åä¹‹ï¼Œå¦‚æœ exists ä¸º falseï¼Œåˆ™è¡¨ç¤º key ä¸å­˜åœ¨ï¼Œç¨‹åºå°†æ‰§è¡Œç›¸åº”çš„é€»è¾‘æ¥å¤„ç† key ä¸å­˜åœ¨çš„æƒ…å†µã€‚</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>æ˜¯çš„ï¼Œä½ æ˜¯å¯¹çš„ã€‚åœ¨ä½ æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œkey æ˜¯åœ¨ä¹‹å‰å®šä¹‰çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾åœ¨è¿™æ®µä»£ç ä¹‹å‰ï¼Œå·²ç»å®šä¹‰äº†ä¸€ä¸ªåä¸º key çš„å˜é‡ï¼Œç”¨äºæŒ‡å®šè¦æ£€æŸ¥çš„ Redis é”®åã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Redis è¿›è¡Œé”®å€¼å­˜å‚¨çš„ç®€å•ç¤ºä¾‹ï¼Œå…¶ä¸­ä½¿ç”¨äº†ç±»ä¼¼äºä½ æä¾›çš„ä»£ç ç‰‡æ®µï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">use redis::AsyncCommands;

#[tokio::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let client = redis::Client::open(&quot;redis://127.0.0.1/&quot;).unwrap();
    let mut conn = client.get_async_connection().await?;

    // å®šä¹‰è¦æ£€æŸ¥çš„ Redis é”®å
    let key = &quot;my_key&quot;;

    // æ£€æŸ¥æŒ‡å®šçš„é”®æ˜¯å¦å­˜åœ¨
    if let Ok(exists) = conn.exists::&lt;bool, _&gt;(key).await {
        if exists {
            // å¦‚æœ key å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„é€»è¾‘
            let value: String = conn.get(key).await?;
            println!(&quot;{}: {}&quot;, key, value);
        } else {
            // å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„é€»è¾‘
            conn.set(key, &quot;Hello, Redis!&quot;).await?;
            println!(&quot;Set {} successfully&quot;, key);
        }
    } else {
        // å¦‚æœæ£€æŸ¥æ“ä½œå¤±è´¥ï¼Œåˆ™è®°å½•é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯
        eprintln!(&quot;Failed to check if key exists: {:?}&quot;, key);
        return Err(&quot;RedisError&quot;.into());
    }

    Ok(())
}
</code></pre></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªåä¸º key çš„å˜é‡ï¼Œç”¨äºæŒ‡å®šè¦æ£€æŸ¥çš„ Redis é”®åã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ conn.exists æ–¹æ³•æ£€æŸ¥æŒ‡å®šçš„é”®æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ£€æŸ¥æ“ä½œæˆåŠŸï¼Œåˆ™æ ¹æ®æ£€æŸ¥ç»“æœçš„å€¼ï¼ˆå³å˜é‡ existsï¼‰æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚å¦‚æœæ£€æŸ¥æ“ä½œå¤±è´¥ï¼Œåˆ™è®°å½•é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ eprintln æ¥è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ return Err(...) è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„é”™è¯¯ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ Ok(()) è¿”å›ä¸€ä¸ªè¡¨ç¤ºæˆåŠŸçš„ç»“æœã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ Result&lt;(), Box<dyn std::error::Error>&gt;
æ˜¯ä»€ä¹ˆå«ä¹‰, åº”è¯¥å¦‚ä½•ç†è§£?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Result ç±»å‹ï¼Œå…¶ä¸­ () è¡¨ç¤ºä¸€ä¸ªç©ºå…ƒç»„ï¼ˆä¹Ÿç§°ä¸º unit typeï¼‰ã€‚åœ¨ Rust ä¸­ï¼Œ() ç”¨äºè¡¨ç¤ºæ²¡æœ‰å€¼çš„æƒ…å†µï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„ void ç±»å‹ã€‚åœ¨è¿™ä¸ªå‡½æ•°çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ() è¡¨ç¤ºå‡½æ•°æ²¡æœ‰è¿”å›ä»»ä½•æœ‰ç”¨çš„å€¼ï¼Œåªæ˜¯æ‰§è¡Œäº†ä¸€äº›æ“ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼è§£è¯»ä¸ºâ€œè¡¨ç¤ºå‡½æ•°æ‰§è¡Œæ˜¯å¦æˆåŠŸçš„ç»“æœï¼Œå¦‚æœæˆåŠŸåˆ™ä¸è¿”å›ä»»ä½•å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªå®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹â€ã€‚</p>
<p>Box<dyn std::error::Error> æ˜¯ä¸€ä¸ª trait å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå¯ä»¥ä½œä¸ºé”™è¯¯ç±»å‹çš„ä»»ä½•ç±»å‹ï¼Œåªè¦è¯¥ç±»å‹å®ç°äº† std::error::Error traitã€‚åœ¨ Rust ä¸­ï¼Œstd::error::Error trait æ˜¯ä¸€ä¸ªé€šç”¨çš„é”™è¯¯å¤„ç† traitï¼Œå®ƒå®šä¹‰äº†ä¸€äº›æ–¹æ³•å’Œå±æ€§ï¼Œç”¨äºå¤„ç†å’Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚å®ç° std::error::Error trait çš„ç±»å‹å¯ä»¥æ˜¯ä»»ä½•å…·ä½“çš„ç±»å‹ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€è‡ªå®šä¹‰ç»“æ„ä½“ã€æšä¸¾ç­‰ç­‰ã€‚ä½†æ˜¯ï¼Œä¸ºäº†æ–¹ä¾¿å’Œé€šç”¨æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†å®ç°äº† std::error::Error trait çš„ç±»å‹å°è£…åœ¨ä¸€ä¸ª Box ä¸­ï¼Œä»¥å®ç°åŠ¨æ€åˆ†é…å’Œå›æ”¶å†…å­˜çš„æ•ˆæœã€‚</p>
<p>å› æ­¤ï¼Œå°† Box<dyn std::error::Error> ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªå®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹ã€‚å½“å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª Ok(()) å€¼ï¼Œè¡¨ç¤ºå‡½æ•°æ‰§è¡ŒæˆåŠŸä¸”æ²¡æœ‰è¿”å›ä»»ä½•å€¼ã€‚å½“å‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª Err å€¼ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹ï¼Œè¯¥é”™è¯¯ç±»å‹å¯ä»¥æä¾›æœ‰å…³é”™è¯¯çš„æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚é”™è¯¯æ¶ˆæ¯ã€é”™è¯¯ç ã€å †æ ˆè·Ÿè¸ªç­‰ç­‰ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ ¹æ®é”™è¯¯ç±»å‹æ¥å¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚è®°å½•é”™è¯¯æ—¥å¿—ã€è¿”å›é”™è¯¯ç ã€é‡è¯•æ“ä½œç­‰ç­‰ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>è¿™é‡Œçš„ dyn æ˜¯ä»€ä¹ˆè¯­æ³•?ä¸ºä»€ä¹ˆè¦åŒ…åœ¨ä¸€ä¸ª Box ä¸­?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>dyn æ˜¯ Rust è¯­è¨€ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºè¡¨ç¤ºåŠ¨æ€æ´¾å‘çš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œå­˜åœ¨ä¸¤ç§ç±»å‹çš„å¤šæ€ï¼šé™æ€å¤šæ€å’ŒåŠ¨æ€å¤šæ€ã€‚é™æ€å¤šæ€æ˜¯é€šè¿‡æ³›å‹å®ç°çš„ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ï¼Œè€ŒåŠ¨æ€å¤šæ€æ˜¯é€šè¿‡ trait å¯¹è±¡å®ç°çš„ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„ç±»å‹ã€‚</p>
<p>åœ¨ Rust ä¸­ï¼ŒBox æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼Œç”¨äºåœ¨å †ä¸Šåˆ†é…å’Œç®¡ç†åŠ¨æ€åˆ†é…çš„å€¼ã€‚ç”±äº trait å¯¹è±¡çš„å¤§å°å’Œç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥å°† trait å¯¹è±¡æ”¾åœ¨æ ˆä¸Šæˆ–è€…åµŒå…¥åˆ°å…¶ä»–ç±»å‹ä¸­ã€‚ä¸ºäº†æ–¹ä¾¿å’Œå®‰å…¨åœ°ä½¿ç”¨ trait å¯¹è±¡ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†å…¶å°è£…åœ¨ä¸€ä¸ª Box ä¸­ï¼Œä»¥å®ç°åŠ¨æ€åˆ†é…å’Œå›æ”¶å†…å­˜çš„æ•ˆæœã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ Result&lt;(), Box<dyn std::error::Error>&gt; è¿™ä¸ªç±»å‹ä¸­ï¼ŒBox<dyn std::error::Error> è¡¨ç¤ºä¸€ä¸ªå®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹ï¼Œå®ƒå¯èƒ½æ˜¯ä»»ä½•å…·ä½“çš„ç±»å‹ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€è‡ªå®šä¹‰ç»“æ„ä½“ã€æšä¸¾ç­‰ç­‰ã€‚ç”±äºè¯¥ç±»å‹æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Box æ¥ç®¡ç†å…¶å†…å­˜ã€‚æœ€åï¼ŒResult&lt;(), Box<dyn std::error::Error>&gt; è¡¨ç¤ºä¸€ä¸ªæˆåŠŸæ—¶ä¸è¿”å›ä»»ä½•å€¼ï¼Œå¤±è´¥æ—¶è¿”å›ä¸€ä¸ªå®ç°äº† std::error::Error trait çš„é”™è¯¯ç±»å‹çš„ç»“æœç±»å‹ã€‚</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>å¯¹åº” dyn çš„é™æ€å¤šæ€æ˜¯ä»€ä¹ˆ, èƒ½ä¸¾ä¸ªä¾‹å­å˜›?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>å¯¹åº”äº dyn çš„é™æ€å¤šæ€æ˜¯ Rust ä¸­çš„æ³›å‹ï¼Œç”¨äºåœ¨ç¼–è¯‘æ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œæ³›å‹å¯ä»¥é€šè¿‡ç±»å‹å‚æ•°æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add&lt;T&gt;(x: T, y: T) -&gt; T
where
    T: std::ops::Add&lt;Output = T&gt; + Copy,
{
    x + y
}

let x = 1;
let y = 2;
let z = add(x, y);

<span class="boring">}</span></code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œadd å‡½æ•°ä½¿ç”¨äº†æ³›å‹ç±»å‹ Tï¼Œå®ƒè¡¨ç¤ºä»»æ„ç±»å‹ã€‚å‡½æ•°ç­¾åä¸­çš„ where å…³é”®å­—è¡¨ç¤ºæ³›å‹ç±»å‹ T éœ€è¦æ»¡è¶³çš„ä¸€äº›çº¦æŸï¼Œä¾‹å¦‚å®ç°äº† std::ops::Add traitï¼Œå¹¶ä¸”è¯¥ trait çš„ Output å…³è”ç±»å‹ä¸º Tï¼ŒåŒæ—¶è¿˜éœ€è¦å®ç° Copy traitã€‚è¿™äº›çº¦æŸä¿è¯äº†ç±»å‹ T æ”¯æŒåŠ æ³•æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œå€¼çš„æ‹·è´æ“ä½œã€‚æœ€åï¼Œadd å‡½æ•°è¿”å›ç±»å‹ä¸º Tï¼Œè¡¨ç¤ºå‡½æ•°çš„è¿”å›å€¼ç±»å‹å’Œå‚æ•°ç±»å‹ç›¸åŒã€‚</p>
<p>åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨å‡½æ•°è°ƒç”¨æ—¶æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 1;
let y = 2;
let z = add::&lt;i32&gt;(x, y);
<span class="boring">}</span></code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œadd::<i32> è¡¨ç¤ºè°ƒç”¨ add å‡½æ•°ï¼Œå¹¶å°†ç±»å‹å‚æ•° T æŒ‡å®šä¸º i32 ç±»å‹ã€‚ç”±äº i32 ç±»å‹å®ç°äº† std::ops::Add trait å’Œ Copy traitï¼Œå› æ­¤æ»¡è¶³å‡½æ•°ç­¾åä¸­çš„çº¦æŸï¼Œå¯ä»¥æˆåŠŸè°ƒç”¨å‡½æ•°å¹¶è¿”å›å€¼ã€‚</p>
<p>æ€»ä¹‹ï¼Œé™æ€å¤šæ€å’ŒåŠ¨æ€å¤šæ€æ˜¯ Rust ä¸­çš„ä¸¤ç§å¤šæ€æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºåœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œæ³›å‹ç”¨äºé™æ€å¤šæ€ï¼Œé€šè¿‡ç±»å‹å‚æ•°åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ï¼Œè€Œ trait å¯¹è±¡ç”¨äºåŠ¨æ€å¤šæ€ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„ç±»å‹ã€‚</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´é™æ€å¤šæ€ç”¨ T æ¥å£°æ˜, åŠ¨æ€å¤šæ€ç”¨ dyn å£°æ˜? ä¸Šè¿°é‚£ä¸ª add çš„ç¤ºä¾‹ç”¨ dyn æ¥å®šä¹‰åº”è¯¥å¦‚ä½•å†™?</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>ä¸å®Œå…¨æ­£ç¡®ï¼Œé™æ€å¤šæ€å’ŒåŠ¨æ€å¤šæ€éƒ½å¯ä»¥ä½¿ç”¨æ³›å‹æ¥å®ç°ï¼Œåªä¸è¿‡å®ƒä»¬ä½¿ç”¨æ–¹å¼å’Œç›®çš„ç•¥æœ‰ä¸åŒã€‚å…·ä½“æ¥è¯´ï¼Œæ³›å‹ä¸»è¦ç”¨äºé™æ€å¤šæ€ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ï¼Œè€Œ trait å¯¹è±¡ä¸»è¦ç”¨äºåŠ¨æ€å¤šæ€ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ã€‚å› æ­¤ï¼Œæ³›å‹é€šå¸¸ç”¨äºå‡½æ•°ã€ç»“æ„ä½“ã€æšä¸¾ç­‰é™æ€ç±»å‹çš„å®šä¹‰ä¸­ï¼Œè€Œ trait å¯¹è±¡é€šå¸¸ç”¨äºå‡½æ•°å‚æ•°ã€è¿”å›å€¼ã€å®ç°åŠ¨æ€åˆ†å‘ç­‰éœ€è¦åŠ¨æ€ç±»å‹çš„åœºæ™¯ä¸­ã€‚</p>
<p>å¯¹äºä½ çš„é—®é¢˜ï¼Œå¦‚æœè¦å°†ä¸Šé¢çš„ add å‡½æ•°æ”¹å†™æˆä½¿ç”¨ trait å¯¹è±¡å®ç°çš„åŠ¨æ€å¤šæ€ï¼Œå¯ä»¥å°†å‚æ•°ç±»å‹ä»æ³›å‹ T æ”¹ä¸º trait å¯¹è±¡ dyn std::ops::Add&lt;Output = T&gt;ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add&lt;T&gt;(x: T, y: T) -&gt; T
where
    T: Copy,
    dyn std::ops::Add&lt;Output = T&gt; + 'static,
{
    x + y
}

let x = 1;
let y = 2;
let z = add(x, y);

<span class="boring">}</span></code></pre></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œadd å‡½æ•°ä½¿ç”¨äº† trait å¯¹è±¡ dyn std::ops::Add&lt;Output = T&gt;ï¼Œå®ƒè¡¨ç¤ºå®ç°äº† std::ops::Add traitï¼Œå¹¶ä¸”è¯¥ trait çš„ Output å…³è”ç±»å‹ä¸º T çš„ä»»æ„ç±»å‹ã€‚ç”±äº trait å¯¹è±¡çš„å¤§å°å’Œç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ dyn å…³é”®å­—æ¥è¡¨ç¤ºåŠ¨æ€ç±»å‹ã€‚åŒæ—¶ï¼Œä¸ºäº†ä½¿ trait å¯¹è±¡èƒ½å¤Ÿåœ¨å‡½æ•°å†…éƒ¨è¢«å­˜å‚¨å’Œä½¿ç”¨ï¼Œè¿˜éœ€è¦ä½¿ç”¨ 'static lifetime æ¥ä¿è¯ trait å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè‡³å°‘å’Œæ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ trait å¯¹è±¡æ—¶ï¼Œéœ€è¦å°† trait å¯¹è±¡çš„å®ç°é™åˆ¶åœ¨ç¼–è¯‘æ—¶å·²çŸ¥çš„èŒƒå›´å†…ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç”±äº add å‡½æ•°éœ€è¦ä½¿ç”¨ x + y è¡¨è¾¾å¼ï¼Œå› æ­¤è¦æ±‚ trait å¯¹è±¡ dyn std::ops::Add&lt;Output = T&gt; çš„å®ç°ç±»å‹å¿…é¡»å®ç°äº† Copy traitï¼Œä»¥ä¾¿è¿›è¡Œå€¼çš„æ‹·è´æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿ trait å¯¹è±¡çš„å®ç°ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç¡®å®šçš„ï¼Œä¹Ÿèƒ½å¤Ÿä¿è¯å®ƒä»¬æ»¡è¶³ Copy trait çš„è¦æ±‚ï¼Œä»è€Œé¿å…å‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>é‚£ä¹ˆ trait å¯¹è±¡ä¹Ÿèƒ½å®Œæˆé™æ€å¤šæ€çš„ä»»åŠ¡å˜›? ä¸¾è¡Œè¯´æ˜?</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>Trait å¯¹è±¡ä¸»è¦ç”¨äºå®ç°åŠ¨æ€å¤šæ€ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨è¿è¡Œæ—¶æ ¹æ®å…·ä½“ç±»å‹æ¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•å®ç°ã€‚è€Œæ³›å‹ä¸»è¦ç”¨äºå®ç°é™æ€å¤šæ€ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…·ä½“ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å…·ä½“ç±»å‹æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ç­‰æ“ä½œã€‚</p>
<p>è™½ç„¶ trait å¯¹è±¡ä¸èƒ½åƒæ³›å‹ä¸€æ ·è¿›è¡Œç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å®Œæˆä¸€äº›é™æ€å¤šæ€çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•° printï¼Œå®ƒå¯ä»¥æ‰“å°ä¸åŒç±»å‹çš„å€¼ã€‚å¦‚æœä½¿ç”¨æ³›å‹æ¥å®ç°ï¼Œå¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn print&lt;T: std::fmt::Display&gt;(value: T) {
    println!(&quot;{}&quot;, value);
}

<span class="boring">}</span></code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ³›å‹æ¥å®ç°é™æ€å¤šæ€ï¼Œå‡½æ•°çš„å‚æ•°ç±»å‹ T åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šï¼Œå› æ­¤å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ std::fmt::Display trait æ¥æ‰“å°ä¸åŒç±»å‹çš„å€¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨è¿è¡Œæ—¶åŠ¨æ€ç¡®å®šå‚æ•°ç±»å‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ trait å¯¹è±¡æ¥å®ç°ã€‚ä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn print(value: &amp;dyn std::fmt::Display) {
    println!(&quot;{}&quot;, value);
}

let s = &quot;Hello, world!&quot;;
let n = 42;
print(&amp;s);
print(&amp;n);

<span class="boring">}</span></code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† trait å¯¹è±¡ &amp;dyn std::fmt::Display æ¥å®ç°åŠ¨æ€å¤šæ€ï¼Œå‡½æ•°çš„å‚æ•°ç±»å‹åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ std::fmt::Display trait æ¥æ‰“å°ä¸åŒç±»å‹çš„å€¼ï¼Œç”±äº trait å¯¹è±¡çš„å¤§å°å’Œç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤ä¸èƒ½åƒæ³›å‹é‚£æ ·è¿›è¡Œç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œä½†æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶æ ¹æ®å…·ä½“ç±»å‹è¿›è¡ŒåŠ¨æ€åˆ†å‘ï¼Œä»è€Œå®Œæˆç±»ä¼¼äºé™æ€å¤šæ€çš„ä»»åŠ¡ã€‚</p>
<p>æ€»ä¹‹ï¼Œå°½ç®¡ trait å¯¹è±¡å’Œæ³›å‹éƒ½å¯ä»¥ç”¨äºå¤šæ€ç¼–ç¨‹ï¼Œä½†å®ƒä»¬å„è‡ªé€‚ç”¨äºä¸åŒçš„åœºæ™¯å’Œä»»åŠ¡ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„æ–¹å¼ã€‚æ³›å‹é€‚ç”¨äºåœ¨ç¼–è¯‘æ—¶ç¡®å®šç±»å‹çš„åœºæ™¯ï¼Œè€Œ trait å¯¹è±¡é€‚ç”¨äºåœ¨è¿è¡Œæ—¶ç¡®å®šç±»å‹çš„åœºæ™¯ï¼ŒåŒæ—¶ï¼Œä¸¤è€…ä¹Ÿå¯ä»¥ç»“åˆä½¿ç”¨æ¥å®ç°æ›´åŠ çµæ´»å’Œé«˜æ•ˆçš„ç¼–ç¨‹æ–¹å¼ã€‚</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>&lt;T: std::fmt::Display&gt; æ˜¯ä»€ä¹ˆè¯­æ³•? èµ·ä»€ä¹ˆä½œç”¨? å¦‚ä½•ç†è§£? æœ‰å…¶å®ƒè¡¨è¿°å½¢å¼å˜›?</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>&lt;T: std::fmt::Display&gt; æ˜¯ä¸€ä¸ªæ³›å‹å‚æ•°å£°æ˜ï¼Œç”¨äºåœ¨å‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»å‹ Tï¼Œè¯¥ç±»å‹å¿…é¡»å®ç° std::fmt::Display traitã€‚å®ƒçš„ä½œç”¨æ˜¯è®©å‡½æ•°èƒ½å¤Ÿå¤„ç†ä¸åŒç±»å‹çš„å‚æ•°ï¼ŒåŒæ—¶è¦æ±‚è¿™äº›å‚æ•°å¿…é¡»å®ç° Display traitã€‚</p>
<p>è¿™ä¸ªè¯­æ³•å¯ä»¥ç†è§£ä¸ºï¼šâ€œå®šä¹‰ä¸€ä¸ªåä¸º T çš„æ³›å‹ç±»å‹ï¼Œå®ƒå¿…é¡»å®ç° std::fmt::Display traitã€‚â€</p>
<p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç­‰æ•ˆçš„è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ where å…³é”®å­—æ¥å£°æ˜æ³›å‹ç±»å‹çš„çº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn print&lt;T&gt;(value: T)
where
    T: std::fmt::Display,
{
    println!(&quot;{}&quot;, value);
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ªè¯­æ³•çš„æ„æ€å’Œå‰é¢çš„è¯­æ³•æ˜¯ç­‰ä»·çš„ï¼Œå®ƒè¡¨ç¤ºï¼šâ€œå®šä¹‰ä¸€ä¸ªåä¸º T çš„æ³›å‹ç±»å‹ï¼Œåœ¨å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨å®ƒï¼Œå¹¶è¦æ±‚å®ƒå¿…é¡»å®ç° std::fmt::Display traitã€‚â€</p>
<p>åœ¨ Rust ä¸­ï¼Œè¿™ä¸¤ç§è¯­æ³•æ˜¯ç­‰ä»·çš„ï¼Œé€‰æ‹©å“ªç§è¯­æ³•ä¸»è¦å–å†³äºä¸ªäººçš„ç¼–ç ä¹ æƒ¯å’Œå–œå¥½ã€‚é€šå¸¸æ¥è¯´ï¼Œç¬¬ä¸€ç§è¯­æ³•é€‚ç”¨äºç®€å•çš„æ³›å‹å‡½æ•°ï¼Œè€Œç¬¬äºŒç§è¯­æ³•é€‚ç”¨äºæ›´å¤æ‚çš„æ³›å‹å‡½æ•°ï¼Œå› ä¸ºå®ƒå¯ä»¥å°†ç±»å‹çº¦æŸæ¡ä»¶å•ç‹¬åˆ—å‡ºæ¥ï¼Œä½¿å¾—å‡½æ•°çš„å£°æ˜æ›´åŠ æ¸…æ™°å’Œæ˜“è¯»ã€‚</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>æ˜ç™½äº†, ä¸¾ä¾‹è¯´æ˜å¦‚ä½•å…¼å®¹æ²¡æœ‰å®ç° std::fmt::Display trait çš„å¯¹è±¡ä¼ å…¥å, å¦‚ä½•å®‰å…¨å“åº”?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°ä¸­å¤„ç†å¯èƒ½æ²¡æœ‰å®ç° std::fmt::Display trait çš„ç±»å‹ï¼Œä¸€ç§å¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨ Rust æä¾›çš„ Option æˆ– Result ç±»å‹æ¥è¡¨ç¤ºè¿™ç§æƒ…å†µï¼Œå¹¶åœ¨å‡½æ•°ä¸­è¿›è¡Œå¤„ç†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°† print å‡½æ•°æ”¹ä¸ºè¿”å›ä¸€ä¸ª Result&lt;(), Box<dyn std::error::Error>&gt; ç±»å‹çš„ç»“æœï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å‡½æ•°ä¸­å¤„ç†å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>fn print&lt;T: std::fmt::Display&gt;(value: T) -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    println!(&quot;{}&quot;, value);
    Ok(())
}

<span class="boring">}</span></code></pre></pre>
<p>åœ¨è¿™ä¸ªç‰ˆæœ¬çš„ print å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Result ç±»å‹æ¥è¡¨ç¤ºå‡½æ•°æ‰§è¡Œçš„ç»“æœï¼Œå¹¶ä½¿ç”¨ Box<dyn std::error::Error> ç±»å‹æ¥è¡¨ç¤ºå¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚å¦‚æœä¼ å…¥çš„å‚æ•°æ²¡æœ‰å®ç° std::fmt::Display traitï¼Œåˆ™åœ¨æ‰§è¡Œ println! æ—¶ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯ä¼šè¢«æ•è·å¹¶è¿”å›ä¸€ä¸ª Err å€¼ã€‚</p>
<p>è°ƒç”¨æ–¹å¯ä»¥æ ¹æ® Result ç±»å‹çš„è¿”å›å€¼æ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¦‚æœè¿”å›äº† Err å€¼ï¼Œåˆ™è¯´æ˜å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ã€‚è°ƒç”¨æ–¹å¯ä»¥é€‰æ‹©å¿½ç•¥è¿™ä¸ªé”™è¯¯ï¼Œæˆ–è€…å°†é”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ã€‚ä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let value = 42;
    print(value)?;
    Ok(())
}
</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªæ•´æ•°ç±»å‹çš„å€¼ 42 ä¼ ç»™äº† print å‡½æ•°ï¼Œç”±äºæ•´æ•°ç±»å‹æ²¡æœ‰å®ç° std::fmt::Display traitï¼Œå› æ­¤åœ¨å‡½æ•°ä¸­ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯ä¼šè¢«æ•è·å¹¶è¿”å›ä¸€ä¸ª Err å€¼ã€‚åœ¨ main å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ ? æ“ä½œç¬¦æ¥å¤„ç†è¿™ä¸ªé”™è¯¯ï¼Œè¿™æ ·å¦‚æœ print å‡½æ•°æ‰§è¡Œå¤±è´¥ï¼Œmain å‡½æ•°ä¹Ÿä¼šè¿”å›ä¸€ä¸ª Err å€¼ï¼Œç¨‹åºä¼šæ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<blockquote>
<p>PS:è¿›ä¸€æ­¥çš„, ç»¼åˆä¹‹å‰ä»‹ç»,å¯ä»¥ç”¨ where è¿›è¡Œå¤–éƒ¨å£°æ˜,ç®€åŒ–å‡½æ•°å£°æ˜:</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn print&lt;T&gt;(value: T) -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt;
where
    T: std::fmt::Display,
{
    println!(&quot;{}&quot;, value);
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>A:</p>
</blockquote>
<p>æˆ‘æ˜¯è¯´ Result&lt;(), Box<dyn std::error::Error>&gt; è¿™é‡Œä¹Ÿå¤ªé•¿äº†, æœ‰å¯¹åº”ç®€æ´å½¢å¼å˜›?</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>åœ¨ Rust ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ type å…³é”®å­—æ¥ç»™æŸç§ç±»å‹èµ·ä¸€ä¸ªåˆ«åï¼Œä»è€Œåœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªåˆ«åæ¥ä»£æ›¿åŸå§‹çš„ç±»å‹ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—ä»£ç æ›´åŠ æ˜“è¯»å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<p>å¯¹äº Result&lt;(), Box<dyn std::error::Error>&gt; è¿™æ ·çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ type å…³é”®å­—æ¥ä¸ºå®ƒèµ·ä¸€ä¸ªåˆ«åï¼Œä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>type MyResult = Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt;;

<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ªä»£ç ç‰‡æ®µå®šä¹‰äº†ä¸€ä¸ªåä¸º MyResult çš„åˆ«åï¼Œå®ƒè¡¨ç¤ºçš„ç±»å‹å’Œ Result&lt;(), Box<dyn std::error::Error>&gt; æ˜¯ä¸€æ ·çš„ã€‚æœ‰äº†è¿™ä¸ªåˆ«åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ MyResult æ¥ä»£æ›¿ Result&lt;(), Box<dyn std::error::Error>&gt;ï¼Œä»è€Œä½¿å¾—ä»£ç æ›´åŠ æ˜“è¯»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªåˆ«åæ¥å®šä¹‰ print å‡½æ•°çš„è¿”å›ç±»å‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn print&lt;T: std::fmt::Display&gt;(value: T) -&gt; MyResult {
    println!(&quot;{}&quot;, value);
    Ok(())
}

<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ªç‰ˆæœ¬çš„ print å‡½æ•°å’Œä¹‹å‰çš„ç‰ˆæœ¬ç›¸æ¯”ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä½¿ç”¨äº† MyResult è¿™ä¸ªåˆ«åæ¥ä»£æ›¿äº† Result&lt;(), Box<dyn std::error::Error>&gt;ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—å‡½æ•°å£°æ˜æ›´åŠ ç®€æ´æ˜“è¯»ã€‚</p>
<p>è°ƒç”¨è¿™ä¸ªç‰ˆæœ¬çš„ print å‡½æ•°å’Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ä¸€æ ·çš„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() -&gt; MyResult {
    let value = 42;
    print(value)?;
    Ok(())
}
</code></pre></pre>
<h2 id="refer-5"><a class="header" href="#refer-5">refer.</a></h2>
<blockquote>
<p>å…¶å®å®˜æ–¹çš„æ–‡æ¡£åƒé€, åŸºæœ¬å¯ä»¥å¹³è¶Ÿ 80% çš„æ—¥å¸¸å¼€å‘äº†...</p>
</blockquote>
<p><a href="https://doc.rust-lang.org/book/ch10-00-generics.html">Generic Types, Traits, and Lifetimes - The Rust Programming Language</a></p>
<ul>
<li><a href="https://doc.rust-lang.org/book/ch10-01-syntax.html">Generic Data Types - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/book/ch10-02-traits.html#defining-a-trait">Traits: Defining Shared Behavior - The Rust Programming Language</a></li>
</ul>
<p>...è¿™äº›é“¾æ¥å¯¹åº”çš„æ˜¯ Rust å®˜æ–¹æ–‡æ¡£ä¸­çš„ã€ŠRust ç¨‹åºè®¾è®¡è¯­è¨€ã€‹ä¸€ä¹¦ä¸­çš„ç›¸å…³ç« èŠ‚ï¼ŒåŒ…å«äº†é™æ€å¤šæ€å’ŒåŠ¨æ€å¤šæ€çš„åŸºæœ¬æ¦‚å¿µã€ä½¿ç”¨æ–¹æ³•å’Œç¤ºä¾‹ä»£ç ç­‰å†…å®¹ï¼Œéå¸¸é€‚åˆåˆå­¦è€…é˜…è¯»å­¦ä¹ ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å‚è€ƒ Rust å®˜æ–¹æ–‡æ¡£ä¸­çš„å…¶ä»–éƒ¨åˆ†ï¼Œå¦‚ã€ŠRust æ ‡å‡†åº“ API å‚è€ƒã€‹å’Œã€ŠRust é£æ ¼æŒ‡å—ã€‹ç­‰ï¼Œæ¥æ·±å…¥ç†è§£ Rust ä¸­çš„æ³›å‹å’Œ trait ç­‰æ¦‚å¿µã€‚</p>
<pre><code>       _~~|-~_
   () /  â—• -  \ (/
     '_   âµ   _'
     | '-----' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="idioms"><a class="header" href="#idioms">idioms</a></h1>
<blockquote>
<p>åœ¨ Python ç§° Pythonic çš„ä¸œè¥¿, åœ¨å…¶å®ƒè¯­è¨€å°±æ˜¯ -style</p>
</blockquote>
<h2 id="background-6"><a class="header" href="#background-6">background</a></h2>
<p>å¦‚æœæœ‰å…¶å®ƒå¼€å‘è¯­è¨€ç»éªŒ, å¾ˆåº”è¯¥ç¬¬ä¸€æ—¶é—´å¯å°†å¯¹åº”ä¹ æƒ¯è¿ç§»åˆ°æ–°è¯­è¨€ä¸­</p>
<h2 id="goal-6"><a class="header" href="#goal-6">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>è®¤çœŸæ”¶é›†æ—¥å¸¸å¸¸è§çš„å„ç§å¾®ä»»åŠ¡,
å¹¶å¯¹æ¯” Python ä»£ç æ¥ç†è§£ Rust çš„...</p>
<h2 id="trace-6"><a class="header" href="#trace-6">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<h2 id="refer-6"><a class="header" href="#refer-6">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://programming-idioms.org/all-idioms">programming-idioms.org</a></li>
<li><a href="https://www.dotnetperls.com/s#rust">Dot Net Perls: Search</a></li>
<li><a href="https://rosettacode.org/wiki/Queue/Usage#Rust">Queue/Usage - Rosetta Code</a></li>
<li>...</li>
</ul>
<h2 id="logging-5"><a class="header" href="#logging-5">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>220228 ZQ init.</li>
</ul>
<pre><code>         _~-|`~_
     () /  o -  \ (/
       '_   â¡   _'
       | '--âŒ„--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="idiom325æ„é€ é˜Ÿåˆ—"><a class="header" href="#idiom325æ„é€ é˜Ÿåˆ—">idiom#325:æ„é€ é˜Ÿåˆ—</a></h1>
<p>SEE: <a href="https://programming-idioms.org/idiom/325/create-a-queue/6291/rust">Create a queue, in Rust</a></p>
<h2 id="python"><a class="header" href="#python">Python</a></h2>
<pre><code class="language-python">import queue

q = queue.Queue()
q.put(x)
q.put(y)
z = q.get()
</code></pre>
<h2 id="rust"><a class="header" href="#rust">Rust</a></h2>
<pre><pre class="playground"><code class="language-rust edition2021">use std::collections::VecDeque;

fn main() {
    let mut q = VecDeque::new();
    q.push_back(&quot;zoom&quot;);
    q.push_back(&quot;quiet&quot;);
    let z = q.pop_front(); 
    println!(&quot;1st item ~&gt; {}&quot;,z.unwrap());
}</code></pre></pre>
<h2 id="humm"><a class="header" href="#humm">Humm?</a></h2>
<ul>
<li>å†…ç½®æ¨¡å—</li>
<li>å‡½æ•°å/æµç¨‹/...åŸºæœ¬ä¸€è‡´</li>
<li>..è®°ä½å°±å¥½</li>
</ul>
<pre><code>          _~-+^~_
      \) /  + =  \ \/
        '_   â–³   _'
        ( '--âˆ½--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-quiz"><a class="header" href="#rust-quiz">Rust Quiz</a></h1>
<h2 id="background-7"><a class="header" href="#background-7">background</a></h2>
<p>å¿…åˆ·çš„å®˜æ–¹ç»ƒä¹ é¢˜é›†</p>
<p><a href="https://dtolnay.github.io/rust-quiz/1">Rust Quiz #1</a></p>
<h2 id="goal-7"><a class="header" href="#goal-7">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>å½“å‰ 36 ä¸ªé—®é¢˜éƒ½çœ‹ä¸€é</p>
<h2 id="trace-7"><a class="header" href="#trace-7">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<h2 id="refer-7"><a class="header" href="#refer-7">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rustlings/">å­¦ä¹  Rust - Rust ç¨‹åºè®¾è®¡è¯­è¨€</a></p>
<h2 id="logging-6"><a class="header" href="#logging-6">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230304 ZQ init.</li>
</ul>
<pre><code>        _~^-^~_
    () /  â—´ O  \ (/
      '_   â•   _'
      | '--~--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-quiz-1"><a class="header" href="#rust-quiz-1">Rust Quiz #1</a></h1>
<h2 id="background-8"><a class="header" href="#background-8">background</a></h2>
<p>What is the output of this Rust program?</p>
<pre><pre class="playground"><code class="language-rust edition2021">macro_rules! m {
    ($($s:stmt)*) =&gt; {
        $(
            { stringify!($s); 1 }
        )&lt;&lt;*
    };
}

fn main() {
    print!(
        &quot;{}{}{}&quot;,
        m! { return || true },
        m! { (return) || true },
        m! { {return} || true },
    );
}</code></pre></pre>
<h2 id="trace-8"><a class="header" href="#trace-8">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<p>ä¸æ˜¯, ç­‰ç­‰, ç¬¬ä¸€é¢˜å°±æ˜¯å®å±•å¼€å˜›?</p>
<blockquote>
<p>Q:</p>
</blockquote>
<p>è¿è¡Œç»“æœä¸ºä»€ä¹ˆæ˜¯ 112 ?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>ä»£ç çš„è¿è¡Œç»“æœæ˜¯112ï¼ŒåŸå› æ˜¯å®å±•å¼€åç”Ÿæˆçš„ä»£ç ä¸­æœ‰ä¸‰ä¸ªå—è¡¨è¾¾å¼ï¼Œæ¯ä¸ªå—è¡¨è¾¾å¼å†…éƒ¨åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—1ï¼Œç„¶åå°†è¿™ä¸ªæ•°å­—1å·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºä¹˜ä»¥2ï¼Œæœ€åè¿”å›çš„æ˜¯ä¸‰ä¸ªå—è¡¨è¾¾å¼ç»“æœçš„å’Œã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå® m çš„ä½œç”¨æ˜¯å°†ä¼ å…¥çš„ä»£ç å—ä¸­çš„æ¯ä¸ªè¯­å¥è½¬åŒ–ä¸ºä¸€ä¸ªå—è¡¨è¾¾å¼ï¼Œå…¶ä¸­æ¯ä¸ªå—è¡¨è¾¾å¼åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—1ï¼Œå³ { stringify!($s); 1 }ã€‚stringify!($s) æ˜¯ Rust ä¸­çš„ä¸€ä¸ªå†…ç½®å®ï¼Œç”¨äºå°†ä¼ å…¥çš„ä»£ç è½¬åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€‚</p>
<p>åœ¨ main å‡½æ•°ä¸­ï¼Œåˆ†åˆ«ä¼ å…¥äº†ä¸‰ä¸ªä¸åŒçš„ä»£ç å—ï¼š</p>
<ul>
<li>m! { return || true } å±•å¼€åç”Ÿæˆçš„ä»£ç å—æ˜¯ { stringify!(return || true); 1 }ï¼Œå…¶ä¸­çš„ stringify!(return || true) ä¼šå°†ä»£ç å—è½¬åŒ–ä¸ºå­—ç¬¦ä¸² &quot;return || true&quot;ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç å—çš„ç»“æœæ˜¯ { &quot;return || true&quot;; 1 }ã€‚</li>
<li>m! { (return) || true } å±•å¼€åç”Ÿæˆçš„ä»£ç å—æ˜¯ { stringify!((return) || true); 1 }ï¼Œå…¶ä¸­çš„ stringify!((return) || true) ä¼šå°†ä»£ç å—è½¬åŒ–ä¸ºå­—ç¬¦ä¸² &quot;(return) || true&quot;ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç å—çš„ç»“æœæ˜¯ { &quot;(return) || true&quot;; 1 }ã€‚</li>
<li>m! { {return} || true } å±•å¼€åç”Ÿæˆçš„ä»£ç å—æ˜¯ { stringify!({return} || true); 1 }ï¼Œå…¶ä¸­çš„ stringify!({return} || true) ä¼šå°†ä»£ç å—è½¬åŒ–ä¸ºå­—ç¬¦ä¸² &quot;{return} || true&quot;ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç å—çš„ç»“æœæ˜¯ { &quot;{return} || true&quot;; 1 }ã€‚</li>
</ul>
<p>ç”±äºæ¯ä¸ªå—è¡¨è¾¾å¼å†…éƒ¨éƒ½æœ‰æ•°å­—1ï¼Œå› æ­¤æœ€ç»ˆçš„ç»“æœæ˜¯å°†ä¸‰ä¸ªå—è¡¨è¾¾å¼çš„ç»“æœç›¸åŠ ï¼Œå³ 1 + 2 + 4 = 7ï¼Œç„¶åå°†ç»“æœå·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºä¹˜ä»¥2ï¼Œå³ 7 &lt;&lt; 1 = 14ã€‚æœ€åï¼Œè¿™ä¸ªç»“æœä¼šè¢«ä¼ å…¥ print! å®ä¸­ï¼Œå› æ­¤è¾“å‡ºçš„ç»“æœæ˜¯ 112ã€‚</p>
<p>å¯¹åº”å±•å¼€åçš„ä»£ç :</p>
<pre><pre class="playground"><code class="language-rust edition2021">// $ cargo expand 

#![feature(prelude_import)]
#[prelude_import]
use std::prelude::rust_2021::*;
#[macro_use]
extern crate std;
fn main() {
    {
        ::std::io::_print(
            format_args!(
                &quot;{0}{1}{2}&quot;, 
                { &quot;return (|| true);&quot;; 1 }, 
                { &quot;(return) || true;&quot;; 1 }, 
                { &quot;{ return }&quot;; 1 } &lt;&lt; { &quot;|| true;&quot;; 1 }
            ),
        );
    };
}</code></pre></pre>
<h2 id="refer-8"><a class="header" href="#refer-8">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://github.com/rust-lang/rustlings/">å­¦ä¹  Rust - Rust ç¨‹åºè®¾è®¡è¯­è¨€</a></p>
<ul>
<li><a href="https://zjp-cn.github.io/tlborm/syntax-extensions/debugging.html">è°ƒè¯• - The Little Book of Rust Macros ï¼ˆRust å®å°å†Œï¼‰</a>
<ul>
<li><a href="https://github.com/dtolnay/cargo-expand">dtolnay/cargo-expand: Subcommand to show result of macro expansion</a>
<ul>
<li>è™½ç„¶å†…æ ¸æœ‰æ”¯æŒ, ä½†æ˜¯, åŒ…è£…ä¸€ä¸‹å¥½ä½¿ç”¨</li>
<li>cargo install cargo-expand</li>
<li>rustup component add rustfmt</li>
<li>å°±å¯éšæ—¶ç”¨ $ cargo expand æ¥è§‚å¯Ÿå±•å¼€åçš„ä»£ç </li>
<li>ç­‰åŒ:
<ul>
<li>$ cargo rustc --profile=check -- -Zunpretty=expanded</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021">Rust Playground</a></li>
</ul>
</li>
<li></li>
</ul>
<pre><code>      _~^*âˆ½~_
  \/ /  â—· â˜‰  \ \/
    '_   âµ   _'
    | '--~--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercism"><a class="header" href="#exercism">Exercism</a></h1>
<blockquote>
<p>ç»ƒä¹ ä¸»ä¹‰</p>
</blockquote>
<h2 id="background-9"><a class="header" href="#background-9">background</a></h2>
<blockquote>
<p>å…·ä½“èƒŒæ™¯</p>
</blockquote>
<p><a href="https://exercism.org/about">About Exercism</a></p>
<p>æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç½‘ç«™</p>
<p><img src="https://ipic.zoomquiet.top/2022-12-14-zshot%202022-12-14%2021.30.38.jpg" alt="" /></p>
<p>ä¸€æ˜¯ä¸ªä¸“æ³¨ç”¨ç»ƒä¹ é¢˜æ¥å­¦ä¹ å„ç§å¼€å‘è¯­è¨€çš„ç½‘ç«™,
å…è´¹,åŒ…å«è¶Šæ¥è¶Šå¤šçš„è¯­è¨€</p>
<h2 id="goal-8"><a class="header" href="#goal-8">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p><a href="https://exercism.org/tracks/rust">Rust on Exercism</a></p>
<p>è‡³å°‘å…ˆåˆ·å®Œè¿™ 103 é“é¢˜ç›®, ç„¶å, å†å¼€å‘å…·ä½“çš„å®ç”¨å·¥å…·;</p>
<h2 id="trace-9"><a class="header" href="#trace-9">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<p><img src="https://ipic.zoomquiet.top/2022-12-14-zshot%202022-12-14%2021.31.48.jpg" alt="rust" /></p>
<p>ä¸è¿‡æœ€ç»ˆæ˜¯ä¹±åºæ¥çš„</p>
<h2 id="refer-9"><a class="header" href="#refer-9">refer.</a></h2>
<blockquote>
<p>å„ç§å‚è€ƒ</p>
</blockquote>
<p><a href="https://cheats.rs/">Rust Language Cheat Sheet</a></p>
<ul>
<li><a href="https://juejin.cn/post/7146144676532191262">16ï½œæ•°æ®ç»“æ„ï¼šVec<T>ã€&amp;[T]ã€Box&lt;[T]&gt; ï¼Œä½ çœŸçš„äº†è§£é›†åˆå®¹å™¨ä¹ˆï¼Ÿ - æ˜é‡‘</a></li>
<li>...</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a16a825f50d4d34866d432c15fa3ebd~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?" alt="" /></p>
<h2 id="logging-7"><a class="header" href="#logging-7">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>221214 ZQ init.</li>
</ul>
<pre><code>           _~^*`~_
       () /  â—´ O  \ (/
         '_   âµ   _'
         | '--+--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rs42all-your-base"><a class="header" href="#rs42all-your-base">rs42all-your-base</a></h1>
<blockquote>
<p>æ‰€æœ‰è¿›åˆ¶</p>
</blockquote>
<h2 id="background-10"><a class="header" href="#background-10">background</a></h2>
<blockquote>
<p>å…·ä½“èƒŒæ™¯</p>
</blockquote>
<p><a href="https://exercism.org/docs/tracks/rust">All Your Base in Rust on Exercism</a></p>
<h2 id="logging-8"><a class="header" href="#logging-8">logging</a></h2>
<blockquote>
<p>è®°è¦</p>
</blockquote>
<h3 id="try_fold"><a class="header" href="#try_fold">try_fold()</a></h3>
<blockquote>
<p>è¡¨è¾¾èƒ½åŠ›çš„å…¸èŒƒ...</p>
</blockquote>
<h2 id="refer-10"><a class="header" href="#refer-10">refer.</a></h2>
<blockquote>
<p>å„ç§å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Positional_notation#External_links">Positional notation - Wikipedia</a></li>
<li><a href="https://doc.rust-lang.org/stable/std/iter/trait.Iterator.html">Iterator in std::iter - Rust</a>
<ul>
<li><a href="https://qiita.com/lo48576/items/34887794c146042aebf1">Rustã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ç¶²ç¾…çš„ã‹ã¤å¤§é›‘æŠŠãªç´¹ä»‹ - Qiita</a></li>
<li><a href="https://zenn.dev/megeton/articles/fb6266bcb6aa1b">Rubyè„³ã®ãŸã‚ã®Rusté…åˆ—ç³»ãƒ¡ã‚½ãƒƒãƒ‰ã¾ã¨ã‚</a></li>
<li>...</li>
</ul>
</li>
<li><a href="https://rustcc.cn/article?id=2f4b3a15-7874-4c68-b9d8-5a717e9a3af0">rustæ–°æ‰‹çš„ä¸€ä¸ªé—®é¢˜ï¼šfoldå’Œscanã€‚ - Rustè¯­è¨€ä¸­æ–‡ç¤¾åŒº</a>
<ul>
<li><a href="https://juejin.cn/post/7067102952602746910">æŠ›å¼ƒRustçš„try...catchå’Œnullæ£€æŸ¥ - æ˜é‡‘</a></li>
<li>...</li>
</ul>
</li>
</ul>
<pre><code>         _~-|^~_
     () /  ? o  \ \/
       '_   â   _'
       ( '--.--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ex43allergies"><a class="header" href="#ex43allergies">ex43Allergies</a></h1>
<blockquote>
<p>è¿‡æ•æº</p>
</blockquote>
<h2 id="background-11"><a class="header" href="#background-11">background</a></h2>
<blockquote>
<p>å…·ä½“èƒŒæ™¯</p>
</blockquote>
<p><a href="https://exercism.org/tracks/rust/exercises/allergies">Allergies in Rust on Exercism</a></p>
<h2 id="logging-9"><a class="header" href="#logging-9">logging</a></h2>
<blockquote>
<p>è®°è¦</p>
</blockquote>
<h3 id=""><a class="header" href="#">&amp;</a></h3>
<blockquote>
<p>ç°å®ä¸–ç•Œçš„ ä¸è®¡ç®—</p>
</blockquote>
<h2 id="refer-11"><a class="header" href="#refer-11">refer.</a></h2>
<blockquote>
<p>å„ç§å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://hltj.me/lang/2016/11/07/10m-letters.html">ç”±â€œåƒä¸‡å­—æ¯è¡¨é—®é¢˜â€çœ‹å¤šèŒƒå¼ç¼–ç¨‹è¯­è¨€ | ç°è“æ—¶å…‰</a>
<ul>
<li><a href="http://www.nct9.ne.jp/m_hiroi/linux/rust14.html">Linux Programming / ãŠæ°—æ¥½ Rust ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¶…å…¥é–€</a></li>
</ul>
</li>
<li>...</li>
</ul>
<pre><code>      _~~-~~_
  \) /  â—· â˜‰  \ \/
    '_   â   _'
    ( '-----' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¼€å‘"><a class="header" href="#å¼€å‘">å¼€å‘</a></h1>
<blockquote>
<p>projects ...</p>
</blockquote>
<h2 id="background-12"><a class="header" href="#background-12">background</a></h2>
<blockquote>
<p>æ— å¥ˆèƒŒæ™¯</p>
</blockquote>
<p>å¼€å‘è¯­è¨€å­¦ä¹ , ä¸ç”¨æ¥å¼€å‘çœŸå®é¡¹ç›®, åŸºæœ¬æ˜¯è¡¨æ¼”å­¦ä¹ è¡Œä¸ºäº†...</p>
<h2 id="goal-9"><a class="header" href="#goal-9">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>ä¸€ç»„æ—¥å¸¸è¦ç”¨å·¥å…·, åŸåˆ›/å†åˆ¶/...</p>
<p>å…³é”®æ˜¯ç§¯ç´¯ä¸€ç»„å¯ç”¨ä½œå“, æ‰“åº•å„¿.</p>
<h2 id="trace-10"><a class="header" href="#trace-10">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<p>MVP ~ æœ€å°å¯è¡Œå·¥ç¨‹èƒ½åŠ›?</p>
<ul>
<li><input disabled="" type="checkbox"/>
å·¥ç¨‹ç»“æ„
<ul>
<li><input disabled="" type="checkbox"/>
crate/library/pakage/workspace/project åˆ’åˆ†å’Œä½¿ç”¨
<ul>
<li><input disabled="" type="checkbox" checked=""/>
package ~ cargo new å‡ºæ¥çš„ä¸œè¥¿</li>
<li><input disabled="" type="checkbox" checked=""/>
crate ~ src/*.rs 
<ul>
<li>äºŒè¿›åˆ¶åŒ…
<ul>
<li><code>src/main.rs</code> </li>
<li><code>src/bin/*.rs</code> </li>
</ul>
</li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
library ~ src/lib.rs</li>
<li><input disabled="" type="checkbox" checked=""/>
module ~ mod åœˆå®šçš„ä»£ç å—
- ç»å¯¹/ç›¸å¯¹å¼•ç”¨è·¯å¾„
- self/super/crate/... ~&gt; <a href="https://rustwiki.org/zh-CN/rust-by-example/mod/split.html">super å’Œ self - é€šè¿‡ä¾‹å­å­¦ Rust ä¸­æ–‡ç‰ˆ</a>
- rustc 1.30+ è¦æ±‚:
- åŒçº§ç›®å½•åˆ›å»º mod ååŒåç›®å½•
- åœ¨å…¶ä¸­åˆ›å»ºå­æ¨¡å—.rs æ–‡ä»¶
- æ­¤æ—¶æ‰èƒ½åœ¨ mod ååŒå .rs ä¸­ä½¿ç”¨ mod æ¥å¼•ç”¨
- lib.rs ~ æ£€ç´¢æ›´æ–¹ä¾¿
- crates.rs ~ ä¸‹è½½æœ€ç¨³å®š</li>
<li><input disabled="" type="checkbox" checked=""/>
use å’Œå¯è§æ€§...
<ul>
<li>ç»“æ„ä½“å’Œæšä¸¾çš„å¯è§æ€§...<a href="https://rustwiki.org/zh-CN/rust-by-example/mod/struct_visibility.html#%E5%8F%82%E8%A7%81">ç»“æ„ä½“çš„å¯è§æ€§ - é€šè¿‡ä¾‹å­å­¦ Rust ä¸­æ–‡ç‰ˆ</a></li>
<li>ä¼˜å…ˆä½¿ç”¨æœ€ç»†ç²’åº¦(å¼•å…¥å‡½æ•°ã€ç»“æ„ä½“ç­‰)çš„å¼•ç”¨æ–¹å¼ï¼Œå¦‚æœå¼•èµ·äº†æŸç§éº»çƒ¦(ä¾‹å¦‚å‰é¢ä¸¤ç§æƒ…å†µ)ï¼Œå†ä½¿ç”¨å¼•å…¥æ¨¡å—çš„æ–¹å¼</li>
<li>ä¸åŒæ¨¡å—åŒå as åˆ«åå¼•ç”¨</li>
<li>use xxx::{self, yyy}; ~ é›†æˆå¼•ç”¨</li>
<li>use std::collections::*; ~ åªç”¨æ¥å¼•å…¥ tests</li>
<li>pub use ~ å¼•å…¥åå†å¯¼å‡º(æ‰€æœ‰æƒæ— å¤„ä¸åœ¨...)</li>
<li>pub(in crate::a) ... é™åˆ¶å¯è§æ€§è¯­æ³•
<ul>
<li>pub æ„å‘³ç€å¯è§æ€§æ— ä»»ä½•é™åˆ¶</li>
<li>pub(crate) è¡¨ç¤ºåœ¨å½“å‰åŒ…å¯è§</li>
<li>pub(self) åœ¨å½“å‰æ¨¡å—å¯è§</li>
<li>pub(super) åœ¨çˆ¶æ¨¡å—å¯è§</li>
<li>pub(in <path>) è¡¨ç¤ºåœ¨æŸä¸ªè·¯å¾„ä»£è¡¨çš„æ¨¡å—ä¸­å¯è§ï¼Œå…¶ä¸­ <code>path</code> å¿…é¡»æ˜¯çˆ¶æ¨¡å—æˆ–è€…ç¥–å…ˆæ¨¡å—</li>
<li>~&gt; <a href="https://course.rs/basic/crate-module/use.html#%E9%99%90%E5%88%B6%E5%8F%AF%E8%A7%81%E6%80%A7%E8%AF%AD%E6%B3%95">ä½¿ç”¨ use å¼•å…¥æ¨¡å—åŠå—é™å¯è§æ€§ - Rustè¯­è¨€åœ£ç»(Rust Course)</a></li>
</ul>
</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
workspace</li>
<li><input disabled="" type="checkbox"/>
project</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
æ¨¡å—åˆ‡åˆ†/å‘½å..è‰ºæœ¯?</li>
<li><input disabled="" type="checkbox" checked=""/>
<a href="https://wangchujiang.com/rust-cn-document-for-docker/cargo/reference/publishing.html#%E6%89%93%E5%8C%85%E4%B8%80%E4%B8%AA-crate">å°† crate å‘å¸ƒåˆ° Crates.io - Cargo æ‰‹å†Œ ä¸­æ–‡ç‰ˆ</a></li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬åº”ç”¨
<ul>
<li><input disabled="" type="checkbox" checked=""/>
åŸºæœ¬è°ƒè¯•å¾ªç¯ ~ é…åˆ tracing å’Œ log ç›®å½•...</li>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬å•å…ƒæµ‹è¯•</li>
<li><input disabled="" type="checkbox" checked=""/>
åŸºæœ¬ç¼–è¯‘å‘è¡Œ ~ cargo build</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
åˆ†å¸ƒå¼
<ul>
<li><input disabled="" type="checkbox"/>
è°ƒè¯•/è¿½è¸ª</li>
<li><input disabled="" type="checkbox"/>
CI/CD</li>
<li><input disabled="" type="checkbox"/>
...</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
æ ¸å¿ƒæ¦‚å¿µ/æŠ€èƒ½
<ul>
<li><input disabled="" type="checkbox"/>
å†…å»ºæ•°æ®ç±»å‹</li>
<li><input disabled="" type="checkbox"/>
æ™ºèƒ½æŒ‡é’ˆ</li>
<li><input disabled="" type="checkbox"/>
æ‰€æœ‰æƒå’Œå€Ÿç”¨</li>
<li><input disabled="" type="checkbox"/>
æ³›å‹</li>
<li><input disabled="" type="checkbox"/>
trait</li>
<li><input disabled="" type="checkbox"/>
ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
é«˜çº§å·¥ç¨‹æŠ€å·§
<ul>
<li><input disabled="" type="checkbox"/>
å®</li>
<li><input disabled="" type="checkbox"/>
GDB</li>
<li><input disabled="" type="checkbox"/>
...</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
åµŒå…¥å¼
<ul>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬å·¥å…·ç®±</li>
<li><input disabled="" type="checkbox"/>
Pico</li>
<li><input disabled="" type="checkbox"/>
...</li>
</ul>
</li>
</ul>
<h2 id="refer-12"><a class="header" href="#refer-12">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://www.contributor-covenant.org/zh-cn/version/2/1/code_of_conduct/">è´¡çŒ®è€…å…¬çº¦/Contributor Covenant:</a></p>
<ul>
<li><a href="https://llever.com/gentle-intro/readme.zh.html">ä»‹ç» - Rust çš„ç»…å£«ä»‹ç»</a></li>
<li><a href="https://www.sheshbabu.com/posts/rust-module-system/">Clear explanation of Rustâ€™s module system</a></li>
<li><a href="https://wangchujiang.com/rust-cn-document-for-docker/cargo/reference/publishing.html#%E6%89%93%E5%8C%85%E4%B8%80%E4%B8%AA-crate">å°† crate å‘å¸ƒåˆ° Crates.io - Cargo æ‰‹å†Œ ä¸­æ–‡ç‰ˆ</a></li>
<li>å„ç§å€¼å¾—å°è¯•çš„ä½œå“ç±»å‹:
<ul>
<li>SSG: <a href="https://www.youtube.com/watch?v=9uAy8skUVsc">Tutorial: Building a Blog in Rust - Static File Server - YouTube</a></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h2 id="logging-10"><a class="header" href="#logging-10">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230228 ZQ ++ğŸ¦€ğŸ¦€ğŸ¦€</li>
<li>221023 ZQ init.</li>
</ul>
<pre><code>           _~`+~~_
       () /  â™¡ â—·  \ \/
         '_   V   _'
         \ '--~--' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å®è·µä½œå“"><a class="header" href="#å®è·µä½œå“">å®è·µä½œå“</a></h1>
<h2 id="background-13"><a class="header" href="#background-13">background</a></h2>
<p>å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€, æœ€é«˜æ•ˆçš„å§¿åŠ¿å°±æ˜¯æ‹¿æ¥ä½¿ç”¨äº†</p>
<h2 id="goal-10"><a class="header" href="#goal-10">goal</a></h2>
<p>å°†å½“å‰æ—¥å¸¸è¦ç”¨çš„å„ç§å·¥å…·, è½¬åŒ–ä¸º rust ç‰ˆæœ¬çš„...</p>
<h2 id="plan"><a class="header" href="#plan">plan</a></h2>
<p>è¿›å±•å›¾ä¾‹: </p>
<ul>
<li>
<p>ğŸŒš ~ èŒåŠ¨</p>
</li>
<li>
<p>ğŸŒ˜ ~ å¼€æ</p>
</li>
<li>
<p>ğŸŒ— ~ æŠ˜è…¾</p>
</li>
<li>
<p>ğŸŒ– ~ å¯ç”¨</p>
</li>
<li>
<p>ğŸŒ ~ å‘å¸ƒ</p>
</li>
<li><input disabled="" type="checkbox"/>
<p>ğŸŒ–NNera ~ ç‰›å¦çºªå…ƒ</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
CLI</li>
<li><input disabled="" type="checkbox"/>
å‘å¸ƒ</li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
<p>ğŸŒbxmr ~ BXM è¾“å…¥ç è¡¨ç»´æŠ¤å™¨</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
CLI</li>
<li><input disabled="" type="checkbox" checked=""/>
å‘å¸ƒ</li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
<p>ğŸŒ ferris ~ å‰ç¥¥ç‰©ASCII-art ç”Ÿæˆå™¨</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
CLI</li>
<li><input disabled="" type="checkbox" checked=""/>
crate</li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
<p>ğŸŒ<a href="dev//dev/cli_rss4mdbook.html">RSS4mdbook</a> è‡ªåˆ¶ RSS ç”Ÿæˆå™¨</p>
</li>
<li><input disabled="" type="checkbox"/>
<p>ğŸŒš yuzu ~ æŸšå­, ç®€é™‹çš„ç§ç”¨çŸ­å€ç”Ÿæˆå™¨</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
SUUID ~ çŸ­ UUID ç”Ÿæˆå™¨; ç»„åˆæ ‡å‡†çš„ UUID+Md5 å°±å¥½
<ul>
<li><input disabled="" type="checkbox"/>
è‡ªåˆ¶, å‚è€ƒ: <a href="https://github.com/skorokithakis/shortuuid/blob/master/shortuuid/main.py">shortuuid/main.py at master Â· skorokithakis/shortuuid</a></li>
<li><input disabled="" type="checkbox"/>
crate</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
CLI</li>
<li><input disabled="" type="checkbox"/>
å‘å¸ƒ
<ul>
<li><input disabled="" type="checkbox"/>
RESTful ... etc</li>
</ul>
</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
<p>ğŸŒš Yazi ~ çšçœ¦ git ä»“åº“è¡Œä¸ºåˆ†æå™¨</p>
<ul>
<li><input disabled="" type="checkbox"/>
CLI</li>
<li><input disabled="" type="checkbox"/>
å‘å¸ƒ</li>
</ul>
</li>
</ul>
<h2 id="trace-11"><a class="header" href="#trace-11">trace</a></h2>
<blockquote>
<p>è¿½è¸ªç¬”è®°</p>
</blockquote>
<p>æŒæ¡ rust åˆ°ä»€ä¹ˆç¨‹åº¦å°±èƒ½ç»™è‡ªå·±å¼€å§‹å°å·¥å…·äº†?</p>
<ul>
<li>ç›®æµ‹å˜¦ä¼šç”¨ RA å°±å¯ä»¥äº†...å‘—?</li>
<li>...</li>
</ul>
<h3 id="crateio"><a class="header" href="#crateio">crate.io</a></h3>
<blockquote>
<p>cargo login 
é¦–å…ˆå¶åˆ°çš„é—®é¢˜:</p>
</blockquote>
<pre><code>$ cargo login [è‡ªå·±çš„ crate.io token]
error: crates-io is replaced with non-remote-registry source registry `tuna`;
include `--registry crates-io` to use crates.io
</code></pre>
<p>æ„å‘³ç€ä½ çš„ Rust åŒ…ç®¡ç†å™¨ Cargo æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªåä¸º tuna çš„æœ¬åœ° Rust åŒ…æºï¼Œè€Œä¸æ˜¯é»˜è®¤çš„è¿œç¨‹æº crates.ioã€‚</p>
<p>æ ¹æ®æç¤ºé¦–æ¬¡ä½¿ç”¨å®˜æ–¹æº:</p>
<pre><code>$ cargo login [è‡ªå·±çš„ crate.io token] --registry crates-io -v
    Updating crates.io index
     Running `git fetch --force --update-head-ok 'https://github.com/rust-lang/crates.io-index' '+HEAD:refs/remotes/origin/HEAD'`
       Login token for `crates-io` saved
</code></pre>
<p>è¿½åŠ ä¸Šç›®æ ‡ä»“åº“ <code>--registry crates-io</code> å°±å¯ä»¥å®Œæˆäº†...
(å¤§çº¦3åˆ†é’Ÿå)</p>
<blockquote>
<p>cargo package</p>
</blockquote>
<pre><code>$ cargo package
...
   Compiling proc-macro2 v1.0.51
   Compiling quote v1.0.23
   Compiling unicode-ident v1.0.6
   Compiling libc v0.2.139
    ...
   Compiling ferris-actor v0.1.42 (/path/2/../ferris-actor/target/package/ferris-actor-0.1.42)
    Finished dev [unoptimized + debuginfo] target(s) in 20.85s
    Packaged 12 files, 40.8KiB (13.1KiB compressed)
</code></pre>
<p>ä¸é”™, è‡ªåŠ¨åŒ–å®Œæˆæ‰€æœ‰</p>
<blockquote>
<p>cargo publish --registry crates-io</p>
</blockquote>
<pre><code>$ cargo publish --registry crates-io
    Updating crates.io index
...
   Compiling proc-macro2 v1.0.51
   Compiling unicode-ident v1.0.6
   Compiling quote v1.0.23
   ...

</code></pre>
<p>åŒæ ·, å¿…é¡»è¿½åŠ ä¸Š <code>--registry crates-io</code> ç›®æ ‡ä»“åº“å‚æ•°</p>
<blockquote>
<p>LICENSES</p>
</blockquote>
<pre><code>...
    Packaged 12 files, 40.9KiB (13.1KiB compressed)
   Uploading ferris-actor v0.1.42 (/Users/zoomq/Exercism/proj/ferris-actor)
error: failed to publish to registry at https://crates.io

</code></pre>
<p>æ— æ³•å®Œæˆå‘å¸ƒ, åŸå› ç«Ÿç„¶æ˜¯ Caused by:</p>
<ul>
<li>the remote server responded with an error: unknown or invalid license expression; 
<ul>
<li>see http://opensource.org/licenses for options, </li>
<li>and http://spdx.org/licenses/ for their identifiers</li>
</ul>
</li>
</ul>
<p>å¯¹æ¯”å…¶å®ƒ crate ä¿®è®¢ Cargo.toml ä¸­çš„å…³é”®é…ç½®é¡¹ç›®ä¸º:</p>
<blockquote>
<p>license = &quot;BSD-2-Clause&quot;</p>
</blockquote>
<p>æ˜¯çš„, å°±å°‘äº† github è‡ªåŠ¨åˆ›å»ºæ—¶åé¢çš„ä¸€ä¸ª <code>License</code> å°±é€šè¿‡äº†:</p>
<pre><code>$   cargo publish --registry crates-io
    Updating crates.io index
...
     Waiting on `ferris-actor` to propagate to crates.io index (ctrl-c to wait asynchronously)
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
    Updating crates.io index
</code></pre>
<p>å®Œæˆå‘å¸ƒ;-)</p>
<h2 id="refer-13"><a class="header" href="#refer-13">refer.</a></h2>
<blockquote>
<p>å„ç§ç›¸å…³å‚è€ƒ...</p>
</blockquote>
<ul>
<li><a href="https://www.oreilly.com/library/view/command-line-rust/9781098109424/">Command-Line Rust [Book]</a>
<ul>
<li><a href="https://determinate.systems/posts/determinate-nix-installer">Introducing the Determinate Nix Installer â€” Determinate Systems</a> ~ å®æˆ˜æ¡ˆä¾‹, ä» bash è¿ç§»ä¸º rust...</li>
</ul>
</li>
<li><a href="https://rustacean.net/">Rustacean.net: Home of Ferris the Crab</a></li>
<li>...</li>
</ul>
<h3 id="pg"><a class="header" href="#pg">+Pg</a></h3>
<p><a href="https://postgresconf.org/blog/posts/from-zero-to-postgresql-extension-in-3-hours-with-rust">From Zero to PostgreSQL extension in 3 hours with Rust - Postgres Conference</a></p>
<ul>
<li>+Tokio ~ <a href="https://shanmukhsista.com/real-world-rest-api-using-rust-axum-framework-with-request-validations-and-error-handling-75d4175cef96">How to Write a REST API Using Rust and Axum Framework | by Shanmukh Sista | Medium</a></li>
<li>
<ul>
<li>SQLx ~ <a href="https://codevoweb.com/rust-build-a-crud-api-with-sqlx-and-postgresql/">Rust - Build a CRUD API with SQLX and PostgreSQL 2023</a>
<ul>
<li><a href="https://zenn.dev/codemountains/articles/159a8a0323a56f">Axum ã¨ SQLx ã§ Todo ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ï¼ˆDB ã¯ PostgreSQLï¼‰</a></li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://genekuo.medium.com/creating-a-rest-api-in-rust-with-persistence-rust-rocket-and-diesel-a4117d400104">Creating a REST API in Rust with Persistence: Rust, Rocket and Diesel | by Gene Kuo | Medium</a></li>
<li>+actix ~ <a href="https://cloudmaker.dev/how-to-create-a-rest-api-in-rust/">Rust Web Development Tutorial: REST API | Cloudmaker</a></li>
<li></li>
</ul>
<h2 id="logging-11"><a class="header" href="#logging-11">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>...</li>
<li>230122 ZQ init.</li>
</ul>
<pre><code>       _~âˆ½*^~_
   () /  â—´ =  \ \/
     '_   âŒ„   _'
     ( '--#--' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tuicli"><a class="header" href="#tuicli">TUI:CLI</a></h1>
<h2 id="backgroung"><a class="header" href="#backgroung">backgroung</a></h2>
<p>ä½œä¸ºä¸€åç¨‹åºçŒ¿, ç»ˆç«¯å‡ ä¹å°±æ˜¯ç”Ÿå­˜ç©ºé—´, 
åœ¨è¿™è¿™é‡Œå€¼å¾—æŠ˜è…¾ä¸€åˆ‡...</p>
<h2 id="goal-11"><a class="header" href="#goal-11">goal</a></h2>
<p>æ‰¾åˆ°ä¸€ç§èˆ’æœçš„å§¿åŠ¿:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
å¯ä»¥å¿«é€Ÿæ„é€ å‡ºå„ç§ CLI å·¥å…·
<ul>
<li><input disabled="" type="checkbox" checked=""/>
<a href="https://qiita.com/Tadahiro_Yamamura/items/4ae32347fb4be07ea642#app%E3%81%A8parser%E3%81%AE%E3%81%A9%E3%81%A1%E3%82%89%E3%82%92%E4%BD%BF%E3%81%86%E3%81%B9%E3%81%8D%E3%81%8B">Rustã§æ‰‹è»½ã«CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Œã‚‹clapã‚’è»½ãç´¹ä»‹ã™ã‚‹ - Qiita</a></li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
å¯ä»¥å¿«é€Ÿæ„é€ å‡ºå„ç§ TUI è½¯ä»¶ ~ ç±»ä¼¼ POS ç³»ç»Ÿç•Œé¢çš„...
<ul>
<li>å‚è€ƒä½œå“: <a href="https://github.com/extrawurst/gitui/search?l=makefile">extrawurst/gitui: Blazing ğŸ’¥ fast terminal-ui for git written in rust ğŸ¦€</a>
<ul>
<li><a href="https://github.com/ClementTsang/bottom">ClementTsang/bottom: Yet another cross-platform graphical process/system monitor.</a></li>
<li><a href="https://github.com/actuday6418/Diary">actuday6418/Diary: Encrypted memories</a></li>
<li><a href="https://github.com/TaKO8Ki/gobang">TaKO8Ki/gobang: A cross-platform TUI database management tool written in Rust</a></li>
<li>...</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="tracing"><a class="header" href="#tracing">tracing</a></h2>
<blockquote>
<p>é—®é¢˜æ˜¯è¿™ä¹ˆæ¥çš„...</p>
</blockquote>
<h2 id="refer-14"><a class="header" href="#refer-14">refer.</a></h2>
<p><a href="https://github.com/rothgar/awesome-tuis">rothgar/awesome-tuis: List of projects that provide terminal user interfaces</a></p>
<ul>
<li><a href="https://www.libhunt.com/l/rust/topic/tui">Top 23 Rust TUI Projects (Feb 2023)</a>
<ul>
<li><a href="https://blog.logrocket.com/rust-and-tui-building-a-command-line-interface-in-rust/">Rust and TUI: Building a command-line interface in Rust - LogRocket Blog</a></li>
<li><a href="https://developers.facebook.com/blog/2022/">Superconsole, a Text-based User Interface (TUI) library written in Rust</a></li>
<li><a href="https://www.reddit.com/r/rust/comments/xdxcpr/intuitive_a_crate_for_writing_tuis_declaratively/">Intuitive: A crate for writing TUIs declaratively : rust</a></li>
<li><a href="https://dev.to/protium/creating-a-text-based-ui-with-rust-420">Creating a Text-based UI with rust - DEV Community</a></li>
<li><a href="https://blog.ediri.io/how-to-build-a-trivy-plugin-in-rust">How to build a Trivy plugin in Rust ğŸ¦€</a></li>
<li>...</li>
</ul>
</li>
<li>7.4kâ˜… <a href="https://github.com/DioxusLabs/dioxus/releases">DioxusLabs/dioxus: Friendly React-like GUI library for desktop, web, mobile, and more.</a>
<ul>
<li><a href="https://dioxus.mrxzx.info/">ä»‹ç» - Dioxus</a></li>
</ul>
</li>
<li><a href="https://github.com/gyscos/cursive">gyscos/cursive: A Text User Interface library for the Rust programming language</a></li>
<li><a href="https://github.com/redox-os/termion/watchers">redox-os/termion: Mirror of https://gitlab.redox-os.org/redox-os/termion</a> ~ åŠ¨ç”»ç‰‡ä¸“æ³¨...</li>
<li><a href="https://github.com/fdehau/tui-rs">fdehau/tui-rs: Build terminal user interfaces and dashboards using Rust</a></li>
<li>...</li>
</ul>
<pre><code>       _~^|âˆ½~_
   \/ /  # O  \ (/
     '_   ğŸ‚   _'
     &gt; '-----' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nn-çºªå…ƒ"><a class="header" href="#nn-çºªå…ƒ">NN çºªå…ƒ</a></h1>
<blockquote>
<p>CLI å°ä½œå“</p>
</blockquote>
<h2 id="backgroung-1"><a class="header" href="#backgroung-1">backgroung</a></h2>
<p>ä½œä¸ºä¸€åç¨‹åºçŒ¿æ€»æ˜¯è¦æœ‰ä¸€ç§ç‰¹æ®Šçš„æ—¶é—´ç‚¹è®°å½•ç³»ç»Ÿ...</p>
<h2 id="goal-12"><a class="header" href="#goal-12">goal</a></h2>
<p>ä»¥å¥³å„¿å‡ºç”Ÿå½“å¤©é›¶æ—¶, ä¸ºç±»ä¼¼ UNIX æ—¶é—´æˆ³çš„èµ·ç‚¹,
å¯ä»¥åœ¨å„ç§ç³»ç»Ÿä¸­å¿«é€Ÿç¡®å®š/åæŸ¥:</p>
<ul>
<li>nn ~ é»˜è®¤ç»™å‡ºå½“å¤©æ˜¯å¥³å„¿å‡ºç”Ÿç¬¬å‡ å¤©</li>
<li>nn -e 4200 ~ ç»™å‡ºæŒ‡å®š NNera æ˜¯å…¬å† YYYY-mm-dd</li>
<li>nn -d 230225 ~ ç»™å‡ºæŒ‡å®š yymmdd æ—¥æœŸæ˜¯å¥³å„¿å‡ºç”Ÿç¬¬å‡ å¤©</li>
</ul>
<h2 id="trace-12"><a class="header" href="#trace-12">trace</a></h2>
<ul>
<li>æœ€æ—©æ˜¯ æ¯å¤©æ—¥è®°æ—¶, æ‰‹å·¥å¢é‡, äººå·¥æŸ¥è¯¢;</li>
<li>åæ¥ç”¨ Python å†™äº†ä¸ªè„šæœ¬, ä½†æ˜¯, ç¯å¢ƒéƒ¨ç½²æ˜¯ä¸ªéº»çƒ¦äº‹å„¿;</li>
<li>ç„¶å, å­¦ä¹  Elixri æ—¶å†™äº†ä¸ªå·¥å…·, ä½†æ˜¯, å‘ç°ç«Ÿç„¶æ²¡åŠæ³•ç®€å•ç¼–è¯‘ä¸º Linux åº”ç”¨;</li>
<li>åˆåæ¥, å­¦ä¹  Golang æ—¶å†™äº†ä¸ªæŒ‡ä»¤, å‘ç°, ç«Ÿç„¶è¶…è¿‡ 10M ...</li>
<li>æœ€åç”¨ bash ç¼–äº†ä¸ª .sh è„šæœ¬åè€Œå…¼å®¹æ€§æœ€å¥½</li>
<li>ç°åœ¨, è½®åˆ° Rust æ¥é‡æ„äº†...</li>
</ul>
<h2 id="refer-15"><a class="header" href="#refer-15">refer.</a></h2>
<ul>
<li><a href="https://docs.rs/clap/latest/clap/index.html">clap - Rust</a>
<ul>
<li><a href="https://blog.ediri.io/lets-build-a-cli-in-rust">Let's build a CLI in Rust ğŸ¦€</a></li>
<li><a href="https://medium.com/javascript-in-plain-english/coding-wont-exist-in-5-years-this-is-why-6da748ba676c">Building a CLI from scratch with Clapv3 | by Ukpai Ugochi | Medium</a></li>
<li><a href="https://qiita.com/Tadahiro_Yamamura/items/4ae32347fb4be07ea642">Rustã§æ‰‹è»½ã«CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Œã‚‹clapã‚’è»½ãç´¹ä»‹ã™ã‚‹ - Qiita</a></li>
<li><a href="https://zenn.dev/shinobuy/articles/53aed032fe5977">Rustã®Clapã‚¯ãƒ¬ãƒ¼ãƒˆãŒãƒ¡ãƒãƒ£ã‚¯ãƒãƒ£è‰¯ã‹ã£ãŸè©±</a></li>
<li><a href="https://juejin.cn/post/7158808367233204261">å¦‚ä½•ç”¨clapè¿›è¡Œå‘½ä»¤è¡Œè§£æ - æ˜é‡‘</a></li>
</ul>
</li>
<li><a href="https://docs.rs/structopt/latest/structopt/trait.StructOpt.html">structopt - Rust</a>
<ul>
<li><a href="https://suibianxiedianer.github.io/rust-cli-book-zh_CN/crates/README_zh.html">è§£æå‘½ä»¤è¡Œå‚æ•° - Rust ä¸­çš„å‘½ä»¤è¡Œåº”ç”¨</a></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h2 id="logging-12"><a class="header" href="#logging-12">logging</a></h2>
<ul>
<li>...</li>
<li>230228 ZQ ...ğŸ¦€</li>
<li>230225 ZQ re-re-re-init.</li>
</ul>
<pre><code>          _~^+`~_
      \/ /  + ^  \ (/
        '_   âˆ§   _'
        ( '-----' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ferris-actor"><a class="header" href="#ferris-actor">Ferris-Actor</a></h1>
<blockquote>
<p>Freeis ASCII-art actor and CLI animation/tools
å•åœ¨ç»ˆç«¯ä¸­èµ·èˆåŠ¨çš„ Ferris, è¿™æ¬¡å¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ª pose ä»¥ä¾› Markdown ä½¿ç”¨</p>
</blockquote>
<p>é¦–ä¸ª crate å‘å¸ƒ:
<strong><a href="https://crates.io/crates/ferris-actor">ferris-actor - crates.io: Rust Package Registry</a></strong></p>
<h2 id="backgroung-2"><a class="header" href="#backgroung-2">backgroung</a></h2>
<p>ä½œä¸ºä¸€åç¨‹åºçŒ¿, ç»ˆç«¯å‡ ä¹å°±æ˜¯ç”Ÿå­˜ç©ºé—´, åœ¨è¿™è¿™é‡Œå‘ç”Ÿä»€ä¹ˆ, éƒ½ä¸å¥‡æ€ª</p>
<h2 id="goal-13"><a class="header" href="#goal-13">goal</a></h2>
<p>å®Œæˆæœ€æ—©åœ¨ç½‘é¡µä¸­çœ‹åˆ°çš„ ASCII-art ç‰ˆæœ¬ STAR WAR MOIVE....</p>
<h3 id="installation"><a class="header" href="#installation">installation</a></h3>
<p>...TBD</p>
<h3 id="usage"><a class="header" href="#usage">usage</a></h3>
<p>...TBD</p>
<h2 id="tracing-1"><a class="header" href="#tracing-1">tracing</a></h2>
<blockquote>
<p>é—®é¢˜æ˜¯è¿™ä¹ˆæ¥çš„...</p>
</blockquote>
<ul>
<li>å¦‚ä½•æ‰“å°å¤šè¡Œ?
<ul>
<li>println! å°±è¡Œ</li>
</ul>
</li>
<li>å¦‚ä½•åˆ·æ–°å¤šè¡Œ?
<ul>
<li>print!(&quot;\x1B[{}A&quot;, frames.len()); // move the cursor up</li>
<li>é—®é¢˜æ˜¯æ€ä¹ˆè®¡ç®—æ¯ä¸€å¸§çš„è¡Œæ•°?
<ul>
<li>å¥½å§, åˆ¶ä½œç»ˆç«¯ ASCII-art åŠ¨ç”»åŸæœ¬å°±æ˜¯æœ‰ä¸“ç”¨ crate çš„</li>
<li>ä¸Š: termion</li>
</ul>
</li>
</ul>
</li>
<li>å¦‚ä½•ä½¿ç”¨å¤šè¡Œæ‰“å°æ¨¡æ¿?
<ul>
<li>format!() ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å°±å¥½</li>
<li>å¦å¤–,ç”¨ indoc å¯ä»¥ç®€åŒ–å®šä¹‰å½¢å¼</li>
</ul>
</li>
<li>å¦‚ä½•å¤šè¡Œæ‰“å°æ¨¡æ¿ä»å¦å¤–æ–‡ä»¶å¼•ç”¨?
<ul>
<li>ä¸è¡Œ,å¿…é¡»æ˜¯: å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆstring literalï¼‰,åœ¨ç¼–è¯‘æ—¶è¦æ˜¯å·²çŸ¥çš„</li>
<li>è¿™å·²ç»ä¸æ˜¯ç®€å•çš„ format!() å‡½æ•°äº†,å®Œå…¨æ˜¯æ ‡å‡†çš„æ¨¡æ¿å¼•æ“äº†</li>
<li>è¿™ç§å½“ç„¶ä¹Ÿæ˜¯æœ‰ä¸“ç”¨ crate çš„
<ul>
<li>ä¸Š:handlebars</li>
</ul>
</li>
</ul>
</li>
<li>å¦‚ä½•å°† <code>Result&lt;std::string::String, RenderError&gt;</code> å…¼å®¹æå–ä¸º String?
<ul>
<li>map_err/unwrap_or_else/... å †ä¸Š, æ€»ä¹‹, ä¸èƒ½æ”¾ä»»ä½•ä¸€ä¸ªé—®é¢˜è·‘æ‰</li>
</ul>
</li>
<li>å¦‚ä½•å°† HTML è½¬ä¹‰å­—ç¬¦æ‰“å°å›åŸæœ¬çš„æ ·å­?
<ul>
<li>LOOK: <a href="https://handlebarsjs.com/guide/hooks.html">Introduction | Handlebars</a></li>
<li>åŸæ¥, Handlebars æ ¹æœ¬å°±æ˜¯ä¸ªæ¨¡æ¿è¯­è¨€, äººå®¶æœ‰å®Œå¤‡çš„åŠŸèƒ½è¯­æ³•</li>
<li>åªæ˜¯ <a href="https://crates.io/crates/handlebars/0.6.14">handlebars - crates.io: Rust Package Registry</a> å®Œæˆäº†å…¨éƒ¨æ”¯æŒ</li>
<li>è€Œä¸”, äººå®¶æ˜¯å°†è¿‘10å¹´çš„è€å·¥ç¨‹äº†,ä¸€ç›´åœ¨å®Œå–„</li>
</ul>
</li>
<li>...</li>
</ul>
<blockquote>
<p>Cargo.toml ç¼–è¯‘å‘è¡Œ</p>
</blockquote>
<p>å¼€å§‹æ‰¾åˆ°åŠæ³•, å¯ä»¥å°† Carogo.toml ä¸­çš„å…³é”®ä¿¡æ¯æ‹¿åˆ°ç¨‹åºä»£ç ä¸­ä½¿ç”¨, 
æ¯”å¦‚è¯´:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    let version = env::var(&quot;CARGO_PKG_VERSION&quot;).unwrap();
<span class="boring">}</span></code></pre></pre>
<p>å¯æƒœ, ç¼–è¯‘å‘è¡Œå, ä½¿ç”¨äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶å‡ºé”™:</p>
<pre><code class="language-shell">cd ./target/release/ferris-actor snap
Snap a randomly Ferris ASCII-art pose as Markdown:

thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: NotPresent', src/act/snap.rs:99:49
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>æ¯•ç«Ÿæ²¡æœ‰å¯¹åº”ç¯å¢ƒå˜é‡äº†, å¾—ä½¿ç”¨ç¼–è¯‘å‰æ–‡æœ¬æå–çš„åŠæ³•æ¥é™æ€åŒ–;
å‚è€ƒ: <a href="https://github.com/ogham/exa/commits/master/build.rs?author=ogham">exa/build.rs at master Â· ogham/exa</a></p>
<p>æ‰å‘ç°, Rust ä¸­ä½¿ç”¨ä¸€ä¸ªé™æ€é…ç½®, è¿™ä¹ˆå¤æ‚...</p>
<p>æ€è·¯æœ‰ä¸€äº›:</p>
<ul>
<li>ä½¿ç”¨ build.rs å®šåˆ¶ä¸åŒç¼–è¯‘è¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆçš„è¾…åŠ©æ–‡ä»¶:
<ul>
<li>å‚è€ƒ: <a href="https://github.com/ogham/exa/blob/master/build.rs#enroll-beta">exa/build.rs at master Â· ogham/exa</a></li>
<li>æ¯”å¦‚, åŒºåˆ†ä¸åŒçš„ç¼–è¯‘ç›®æ ‡æ—¶, åœ¨å¯¹åº”ç¼–è¯‘è·¯å¾„ä¸­åŠ¨æ€æ’å…¥ä¸€ä¸ª version.rs</li>
<li>åŒ…å«ä» Cargo.toml ä¸­æå–çš„ç‰ˆæœ¬ä¿¡æ¯, å¹¶å£°æ˜ä¸ºé™æ€å¸¸é‡:</li>
<li><code>write!(&amp;mut f, &quot;pub const VERSION: &amp;str = \&quot;{}\&quot;;\n&quot;, version).unwrap();</code></li>
<li>ç„¶å, åœ¨æƒ³å¼•ç”¨çš„æ–‡ä»¶ä¸­å¼•ç”¨</li>
<li>... Hummm, é—®é¢˜åœ¨è¿™å°±è±¡ä¸ªç¼–è¯‘å®, æ¯æ¬¡ç”Ÿæˆçš„ä¸œè¥¿æ ¹æœ¬æ˜¯ä¸å¯è§çš„</li>
</ul>
</li>
<li>ä½¿ç”¨ workspaces å°†å¯¹åº”å·¥å…·ç»„çš„æ¨¡å—æ”¾åˆ°ä¸“ç”¨è¾…åŠ©åº“ä¸­...
<ul>
<li>ç„¶å, å‘ç°è¿™å°±æ¶‰åŠå¤šå¤šä¸ª Crate çš„ç¼–è¯‘, æ”¹å˜äº†æ•´ä¸ªå„¿æ—¥å¸¸å¼€å‘æµç¨‹</li>
<li>... Hummm, æ”¾å¼ƒ</li>
</ul>
</li>
<li>ä½¿ç”¨ æœ¬åœ°åº“, åœ¨å½“å‰å·¥ç¨‹ç›®å½•ä¸­å†æ¥ä¸€å‘ <code>cargo new utils --lib</code>
<ul>
<li>å½¢æˆä¸€ä¸ªæ ¹ç›®å½•ä¸­çš„ <code>utils</code> æ–‡ä»¶å¤¹/åº“</li>
<li>ç„¶å,åœ¨åŸæœ‰ Cargo.toml ä¸­è¿½åŠ æœ¬åœ°ä¾èµ–, ç±»ä¼¼:</li>
</ul>
</li>
</ul>
<pre><code class="language-toml">[dependencies.utils]
path = &quot;utils&quot;
version = &quot;0.1.0&quot;
</code></pre>
<blockquote>
<p>ç„¶å, å‘ç°, <code>found to be present in multiple build targets:...</code> å’Œ workspaces ä¸€æ ·çš„æ¯›ç—…, Humm æ”¾å¼ƒ</p>
</blockquote>
<ul>
<li>ä½¿ç”¨æ™®é€šçš„åŒçº§è¾…åŠ©æ¨¡å— <code>src/act/version.rs</code> , åŸºäºæ ‡å‡†çš„ toml æ¨¡å—è§£æ Cargo.toml ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯;
<ul>
<li>é€šè¿‡ <code>env::current_dir()</code> è·å¾—å½“å‰ç³»ç»Ÿç»å¯¹è·¯å¾„</li>
<li>ä½¿ç”¨ <code>std::path::PathBuf</code> åˆç†æ“ä½œ, æ‹¼å‡º Cargo.toml çš„ç»å¯¹è·¯å¾„</li>
<li>å°±å¯ä»¥è¿›è¡Œæ­£å¸¸çš„é…ç½®æ–‡ä»¶è§£æå’Œä½¿ç”¨è€Œå·²...</li>
<li>...æ˜¯çš„, é€šäº†.</li>
</ul>
</li>
</ul>
<p>å¯æƒœæ˜¯å‡çš„:</p>
<pre><code class="language-shell">$ /opt/bin/ferris-actor snap
Snap a randomly Ferris ASCII-art pose as Markdown:

thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }', src/act/version.rs:22:51
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>å’Œä»¥å¾€ä¸€æ ·...</p>
<ul>
<li>å†·é™äº†ä¸€ä¸‹,æ‹ä¸€ä¸‹æ€è·¯:
<ul>
<li>ç›®çš„: å¯ä»¥ä» Cargo.toml ä¸­æ‹¿åˆ°ç‰ˆæœ¬ä¿¡æ¯, ç„¶åå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå½“å‰ç¼–è¯‘çš„æ—¶é—´æˆ³</li>
<li>ç„¶å: å…¶å®ƒåŠŸèƒ½ä»£ç ä¸­, å¯ä»¥å®‰å…¨è·å¾—è¿™ä¸ªåŠ¨æ€ä¿¡æ¯, é€šè¿‡ä¸€ç§é™æ€æ•°æ®å®šé‡çš„å½¢å¼</li>
<li>å‘ç°: built.rs æ˜¯ç§å¸¸ç”¨è¾…åŠ©å·¥å…·, å°±æ˜¯ä»‹å…¥ cargo å„ç§ç¼–è¯‘è¡Œä¸ºä¸­, äº‹å…ˆå®Œæˆå¯¹åº”å®šåˆ¶</li>
<li>é‚£ä¹ˆ: ä¸ºäº†å…¼å®¹å¼€å‘è°ƒè¯•å’Œç¼–è¯‘å‘è¡Œæ—¶ä¸¤ç§çŠ¶æ€å¯¹ <code>ç¼–è¯‘+ç‰ˆæœ¬</code> ä¿¡æ¯çš„ä½¿ç”¨å’Œç®¡ç†</li>
<li>è‡ªç„¶:
<ul>
<li>è¿˜æ˜¯ä½¿ç”¨ version.rs</li>
<li>ä¸è¿‡å†…å®¹ä¸æ˜¯è‡ªåŠ¨è·å¾—ä¿¡æ¯, è€Œæ˜¯ä¸€ä¸ªå®šé‡å£°æ˜è¯­å¥</li>
<li>å¯ä»¥åœ¨è°ƒè¯•æ—¶å…ˆå®Œæˆå¯¹åº” use å’Œæ£€éªŒ, å½“ç„¶å†…å®¹æ˜¯å¾¦çš„</li>
<li>åœ¨ built.rs 
<ul>
<li>ä¸­ä½¿ç”¨ cargo_metadata æ”¯æŒ, åŠ¨æ€ä» Cargo.toml ä¸­æ‹¿åˆ°ç‰ˆæœ¬ä¿¡æ¯</li>
<li>å†åŸºäº chrono è‡ªç”±ç”Ÿæˆéœ€è¦æ ¼å¼çš„æ—¶é—´æˆ³</li>
<li>å°† version.rs ä¸­æ•´ä¸ªå„¿å®šé‡å£°æ˜è¯­å¥åœ¨æ•´ä½“æ‹¼å¥½å†™å›å»</li>
</ul>
</li>
</ul>
</li>
<li>ä»¥ä¸Š, æœç„¶è¾¾æˆç›®æ ‡:
<ul>
<li>å‚è€ƒ:<a href="https://github.com/zhrust/ferris-actor/blob/main/build.rs">ferris-actor/build.rs at main Â· zhrust/ferris-actor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<blockquote>
<p>PS:
åªæ˜¯è¿™æ ·ä¸€æ¥, ä»“åº“ä¸­æ°¸è¿œæœ‰ä¸€ä¸ªå†…å®¹åœ¨åŠ¨æ€å˜åŒ–çš„æ–‡ä»¶,
å¯¼è‡´ <code>cargo publish</code> æ—¶æ€»æ˜¯å¤±è´¥, è¦ä½¿ç”¨å¯¹åº”å‚æ•°, æ— è§†ä¹‹...</p>
</blockquote>
</blockquote>
<pre><code class="language-shell">$  cargo publish --registry crates-io --allow-dirty --no-verify
</code></pre>
<h3 id="build---verbose"><a class="header" href="#build---verbose">build --verbose</a></h3>
<blockquote>
<p>cargo çœŸçš„æ˜¯ä¸ªå…¨èƒ½å·¥å…·ç®±</p>
</blockquote>
<p>ç»è¿‡æŒ–æ˜, æ‰çŸ¥é“, è¿›è¡Œ build æ—¶, å½“ç„¶å¯ä»¥å…¬å¼€æ‰€æœ‰è¡Œä¸º,
å¯ä»¥æ¸…æ™°çš„çœ‹åˆ° rustc åˆ°åº•åœ¨å¹²ä»€ä¹ˆ, æ¯ä¸ªæ­¥éª¤ä½¿ç”¨çš„å‚æ•°...</p>
<blockquote>
<blockquote>
<p>è¦çŸ¥é“è¿™äº›å‚æ•°å½“å¹´éƒ½æ˜¯äººå·¥é€ä¸€è¾“å…¥çš„...</p>
</blockquote>
</blockquote>
<pre><code>$  cargo build --release --verbose
...

       Fresh indoc v2.0.0
     Running `/Users/zoomq/Exercism/proj/ferris-actor/target/release/build/libc-44b1e034f3f26ee4/build-script-build`
     Running `rustc --crate-name core_foundation_sys /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/core-foundation-sys-0.8.3/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off -C metadata=f09e1a3332d57a02 -C extra-filename=-f09e1a3332d57a02 --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --cap-lints allow -l framework=CoreFoundation`
   Compiling iana-time-zone v0.1.53
     Running `rustc --crate-name iana_time_zone --edition=2018 /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/iana-time-zone-0.1.53/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off --cfg 'feature=&quot;fallback&quot;' -C metadata=2aca5692396caa43 -C extra-filename=-2aca5692396caa43 --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --extern core_foundation_sys=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libcore_foundation_sys-f09e1a3332d57a02.rmeta --cap-lints allow`
     Running `rustc --crate-name num_traits /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/num-traits-0.2.15/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off -C metadata=b04e009ff1e9804c -C extra-filename=-b04e009ff1e9804c --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --cap-lints allow --cfg has_i128 --cfg has_to_int_unchecked --cfg has_reverse_bits --cfg has_leading_trailing_ones --cfg has_int_assignop_ref --cfg has_div_euclid`
     Running `rustc --crate-name libc /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/libc-0.2.139/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off --cfg 'feature=&quot;default&quot;' --cfg 'feature=&quot;std&quot;' -C metadata=992234b65e6ba903 -C extra-filename=-992234b65e6ba903 --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --cap-lints allow --cfg freebsd11 --cfg libc_priv_mod_use --cfg libc_union --cfg libc_const_size_of --cfg libc_align --cfg libc_int128 --cfg libc_core_cvoid --cfg libc_packedN --cfg libc_cfg_target_vendor --cfg libc_non_exhaustive --cfg libc_ptr_addr_of --cfg libc_underscore_const_names --cfg libc_const_extern_fn`
   Compiling time v0.1.45
     Running `rustc --crate-name time /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/time-0.1.45/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off -C metadata=7bfae04e9962e5d8 -C extra-filename=-7bfae04e9962e5d8 --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --extern libc=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/liblibc-992234b65e6ba903.rmeta --cap-lints allow`
     Running `rustc --crate-name num_integer /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/num-integer-0.1.45/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off -C metadata=184fc31131d60eab -C extra-filename=-184fc31131d60eab --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --extern num_traits=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libnum_traits-b04e009ff1e9804c.rmeta --cap-lints allow --cfg has_i128`
   Compiling chrono v0.4.23
     Running `rustc --crate-name chrono --edition=2018 /Users/zoomq/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/chrono-0.4.23/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debug-assertions=off --cfg 'feature=&quot;clock&quot;' --cfg 'feature=&quot;default&quot;' --cfg 'feature=&quot;iana-time-zone&quot;' --cfg 'feature=&quot;js-sys&quot;' --cfg 'feature=&quot;oldtime&quot;' --cfg 'feature=&quot;std&quot;' --cfg 'feature=&quot;time&quot;' --cfg 'feature=&quot;wasm-bindgen&quot;' --cfg 'feature=&quot;wasmbind&quot;' --cfg 'feature=&quot;winapi&quot;' -C metadata=d3c20a3ba0fbfc72 -C extra-filename=-d3c20a3ba0fbfc72 --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --extern iana_time_zone=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libiana_time_zone-2aca5692396caa43.rmeta --extern num_integer=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libnum_integer-184fc31131d60eab.rmeta --extern num_traits=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libnum_traits-b04e009ff1e9804c.rmeta --extern time=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libtime-7bfae04e9962e5d8.rmeta --cap-lints allow`
   Compiling ferris-actor v0.2.4 (/Users/zoomq/Exercism/proj/ferris-actor)
     Running `rustc --crate-name build_script_build --edition=2021 build.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debug-assertions=off -C metadata=59b650788a6d6b7f -C extra-filename=-59b650788a6d6b7f --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/build/ferris-actor-59b650788a6d6b7f -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --extern cargo_metadata=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libcargo_metadata-86d30a0408a5a2b1.rlib --extern chrono=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libchrono-d3c20a3ba0fbfc72.rlib`
     Running `/Users/zoomq/Exercism/proj/ferris-actor/target/release/build/ferris-actor-59b650788a6d6b7f/build-script-build`
     Running `rustc --crate-name ferris_actor --edition=2021 src/main.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type bin --emit=dep-info,link -C opt-level=3 -C embed-bitcode=no -C metadata=a20b677d4d0c20d7 -C extra-filename=-a20b677d4d0c20d7 --out-dir /Users/zoomq/Exercism/proj/ferris-actor/target/release/deps -L dependency=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps --extern clap=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libclap-fd5df38d2b65208f.rlib --extern clia_tracing_config=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libclia_tracing_config-e0e4f4192befb03f.rlib --extern handlebars=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libhandlebars-54715fbcc7488164.rlib --extern indoc=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libindoc-1fa0458745c98152.dylib --extern log=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/liblog-c2586173bc1389d4.rlib --extern rand=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/librand-cf3e2775330e5826.rlib --extern serde_json=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libserde_json-ed5e928c653c8e39.rlib --extern termion=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libtermion-e1080b4cecde7e2b.rlib --extern toml=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libtoml-db505b4d1c897e14.rlib --extern tracing=/Users/zoomq/Exercism/proj/ferris-actor/target/release/deps/libtracing-42c6c9622152d235.rlib`
    Finished release [optimized] target(s) in 6.08s
</code></pre>
<h2 id="tod"><a class="header" href="#tod">TOD:</a></h2>
<blockquote>
<p>ä¸ºæ¯› Rust ä¸­æƒ³å¼•ç”¨å…„å¼Ÿç›®å½•çš„æ¨¡å—å°±è¿™ä¹ˆéš¾å‘¢?</p>
</blockquote>
<pre><code>foobar/
    +- Cargo.toml
    +- Cargo.lock
    +- README.md
    +- ...
    +- src/
        +- main.rs
        +- act.rs
        +- act/
        |   + ...
        |   + snap.rs
        +- misc.rs
        `- misc/
            + version.rs
</code></pre>
<p>ä»¥ä¸Šç»“æ„æ˜¯ä¸€ä¸ªç®€å•çš„ bin å·¥ç¨‹ç›®å½•,
åªæ˜¯, main.rs è¦è°ƒç”¨çš„å„ç§å‡½æ•°, åˆ†å¸ƒåˆ°ä¸åŒå­ç›®å½•ä¸­äº†,
é—®é¢˜åœ¨:</p>
<ul>
<li>src/act/snap.rs ä¸­å¼•ç”¨åŒçº§çš„å…¶å®ƒæ¨¡å—, éƒ½å¯ä»¥, 
<ul>
<li>å˜¦åœ¨ src/mod.rs ä¸­æœ‰å¯¹åº”è¿›è¡Œå£°æ˜;</li>
</ul>
</li>
<li>å¯æ˜¯ src/act/snap.rs ä¸­æƒ³å¼•ç”¨ <code>src/misc/version.rs</code> ä¸­çš„æ¨¡å—/å¯¹è±¡/å‡½æ•°/...
<ul>
<li>æ€ä¹ˆæŠ˜è…¾å°±æ˜¯ä¸è¡Œ...?</li>
</ul>
</li>
</ul>
<p>--&gt; å‚è€ƒ:<a href="dev//tip/manag_growing_proj_with_crates_modules.html">Crateä¸­åˆç†åˆ’åˆ†ç›®å½•</a></p>
<h3 id="refer-16"><a class="header" href="#refer-16">refer.</a></h3>
<ul>
<li><a href="https://rustacean.net/">Rustacean.net: Home of Ferris the Crab</a>
<ul>
<li><a href="https://jsfiddle.net/Diggsey/3pdgh52r/embedded/result/">Animated Ferris - JSFiddle</a></li>
<li><a href="https://crates.io/crates/ferris-says">ferris-says - crates.io: Rust Package Registry</a></li>
<li><a href="https://crates.io/crates/ferris-say">ferris-say - crates.io: Rust Package Registry</a>
<ul>
<li><a href="https://spaghettidev.tech/posts/creating-a-cli-with-rust/">spaghettidev ğŸ¦€ â€” I'm a Software engineering student and Typescript &amp; Rust developer.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://rust-cli-recommendations.sunshowers.io/index.html#locations">Introduction - Rain's Rust CLI recommendations</a>
<ul>
<li><a href="https://crates.io/crates/clap">clap - crates.io: Rust Package Registry</a>
<ul>
<li><a href="https://www.joshfinnie.com/blog/a-command-line-application-in-rust/">Building a Command-Line Application in Rust | www.joshfinnie.com</a></li>
<li><a href="https://medium.com/@MatthieuL49/data-processing-with-rust-and-apache-arrow-datafusion-a-cli-application-with-clap-73c9df229540">Data Engineering With Rust And Apache Arrow DataFusion 2/4â€Šâ€”â€ŠA CLI Application with Clap | by Matt | Jul, 2022 | Medium | Medium</a></li>
<li><a href="https://qiita.com/Tadahiro_Yamamura/items/4ae32347fb4be07ea642#app%E3%81%A8parser%E3%81%AE%E3%81%A9%E3%81%A1%E3%82%89%E3%82%92%E4%BD%BF%E3%81%86%E3%81%B9%E3%81%8D%E3%81%8B">Rustã§æ‰‹è»½ã«CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Œã‚‹clapã‚’è»½ãç´¹ä»‹ã™ã‚‹ - Qiita</a></li>
<li><a href="https://github.com/clap-rs/clap/discussions/categories/q-a">What is the way to display the author? Â· clap-rs/clap Â· Discussion #4316</a>
<ul>
<li><a href="https://epage.github.io/blog/2022/09/clap4/#polishing-help-output">clap 4.0, a Rust CLI argument parser</a></li>
</ul>
</li>
<li>..</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://doc.rust-lang.org/reference/tokens.html#raw-string-literals">Tokens - The Rust Reference</a>
<ul>
<li>...</li>
</ul>
</li>
</ul>
<pre><code>          _~^~`~_
      \) /  â˜‰ â˜‰  \ (/
        '_   V   _'
        / '-----' |

...act by ferris-actor v0.2.2
</code></pre>
<h2 id="logging-13"><a class="header" href="#logging-13">logging</a></h2>
<ul>
<li>...</li>
<li>230301 ZQ ...ğŸ¦€</li>
<li>230225 ZQ re-re-re-init.</li>
</ul>
<pre><code>           _~`|`~_
       \/ /  &gt; â—•  \ ()
         '_   ğŸ‚   _'
         &gt; '--~--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bxmr"><a class="header" href="#bxmr">BXMr</a></h1>
<blockquote>
<p>rIME-Squirrel è¡¨å½¢ç ç»´æŠ¤å·¥å…·</p>
</blockquote>
<h2 id="backgroung-3"><a class="header" href="#backgroung-3">backgroung</a></h2>
<p>ä½œä¸ºä¸€åç¨‹åºçŒ¿, æ€»æ˜¯è¦å¯¹è¾“å…¥æ³•ä¹Ÿè¦æœ‰å…¨é¢æ§åˆ¶</p>
<p>æ‰€ä»¥, ä¸€ç›´æœ‰æŠ˜è…¾:<a href="https://github.com/ZoomQuiet/ZqBXM/tree/master/Rime-Squirrel">ZqBXM/Rime-Squirrel at master Â· ZoomQuiet/ZqBXM</a></p>
<h2 id="goal-14"><a class="header" href="#goal-14">goal</a></h2>
<p>å…¨é¢ä½¿ç”¨ Rust é‡æ„åŸæœ‰ Python ç‰ˆæœ¬çš„ç»´æŠ¤æŒ‡ä»¤é›†;</p>
<h2 id="trace-13"><a class="header" href="#trace-13">trace</a></h2>
<ul>
<li>æœ€æ—©æ˜¯ æ‰‹å·¥ç»´æŠ¤</li>
<li>åæ¥ç”¨ Python å†™äº†ä¸ªè„šæœ¬, ä½†æ˜¯è¿˜æ˜¯è¦äººå·¥å¤åˆ¶åˆ°å¯¹åº”ç›®å½•ä¸­å†é‡æ–°ç¼–è¯‘ç è¡¨</li>
<li>åˆåæ¥, ä½¿ç”¨ invoke æ¡†æ¶æ‹“å±•å¹¶å¢å¼ºäº† BXM ç è¡¨çš„ç»´æŠ¤å†…éƒ¨ç¼–è¾‘</li>
<li>ç°åœ¨, è½®åˆ° Rust æ¥é‡æ„äº†...</li>
</ul>
<h3 id="feeling"><a class="header" href="#feeling">feeling</a></h3>
<blockquote>
<p>ç»ˆäºæœ‰æ„Ÿè§‰äº†...</p>
</blockquote>
<p>çŸ¥é“ Rust æœ‰å¹´å¤´äº†, ä½†æ˜¯, å’Œ golang ç±»ä¼¼, ä¸€ç›´æ²¡æœ‰è®¤çœŸä¸Šæ‰‹,
golang ä¹Ÿå¼€å‘è¿‡å‡ ä¸ªå®ç”¨å°å·¥å…·/ç³»ç»Ÿ, æ„Ÿè§‰å’Œç”¨ Python å·®ä¸å¤š,
è¿˜æ˜¯å¾—é  print ä»¥åŠçº¿ä¸Šäººçœ¼è§‚å¯Ÿ...</p>
<p>Rust å¼€å§‹è¿›å…¥ Linux å†…æ ¸äº†, æ„Ÿè§‰ä¸ä¸€æ ·äº†, è¶³å¤Ÿæ•¦å®äº†,
è€Œä¸”, ä»¥å¾€å¥½è±¡æ‰€æœ‰æŠ˜è…¾è¿‡çš„å¼€å‘è¯­è¨€éƒ½æ˜¯æœ‰ GC çš„...</p>
<p>åœ¨å®Œæˆ <a href="dev//dev/cli_ferris_art.html">Ferrisè‰ºæœ¯</a> å°å·¥å…·å,
å†³å®šä»‹å…¥æ—¥å¸¸ç”Ÿæ´», é‡åˆ¶è¿™ä¸ªå®ç”¨å·¥å…·: <code>BXMr</code> ~ BXM ç®¡ç†å™¨;
ä»¥ä¾¿æ›¿ä»£åŸå…ˆ Python ç‰ˆæœ¬çš„ -&gt; <a href="https://github.com/ZoomQuiet/ZqBXM/blob/master/Rime-Squirrel/tasks.py">tasks.py</a></p>
<p>ä»£ç çš„å¢é•¿, è¦æ±‚å¿…é¡»å¯¹é¡¹ç›®ç›®å½•ç»“æ„è¿›è¡Œè‰¯å¥½çš„è§„åˆ’/æ§åˆ¶/æ¼”å˜/...</p>
<p>è¿›ä¸€æ­¥çš„, åœ¨ä»£ç è°ƒè¯•è¿‡ç¨‹ä¸­, å‘ç°, æœ‰äº† rust-analyzer çš„åŠ æŒ,
ä»¥å¾€çš„å¾ªç¯:</p>
<pre><code>    å¼€å‘
    ^   \ 
    |    è¿è¡Œ
    |     \
    |     è§‚å¯Ÿ print()
    |    /
     è°ƒè¯•
</code></pre>
<p>å¯ä»¥æœ‰è´¨çš„æå‡, ç°åœ¨å¯ä»¥å®Œå…¨ä¿¡ä»»ç¼–è¯‘å™¨äº†,
ç°åœ¨çš„æµç¨‹å˜æˆ:</p>
<ul>
<li>æ€è€ƒé—®é¢˜</li>
<li>æ’°å†™ä»£ç , å®æ—¶æ ¹æ® RA(rust-analyzer) æç¤º, è¿›è¡Œä¿®è®¢</li>
<li>é‚£ä¹ˆå˜¦åœ¨ IDE ä¸­æ²¡æœ‰è­¦å‘Šæ—¶ 
<ul>
<li>ä¸€èˆ¬ cargo check ä¹Ÿä¸ä¼šæœ‰é—®é¢˜</li>
<li>ä»¥åŠ cargo check ä¹Ÿä¸ä¼šæœ‰é—®é¢˜</li>
<li>ç”šè‡³ cargo build ä¹Ÿä¸ä¼šæœ‰é—®é¢˜</li>
<li>...ä¹Ÿå°±æ„å‘³ç€æ­¤æ—¶, ä»£ç åŒ…å«çš„æ‰€æœ‰åº”ç”¨/ç³»ç»Ÿè¡Œä¸ºå°±å·²ç»æ˜¯å¯ä¿¡/å¯ç”¨/åšä¸å¯æ‘§çš„äº†</li>
</ul>
</li>
<li>è¿™ç§é—®é¢˜/ç›®æ ‡/ä»£ç /ç†è§£/... all-in-one çš„æ„Ÿè§‰å¤ªåšå®äº†
<ul>
<li>å¯¹æ¯”ä»¥å¾€å…¶å®ƒè¯­è¨€, å³ä¾¿æ˜¯ IDE/ç¼–è¯‘å™¨ éƒ½æ²¡é—®é¢˜</li>
<li>çœŸæ­£è¿è¡Œèµ·æ¥æ—¶, ç…§æ ·æœ‰å„ç§æ„å¤–</li>
<li>...é‚£ç§æ„Ÿè§‰å°±è±¡ å±è±å§† ...è½¯åŸåŸçš„,æƒ³æ€ä¹ˆæŠ˜è…¾å°±æ€ä¹ˆæŠ˜è…¾, å¯å°±æ˜¯æ°¸è¿œå›ºå®šä¸åˆ°ä¸€ä¸ªç†æƒ³çš„çŠ¶æ€</li>
</ul>
</li>
<li>è€Œ Rust ä¸–ç•Œä¸­,å˜¦ç¼–è¯‘å™¨è¿‡äº†, åŸºæœ¬ä¸Šå°±å¤¯å®äº†...</li>
<li>å¦‚æœæœ‰é—®é¢˜, åŸºæœ¬ä¸Šå¯ä»¥æ˜ç¡®, ç»å¯¹ä¸æ˜¯ä»£ç é—®é¢˜
<ul>
<li>åªå¯èƒ½æ˜¯è‡ªå·±å¯¹é—®é¢˜çš„ç†è§£æœ‰åå·®</li>
<li>ä»¥åŠä»£ç è¡¨è¿°çš„è¡Œä¸ºå’Œæˆ‘ä»¬çš„æœŸå¾…ä¸åŒ...</li>
</ul>
</li>
</ul>
<blockquote>
<p>å·¥ä½œé‡:</p>
</blockquote>
<pre><code>
à¼„  tokei
===============================================================================
 Language            Files        Lines         Code     Comments       Blanks
===============================================================================
 Markdown                2          218            0          152           66
 Rust                   13         1137          657          322          158
 TOML                    1           51           28           15            8
===============================================================================
 Total                  16         1406          685          489          232
===============================================================================
</code></pre>
<p>å¯¹æ¯”åŸæœ‰ Python çš„ç‰ˆæœ¬:</p>
<pre><code>
à¼„  tokei tasks.py
===============================================================================
 Language            Files        Lines         Code     Comments       Blanks
===============================================================================
 Python                  1          248          157           22           69
===============================================================================
 Total                   1          248          157           22           69
===============================================================================
</code></pre>
<p>å—¯å“¼? æ²¡æœ‰ä¸»è§‚æ„Ÿè§‰çš„10å€, å½“ç„¶,è¿‡ç¨‹ä¸­åˆ é™¤çš„ä¸åŒç‰ˆæœ¬,å¾—æœ‰10å€äº†;</p>
<h3 id="verb"><a class="header" href="#verb">verb</a></h3>
<blockquote>
<p>çº ç»“æ‰€åœ¨....</p>
</blockquote>
<p>åŸé—®é¢˜æ˜¯è¿™æ ·çš„:</p>
<ul>
<li>è¾“å…¥æ³•çš„ç è¡¨, åªæ˜¯å°±æ˜¯ä¸€æ‰¹ é”®ç å’Œæ–‡å­— çš„ K/V å€¼å¯¹</li>
<li>åœ¨ rIME-Squirrel ä¸­åˆ™æ˜¯è¦æ±‚ç»„ç»‡ä¸ºä¸€ä¸ªçº¦å®šçš„ .yaml æ–‡ä»¶
<ul>
<li>æ•°æ®ç»“æ„ä¸º: &quot;{æ–‡å­—}\t{é”®ç }&quot;</li>
<li>é”®ç ç›¸åŒæŒ‡å‘å¤šä¸ªæ–‡å­—æ—¶, å°±å¯¹åº”å¤åˆ¶å‡ºæ–°è¡Œæ¥</li>
<li>è¡Œçš„å‰åé¡ºåºå†³å®šäº†è¾“å…¥æ—¶æ¨èçš„é¡ºåº</li>
<li>æ¯”å¦‚ç°æœ‰å®šä¹‰ç è¡¨è¡Œç‰‡æ®µ:
<ul>
<li>æ•     aaaa</li>
<li>å•    aaaa</li>
<li>æ•ª    aaaa</li>
<li>å¨º    aaaa</li>
<li>å•Šå•Šå•Šå•Š    aaaa</li>
</ul>
</li>
<li>é‚£ä¹ˆåœ¨ä½¿ç”¨ rIME è¾“å…¥æ—¶è‡ªåŠ¨å¼¹å‡ºçš„æ¨èå­—åˆ—å°±åº”è¯¥æ˜¯:</li>
</ul>
</li>
</ul>
<p><img src="https://ipic.zoomquiet.top/2023-03-05-zshot%202023-03-05%2021.16.04.jpg" alt="aaaa" /></p>
<p>éš¾ç‚¹åœ¨ <code>é”®/å­—</code> æ¡ç›®è¡Œçš„æ¬¡åºæ˜¯æœ‰è¦æ±‚çš„, ä»¥åæ’å…¥æ—¶è¦éµå®ˆ:</p>
<ul>
<li>çŸ­é”®ç åœ¨å‰</li>
<li>ASCII å­—æ¯é¡ºåºä¸ºå…ˆ</li>
<li>é•¿åº¦ä» 1 åˆ° 4 ä¸ªå­—ç¬¦</li>
<li>ä¸å¯èƒ½è¶…è¿‡ 4 ä¸ªå­—ç¬¦</li>
<li>ä¾‹å¦‚:
<ul>
<li>a åœ¨ b ä¹‹å‰</li>
<li>a åœ¨ aa ä¹‹å‰</li>
<li>aa åœ¨ ab ä¹‹å‰</li>
<li>az åœ¨ aaa ä¹‹å‰</li>
<li>aaaa åœ¨ b ä¹‹å‰</li>
<li>...</li>
</ul>
</li>
<li>å¦‚æœå¯¹åº”é”®å¹¶æ²¡å®šåˆ¶å°±ä¸è®°å½•</li>
<li>ä¾‹å¦‚:
<ul>
<li>åŸæœ‰å®šä¹‰æ¡ç›®è®°å½•:
<ul>
<li>btk æ˜¯ä¸å¹¶</li>
<li>btmd æ‚¬è€Œæœªå†³</li>
</ul>
</li>
<li>é‚£ä¹ˆ, æƒ³è¿½åŠ ä¸€ä¸ª <code>btl æ˜¯ä¹Ÿä¹</code> å°±åº”è¯¥æ’å…¥ä¸º:
<ul>
<li>btk æ˜¯ä¸å¹¶</li>
<li>btl æ˜¯ä¹Ÿä¹</li>
<li>btmd æ‚¬è€Œæœªå†³</li>
</ul>
</li>
</ul>
</li>
<li>è¿™é‡Œå°±é—®é¢˜å°±åœ¨ä¸€ä¸ªåŸæœ¬æœ‰å…·ä½“æ’åºè¦æ±‚çš„é”®ç åºåˆ—
<ul>
<li>æœ¬èº«æ˜¯æ®‹ç¼ºçš„</li>
<li>è¦åˆ¤å®šæŸä¸ªæ–°å¢é”®ç åº”è¯¥åœ¨å“ªé‡Œæ’å…¥,è¦é¡¾è™‘çš„æ¡ä»¶å¾ˆå¤š</li>
<li>ä»¥å¾€éƒ½æ˜¯äººå·¥è§‚å¯Ÿæ’å…¥çš„...è¿˜ä¸å¾—ä¿è¯å¯¹, é‚£æ—¶ rIME ç¼–è¯‘æ—¶å°±æŠ¥é”™...</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥, Python ä»£ç å®ç°æ—¶, ç”¨äº†ä¸€ä¸ªåæ¨¡å¼:</p>
<ul>
<li>å…ˆæ ¹æ® BXM çš„ç¼–ç è§„åˆ™, æ„é€ å‡ºä¸€ä¸ªä¸¥æ ¼æŒ‰ç…§é”®ç æ’åºçš„ç¼–ç è¡¨</li>
<li>ç„¶å, å†æ ¹æ®ç°è¡Œä½¿ç”¨çš„ BXM å®šä¹‰ <code>é”®/å­—</code> å¡«å†™å…¥è¿™ä¸ªç¼–ç è¡¨</li>
<li>é‚£ä¹ˆ, è¿›è¡Œç»´æŠ¤æ—¶å°±å˜æˆä¸€ä¸ªç®€å•çš„æŸ¥è¡¨è¿‡ç¨‹:
<ul>
<li>å¯¹åŸæœ‰ <code>é”®/å­—</code> çš„æ¡ç›®, è¿½åŠ åŒé”®ä¸åŒå­—æ—¶, è¿½åŠ å­—åˆ°å¯¹åº”çš„é”®åæ•°ç»„å°±å¥½</li>
<li>å¯¹åŸå…ˆæ²¡æœ‰çš„æ¡ç›®, åˆ°å¯¹åº”é”®åç©ºç™½æ•°ç»„ä¸­è¿½åŠ å°±å¥½</li>
<li>...</li>
<li>æœ€åéœ€è¦æ›´æ–° .yaml æ—¶,  ä»è¿™ä¸ªå…¨ç å…¨åºçš„ç¼–ç è¡¨å¯¹å…¶ä¸­æœ‰æ•ˆçš„æ¡ç›®è¿›è¡Œè½¬æ¢è¾“å‡ºå°±å¥½</li>
</ul>
</li>
<li>ä¹Ÿå°±æ˜¯è¯´, å°†åŸå…ˆ .yaml ä¸­çš„ &quot;{æ–‡å­—}\t{é”®ç }&quot; å®šä¹‰è®°å½•æ¡ç›®æ–‡æœ¬
<ul>
<li>å…ˆå˜æˆ &quot;{&quot;é”®&quot;:[&quot;å­—0&quot;,&quot;å­—1&quot;,,]}&quot; ç±»å­—å…¸/HashMap è®°å½•</li>
<li>è€Œä¸”,å…¶ä¸­çš„é”®æ˜¯å»åˆ BXM è§„åˆ™çš„å…¨éƒ¨é¡ºåºå¯èƒ½é”®ç </li>
</ul>
</li>
</ul>
<p>å¯¹åº”åŸæœ‰ Python ä»£ç :</p>
<pre><code class="language-python">BXMC = &quot;abcdefghijklmnopqrstuvwxyz&quot;

@task
def init2(c):
    print(f&quot;init from\n\t{ORIG};\nAIM-&gt;\t{AIMP}&quot;)
    print(f&quot;{AIMP} exists?\n\t&quot;,os.path.exists(f&quot;{AIMP}&quot;))
    _gbxm = {}

    def generate_strings(length, prefix=''):
        if length == 0:
            return
        for c in BXMC:
            key = prefix + c
            print(key)
            _gbxm[key] = []
            generate_strings(length-1, key)

    generate_strings(4)
    print(f&quot;gen. all BXM code as {len(_gbxm.keys())}&quot;)
    return None
</code></pre>
<p>å¯¹åº” Rust ç‰ˆæœ¬æ˜¯:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>//  å®šä¹‰åœ¨: src/inv/util.rs
pub const BXMC: &amp;str = &quot;abcdefghijklmnopqrstuvwxyz&quot;;
pub const MBCL: usize = 4; // code len.

pub fn generate_strings(length: usize, 
            prefix: String, 
            gbxm: &amp;mut BTreeMap&lt;String, Vec&lt;String&gt;&gt;
        ) {
        if length == 0 {
            return;
        }
        for c in BXMC.chars() {
            let key = prefix.clone() + &amp;c.to_string();
            gbxm.insert(key.clone(), Vec::new());
            generate_strings(length - 1, key, gbxm);
        }
    }

pub fn init2(codelen:usize) -&gt; Option&lt;BTreeMap&lt;String, Vec&lt;String&gt;&gt;&gt; {
    let mut gbxm = BTreeMap::new();
    generate_strings(codelen, String::new(), &amp;mut gbxm);
    //println!(&quot;\n\t gen. all BXM code as {} &quot;, gbxm.len());

    Some(gbxm)
}

//  å…·ä½“è°ƒç”¨å½¢å¼:
use crate::inv::util;
...
    let gbxm = util::init2(util::MBCL).unwrap();
<span class="boring">}</span></code></pre></pre>
<p>åŸºæœ¬ä¸Šå’Œ Python ä»£ç  1:1 è½¬æ¢, å½“ç„¶, ä»£ç çš„å¯ä¿¡åº¦è¦é«˜å¾ˆå¤š;</p>
<p>æ¥ä¸‹æ¥æ‰æ˜¯é—®é¢˜:</p>
<ul>
<li>ç”Ÿæˆçš„å…¨é‡é”®ç æœ‰ 475,254 ä¸ª
<ul>
<li>ç”¨ toml è®°å½•æ—¶, æœ‰4Mb</li>
</ul>
</li>
<li>è€Œå¯¹åº” BXM å½“å‰åŒ…å«çš„æ‰€æœ‰é”®ç ä»… 60,337 ä¸ª
<ul>
<li>ç”¨ yaml è®°å½•æ—¶, åªæœ‰ 700Kb</li>
</ul>
</li>
<li>ç”¨ Python åŠ è½½/æ›´æ–°/å›å†™/... IO æ“ä½œæ—¶,è¦3~4ç§’</li>
<li>è€Œç”¨ cargo run è¿›è¡Œè¯•ç”¨æ—¶, è¦10ç§’å·¦å³
<ul>
<li>å¥½åœ¨ cargo build --release ä¹‹åçš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶, å¿«åˆ°äº† 2~3 ç§’</li>
</ul>
</li>
<li>è¿™æ ·è¿˜æ˜¯æ…¢å“ª....
<ul>
<li>å°è¯•ç”¨å¼‚æ­¥ crate åŠ é€Ÿ, æ•ˆæœä¸æ˜æ˜¾</li>
<li>ä»¥å­—æ¯è¡¨ä¸ºåŸºå‡†åˆ‡ä¸º26ä¸ªæ–‡ä»¶? å¤ªéº»çƒ¦è€Œä¸”, è¦åœ¨ç”¨æˆ·æœ¬åœ°ç”Ÿæˆä¸€ç»„æ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯é—®é¢˜</li>
<li>ä¸Š SQLite å†…å­˜æ•°æ®åº“? ç›¸åŒçš„æ•°æ®é‡æƒ³åŠ è½½åˆ°å†…å­˜ä¸­ä¸€æ ·æœ‰è€—æ—¶è¦ç­‰å¾…</li>
<li>....</li>
</ul>
</li>
</ul>
<blockquote>
<p>è¿˜èƒ½æ€ä¹ˆåŠ é€Ÿå‘¢?</p>
</blockquote>
<ul>
<li>ä»¥ç°è¡Œæœ‰æ•ˆ <code>é”®/å­—</code> å®šä¹‰ä¸ºå‡†, åªç®¡ç†ä¸åˆ°7ä¸‡è¡Œæ•°æ®,æ¯”å°†è¿‘50ä¸‡è¡Œè‚¯å®šè¦å¿«
<ul>
<li>ä½†æ˜¯, è¿™å°±å¾—å®Œæˆå®Œå¤‡çš„æ’å…¥æ¬¡åºåˆ¤å®šç®—æ³•</li>
<li>...å½“ç„¶ä¹Ÿè¡Œ, åªæ˜¯æ²¡å¿…è¦, å¦‚æœ BXMr æƒ³å…¼å®¹æ‰€æœ‰è¾“å…¥æ³•çš„è¯, å°±ä¸èƒ½ç‰¹åŒ–æ”¯æŒç‰¹å®šç è¡¨...</li>
</ul>
</li>
<li>å›åˆ°é—®é¢˜æºå¤´:
<ul>
<li>æ•°æ®æ–‡ä»¶å¤§, æ‰€ä»¥åŠ è½½æ…¢</li>
<li>è€Œä¸”æ²¡ä½¿ç”¨å¤šæ ¸ CPU æ¥åŠ é€Ÿ</li>
<li>...</li>
<li>ä¹Ÿå°±æ˜¯è¯´, å€¼å¾—æŠ˜è…¾çš„æ˜¯åˆ©ç”¨ Rust çš„ç³»ç»Ÿç¼–ç¨‹èƒ½åŠ›:
<ul>
<li>æ„é€  <code>é”®/å­—</code> å…¨é‡ç è¡¨çš„äºŒè¿›åˆ¶æ–‡ä»¶å½¢å¼, å¤§å¹…å‡å°‘è¦åŠ è½½çš„æ–‡ä»¶å°ºå¯¸</li>
<li>åŠ¨ç”¨å¼‚æ­¥/å¹¶å‘/å¹¶è¡Œ/å¤šçº¿ç¨‹/éé˜»å¡/... èƒ½åŠ›, åœ¨æ•°æ®åŠ è½½ä»¥åŠå¤„ç†ä¸ŠåŠ é€Ÿ</li>
</ul>
</li>
<li>æ­£å¥½, è¿™ä¹Ÿå°±èƒ½å°†ä»¥å¾€çœ‹çš„èµ„æ–™ä¸­é«˜çº§è¯é¢˜, å¯¹åº”åˆ°å…·ä½“é—®é¢˜éœ€æ±‚ä¸Šæ¥äº†...</li>
</ul>
</li>
</ul>
<h3 id="env"><a class="header" href="#env">.env</a></h3>
<blockquote>
<p>å¦‚ä½•å¯ä»¥ç¼“å­˜å„ç§å¸¸ç”¨é…ç½®?</p>
</blockquote>
<p>å’Œ Python æ—¥å¸¸å¼€å‘å’Œéƒ¨ç½²ä½¿ç”¨ä¸åŒ, ä»¥å¾€:</p>
<ul>
<li>ä¸€èˆ¬ä½¿ç”¨ä¸ª _settings.py æ–‡ä»¶,ä½œä¸ºä¸€ä¸ªå…¨å±€å˜é‡æ¡¶, æ”¶é›†å„ç§åœ¨æ‰€æœ‰æ¨¡å—ä¸­éƒ½è¦ç”¨çš„å…³é”®é…ç½®å’Œæ•°æ®
<ul>
<li>åæ­£ä¸€èˆ¬ Python å°å·¥å…·å‘è¡Œæ—¶, å¹¶æ²¡æœ‰ç¼–è¯‘/æ‰“åŒ…çš„è¿‡ç¨‹, éƒ½æ˜¯è„šæœ¬å’Œé…ç½®ä¸€èµ·å‘å¸ƒ</li>
<li>å˜¦æ³¨æ„åŠ è½½çš„ç›®å½•å…³ç³», å°±å¯ä»¥æ— è§†æ“ä½œç³»ç»Ÿ, åœ¨ Python è¿è¡Œæ—¶çš„å¸®åŠ©ä¸‹åŠ è½½åˆ°éœ€è¦çš„é…ç½®</li>
</ul>
</li>
</ul>
<p>ä½†æ˜¯, åœ¨å°è¯•ç”¨ç›¸ä¼¼çš„è¡Œä¸ºå¥—åœ¨ Rust å·¥ç¨‹ä¸­æ‰å›§rz...</p>
<ul>
<li>å¦‚æœä¹Ÿæ˜¯ç”¨ _stettings.rs é‚£ä¹ˆç¼–è¯‘å, ä½ç½®å°±ä¸çŸ¥é“äº†, è€Œä¸”ç”¨æˆ·æœ¬åœ°è¦ç°åœºé…ç½®çš„ä¸œè¥¿ä¹Ÿä¸å¯èƒ½å†™å› _settings.rs äº†</li>
<li>é‚£ä¹ˆ,ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ .toml é…ç½®æ–‡ä»¶å‘¢? è¿›è¡Œ cargo build --release å, å‘è¡Œå•ä¸€å¯æ‰§è¡ŒäºŒè¿›åˆ¶ç›®æ ‡æ–‡ä»¶, å’Œå¯¹åº”å†…æ ¸ç³»ç»Ÿé…å¥—çš„, ä¸€èˆ¬å¹¶æ²¡äººæ‹–ä¸€ä¸ª .toml æ¥åˆ°æœ¬åœ°é…ç½®</li>
<li>å°è¯•å°†å®¢æˆ·çš„é…ç½®ä¿¡æ¯è®°å½•åˆ°ç¯å¢ƒå˜é‡ä¸­, æ‰å‘ç°, æƒ³æ°¸è¿œæœ‰æ•ˆå¿…é¡»å†™å¯¹åº” *rc æ–‡ä»¶, é—®é¢˜æ˜¯ç°åœ¨ bash å¦‚ä¸æ˜¯å¤§ä¸€ç»Ÿ, è¿˜æœ‰å…¶å®ƒæµè¡Œ shell ç‰ˆæœ¬, å¯¹åº”çš„ *rc æ–‡ä»¶æ ¼å¼å’Œä½ç½®ä¹Ÿæ˜¯ä¸å¯é¢„è§çš„...</li>
<li>è¦ä¸, å˜¦æ¶‰åŠåˆ°å¤–éƒ¨å¯¼å…¥/å¯¼å‡ºçš„æ¥æºå’Œå‘å¸ƒç›®æ ‡æ–‡ä»¶, è¦æ±‚æ¯æ¬¡æŒ‡ä»¤ç”¨æˆ·è‡ªå·±é€šè¿‡é™„åŠ å‚æ•°ç»™å‡ºæ¥å°±å¥½?
<ul>
<li>å›æƒ³è‡ªå·±ä½¿ç”¨å°±è¿‡ç¨‹, æ¯æ¬¡æ— è®ºä»€ä¹ˆæŒ‡ä»¤, éƒ½è¦è·Ÿä¸Š 1~2 ä¸ª, æˆ–æ˜¯æ›´å¤šè·¯å¾„å‚æ•°....è´¥é€€...</li>
</ul>
</li>
<li>...çªç„¶æƒ³åˆ°è¿˜æœ‰ä¸ª <code>.env</code> æ–‡ä»¶å“ª...ç®—æ˜¯åº”ç”¨ç³»ç»Ÿçš„éšèº«è¿è¡Œæ—¶ç¯å¢ƒå˜é‡,æœ¬èº«å¾ˆç®€å•å¯ä»¥è§†ä¸ºç®€åŒ–ç‰ˆæœ¬çš„ .ini æ–‡ä»¶</li>
<li>è¿½æŸ¥äº†ä¸€ä¸‹æœç„¶æœ‰ <a href="https://crates.io/crates/dotenv/0.15.0">dotenv - crates.io: Rust Package Registry</a>
<ul>
<li>é‚£ä¹ˆé€»è¾‘å°±ç®€å•äº†:</li>
<li>æ— è®ºç”¨å“ªä¸ªæŒ‡ä»¤, å…ˆæ£€éªŒå›ºå®šçš„å’Œæ‰§è¡Œæ–‡ä»¶åŒç›®å½•çš„ .env æ–‡ä»¶</li>
<li>å¦‚æœæ²¡æœ‰, æŒ‡å¼•ç”¨æˆ·å…ˆç”¨ <code>$ bxmr cfg ...</code> æŒ‡ä»¤æ¥å®Œæˆå…³é”®æ–‡ä»¶çš„æŒ‡å¼•</li>
<li>ç„¶å, å†™å…¥ .env æ–‡ä»¶ä¸­, å¹¶è‡ªåŠ¨åŠ è½½åˆ°ç¯å¢ƒå˜é‡é‡Œ</li>
<li>è¿™æ ·, å˜¦è¿è¡Œè‡ªå·±å·¥å…·çš„å‘è¡Œç‰ˆ, å°±å¯ä»¥ä»æœ¬èº«æ‰€åœ¨ç›®å½•ä¸­åŠ è½½åˆ°ä»¥å¾€çš„å…³é”®é…ç½®, ç”¨åœ¨å…·ä½“æŒ‡ä»¤å“åº”è¿‡ç¨‹ä¸­...</li>
</ul>
</li>
</ul>
<h3 id="async"><a class="header" href="#async">async</a></h3>
<blockquote>
<p>åªæ˜¯æƒ³åŠ é€Ÿä¸€ä¸ªæ–‡ä»¶çš„è¯»å–...</p>
</blockquote>
<p>-&gt; <a href="dev//tip/open_big_file_speed.html">æ–‡ä»¶åŠ é€Ÿæ‰“å¼€</a></p>
<p>ç„¶åå°±å‘ç°,è¿™äº‹å„¿æ²¡é‚£ä¹ˆç®€å•, æ•´ä½“ä¸Š:</p>
<blockquote>
<p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œasyncå‡½æ•°åœ¨Rustä¸­æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ç±»å‹ï¼Œå¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨awaitæ“ä½œç¬¦ç­‰å¼‚æ­¥æ“ä½œï¼Œè€Œasyncå‡½æ•°çš„è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªå®ç°äº†Future traitçš„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œå› ä¸ºå®ƒè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œéœ€è¦ç­‰å¾…æ‰§è¡Œå®Œæˆæ‰èƒ½å¾—åˆ°å…·ä½“çš„ç»“æœç±»å‹ã€‚å› æ­¤ï¼Œå½“ä½ è°ƒç”¨ä¸€ä¸ªasyncå‡½æ•°æ—¶ï¼Œä½ éœ€è¦åœ¨ä¸€ä¸ªasyncä¸Šä¸‹æ–‡ä¸­ï¼Œä¾‹å¦‚åœ¨asyncå‡½æ•°ä¸­æˆ–è€…ä½¿ç”¨tokioç­‰å¼‚æ­¥è¿è¡Œæ—¶åº“çš„Runtimeæ¥è¿è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚</p>
</blockquote>
<p>æ‰€ä»¥, åŸæœ‰çš„è°ƒç”¨æ ˆ:</p>
<ul>
<li>src/main.rs -&gt; fn main() 
<ul>
<li>inv::run() -&gt; src/inv.rs 
<ul>
<li>seek::echo() -&gt; src/inv/seek.rs
<ul>
<li>util::toml2btmap() -&gt; src/inv/util.rs
<ul>
<li>file.read_to_string(&amp;mut contents).unwrap()
<ul>
<li>let mut file = File::open(tfile).unwrap()</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>å‘ç°å¯ä»¥ç”¨ tokio å®ç°å¼‚æ­¥æ“ä½œ, å¹¶åŠ é€Ÿæ–‡ä»¶è¯»å–?
<ul>
<li>äºæ˜¯-&gt; 
<ul>
<li>use tokio::fs::File as TokioFile;</li>
<li>use tokio::io::BufReader as TokioBufReader;</li>
</ul>
</li>
<li>ç„¶å-&gt; 
<ul>
<li>let file = TokioFile::open(path).await?;</li>
<li>let reader = TokioBufReader::new(file);</li>
</ul>
</li>
<li>ä½†æ˜¯, å‘ç°ä¸è¡Œ, await? ä¸èƒ½ç¼–è¯‘, å› ä¸ºæ‰€åœ¨å‡½æ•°ä¸æ˜¯ async çš„, äºæ˜¯è¿é”ååº”</li>
<li>pub async fn async_read_lines().await &lt;- ä»¥ä¾¿è¢«è°ƒç”¨
<ul>
<li>pub async fn async_toml2btmap() &lt;- ä»¥ä¾¿è¢«è°ƒç”¨
<ul>
<li>util::async_toml2btmap().await &lt;- src/inv/util.rs
<ul>
<li>async fn seek::echo().await &lt;- src/inv/seek.rs
<ul>
<li>async fn run() &lt;- src/inv.rs 
<ul>
<li>inv::run().await &lt;- src/main.rs
<ul>
<li>async fn main()</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å¦‚æœä¸æ˜¯ rust-analyzer ä¸€è·¯æé†’, çœŸä¼šè’™åœˆå„¿çš„...</p>
<h2 id="refer-17"><a class="header" href="#refer-17">refer.</a></h2>
<ul>
<li><a href="https://docs.rs/clap/latest/clap/_derive/_cookbook/git_derive/index.html">clap::_derive::_cookbook::git_derive - Rust</a>
<ul>
<li>ç®€åŒ–å®˜æ–¹ç¤ºä¾‹,å®Œæˆç»“æ„æ€§æ¢ç´¢</li>
</ul>
</li>
<li><a href="https://medium.com/javascript-in-plain-english/coding-wont-exist-in-5-years-this-is-why-6da748ba676c">Building a CLI from scratch with Clapv3 | by Ukpai Ugochi | Medium</a>
<ul>
<li>å¾ˆå›§çš„æ¡ˆä¾‹, çœ‹èµ·æ¥å¾ˆç¾å´æ ¹æœ¬ç¼–è¯‘ä¸è¿‡...</li>
</ul>
</li>
<li>å°´å°¬äº†, äºŒè¿›åˆ¶å‘è¡Œç‰ˆæœ¬çš„åº”ç”¨å¯æ²¡æœ‰é‚£ä¹ˆç®€å•çš„å…¨å±€é…ç½®å¯ä»¥ä½¿ç”¨...
<ul>
<li><a href="https://www.thorsten-hans.com/working-with-environment-variables-in-rust/">Working with Environment Variables in Rust Â· Thorsten Hans' blog</a></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h2 id="logging-14"><a class="header" href="#logging-14">logging</a></h2>
<ul>
<li>...</li>
<li>230301 ZQ ...ğŸ¦€</li>
<li>230227 ZQ mod/clap/tracing/... é¡¹ç›®ç»“æ„å˜å®š</li>
<li>230225 ZQ re-re-re-init.</li>
</ul>
<pre><code>        _~^|âˆ½~_
    \) /  â—´ â˜‰  \ \/
      '_   âµ   _'
      / '--âˆ½--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rss-for-mdbook"><a class="header" href="#rss-for-mdbook">RSS for Mdbook</a></h1>
<blockquote>
<p>æ˜¯çš„ä¸€ä¸ªåº”è¯¥æ˜¯å¸¸ç”¨çš„å·¥å…·...</p>
</blockquote>
<h2 id="backgroung-4"><a class="header" href="#backgroung-4">backgroung</a></h2>
<p>ä½œä¸ºä¸€åå·¥ç¨‹å¸ˆ, ä½¿ç”¨å“ªç§è¯­è¨€, å°±æƒ³ç”¨è¿™è¯­è¨€ä½œä¸€åˆ‡...</p>
<p>mdbook éå¸¸å¥½, å»åˆä»¥å¾€æƒ³ç”¨ Markdown å¿«é€Ÿå‘å¸ƒç½‘ç«™çš„æ‰€æœ‰æœŸå¾…:</p>
<ul>
<li>çº¯ .md, ä¸åŒ…å«çº¦å®šçš„å„ç§å¥‡æ€ªçš„ meta head</li>
<li>æ ¹æ®è‡ªç„¶ç›®å½•ç”Ÿæˆ</li>
<li>ç”Ÿæˆé€Ÿåº¦éå¸¸å¿«</li>
<li>...</li>
</ul>
<h2 id="goal-15"><a class="header" href="#goal-15">goal</a></h2>
<p>è™½ç„¶ RSS æœ‰ç‚¹å„¿è¿‡æ°”äº†, ä½†æ˜¯, åœ¨å·¥ç¨‹å¸ˆä¸–ç•Œé‡Œè¿˜æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä¿¡æ¯äº¤æ¢æ¥å£,</p>
<p>ä½†æ˜¯, <a href="https://crates.io/crates/mdbook-rss">mdbook-rss - crates.io: Rust Package Registry</a> </p>
<ul>
<li>å¾ˆä¹…æ²¡æ›´æ–°</li>
<li>è€Œä¸”ä¹Ÿä¸ç”Ÿæ•ˆ</li>
<li>...</li>
</ul>
<p>é‚£ä¹ˆå°±å¾—è‡ªå·±ä¸Šäº†...</p>
<h2 id="trace-14"><a class="header" href="#trace-14">trace</a></h2>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
æ¢ç´¢..å†³å®šæ–¹æ¡ˆ</li>
<li><input disabled="" type="checkbox" checked=""/>
æ¶æ„åŸºæœ¬æ¡†æ¶</li>
<li><input disabled="" type="checkbox" checked=""/>
å®ç°æ ¸å¿ƒåŠŸèƒ½</li>
<li><input disabled="" type="checkbox" checked=""/>
æ¸…æŸ¥å‘è¡¨ crate
<ul>
<li><a href="https://crates.io/crates/rss4mdbook">rss4mdbook - crates.io: Rust Package Registry</a></li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
è¯•ç”¨
<ul>
<li>å›§äº†,ç«Ÿç„¶ä¸å¥½æ”¯æŒå¤šç«™ç‚¹...</li>
<li>ğŸŒ å¦¥äº† -&gt; <a href="https://github.com/zhrust/rss4mdbook/releases/tag/v0.2.42">Release RSS4mdBook v0.2.42 Â· zhrust/rss4mdbook</a></li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
å®£ä¼ ?</li>
<li><input disabled="" type="checkbox"/>
...æ— å°½çš„ç»´æŠ¤</li>
</ul>
<h2 id="refer-18"><a class="header" href="#refer-18">refer.</a></h2>
<ul>
<li><a href="https://docs.rs/clap/latest/clap/_derive/_cookbook/git_derive/index.html">clap::_derive::_cookbook::git_derive - Rust</a></li>
<li><a href="https://crates.io/crates/markdown/0.3.0">markdown - crates.io: Rust Package Registry</a></li>
<li><a href="https://crates.io/crates/mdbook/0.4.28">mdbook - crates.io: Rust Package Registry</a></li>
<li><a href="https://crates.io/crates/rss/1.10.0">rss - crates.io: Rust Package Registry</a></li>
<li>...</li>
</ul>
<h2 id="logging-15"><a class="header" href="#logging-15">logging</a></h2>
<ul>
<li>...ğŸ¦€</li>
<li>230308 ZQ publish ~&gt;  <a href="https://crates.io/crates/rss4mdbook">rss4mdbook - crates.io: Rust Package Registry</a></li>
<li>230306 ZQ init.</li>
</ul>
<pre><code>        _~âˆ½&amp;`~_
    \) /  â—• =  \ (/
      '_   â   _'
      / '--~--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="yazu"><a class="header" href="#yazu">Yazu</a></h1>
<blockquote>
<p>Yet another zipper for URI
å•ä¸€ä¸ªè‡ªåˆ¶ç¼©å€å·¥å…·/æœåŠ¡/Lambda/...</p>
</blockquote>
<h2 id="backgroung-5"><a class="header" href="#backgroung-5">backgroung</a></h2>
<p>ä½œä¸ºä¸€åç¨‹åºçŒ¿, æ’°å†™å›¾ä¹¦æ—¶æ€»æ˜¯è¦æœ‰ç¼©å€éœ€æ±‚çš„...</p>
<p>ä½†æ˜¯, ä»¥å¾€æ‰€æœ‰çš„ç¼©å€æœåŠ¡éƒ½å±äº†...
å½“ç„¶å¾—è‡ªè¡Œå—¯å“¼å‡ºæ¥...</p>
<h2 id="goal-16"><a class="header" href="#goal-16">goal</a></h2>
<p>å…¨é¢ä½¿ç”¨ Rust é‡æ„åŸæœ‰ Python ç‰ˆæœ¬çš„å·¥å…·</p>
<h2 id="trace-15"><a class="header" href="#trace-15">trace</a></h2>
<ul>
<li>æœ€æ—©æ˜¯ æ‰‹å·¥ç»´æŠ¤</li>
<li>åæ¥ç”¨ Python å†™äº†ä¸ªè„šæœ¬, è‡ªåŠ¨è½¬åŒ–ä¸º Nginx é…ç½®</li>
<li>ç°åœ¨, è½®åˆ° Rust æ¥é‡æ„äº†...</li>
</ul>
<h2 id="refer-19"><a class="header" href="#refer-19">refer.</a></h2>
<ul>
<li><a href="https://docs.rs/clap/latest/clap/_derive/_cookbook/git_derive/index.html">clap::_derive::_cookbook::git_derive - Rust</a>
<ul>
<li>ç®€åŒ–å®˜æ–¹ç¤ºä¾‹,å®Œæˆç»“æ„æ€§æ¢ç´¢</li>
</ul>
</li>
<li>...</li>
</ul>
<h2 id="logging-16"><a class="header" href="#logging-16">logging</a></h2>
<ul>
<li>...</li>
<li>230301 ZQ ...ğŸ¦€</li>
<li>230225 ZQ re-re-re-init.</li>
</ul>
<pre><code>         _~`~âˆ½~_
     \/ /  O â—´  \ (/
       '_   v   _'
       \ '-----' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="webrs"><a class="header" href="#webrs">Web.rs</a></h1>
<blockquote>
<p>å¿…é¡»å¼‚æ­¥åŒ–çš„....</p>
</blockquote>
<h2 id="background-14"><a class="header" href="#background-14">background</a></h2>
<p>ä½œä¸ºä¸€å¤´ç¨‹åºçŒ¿, äº’è”ç½‘å°±æ˜¯çœŸå®å®‡å®™,
å¿…é¡»åœ¨å…¶ä¸­æ˜¯è‡ªåœ¨çš„...</p>
<h2 id="goal-17"><a class="header" href="#goal-17">goal</a></h2>
<p>ä¸Šæ‰‹ç”¨ Rust ç”Ÿæ€ä¸­æœ€é”ˆçš„å®Œæˆä¸€ä¸ªæˆ–æ˜¯å‡ ä¸ªå¯ç”¨ç³»ç»Ÿ.</p>
<h2 id="trace-16"><a class="header" href="#trace-16">trace</a></h2>
<p>...TBD</p>
<h2 id="refer-20"><a class="header" href="#refer-20">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ
<a href="https://github.com/rust-unofficial/awesome-rust">rust-unofficial/awesome-rust: A curated list of Rust code and resources.</a></p>
</blockquote>
<ul>
<li><a href="https://www.arewewebyet.org/">Are we web yet? Yes, and it's freaking fast!</a></li>
<li>...</li>
</ul>
<pre><code>          _~`|`~_
      () /  - +  \ (/
        '_   â©Œ   _'
        ( '-----' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tokio"><a class="header" href="#tokio">tokio</a></h1>
<h2 id="background-15"><a class="header" href="#background-15">background</a></h2>
<blockquote>
<p>æ— å¥ˆèƒŒæ™¯</p>
</blockquote>
<h2 id="goal-18"><a class="header" href="#goal-18">goal</a></h2>
<p>ä¸Šæ‰‹ç”¨ tokio å®Œæˆå®ç”¨å¾®æœåŠ¡çš„å¼€å‘å’Œæ£€éªŒ...</p>
<h2 id="trace-17"><a class="header" href="#trace-17">trace</a></h2>
<p>TBD</p>
<h2 id="refer-21"><a class="header" href="#refer-21">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://tokio.rs/tokio/tutorial">Tutorial | Tokio - An asynchronous Rust runtime</a></p>
<ul>
<li><a href="https://tony612.github.io/tokio-internals/01_intro_async.html">ä»‹ç» - Tokio Internals</a></li>
<li><a href="https://rust-book.junmajinlong.com/ch100/01_understand_tokio_runtime.html">Rustå¼‚æ­¥ç¼–ç¨‹å’Œtokioæ¡†æ¶ - Rustå…¥é—¨ç§˜ç±</a></li>
<li><a href="https://skyao.io/learning-tokio/docs.html">Tokioå­¦ä¹ ç¬”è®° | Tokioå­¦ä¹ ç¬”è®°</a></li>
<li><a href="https://rustcc.cn/article?id=ba4f86c6-667d-4acb-89a1-e2fb0617f524">ã€åŸåˆ›ã€‘Rust tokio å¦‚ä½•ä»¥å¼‚æ­¥éé˜»å¡æ–¹å¼è¿è¡Œå¤§é‡ä»»åŠ¡ - Rustè¯­è¨€ä¸­æ–‡ç¤¾åŒº</a></li>
<li>...</li>
</ul>
<pre><code>            _~`+`~_
        () /  # â†  \ \/
          '_   âˆ§   _'
          ( '-----' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tokio-1"><a class="header" href="#tokio-1">tokio</a></h1>
<h2 id="background-16"><a class="header" href="#background-16">background</a></h2>
<blockquote>
<p>æ— å¥ˆèƒŒæ™¯</p>
</blockquote>
<h2 id="goal-19"><a class="header" href="#goal-19">goal</a></h2>
<p>ä¸Šæ‰‹ç”¨ tokio å®Œæˆå®ç”¨å¾®æœåŠ¡çš„å¼€å‘å’Œæ£€éªŒ...</p>
<h2 id="trace-18"><a class="header" href="#trace-18">trace</a></h2>
<p>TBD</p>
<h3 id="prototype"><a class="header" href="#prototype">prototype</a></h3>
<blockquote>
<p>Q: </p>
</blockquote>
<p>åœ¨ rust ä¸­å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„ graphQL æœåŠ¡?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤æ¥æ„å»ºä¸€ä¸ªç®€å•çš„ GraphQL æœåŠ¡ï¼š</p>
<ol>
<li>æ·»åŠ  juniper å’Œ hyper ä¾èµ–ï¼š</li>
</ol>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<pre><code>[dependencies]
juniper = &quot;0.15.2&quot;
juniper_hyper = &quot;0.16.1&quot;
hyper = &quot;0.14.3&quot;
</code></pre>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<ol start="2">
<li>å®šä¹‰ä¸€ä¸ª schemaï¼š</li>
</ol>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use juniper::{graphql_object, EmptyMutation, EmptySubscription, FieldResult, RootNode};

struct QueryRoot;

#[graphql_object]
impl QueryRoot {
    fn hello() -&gt; FieldResult&lt;String&gt; {
        Ok(&quot;Hello, world!&quot;.to_string())
    }
}

type Schema = RootNode&lt;'static, QueryRoot, EmptyMutation, EmptySubscription&gt;;

<span class="boring">}</span></code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª QueryRoot ç±»å‹ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ª hello æ–¹æ³•æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<ol start="3">
<li>å®šä¹‰ä¸€ä¸ªè¯·æ±‚å¤„ç†å™¨ï¼š</li>
</ol>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use hyper::{Body, Request, Response, Server};
use juniper_hyper::{graphiql_handler, graphql_handler};

async fn handle_request(req: Request&lt;Body&gt;) -&gt; Result&lt;Response&lt;Body&gt;, hyper::Error&gt; {
    match (req.method(), req.uri().path()) {
        (&amp;hyper::Method::GET, &quot;/graphql&quot;) =&gt; graphiql_handler(&quot;/graphql&quot;)(req).await,
        (&amp;hyper::Method::POST, &quot;/graphql&quot;) =&gt; graphql_handler(&amp;Schema, &amp;QueryRoot, req).await,
        _ =&gt; Ok(Response::builder()
            .status(hyper::StatusCode::NOT_FOUND)
            .body(Body::empty())
            .unwrap()),
    }
}

<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº† hyper åº“æ¥å¤„ç†è¯·æ±‚ã€‚æˆ‘ä»¬æ£€æŸ¥äº†è¯·æ±‚çš„æ–¹æ³•å’Œè·¯å¾„ï¼Œå¦‚æœè¯·æ±‚æ˜¯ GET /graphqlï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ graphiql_handler å‡½æ•°è¿”å› GraphQL IDE é¡µé¢ï¼›å¦‚æœè¯·æ±‚æ˜¯ POST /graphqlï¼Œæˆ‘ä»¬ ä¼šä½¿ç”¨ graphql_handler å‡½æ•°æ¥å¤„ç† GraphQL æŸ¥è¯¢ã€‚</p>
<ol start="4">
<li>å¯åŠ¨æœåŠ¡å™¨ï¼š</li>
</ol>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<pre><pre class="playground"><code class="language-rust edition2021">
#[tokio::main]
async fn main() {
    let addr = ([127, 0, 0, 1], 8080).into();
    let server = Server::bind(&amp;addr).serve(make_service_fn(|_conn| async {
        Ok::&lt;_, hyper::Error&gt;(service_fn(handle_request))
    }));

    println!(&quot;Listening on http://{}&quot;, addr);

    if let Err(e) = server.await {
        eprintln!(&quot;server error: {}&quot;, e);
    }
}
</code></pre></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ hyper åº“æ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶æŠŠè¯·æ±‚å¤„ç†å™¨ä¼ ç»™æœåŠ¡å™¨ã€‚åœ¨ main å‡½æ•°ä¸­å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬åœ¨ 127.0.0.1:8080 ä¸Šã€‚</p>
<ol start="5">
<li>ä½¿ç”¨ GraphQL æŸ¥è¯¢ï¼š</li>
</ol>
<p>ç°åœ¨ä½ å¯ä»¥åœ¨ http://127.0.0.1:8080/graphql ä¸Šè®¿é—® GraphQL IDE é¡µé¢ï¼Œè¾“å…¥ä»¥ä¸‹æŸ¥è¯¢ï¼š</p>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
query {
hello
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç„¶åç‚¹å‡» &quot;Play&quot; æŒ‰é’®å‘é€æŸ¥è¯¢ã€‚æœåŠ¡å™¨ä¼šè¿”å›ä»¥ä¸‹ç»“æœï¼š</p>
<p>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
&quot;data&quot;: {
&quot;hello&quot;: &quot;Hello, world!&quot;
}
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„ Rust GraphQL æœåŠ¡çš„åŸºæœ¬ç»“æ„ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ·»åŠ æ›´å¤šçš„æŸ¥è¯¢ã€å˜å¼‚å’Œè®¢é˜…ã€‚</p>
<h2 id="refer-22"><a class="header" href="#refer-22">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://tokio.rs/tokio/tutorial">Tutorial | Tokio - An asynchronous Rust runtime</a></p>
<ul>
<li><a href="https://tony612.github.io/tokio-internals/01_intro_async.html">ä»‹ç» - Tokio Internals</a></li>
<li>...</li>
</ul>
<pre><code>        _~^|^~_
    \) /  â™¡ â†  \ ()
      '_   â–½   _'
      / '--âˆ½--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-å•å…ƒæµ‹è¯•å¾—çŸ¥é“çš„ä¸€åˆ‡"><a class="header" href="#rust-å•å…ƒæµ‹è¯•å¾—çŸ¥é“çš„ä¸€åˆ‡">Rust å•å…ƒæµ‹è¯•å¾—çŸ¥é“çš„ä¸€åˆ‡</a></h1>
<p>æ¥è‡ª: <a href="https://www.youtube.com/watch?v=_jDKeOtOiEo&amp;t=4488s">Everything You Wanted to Know About Rust Unit Testing (and then some more) - YouTube</a></p>
<h2 id="logging-17"><a class="header" href="#logging-17">logging</a></h2>
<p>Learn how to write unit tests in Rust with this hands-on video that covers these five topics with examples and real code:</p>
<ul>
<li>The basic types of unit tests</li>
<li>The quality of the testing code</li>
<li>Testing the not-so-happy-path</li>
<li>Testing asynchronous code</li>
<li>Testing tools</li>
</ul>
<p>â±ï¸ Timestamps â±ï¸</p>
<h3 id="000000---intro"><a class="header" href="#000000---intro">00:00:00 - Intro</a></h3>
<h3 id="000125---basic-concepts"><a class="header" href="#000125---basic-concepts">00:01:25 - Basic concepts</a></h3>
<h3 id="000443---project-creation"><a class="header" href="#000443---project-creation">00:04:43 - Project creation</a></h3>
<h3 id="000838---tests-module"><a class="header" href="#000838---tests-module">00:08:38 - Tests module</a></h3>
<h3 id="001024---rust-snippets-for-tests"><a class="header" href="#001024---rust-snippets-for-tests">00:10:24 - Rust snippets for tests</a></h3>
<h3 id="001421---first-unit-test-return-value"><a class="header" href="#001421---first-unit-test-return-value">00:14:21 - First unit test return value</a></h3>
<h3 id="002403---second-unit-test-state"><a class="header" href="#002403---second-unit-test-state">00:24:03 - Second unit test state</a></h3>
<h3 id="002846---alternative-implementation-tested"><a class="header" href="#002846---alternative-implementation-tested">00:28:46 - Alternative implementation tested</a></h3>
<h3 id="003244---third-unit-test-interaction"><a class="header" href="#003244---third-unit-test-interaction">00:32:44 - Third unit test interaction</a></h3>
<h3 id="004650---recommended-implementation"><a class="header" href="#004650---recommended-implementation">00:46:50 - Recommended implementation</a></h3>
<h3 id="004909---test-code-quality"><a class="header" href="#004909---test-code-quality">00:49:09 - Test code quality</a></h3>
<h3 id="004934---use-constants-for-literals"><a class="header" href="#004934---use-constants-for-literals">00:49:34 - Use constants for literals</a></h3>
<h3 id="005418---reduce-repetition-with-setup-and-teardown"><a class="header" href="#005418---reduce-repetition-with-setup-and-teardown">00:54:18 - Reduce repetition with setup and teardown</a></h3>
<h3 id="010857---share-code-among-test-modules"><a class="header" href="#010857---share-code-among-test-modules">01:08:57 - Share code among test modules</a></h3>
<h3 id="011305---why-testing-the-not-so-happy-path"><a class="header" href="#011305---why-testing-the-not-so-happy-path">01:13:05 - Why testing the not so happy path</a></h3>
<h3 id="011332---test-panics"><a class="header" href="#011332---test-panics">01:13:32 - Test panics</a></h3>
<h3 id="011803---use-ignore-and-test-results"><a class="header" href="#011803---use-ignore-and-test-results">01:18:03 - Use ignore and test results</a></h3>
<h3 id="012802---bubble-up-errors-in-tests"><a class="header" href="#012802---bubble-up-errors-in-tests">01:28:02 - Bubble up errors in tests</a></h3>
<h3 id="013034---asynchronous-code-in-rust"><a class="header" href="#013034---asynchronous-code-in-rust">01:30:34 - Asynchronous code in Rust</a></h3>
<h3 id="013101---async-tests"><a class="header" href="#013101---async-tests">01:31:01 - Async tests</a></h3>
<h3 id="013819---beyond-cargo-test"><a class="header" href="#013819---beyond-cargo-test">01:38:19 - Beyond cargo test</a></h3>
<h3 id="013846---rustdoc-and-doc-tests"><a class="header" href="#013846---rustdoc-and-doc-tests">01:38:46 - rustdoc and doc-tests</a></h3>
<h3 id="014800---show-test-output"><a class="header" href="#014800---show-test-output">01:48:00 - Show test output</a></h3>
<h3 id="014933---selecting-tests"><a class="header" href="#014933---selecting-tests">01:49:33 - Selecting tests</a></h3>
<h3 id="015555---test-coverage"><a class="header" href="#015555---test-coverage">01:55:55 - Test coverage</a></h3>
<h3 id="020108---nextest"><a class="header" href="#020108---nextest">02:01:08 - Nextest</a></h3>
<h3 id="020554---outro"><a class="header" href="#020554---outro">02:05:54 - Outro</a></h3>
<h2 id="refer-23"><a class="header" href="#refer-23">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://github.com/mongodb-developer/unit-testing-rust">mongodb-developer/unit-testing-rust: This repository contains the code used in MongoDB's video &quot;Intro to Unit Testing in Rust.&quot;</a></p>
<ul>
<li>è”ç³»åŸè‘—/Jorge:
<ul>
<li>Twitter: https://twitter.com/jdortiz</li>
<li>Mastodon: https://fosstodon.org/@jdortiz</li>
<li>LinkedIn: https://www.linkedin.com/in/jorgeortiz/</li>
</ul>
</li>
<li>ä»¥åŠ: 
<ul>
<li><a href="https://www.freecodecamp.org/news/unit-testing-in-rust/">What is Unit Testing? How to Perform Unit Tests in Rust</a></li>
</ul>
</li>
</ul>
<pre><code>            _~`&amp;âˆ½~_
        () /  o â†’  \ \/
          '_   â–³   _'
          &gt; '--#--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="codelldb"><a class="header" href="#codelldb">CodeLLDB</a></h1>
<blockquote>
<p>VSCode ä¸­çš„è°ƒè¯•é‡æ­¦...</p>
</blockquote>
<h2 id="backgroung-6"><a class="header" href="#backgroung-6">backgroung</a></h2>
<p>ä½œä¸ºä¸€åå·¥ç¨‹å¸ˆ, æ€»æ˜¯æƒ³å¯¹è¿è¡Œæ—¶åº”ç”¨è¿›è¡Œæ— é™å±‚æ¬¡çš„æ¢å¯Ÿå“ª...</p>
<h2 id="goal-20"><a class="header" href="#goal-20">goal</a></h2>
<p>CodeLLDB æˆ–æ˜¯ GDB/LLDB CLI æŒ‡ä»¤, åŸºæœ¬ä½¿ç”¨...</p>
<p>è¶³ä»¥è¾…åŠ©æ¢æŸ¥,ç†è§£å…³é”®è¯­æ³•çš„çœŸå®è¡Œä¸º.</p>
<h2 id="trace-19"><a class="header" href="#trace-19">trace</a></h2>
<ul>
<li>æœ€æ—©æ˜¯ æ‰‹å·¥ç»´æŠ¤</li>
<li>åæ¥ç”¨ Python å†™äº†ä¸ªè„šæœ¬, è‡ªåŠ¨è½¬åŒ–ä¸º Nginx é…ç½®</li>
<li>ç°åœ¨, è½®åˆ° Rust æ¥é‡æ„äº†...</li>
</ul>
<h2 id="refer-24"><a class="header" href="#refer-24">refer.</a></h2>
<p><a href="https://llvm.org/">The LLVM Compiler Infrastructure Project</a></p>
<ul>
<li><a href="https://lldb.llvm.org/">LLDB Homepage â€” The LLDB Debugger</a>
<ul>
<li><a href="https://lldb.llvm.org/use/tutorial.html#id1">Tutorial â€” The LLDB Debugger</a></li>
<li><a href="https://lldb.llvm.org/use/map.html#id1">GDB to LLDB command map â€” The LLDB Debugger</a></li>
<li><a href="https://lldb.llvm.org/use/symbols.html">Symbols on macOS â€” The LLDB Debugger</a></li>
<li>...</li>
</ul>
</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB - Visual Studio Marketplace</a>
<ul>
<li><a href="https://lldb.llvm.org/use/tutorial.html">Tutorial â€” The LLDB Debugger</a></li>
<li><a href="https://code.visualstudio.com/docs/editor/debugging">Debugging in Visual Studio Code</a></li>
<li><a href="https://github.com/vadimcn/vscode-lldb/wiki/Troubleshooting">Troubleshooting Â· vadimcn/vscode-lldb Wiki</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">vadimcn/vscode-lldb Â· Discussions Â· GitHub</a></li>
<li>...</li>
</ul>
</li>
<li><a href="https://dev.to/rogertorres/debugging-rust-with-vs-code-11dj">Debugging Rust with VS Code - DEV Community</a></li>
<li><a href="https://blog.logrocket.com/how-debug-rust-vs-code/">How to debug Rust with VS Code - LogRocket Blog</a></li>
<li><a href="https://www.forrestthewoods.com/blog/how-to-debug-rust-with-visual-studio-code/">How to Debug Rust with Visual Studio Code</a></li>
<li><a href="https://chopschips.net/blog/2020/03/03/rust-lldb-workaround/">VSCodeã§Rustã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒãƒƒã‚°ã§ããªã„å•é¡Œ | å‰²ã‚Šç®¸ãƒãƒ†ãƒ</a></li>
<li>...</li>
</ul>
<h2 id="logging-18"><a class="header" href="#logging-18">logging</a></h2>
<ul>
<li>...</li>
<li>...ğŸ¦€</li>
<li>230307 ZQ init.</li>
</ul>
<pre><code>       _~âˆ½*^~_
   () /  o â—¶  \ (/
     '_   âŒ„   _'
     ( '--#--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gui"><a class="header" href="#gui">GUI</a></h1>
<blockquote>
<p>å›¾å½¢ç”¨æˆ·ç•Œé¢..ç°åœ¨åº”è¯¥éƒ½å¯ä»¥ web/WASM åŒ–äº†</p>
</blockquote>
<h2 id="backgroung-7"><a class="header" href="#backgroung-7">backgroung</a></h2>
<p>ä½œä¸ºä¸€åç¨‹åºçŒ¿, ç»ˆç«¯å‡ ä¹å°±æ˜¯ç”Ÿå­˜ç©ºé—´, 
å¯æƒœç”¨æˆ·æ€»æ˜¯çœ‹çœ‹ blingbling çš„æ¡Œé¢å“ª...</p>
<h2 id="goal-21"><a class="header" href="#goal-21">goal</a></h2>
<p>æ‰¾åˆ°ä¸€ç§èˆ’æœçš„å§¿åŠ¿:</p>
<ul>
<li><input disabled="" type="checkbox"/>
å¯ä»¥å¿«é€Ÿæ„é€ å‡ºå„ç§æ¡Œé¢å·¥å…·</li>
<li><input disabled="" type="checkbox"/>
å¯ä»¥å¿«é€Ÿæ„é€ è·¨å¹³å°æ¡Œé¢å·¥å…·</li>
<li><input disabled="" type="checkbox"/>
å¯ä»¥å¿«é€Ÿæ„é€ å‡ºèƒ½ä¸Šå„ç§åº”ç”¨å¸‚åœºçš„æ¡Œé¢å·¥å…·
<ul>
<li><input disabled="" type="checkbox"/>
macOS app store ä¸ºå…ˆ?</li>
</ul>
</li>
</ul>
<h2 id="tracing-2"><a class="header" href="#tracing-2">tracing</a></h2>
<blockquote>
<p>é—®é¢˜æ˜¯è¿™ä¹ˆæ¥çš„...</p>
</blockquote>
<h2 id="refer-25"><a class="header" href="#refer-25">refer.</a></h2>
<p><a href="https://github.com/rust-unofficial/awesome-rust">rust-unofficial/awesome-rust: A curated list of Rust code and resources.</a></p>
<ul>
<li><a href="https://blog.logrocket.com/state-of-rust-gui-libraries/">The state of Rust GUI libraries - LogRocket Blog</a></li>
<li><a href="https://www.areweguiyet.com/">Are we GUI yet?</a>
<ul>
<li><a href="https://www.arewewebyet.org/">Are we web yet? Yes, and it's freaking fast!</a></li>
<li><a href="https://www.arewelearningyet.com/">Are we learning yet?</a></li>
<li><a href="https://arewegameyet.rs/">Are we game yet?</a></li>
</ul>
</li>
<li><a href="https://lib.rs/crates/winit">GUI â€” list of Rust libraries/crates // Lib.rs</a></li>
<li><a href="https://www.libhunt.com/l/rust/topic/gui">Top 23 Rust GUI Projects (Mar 2023)</a>
<ul>
<li><a href="https://www.reddit.com/r/rust/comments/sj54h0/what_are_the_best_gui_libraries_for_a_potentially/">What are the best GUI libraries for a potentially â€œseriousâ€/large project? : rust</a></li>
<li>...</li>
</ul>
</li>
<li>ç›´è§‰ä¸Šå€¼å¾—å°è¯•çš„:
<ul>
<li>26.6kâ˜… <a href="https://github.com/yewstack/yew/releases">yewstack/yew: Rust / Wasm framework for building client web apps</a></li>
<li>18.3kâ˜… <a href="https://github.com/iced-rs/iced/watchers">iced-rs/iced: A cross-platform GUI library for Rust, inspired by Elm</a></li>
<li>13.8kâ˜… <a href="https://github.com/emilk/egui">emilk/egui: egui: an easy-to-use immediate mode GUI in Rust that runs on both web and native</a></li>
<li>7.4kâ˜… <a href="https://github.com/DioxusLabs/dioxus/releases">DioxusLabs/dioxus: Friendly React-like GUI library for desktop, web, mobile, and more.</a> ~ å—¯å“¼? åŒ…å« TUI çš„æ”¯æŒ...</li>
<li>1.1kâ˜… <a href="https://github.com/fltk-rs/fltk-rs">fltk-rs/fltk-rs: Rust bindings for the FLTK GUI library.</a>
<ul>
<li><a href="https://fltk.flatig.vip/Home.html">å¼€å§‹ - fltk book</a></li>
</ul>
</li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
<pre><code>            _~^~`~_
        \) /  ? -  \ (/
          '_   âµ   _'
          \ '-----' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åµŒå…¥å¼å¼€å‘"><a class="header" href="#åµŒå…¥å¼å¼€å‘">åµŒå…¥å¼å¼€å‘</a></h1>
<h2 id="background-17"><a class="header" href="#background-17">background</a></h2>
<p><a href="https://github.com/rust-embedded/awesome-embedded-rust">rust-embedded/awesome-embedded-rust: Curated list of resources for Embedded and Low-level development in the Rust programming language</a></p>
<h2 id="goal-22"><a class="header" href="#goal-22">goal</a></h2>
<p>å’Œ microPython å¯¹æ¯”ä¸€ä¸‹å¼€å‘ä½“éªŒ...</p>
<h2 id="trace-20"><a class="header" href="#trace-20">trace</a></h2>
<p>TBD</p>
<h2 id="refer-26"><a class="header" href="#refer-26">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li>...</li>
</ul>
<pre><code>            _~-*`~_
        \) /  = *  \ \/
          '_   âµ   _'
          / '--~--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="raspberry-pi-pico"><a class="header" href="#raspberry-pi-pico">Raspberry Pi Pico</a></h1>
<blockquote>
<p>æœ€ä¾¿å®œçš„å¼€å‘æ¿äº†...</p>
</blockquote>
<h2 id="background-18"><a class="header" href="#background-18">background</a></h2>
<p>Why not?</p>
<h2 id="goal-23"><a class="header" href="#goal-23">goal</a></h2>
<p>å’Œ microPython å¯¹æ¯”ä¸€ä¸‹å¼€å‘ä½“éªŒ...</p>
<h2 id="trace-21"><a class="header" href="#trace-21">trace</a></h2>
<p>TBD</p>
<h2 id="refer-27"><a class="header" href="#refer-27">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://www.youtube.com/watch?v=JhajoAyP8e4&amp;list=PLc7W4b0WHTAV6EYRVayb9c9dEsq-NeXAt&amp;pp=iAQB">Raspberry Pi Pico - YouTube</a>
<ul>
<li><a href="https://www.youtube.com/watch?v=Yi0WRF5WPFw&amp;list=PLc7W4b0WHTAV6EYRVayb9c9dEsq-NeXAt&amp;index=10">Rust Runs on Everything, Including the Raspberry Pi Pico | Adventures in Embedded Rust Programming - YouTube</a></li>
<li><a href="https://www.youtube.com/watch?v=zSWkrpu8KBA">Don't Worry, C and Rust Can FINALLY Coexist (Here's How) | Embedded Rust and C on the RP2040 Pi Pico - YouTube</a>
<ul>
<li><a href="https://github.com/lowlevellearning/rp2040-blink/commit/0448080d39785592e857d699269c9cc8f13f669f">lowlevellearning/rp2040-blink</a></li>
</ul>
</li>
</ul>
</li>
<li>èµ·ç‚¹:<a href="https://github.com/rust-embedded/cortex-m-quickstart">rust-embedded/cortex-m-quickstart: Template to develop bare metal applications for Cortex-M microcontrollers</a></li>
<li>åŸºç¡€:<a href="https://github.com/rp-rs/rp-hal">rp-rs/rp-hal: A Rust Embedded-HAL for the rp series microcontrollers</a>
<ul>
<li><a href="https://github.com/rp-rs/rp2040-project-template/releases">rp-rs/rp2040-project-template: A basic rp2040-hal project with blinky and rtt logging example code. With this you can quickly get started on a new rp2040 project</a></li>
</ul>
</li>
<li><a href="https://picockpit.com/raspberry-pi/zh/2020/11/">å…³äºRaspberry Pi Picoçš„ä¸€åˆ‡ - PiCockpit | ç›‘æ§å’Œæ§åˆ¶ä½ çš„Raspberry Piï¼šæœ€å¤šå¯ä»¥å…è´¹ä½¿ç”¨5ä¸ªPis!</a></li>
<li>demo:
<ul>
<li><a href="https://tutoduino.fr/en/tutorials/programing-in-rust-the-xiao-rp2040-board/">Programing in Rust the XIAO RP2040 board</a></li>
<li><a href="https://dev.to/jeikabu/early-raspberry-pi-pico-and-rust-4c2a">Early Raspberry Pi Pico and Rust - DEV Community</a></li>
<li><a href="https://qiita.com/Toshiaki0315/items/e6b4ba01623eaa5273a8#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88">RaspberryPi PICOç”¨ã®Rustç’°å¢ƒæ§‹ç¯‰ - Qiita</a></li>
<li><a href="https://picockpit.com/raspberry-pi/zh/2020/11/">å…³äºRaspberry Pi Picoçš„ä¸€åˆ‡ - PiCockpit | ç›‘æ§å’Œæ§åˆ¶ä½ çš„Raspberry Piï¼šæœ€å¤šå¯ä»¥å…è´¹ä½¿ç”¨5ä¸ªPis!</a></li>
<li></li>
</ul>
</li>
<li>...</li>
</ul>
<pre><code>        _~`|`~_
    \/ /  = â—¶  \ ()
      '_   ğŸ‚   _'
      \ '--âŒ„--' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="äº¤å‰ç¼–è¯‘"><a class="header" href="#äº¤å‰ç¼–è¯‘">äº¤å‰ç¼–è¯‘</a></h1>
<blockquote>
<p>ä¸»è¦æ˜¯æ‡’...</p>
</blockquote>
<h2 id="background-19"><a class="header" href="#background-19">background</a></h2>
<p>æ—¥å¸¸ç¯å¢ƒ:</p>
<pre><code>  neofetch
                    'c.          zoomq@ZQ160626rMBP
                 ,xNMM.          ------------------
               .OMMMMo           OS: macOS Big Sur 10.16 22D68 arm64
               OMMM0,            Host: MacBookPro18,4
     .;loddo:' loolloddol;.      Kernel: 22.3.0
   cKMMMMMMMMMMNWMMMMMMMMMM0:    Uptime: 5 days, 5 hours, 39 mins
 .KMMMMMMMMMMMMMMMMMMMMMMMWd.    Packages: 330 (brew)
 XMMMMMMMMMMMMMMMMMMMMMMMX.      Shell: bash 5.1.16
;MMMMMMMMMMMMMMMMMMMMMMMM:       Resolution: 2048x1280, 3200x1800
:MMMMMMMMMMMMMMMMMMMMMMMM:       DE: Aqua
.MMMMMMMMMMMMMMMMMMMMMMMMX.      WM: Spectacle
 kMMMMMMMMMMMMMMMMMMMMMMMMWd.    Terminal: iTerm2
 .XMMMMMMMMMMMMMMMMMMMMMMMMMMk   Terminal Font: FiraCode-Regular 18 (normal) / SarasaMonoSCNerd-regular 18 (non-ascii)
  .XMMMMMMMMMMMMMMMMMMMMMMMMK.   CPU: Apple M1 Max
    kMMMMMMMMMMMMMMMMMMMMMMd     GPU: Apple M1 Max
     ;KMMMMMMMWXXWMMMMMMMk.      Memory: 11065MiB / 65536MiB
       .cooc,.    .,coo:.
</code></pre>
<p>è™½ç„¶æœ‰ linux çš„ home server, ä¸è¿‡, 
ä¸€ä¸ªå°å·¥å…·,èƒ½åœ¨æœ¬åœ°ç¼–è¯‘å‡ºæ¥å‘å¸ƒäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶å¤šå¥½?</p>
<h2 id="goal-24"><a class="header" href="#goal-24">goal</a></h2>
<p>ä»æœ¬åœ°åŒæ—¶å¯ä»¥ cargo build å‡ºæ¥ä¸¤ä¸ªä¸»è¦åœºæ™¯çš„æˆå“:</p>
<ul>
<li>macOS arm64 </li>
<li>Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-175-generic x86_64) ç±»ä¼¼ LTS ç›®æ ‡ç¯å¢ƒ</li>
</ul>
<h2 id="trace-22"><a class="header" href="#trace-22">trace</a></h2>
<p>æ²¡åŠæ³•ç®€å•çš„æˆåŠŸ, è¿˜æ˜¯ç”¨çœŸæœºæˆ–æ˜¯å¯¹åº”ä¸“ç”¨ç¼–è¯‘ Docker æ¥å®Œæˆå§...</p>
<h3 id="abrew"><a class="header" href="#abrew">abrew</a></h3>
<blockquote>
<p>arm ç‰ˆæœ¬ brew</p>
</blockquote>
<pre><code>$ abrew install FiloSottile/musl-cross/musl-cross
</code></pre>
<p>å¼•å‘ä¸€ç³»åˆ—æ‰‹å·¥å®‰è£…:</p>
<ul>
<li>abrew install --build-from-source gnu-sed</li>
<li>abrew install --build-from-source lzip</li>
<li>abrew install --build-from-source make</li>
<li>...</li>
</ul>
<p><img src="https://ipic.zoomquiet.top/2023-02-26-zshot%202023-02-26%2015.22.58.jpg" alt="" /></p>
<pre><code>...
==&gt; /opt/homebrew/opt/make/bin/gmake install TARGET=x86_64-linux-musl
ğŸº  /opt/homebrew/Cellar/musl-cross/0.9.9_1: 1,851 files, 215.8MB, built in 5 minutes 35 seconds
==&gt; Running `brew cleanup musl-cross`...
Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.
Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).
</code></pre>
<p>å¯¹åº” Cargo.toml ä¸­è¿½åŠ :</p>
<pre><code>...
[target.x86_64-unknown-linux-musl]
linker = &quot;/opt/homebrew/Cellar/musl-cross/0.9.9_1/bin/x86_64-linux-musl-gcc&quot;

</code></pre>
<p>å°è¯•ç¼–è¯‘:</p>
<pre><code>$ cargo build --target x86_64-unknown-linux-musl
</code></pre>
<p>ç„¶å:</p>
<pre><code>...
Some errors have detailed explanations: E0405, E0408, E0412, E0416, E0425, E0433, E0463, E0531.
error: could not compile `regex-syntax` due to 990 previous errors
</code></pre>
<p>æŠ˜è…¾å‡º 900+ é”™è¯¯...è´¥é€€...</p>
<h3 id="github-action"><a class="header" href="#github-action">GitHub-action</a></h3>
<blockquote>
<p>èƒ½å…è´¹ç”¨èµ·æ¥çš„, å…ˆç”¨èµ·æ¥...</p>
</blockquote>
<p>..TBD</p>
<h2 id="refer-28"><a class="header" href="#refer-28">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://kerkour.com/rust-cross-compilation">Cross-compilation in Rust</a></p>
<ul>
<li>M1 macOS host:
<ul>
<li><a href="https://stackoverflow.com/questions/68139162/how-can-i-cross-compile-rust-code-into-intel-assembly-on-an-arm-m1-apple-silicon">macos - How can I cross compile Rust code into Intel assembly on an ARM M1 Apple Silicon Mac? - Stack Overflow</a></li>
<li><a href="https://www.reddit.com/topics/a-1/">M1 Users - How are you Cross Compiling? : rust</a></li>
<li><a href="https://levelup.gitconnected.com/bash-vs-python-for-modern-shell-scripting-c1d3d79c3622?source=read_next_recirc---two_column_layout_sidebar------3---------------------95f4769b_05fc_410f_a439_5b8e347b5325-------">Cross-compiling Rust From Mac to Linux | by Merlin Fuchs | Better Programming</a></li>
<li><a href="https://manuel.bernhardt.io/posts/2022-11-04-rust-development-for-the-raspberry-pi-on-apple-silicon/">Rust Development for the Raspberry Pi on Apple Silicon - Manuel Bernhardt</a></li>
<li>...</li>
</ul>
</li>
<li>arm Linux host:
<ul>
<li><a href="https://burgers.io/cross-compile-rust-from-arm-to-x86-64">Cross-compiling Rust from ARM to x86-64 | Bryan Burgers</a></li>
<li>...</li>
</ul>
</li>
<li><a href="https://www.docker.com/blog/cross-compiling-rust-code-for-multiple-architectures/">Cross Compiling Rust Code for Multiple Architectures | Docker</a></li>
</ul>
<h2 id="logging-19"><a class="header" href="#logging-19">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230226 ZQ init.</li>
</ul>
<pre><code>          _~âˆ½|-~_
      \) /  â—· O  \ \/
        '_   â•   _'
        \ '--.--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="20å¹´æ¥ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆå­¦åˆ°çš„20ä»¶äº‹"><a class="header" href="#20å¹´æ¥ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆå­¦åˆ°çš„20ä»¶äº‹">20å¹´æ¥ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆå­¦åˆ°çš„20ä»¶äº‹</a></h1>
<p>åŸæ–‡: <a href="https://www.simplethread.com/20-things-ive-learned-in-my-20-years-as-a-software-engineer/">20 Things I've Learned in my 20 Years as a Software Engineer - Simple Thread</a></p>
<h2 id="æ³¨æ„è¯·å…ˆé˜…è¯»æ­¤å†…å®¹"><a class="header" href="#æ³¨æ„è¯·å…ˆé˜…è¯»æ­¤å†…å®¹">æ³¨æ„:è¯·å…ˆé˜…è¯»æ­¤å†…å®¹</a></h2>
<p>å³å°†å±•ç°çš„æ˜¯ä¸€ç¯‡åŒ…å«å¤§é‡å»ºè®®çš„ blog ;
å‘å‰äººå­¦ä¹ å¯¹æˆåŠŸè‡³å…³é‡è¦,ä½†æ˜¯,æˆ‘ä»¬å¸¸å¸¸å¿˜è®°å¦å¤–ä¸€ä¸ªé‡è¦è­¦å‘Š:
å‡ ä¹æ‰€æœ‰çš„å»ºè®®éƒ½æ˜¯ä¸Šä¸‹æ–‡ç›¸å…³çš„, ä½†æ˜¯,å¾ˆå°‘å¯¹ä¸Šä¸‹æ–‡æä¾›ç»†èŠ‚;</p>
<p>&quot;ä½ éœ€è¦æ”¶å–æ›´å¤šè´¹ç”¨!&quot; è¿™ç»è¥äº†20å¹´çš„å…¬å¸è¯´, å¤šå¹´ä»¥æ¥æ”¶è´¹&quot;å¤ªä½&quot;,æ— æ³•èµ¢å¾—å®¢æˆ·å¹¶å–å¾—æˆåŠŸ;</p>
<p>&quot;ä½ éœ€è¦å°†ä¸€åˆ‡æ„å»ºä¸ºå¾®æœåŠ¡!&quot; è¯¥å…¬å¸è¡¨ç¤º, æ„å»ºäº†ä¸€ä¸ªå¿«é€Ÿçš„æ•´ä½“,è·å¾—äº†æ•°åƒå®¢æˆ·,ç„¶å,åœ¨å¼€å§‹é‡åˆ°é—®é¢˜æ—¶, å…¨é¢è½¬å‘äº†å¾®æœåŠ¡;</p>
<p>å¦‚æœä¸äº†è§£ä¸Šä¸‹æ–‡, å»ºè®®å°±æ¯«æ— æ„ä¹‰,ç”šè‡³æ›´ç³Ÿç³•,æœ‰å®³;
å¦‚æœé‚£äº›äººæ—©ç‚¹å¬ä»ä»–ä»¬è‡ªå·±çš„å»ºè®®,ä»–ä»¬è‡ªå·±å¯èƒ½ä¼šå› æ­¤å—è‹¦;
å¯¹äºä»»ä½•å»ºè®®å¾ˆéš¾é€ƒè„±è¿™ä¸ªé™·é˜±;
æˆ‘ä»¬å¯èƒ½æ˜¯æˆ‘ä»¬ç»å†çš„ç»ˆç‚¹,ä½†æ˜¯,æˆ‘ä»¬å´æ˜¯é€šè¿‡ç°åœ¨çš„é•œå¤´æ¥è§‚å¯Ÿ;</p>
<p>å› æ­¤,ä¸ºäº†è®©ä½ äº†è§£ä¸€ä¸‹è¿™äº›å»ºè®®çš„æ¥æº,ç‰¹æ­¤è¯´æ˜:
æˆ‘åœ¨èŒä¸šç”Ÿæ¶¯çš„å‰åŠæ®µæ‹…å½“è½¯ä»¶å·¥ç¨‹å¸ˆ,ä¸ºå„ç§å°å‹ä¼ä¸šå’Œåˆåˆ›å…¬å¸å·¥ä½œ,
ç„¶å,æˆ‘è¿›å…¥å’¨è¯¢è¡Œä¸šå¹¶åœ¨è®¸å¤šéå¸¸å¤ªçš„ä¼ä¸šå·¥ä½œ;
æœ€å, æˆ‘å¼€åˆ›äº† <code>Simple Thread</code>,
æˆ‘ä»¬ä»ä¸€ä¸ª2äººå›¢é˜Ÿæˆé•¿ä¸ºä¸€ä¸ª25äººçš„å›¢é˜Ÿ;
10å¹´å‰, æˆ‘ä»¬ä¸»è¦å’Œä¸­å°å‹ä¼ä¸šåˆä½œ,ç°åœ¨æˆ‘ä»¬å’Œå¤§å‹å’Œå°å‹ä¼ä¸šåˆä½œ;</p>
<p>æˆ‘çš„æ‰€æœ‰å»ºè®®æ¥è‡ªäº:</p>
<ul>
<li>å‡ ä¹æ€»æ˜¯åœ¨å°è€Œç²¾å¹²çš„å›¢é˜Ÿä¸­,æˆ‘ä»¬å¿…é¡»ç”¨å¾ˆå°‘çš„èµ„æºä½œå¾ˆå¤šäº‹æƒ…</li>
<li>é‡è§†å·¥ä½œè½¯ä»¶è€Œä¸æ˜¯ç‰¹å®šå·¥å…·</li>
<li>ä¸€ç›´åœ¨å¼€å§‹æ–°é¡¹ç›®,åŒæ—¶è¿˜è¦ç»´æŠ¤ä¸€äº›ç³»ç»Ÿ</li>
<li>é‡è§†å·¥ç¨‹å¸ˆçš„ç”Ÿäº§åŠ›,è¶…è¿‡å…¶å®ƒå¤§å¤šæ•°è€ƒè™‘å› ç´ </li>
<li>...</li>
</ul>
<p>æˆ‘è¿‡å»20å¹´çš„ç»å†å¡‘é€ äº†å¯¹è½¯ä»¶çš„åè§,
å¹¶ä½¿æˆ‘å½¢æˆäº†ä¸€äº›ä¿¡å¿µ;
æˆ‘è¯•å›¾å°†è¿™äº›ä¿¡å¿µå‹ç¼©ä¸ºä¸€ä¸ªæ˜“äºä½¿ç”¨çš„åˆ—è¡¨,
å¸Œæœ›ä½ èƒ½å‘ç°å¥¹ä»¬çš„ä»·å€¼;</p>
<h2 id="å»ºè®®æ¸…å•"><a class="header" href="#å»ºè®®æ¸…å•">å»ºè®®æ¸…å•:</a></h2>
<h3 id="1-æˆ‘ä»ç„¶æ‡‚çš„ä¸æ˜¯å¤ªå¤š"><a class="header" href="#1-æˆ‘ä»ç„¶æ‡‚çš„ä¸æ˜¯å¤ªå¤š">1. æˆ‘ä»ç„¶æ‡‚çš„ä¸æ˜¯å¤ªå¤š</a></h3>
<p>&quot;ä½ æ€ä¹ˆä¸çŸ¥é“ BGP ?&quot;</p>
<p>&quot;ä½ ä»æ¥æ²¡å¬è¯´è¿‡ Rust?&quot;</p>
<p>æˆ‘ä»¬å¤§å¤šæ•°äººéƒ½è¢«äººè¿™ä¹ˆè¯´è¿‡,
è€Œä¸”å¯èƒ½å¬çš„å¤ªé¢‘ç¹äº†;
æˆ‘ä»¬ä¸­è®¸å¤šäººå–œæ¬¢è½¯ä»¶çš„åŸå› å°±æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯ç»ˆèº«å­¦ä¹ è€…, åœ¨è½¯ä»¶é¢†åŸŸ,
æ— è®ºä½ ä»å“ªä¸ªæ–¹å‘çœ‹, éƒ½æœ‰å¹¿é˜”çš„çŸ¥è¯†å‰æ™¯å‘å„ä¸ªæ–¹å‘å‘å±•,
è€Œä¸”æ¯å¤©éƒ½åœ¨æ‰©å±•;
è¿™æ„å‘³ç€å³ä¾¿ä½ åœ¨èŒä¸šç”Ÿæ¶¯ä¸­åº¦è¿‡æ•°åå¹´,
ä½†æ˜¯, å’ŒåŒæ ·åœ¨çœ‹ä¼¼ç›¸ä¼¼çš„è§’è‰²ä¸­åº¦è¿‡æ•°åå¹´çš„äººç›¸æ¯”,
ä»ç„¶å­˜åœ¨å·¨å¤§çš„çŸ¥è¯†å·®è·;
è¶Šæ—©æ„è¯†åˆ°è¿™ç‚¹, å°±èƒ½è¶Šæ—©å¼€å§‹æ‘†è„± &quot;é¡¶æ›¿è€…ç»¼åˆç—‡&quot; ,
è½¬è€Œä¹äºå‘ä»–äººå­¦ä¹ å’Œæ•™å¯¼ä»–äºº;</p>
<h3 id="2-è½¯ä»¶æœ€éš¾çš„éƒ¨åˆ†æ˜¯æ„å»ºæ­£ç¡®çš„ä¸œè¥¿"><a class="header" href="#2-è½¯ä»¶æœ€éš¾çš„éƒ¨åˆ†æ˜¯æ„å»ºæ­£ç¡®çš„ä¸œè¥¿">2. è½¯ä»¶æœ€éš¾çš„éƒ¨åˆ†æ˜¯æ„å»ºæ­£ç¡®çš„ä¸œè¥¿</a></h3>
<p>æˆ‘çŸ¥é“åœ¨è¿™ç‚¹ä¸Šç®—é™ˆè¯æ»¥è°ƒ,
ä½†æ˜¯, å¤§å¤šæ•°è½¯ä»¶å·¥ç¨‹å¸ˆå¹¶ä¸ç›¸ä¿¡çš„åŸå› æ˜¯, ä»–ä»¬è®¤ä¸ºè¿™åœ¨è´¬ä½ä»–ä»¬çš„å·¥ä½œ;
æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯æ— ç¨½ä¹‹è°ˆï¼›
ç›¸å,è¿™çªå‡ºäº†æˆ‘ä»¬å¿…é¡»å·¥ä½œçš„ç¯å¢ƒæœ¬èº«å¤æ‚æ€§å’Œä¸åˆç†æ€§,
è¿™æ•…å±…äº†æˆ‘ä»¬çš„æŒ‘æˆ˜;
ä½ å¯ä»¥è®¾è®¡å‡ºä¸–ç•Œä¸ŠæŠ€æœ¯ä¸Šæœ€ä»¤äººå°è±¡æ·±åˆ»çš„ä¸œè¥¿,
ç„¶å, å´æ— äººæ„¿æ„ä½¿ç”¨;
è¿™ç§äº‹å„¿ä¸€ç›´åœ¨å‘ç”Ÿ;
è®¾è®¡è½¯ä»¶ä¸»è¦æ˜¯ä¸€ç§å€¾å¬æ´»åŠ¨,
æˆ‘ä»¬ç»å¸¸ä¸å¾—ä¸æˆä¸ºç«•è½¯ä»¶å·¥ç¨‹å¸ˆ, éƒ¨åˆ†é€šçµå¸ˆ, ä»¥åŠéƒ¨åˆ†äººç±»å­¦å®¶;
æŠ•èµ„åœ¨è¿™ä¸ªè®¾è®¡è¿‡ç¨‹, æ— è®ºæ˜¯é€šè¿‡ä¸“é—¨çš„ UX å›¢é˜Ÿ, è¿˜æ˜¯é€šè¿‡ç®€å•çš„è‡ªæˆ‘æ•™è‚²,
éƒ½å°†å¸¦æ¥å·¨å¤§çš„å›æŠ¥;
å› ä¸º, ä½ å¦‚ä½•è®¡ç®—æ„å»ºé”™è¯¯è½¯ä»¶çš„çœŸæ­£æˆæœ¬?
è¿™ä¸ä»…ä»…æ˜¯æŸå¤±å·¥ç¨‹æ—¶é—´...</p>
<h3 id="3-æœ€å¥½çš„è½¯ä»¶å·¥ç¨‹å¸ˆåƒè®¾è®¡å¸ˆä¸€æ ·æ€è€ƒ"><a class="header" href="#3-æœ€å¥½çš„è½¯ä»¶å·¥ç¨‹å¸ˆåƒè®¾è®¡å¸ˆä¸€æ ·æ€è€ƒ">3. æœ€å¥½çš„è½¯ä»¶å·¥ç¨‹å¸ˆåƒè®¾è®¡å¸ˆä¸€æ ·æ€è€ƒ</a></h3>
<p>ä¼Ÿå¤§çš„è½¯ä»¶å·¥ç¨‹å¸ˆä¼šæ€è€ƒä»–ä»¬ä»£ç çš„ç”¨æˆ·ä½“éªŒ;
ä»–ä»¬å¯èƒ½ä¸ä¼šç”¨å„ç§æœ¯è¯­æ¥è€ƒè™‘,
è€Œæ˜¯è€ƒè™‘åº”è¯¥æ˜¯å¤–éƒ¨API/ç¼–ç¨‹API/ç”¨æˆ·ç•Œé¢/åè®®è¿˜æ˜¯å…¶å®ƒä»»ä½•ç•Œé¢;
ä¼Ÿå¤§çš„å·¥ç¨‹å¸ˆä¼šè€ƒè™‘è°å°†ä½¿ç”¨, ä¸ºä»€ä¹ˆè¦ä½¿ç”¨,å¦‚ä½•ä½¿ç”¨,
ä»¥åŠè¿™äº›å¯¹ç”¨æˆ·æ¥è¯´ä»€ä¹ˆæ˜¯æœ€é‡è¦çš„;
ç‰¢è®°ç”¨æˆ·çš„éœ€æ±‚, ç¡®è®¤æ˜¯è‰¯å¥½ç”¨æˆ·ä½“éªŒçš„æ ¸å¿ƒ;</p>
<h3 id="4-æœ€å¥½çš„ä»£ç æ˜¯æ²¡æœ‰ä»£ç æˆ–æ˜¯ä½ ä¸å¿…ç»´æŠ¤çš„"><a class="header" href="#4-æœ€å¥½çš„ä»£ç æ˜¯æ²¡æœ‰ä»£ç æˆ–æ˜¯ä½ ä¸å¿…ç»´æŠ¤çš„">4. æœ€å¥½çš„ä»£ç æ˜¯æ²¡æœ‰ä»£ç ,æˆ–æ˜¯ä½ ä¸å¿…ç»´æŠ¤çš„</a></h3>
<p>æˆ‘åªæƒ³è¯´: &quot;ç å†œåªèƒ½ç¼–ç &quot;;
ä½ é—®ä»»ä½•è¡Œä¸šçš„äººå¦‚ä½•è§£å†³é—®é¢˜, 
ä»–ä»¬éƒ½ä¼šåœ¨ä»–ä»¬æ“…é•¿çš„é¢†åŸŸçŠ¯é”™è¯¯;
å«åªæ˜¯äººæ€§;
å¤§å¤šæ•°è½¯ä»¶å·¥ç¨‹å¸ˆæ€»æ˜¯ä¼šåœ¨ç¼–å†™ä»£ç æ—¶å‡ºé”™,
å°¤å…¶æ˜¯å½“éæŠ€æœ¯è§£å†³æ–¹æ¡ˆä¸æ˜æœ—æ—¶;
ä½ ä¸å¿…ç»´æŠ¤çš„ä»£ç ä¹Ÿæ˜¯å¦‚æ­¤;
å½“å¾ˆå¤šè½®å­å·²ç»å­˜åœ¨æ—¶,
å·¥ç¨‹å›¢é˜Ÿå¾ˆå®¹æ˜“æƒ³è¦é‡æ–°å‘æ˜è½®å­;
è¿™æ˜¯ä¸€ç§å¹³è¡¡è¡Œä¸º, 
æœ‰å¾ˆå¤šç†ç”±è®©ä½ è‡ªå·±å†æ¥ä¸€é,
ä½†æ˜¯, è¦æé˜²è¿™ç§ &quot;æ²¡åœ¨æ­¤ç°å®&quot;(â€œNot Invented Hereâ€) ç»¼åˆç—‡;</p>
<h3 id="5-è½¯ä»¶æ˜¯è¾¾åˆ°ç›®çš„çš„æ‰‹æ®µ"><a class="header" href="#5-è½¯ä»¶æ˜¯è¾¾åˆ°ç›®çš„çš„æ‰‹æ®µ">5. è½¯ä»¶æ˜¯è¾¾åˆ°ç›®çš„çš„æ‰‹æ®µ</a></h3>
<p>ä»»ä½•è½¯ä»¶å·¥ç¨‹å¸ˆçš„ä¸»è¦å·¥ä½œæ˜¯äº¤ä»˜ä»·å€¼;</p>
<p>å¾ˆå°‘æœ‰è½¯ä»¶å¼€å‘è€…ç†è§£è¿™ä¸€ç‚¹, å°†å…¶å†…åŒ–çš„å°±æ›´å°‘äº†;
çœŸæ­£å°†å…¶å†…åŒ–å, èƒ½å¯¼è‡´è§£å†³é—®é¢˜çš„ä¸åŒæ–¹å¼,
ä»¥åŠè§‚å¯Ÿå·¥å…·çš„ä¸åŒæ–¹å¼;
å¦‚æœçœŸçœŸçš„ç›¸ä¿¡è½¯ä»¶æ˜¯ä»å±äºç»“æœçš„,
ä½ å°±ä¼šå‡†å¤‡å¥½æ‰¾åˆ°çœŸæ­£&quot;é€‚åˆçš„å·¥å…·&quot;,
æœ‰æ—¶å¯èƒ½æ ¹æœ¬ä¸æ˜¯è½¯ä»¶;</p>
<h3 id="6-æœ‰æ—¶ä½ å¿…é¡»åœæ­¢ç£¨é”¯ç›´æ¥å¼€å§‹ç å±"><a class="header" href="#6-æœ‰æ—¶ä½ å¿…é¡»åœæ­¢ç£¨é”¯ç›´æ¥å¼€å§‹ç å±">6. æœ‰æ—¶ä½ å¿…é¡»åœæ­¢ç£¨é”¯,ç›´æ¥å¼€å§‹ç å±</a></h3>
<p>æœ‰äº›äººå€¾å‘äºè·³å…¥é—®é¢˜, å¹¶ç«‹å³å¼€å§‹ç¼–å†™ä»£ç ;
å…¶å®ƒäººå¾€å¾€æƒ³è¦ç ”ç©¶å’Œé™·å…¥ç¡¬ä»¶åˆ†æè¿›è€Œç˜«ç—ª;
åœ¨è¿™äº›æƒ…å†µä¸­,ä¸ºè‡ªå·±è®¾å®šä¸€ä¸ªæˆªæ­¢æ—¥æœŸ,
ç„¶å, å¼€å§‹æ¢ç´¢è§£å†³æ–¹æ¡ˆ;
å½“ä½ å¼€å§‹è§£å†³é—®é¢˜æ—¶,ä½ å¾ˆå¿«èƒ½å­¦ä¹ åˆ°æ›´å¤š,
è¿™ä¹Ÿå°†å¼•å¯¼ä½ è¿­ä»£åˆ°æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ;</p>
<h3 id="7-å¦‚æœä½ ä¸èƒ½å¾ˆå¥½çš„ç†è§£æ‰€æœ‰å¯èƒ½æ€§-å°±æ— æ³•è®¾è®¡å‡ºå¥½çš„ç³»ç»Ÿ"><a class="header" href="#7-å¦‚æœä½ ä¸èƒ½å¾ˆå¥½çš„ç†è§£æ‰€æœ‰å¯èƒ½æ€§-å°±æ— æ³•è®¾è®¡å‡ºå¥½çš„ç³»ç»Ÿ">7. å¦‚æœä½ ä¸èƒ½å¾ˆå¥½çš„ç†è§£æ‰€æœ‰å¯èƒ½æ€§, å°±æ— æ³•è®¾è®¡å‡ºå¥½çš„ç³»ç»Ÿ</a></h3>
<p>è¿™æ˜¯æˆ‘ä¸€ç›´åœ¨åŠªåŠ›è§£å†³çš„é—®é¢˜,
å› ä¸º, æˆ‘çš„èŒè´£ä½¿æˆ‘åœ¨è½¯ä»¶å·¥ç¨‹çš„æ—¥å¸¸å·¥ä½œä¸­è¶Šæ¥è¶Šè¿œ;
å³ä¸Šå¼€å‘è€…ç”Ÿæ€æ˜¯ä¸€é¡¹å·¨å¤§çš„å·¥ä½œ,
ä½†æ˜¯,äº†è§£ä»€ä¹ˆæ˜¯å¯èƒ½çš„è‡³å…³é‡è¦;
å¦‚æœä½ ä¸äº†è§£ç»™å®šç”Ÿæ€ä¸­æœ‰ä»€ä¹ˆæ˜¯å¯èƒ½çš„,ä»¥åŠä»€ä¹ˆæ˜¯å¯ç”¨çš„,
é‚£ä¹ˆä½ å°†å‘ç°é™¤äº†æœ€ç®€å•çš„é—®é¢˜ä¹‹å¤–,
ä¸å¯èƒ½è®¾è®¡å‡ºä¸€ä¸ªåˆç†çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³æ‰€æœ‰é—®é¢˜;
æ€»è€Œè¨€ä¹‹, è¦è­¦æƒ•é‚£äº›å¾ˆé•¿æ—¶é—´æ²¡æœ‰ç¼–å†™ä»»ä½•ä»£ç çš„æ¶æ„ä¸“å®¶;</p>
<h3 id="8-æ¯ä¸ªçš„äº†äº†çš„éƒ½å¾ˆç³Ÿç²•å…‹æœä¸«çš„"><a class="header" href="#8-æ¯ä¸ªçš„äº†äº†çš„éƒ½å¾ˆç³Ÿç²•å…‹æœä¸«çš„">8. æ¯ä¸ªçš„äº†äº†çš„éƒ½å¾ˆç³Ÿç²•,å…‹æœä¸«çš„</a></h3>
<p>Bjarne Stroustrup æœ‰å¥åè¨€:
&quot;åªæœ‰ä¸¤ç§è¯­è¨€: äººä»¬æŠ±æ€¨çš„è¯­è¨€, å’Œæ²¡äººä½¿ç”¨çš„è¯­è¨€&quot;;</p>
<p>è¿™ä¹Ÿå¯ä»¥æ‹“å±•åˆ°å¤§å‹ç³»ç»Ÿ;
æ²¡æœ‰&quot;æ­£ç¡®&quot;çš„æ¶æ„, ä½ æ°¸è¿œæ— æ³•å¿è¿˜æ‰€æœ‰æŠ€æœ¯å€ºåŠ¡,
ä½ æ°¸è¿œæ— æ³•è®¾è®¡å‡ºå®Œç¾çš„ç•Œé¢,
ä½ çš„æµ‹è¯•æ€»æ˜¯å¤ªæ…¢;
è¿™ä¸æ˜¯æ°¸ä¸è®©äº‹æƒ…å˜å¾—æ›´å¥½çš„å€Ÿå£,
è€Œæ˜¯ä¸€ç§ç»™ä½ è§‚ç‚¹çš„æ–¹å¼;
å°‘æ‹…å¿ƒä¼˜é›…å’Œå®Œç¾;
ç›¸å, åŠªåŠ›æŒç»­æ”¹è¿›å¹¶åˆ›å»ºä¸€ä¸ªä½ çš„å›¢é˜Ÿå–œæ¬¢åœ¨å…¶ä¸­å·¥ä½œ,
å¹¶å¯ä»¥æŒç»­åˆ›é€ ä»·å€¼çš„å®œäººç³»ç»Ÿ;</p>
<h3 id="9-æ— äººé—®è¶³ä¸ºä»€ä¹ˆ"><a class="header" href="#9-æ— äººé—®è¶³ä¸ºä»€ä¹ˆ">9. æ— äººé—®è¶³&quot;ä¸ºä»€ä¹ˆ&quot;</a></h3>
<p>æŠ“ä½ä»»ä½•æœºä¼šè´¨ç–‘&quot;ä½œäº‹æ–¹å¼&quot;çš„å‡è®¾å’Œæ–¹æ³•;
æœ‰æ–°äººåŠ å…¥å˜›?
æ³¨æ„ä»–ä»¬åœ¨å“ªé‡Œæ„Ÿåˆ°å›°æƒ‘ä»¥åŠä»–ä»¬åœ¨é—®ä»€ä¹ˆé—®é¢˜;
æœ‰æ²¡æœ‰æ— æ„ä¹‰æ–°åŠŸèƒ½è¯·æ±‚?
ç¡®ä¿ä½ äº†è§£ç›®æ ‡ä»¥åŠæ˜¯ä»€ä¹ˆæ¨åŠ¨äº†å¯¹è¿™ä¸€åŠŸèƒ½çš„æ¸´æœ›;
å¦‚æœä½ æ²¡æœ‰å¾—åˆ°æ˜ç¡®çš„ç­”æ¡ˆ,
è¯·ç»§ç»­é—®ä¸ºä»€ä¹ˆ, ç›´åˆ°ä½ æ˜ç™½ä¸ºæ­¢;</p>
<h3 id="10-æˆ‘ä»¬åº”è¯¥æ›´ä¸“æ³¨äºé¿å…01x-ç¨‹åºå‘˜è€Œä¸æ˜¯å¯»æ‰¾-10x-ç¨‹åºå‘˜"><a class="header" href="#10-æˆ‘ä»¬åº”è¯¥æ›´ä¸“æ³¨äºé¿å…01x-ç¨‹åºå‘˜è€Œä¸æ˜¯å¯»æ‰¾-10x-ç¨‹åºå‘˜">10. æˆ‘ä»¬åº”è¯¥æ›´ä¸“æ³¨äºé¿å…0.1x ç¨‹åºå‘˜,è€Œä¸æ˜¯å¯»æ‰¾ 10x ç¨‹åºå‘˜</a></h3>
<p>10å€é€Ÿç¨‹åºå‘˜æ˜¯ä¸€ä¸ªæ„šè ¢çš„ç¥è¯;
æŸäººå¯ä»¥åœ¨1å¤©é‡Œç”Ÿäº§å‡ºå¦å¤–ä¸€ä½æœ‰èƒ½åŠ›/å‹¤å¥‹/æœ‰ç±»ä¼¼ç»éªŒçš„ç¨‹åºå‘˜éœ€è¦åœ¨2å‘¨ä»¥å†…ç”Ÿäº§ä»£ç çš„æƒ³æ³•æ˜¯æ„šè ¢çš„;
æˆ‘è§è¿‡ç¨‹åºå‘˜ç¼–å†™10å€çš„ä»£ç ,
ç„¶å, ä½ å¿…é¡»ä¿®å¤å®ƒ10å€ä»¥ä¸Šçš„æ¬¡æ•°;
æŸççˆ±å¯ä»¥æˆä¸º10å€ç¨‹åºå‘˜çš„å”¯ä¸€æ–¹æ³•,
æ˜¯å°†ä»–ä»¬å’Œ 0.1 å€é€Ÿç¨‹åºå‘˜è¿›è¡Œæ¯”è¾ƒ;
æœ‰äººæµªè´¹æ—¶é—´, ä¸å¯»æ±‚åé¦ˆ, ä¸æµ‹è¯•ä»£ç ,
ä¸è€ƒè™‘è¾¹ç¼˜æƒ…å†µç­‰ç­‰...</p>
<p>æˆ‘ä»¬åº”è¯¥å…³å¿ƒè®© 0.1 å€é€Ÿç¨‹åºå‘˜è¿œç¦»æˆ‘ä»¬çš„å›¢é˜Ÿ,
è€Œä¸æ˜¯å¯»æ‰¾ç¥è¯èˆ¬çš„ 10 å€é€Ÿç¨‹åºå‘˜;</p>
<h3 id="11-é«˜çº§å·¥ç¨‹å¸ˆå’Œä¸‹çº§å·¥ç¨‹å¸ˆé—´æœ€å¤§çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ä»–ä»¬å·²ç»å½¢æˆäº†å¯¹äº‹æƒ…åº”è¯¥å¦‚ä½•å‘å±•çš„åè§"><a class="header" href="#11-é«˜çº§å·¥ç¨‹å¸ˆå’Œä¸‹çº§å·¥ç¨‹å¸ˆé—´æœ€å¤§çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ä»–ä»¬å·²ç»å½¢æˆäº†å¯¹äº‹æƒ…åº”è¯¥å¦‚ä½•å‘å±•çš„åè§">11. é«˜çº§å·¥ç¨‹å¸ˆå’Œä¸‹çº§å·¥ç¨‹å¸ˆé—´æœ€å¤§çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ä»–ä»¬å·²ç»å½¢æˆäº†å¯¹äº‹æƒ…åº”è¯¥å¦‚ä½•å‘å±•çš„åè§</a></h3>
<p>æ²¡æœ‰ä»€ä¹ˆæ¯”å¯¹ä»–ä»¬çš„å·¥å…·æˆ–æ˜¯å¦‚ä½•æ„å»ºè½¯ä»¶æ²¡æœ‰æœ‰æ„è§çš„é«˜çº§å·¥ç¨‹å¸ˆæ›´è®©æˆ‘æ‹…å¿ƒçš„äº‹å„¿äº†;</p>
<p>æˆ‘å®æ„¿æœ‰äººç»™æœ‰å¼ºçƒˆçš„åå¯¹æ„è§, ä¹Ÿä¸æ„¿ä»–ä»¬å®Œå…¨æ²¡æœ‰æ„è§;
å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä½ çš„å·¥å…·,è€Œä¸”ä½ è¿˜æ²¡æœ‰æ›´å¤šå–œæ¬¢æˆ–æ˜¯è®¨åŒçš„æƒ…ç»ª,
é‚£ä¹ˆ, ä½ éœ€è¦æ›´å¤šä½“éªŒ;
ä½ éœ€è¦æ¢ç´¢å…¶å®ƒè¯­è¨€/åº“/èŒƒä¾‹;
æ²¡æœ‰ä»€ä¹ˆæ¯”ç§¯æå¯»æ‰¾å…¶å®ƒäººå¦‚ä½•ä½¿ç”¨å’Œä½ ä¸åŒçš„å·¥å…·å’ŒæŠ€æœ¯æ¥å®Œæˆä»»åŠ¡æ›´å¿«æé«˜æŠ€èƒ½çš„æ–¹æ³•äº†;</p>
<h3 id="12-äººä»¬å¹¶ä¸æ˜¯çœŸæƒ³åˆ›æ–°"><a class="header" href="#12-äººä»¬å¹¶ä¸æ˜¯çœŸæƒ³åˆ›æ–°">12. äººä»¬å¹¶ä¸æ˜¯çœŸæƒ³åˆ›æ–°</a></h3>
<p>äººä»¬ç»å¸¸è°ˆè®ºåˆ›æ–°,
ä½†æ˜¯, ä»–ä»¬é€šå¸¸å¯»æ‰¾çš„æ˜¯å»‰ä»·çš„èƒœåˆ©å’Œæ–°å¥‡;
å¦‚æœä½ åœ¨çœŸæ­£çš„åˆ›æ–°, å¹¶æƒ³æ”¹å˜äººä»¬ä½œäº‹çš„æ–¹å¼,
é‚£ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¼šæ”¶åˆ°è´Ÿé¢åé¦ˆ;
å¦‚æœä½ ç›¸ä¿¡è‡ªå·±åœ¨ä½œçš„äº‹å„¿,
å¹¶çŸ¥é“ç¡®å®ä¼šæ”¹å–„äº‹æƒ…,
é‚£ä¹ˆä¸ºè‡ªå·±çš„é•¿æœŸæˆ˜æ–—ä½œå¥½å‡†å¤‡;</p>
<h3 id="13-æ•°æ®æ˜¯ä½ ç³»ç»Ÿä¸­æœ€é‡è¦çš„éƒ¨åˆ†"><a class="header" href="#13-æ•°æ®æ˜¯ä½ ç³»ç»Ÿä¸­æœ€é‡è¦çš„éƒ¨åˆ†">13. æ•°æ®æ˜¯ä½ ç³»ç»Ÿä¸­æœ€é‡è¦çš„éƒ¨åˆ†</a></h3>
<p>æˆ‘è§è¿‡å¾ˆå¤šç³»ç»Ÿ, å…¶ä¸­å¸Œæœ›æ•°æ®å®Œå¤‡æ€§æ˜¯ç³»ç»Ÿä¸»è¦æœºåˆ¶;
åœ¨è¿™ç§ç³»ç»Ÿä¸­,
ä»»ä½•åœ¨é»„é‡‘è·¯å¾„ä¹‹å¤–å‘ç”Ÿçš„äº‹æƒ…,éƒ½ä¼šå¿ƒäº§ç”Ÿéƒ¨åˆ†è„æ•°æ®;
å°†æ¥å¤„ç†è¿™äº›æ•°æ®å°†æ˜¯ä¸€åœºå™©æ¢¦;
è¯·è®°ä½, ä½ çš„æ•°æ®å¯èƒ½ä¼šæ¯”ä½ çš„ä»£ç è¦é•¿å¯¿;
èŠ±ç²¾åŠ›ä¿æŒæ•°æ®ç§©åºå’Œæ¸…æ´,ä»é•¿è¿œçœ‹ä¼šæœ‰å¥½çš„å›æŠ¥;</p>
<h3 id="14-å¯»æ‰¾æŠ€æœ¯é²¨é±¼"><a class="header" href="#14-å¯»æ‰¾æŠ€æœ¯é²¨é±¼">14. å¯»æ‰¾æŠ€æœ¯é²¨é±¼</a></h3>
<p>ä»ç„¶å­˜åœ¨çš„æ—§æŠ€æœ¯æ˜¯é²¨é±¼è€Œä¸æ˜¯æé¾™;
ä»–ä»¬è§£å†³é—®é¢˜èƒ½åŠ›å¦‚æ­¤ä¹‹å¼º,ä»¥è‡³åœ¨æŠ€æœ¯ä¸–ç•Œä¸æ–­å‘ç”Ÿçš„å¿«é€Ÿå˜åŒ–ä¸­å¹¸å­˜ä¸‹æ¥;
ä¸è¦å’Œè¿™äº›æŠ€æœ¯æ‰“èµŒ,
åªæœ‰åœ¨æœ‰å……åˆ†ç†ç”±çš„æƒ…å†µä¸‹æ‰è´Ÿæ‹…å®ƒä»¬;
è¿™äº›å·¥å…·ä¸ä¼šåè€Œä¸å®,
ä¹Ÿä¸ä¼šä»¤äººå…´å¥‹,
å¾—æ˜¯ä¸æ˜¯, å®ƒä»¬èƒ½åœ¨æ²¡æœ‰å¾ˆå¤šä¸çœ ä¹‹å¤œçš„æƒ…å†µä¸‹å®Œæˆå·¥ä½œ;</p>
<h3 id="15-è¿˜è¦æŠŠè°¦é€Šè¯¯è®¤ä¸ºæ— çŸ¥"><a class="header" href="#15-è¿˜è¦æŠŠè°¦é€Šè¯¯è®¤ä¸ºæ— çŸ¥">15. è¿˜è¦æŠŠè°¦é€Šè¯¯è®¤ä¸ºæ— çŸ¥</a></h3>
<p>æœ‰å¾ˆå¤šè½¯ä»¶å·¥ç¨‹å¸ˆé™¤éè¢«ç›´æ¥é—®åˆ°,
å¦åˆ™ä¸ä¼šå‘è¡¨æ„è§;
æ°¸è¿œä¸è¦è®¤ä¸ºä»…ä»…å› ä¸ºæœ‰äººæ²¡æœ‰å°†æ„è§æ‰”åˆ°ä½ é¢å‰,
ä»–ä»¬å°±æ²¡æœ‰ä»€ä¹ˆå¯ä»¥è¡¥å……çš„;
æœ‰æ—¶, æœ€åµé—¹çš„äººæ˜¯æˆ‘ä»¬æœ€ä¸æƒ³å¬çš„;
å’Œå‘¨å›´äººäº¤è°ˆ, å¯»æ±‚ä»–ä»¬çš„åé¦ˆå’Œå»ºè®®;
ä½ ä¼šåº†å¹¸ä½ è¿™ä¹ˆä½œäº†;</p>
<h3 id="16-è½¯ä»¶å·¥ç¨‹å¸ˆåº”è¯¥å®šæœŸå†™ä½œ"><a class="header" href="#16-è½¯ä»¶å·¥ç¨‹å¸ˆåº”è¯¥å®šæœŸå†™ä½œ">16. è½¯ä»¶å·¥ç¨‹å¸ˆåº”è¯¥å®šæœŸå†™ä½œ</a></h3>
<p>è½¯ä»¶å·¥ç¨‹å¸ˆåº”è¯¥å®šæœŸå†™ blog/æ—¥è®°/æ–‡æ¡£,
é€šå¸¸ä½œéœ€è¦ä»–ä»¬ä¿æŒä¹¦é¢æ²Ÿé€šæŠ€å·§çš„äº‹å„¿;
å†™ä½œå¯ä»¥å¸®åŠ©ä½ æ€è€ƒé—®é¢˜,
å¹¶å¸®åŠ©ä½ èƒ½æ›´æœ‰æ•ˆçš„å’Œå›¢é˜Ÿä»¥åŠæœªæ¥çš„è‡ªå·±æ²Ÿé€š;
è‰¯å¥½çš„ä¹¦é¢æ²Ÿé€šæ˜¯ä»»ä½•è½¯ä»¶å·¥ç¨‹å¸ˆéƒ½å¿…é¡»æŒæ¡çš„æœ€é‡è¦æŠ€èƒ½ä¹‹ä¸€;</p>
<h3 id="17-å°½å¯èƒ½ä¿æŒæµç¨‹ç®€æ´"><a class="header" href="#17-å°½å¯èƒ½ä¿æŒæµç¨‹ç®€æ´">17. å°½å¯èƒ½ä¿æŒæµç¨‹ç®€æ´</a></h3>
<p>ç°åœ¨æ¯ä¸ªäººæƒ³æƒ³å˜å¾—æ•æ·,
ä½†æ˜¯,&quot;æ•æ·&quot;å°±æ˜¯ä»¥å°å—çš„æ–¹æ³•æ„å»ºäº‹ç‰©/å­¦ä¹ /ç„¶åè¿­ä»£;
å¦‚æœæœ‰äººè¯•å›¾åœ¨å…¶ä¸­å¡å…¥æ›´å¤šä¸œè¥¿,
é‚£ä¹ˆ,ä»–ä»¬å¯èƒ½åªæ˜¯åœ¨å–ä¸œè¥¿;
è¿™å¹¶ä¸æ˜¯è¯´äººä»¬ä¸éœ€è¦é—®è´£æˆ–æ˜¯å¸®åŠ©ä»¥ä¾¿ç”¨è¿™ç§æ–¹å¼åä½œ,
ä½†æ˜¯, ä½ æœ‰å¤šå°‘æ¬¡å¬åˆ°ä½ æœ€å–œæ¬¢çš„ç§‘æŠ€å…¬å¸æˆ–æ˜¯å¤§å‹å¼€æºé¡¹ç›®æˆå‘˜æœ‰å¹å˜˜ä»–ä»¬çš„ Scrum æµç¨‹æœ‰å¤šNB?
ä¿æŒç²¾ç›Šè¿‡ç¨‹,
ç›´åˆ°ä½ çŸ¥é“ä½ éœ€è¦æ›´å¤š;
ç›¸ä¿¡ä½ çš„å›¢é˜Ÿ,ä»–ä»¬èƒ½äº¤ä»˜æˆæœ;</p>
<h3 id="18-è½¯ä»¶å·¥ç¨‹å¸ˆå’Œæ‰€æœ‰äººä¸€æ ·éœ€è¦æœ‰ä¸»äººç¿ç²¾ç¥"><a class="header" href="#18-è½¯ä»¶å·¥ç¨‹å¸ˆå’Œæ‰€æœ‰äººä¸€æ ·éœ€è¦æœ‰ä¸»äººç¿ç²¾ç¥">18. è½¯ä»¶å·¥ç¨‹å¸ˆå’Œæ‰€æœ‰äººä¸€æ ·,éœ€è¦æœ‰ä¸»äººç¿ç²¾ç¥</a></h3>
<p>å¦‚æœä½ å°†æŸäººä»ä»–ä»¬çš„å·¥ä½œæˆæœå°åˆ†ç¦»å‡ºæ¥,
ä»–ä»¬å°±ä¼šæ›´å½¡å…³å¿ƒä»–ä»¬çš„å·¥ä½œ;
æˆ‘è®¤ä¸ºè¿™å‡ ä¹æ˜¯å¿…ç„¶çš„;
è¿™æ˜¯è·¨èŒèƒ½å›¢é˜Ÿä½œçš„å¦‚æ­¤å‡ºè‰²,
ä»¥åŠ DevOps å˜å¾—å¦‚æ­¤æµè¡Œçš„ä¸»è¦åŸå› ;
è¿™ä¸ä»…ä»…æ˜¯å…³äºäº¤æ¥å’Œæ•ˆç‡ä½ä¸‹,
è€Œæ˜¯å…³äºä»å¤´åˆ°å°¾æ‹¥æœ‰æ•´ä¸ªè¿‡ç¨‹, å¹¶ä¸”æ˜¯ç›´æ¥çš„è´Ÿè´£äº¤ä»˜ä»·å€¼;
è®©ä¸€ç¾¤å……æ»¡æ¿€æƒ…çš„äººå®Œå…¨æ‹¥æœ‰è®¾è®¡/æ„å»ºå’Œäº¤ä»˜è½¯ä»¶(æˆ–ä»»ä½•ä¸œè¥¿)çš„æƒåˆ©,
æƒŠäººçš„äº‹æƒ…å°±ä¼šå‘ç”Ÿ;</p>
<p>(è¯‘æ³¨: å½“ç„¶, å¾—æ˜¯æœ‰æ„ä¹‰çš„äº‹åŠ¡, ä¸ºé¢†å¯¼ä¸€äº›å¹»æƒ³å»åŠªåŠ›å¾ˆéš¾æœ‰ä»€ä¹ˆä¸»äººç¿ç²¾ç¥èƒ½è§¦å‘)</p>
<h3 id="19-é¢è¯•å¯¹äºå‘Šè¯‰æŸäººå°†æˆä¸ºå›¢é˜Ÿæˆå‘˜æœ‰å¤šèµå‡ ä¹æ¯«æ— ä»·å€¼"><a class="header" href="#19-é¢è¯•å¯¹äºå‘Šè¯‰æŸäººå°†æˆä¸ºå›¢é˜Ÿæˆå‘˜æœ‰å¤šèµå‡ ä¹æ¯«æ— ä»·å€¼">19. é¢è¯•å¯¹äºå‘Šè¯‰æŸäººå°†æˆä¸ºå›¢é˜Ÿæˆå‘˜æœ‰å¤šèµ,å‡ ä¹æ¯«æ— ä»·å€¼</a></h3>
<p>é¢è¯•æœ€å¥½èŠ±åœ¨äº†è§£æŸäººæ˜¯è°,
ä»¥åŠä»–ä»¬å¯¹ç‰¹å®šä¸“ä¸šé¢†åŸŸçš„å…´è¶£ç¨‹åº¦ä¸Š;
è¯•å›¾æ¨æµ‹ä»–ä»¬å°†æˆä¸ºå¤šä¹ˆä¼˜ç§€çš„å›¢é˜Ÿæˆå‘˜æ˜¯å¾’åŠ³çš„;
ç›¸ä¿¡æˆ‘,
ä¸€ä¸ªäººæœ‰å¤šèªæ˜æˆ–æ˜¯å¤šåšå­¦ä¹Ÿä¸èƒ½å¾ˆå¥½çš„è¯æ˜ä»–ä»¬å°†æˆä¸ºä¸€åä¼˜ç§€çš„å›¢é˜Ÿæˆå‘˜;
æ²¡æœ‰äººä¼šåœ¨é¢è¯•ä¸­å‘Šè¯‰ä½ ä»–ä»¬ä¸å¯é /çˆ±è¾±éª‚/è‡ªè´Ÿæˆ–æ˜¯ä»ä¸å‡†æ—¶å‚åŠ ä¼šè®®;
äººä»¬å¯èƒ½ä¼šå£°ç§°ä»–ä»¬å¯¹è¿™äº›äº‹æƒ…æœ‰&quot;ä¿¡å·&quot;...
&quot;å¦‚æœä»–ä»¬åœ¨ç¬¬ä¸€é¢è¯•æ—¶è¯¢é—®è¯·å‡,é‚£ä¹ˆä»–ä»¬æ°¸è¿œä¸ä¼šå»è¯·å‡!&quot;
ä½†æ˜¯, è¿™äº›éƒ½æ˜¯åºŸè¯;
å¦‚æœä½ ä½¿ç”¨è¿™ç§ä¿¡å·, åªæ˜¯åœ¨çŒœæµ‹å¹¶æ‹’ç»ä¼˜ç§€çš„å€™é€‰äºº;</p>
<h3 id="20-å§‹ç»ˆåŠªåŠ›æ„å»ºä¸€ä¸ªæ›´å°çš„ç³»ç»Ÿ"><a class="header" href="#20-å§‹ç»ˆåŠªåŠ›æ„å»ºä¸€ä¸ªæ›´å°çš„ç³»ç»Ÿ">20. å§‹ç»ˆåŠªåŠ›æ„å»ºä¸€ä¸ªæ›´å°çš„ç³»ç»Ÿ</a></h3>
<p>æœ‰å¾ˆå¤šåŠ›é‡ä¿ƒä½¿ä½ é¢„å…ˆæ„å»ºæ›´å¤§çš„ç³»ç»Ÿ;
é¢„ç®—åˆ†é…, æ— æ³•æµ‹å®šåº”è¯¥ç²¾å‡å“ªäº›åŠŸèƒ½,
å¸Œæœ›æä¾›ç³»ç»Ÿçš„&quot;æœ€ä½³ç‰ˆæœ¬&quot;;
æ‰€æœ‰,è¿™äº›äº‹æƒ…éƒ½éå¸¸æœ‰åŠ›çš„æ¨åŠ¨æˆ‘ä»¬æ„å»ºæ›´å¤š;
ä½ åº”è¯¥é˜»æ­¢è¿™ä¸ª;
ä½ åœ¨æ„å»ºä¸€ä¸ªç³»ç»Ÿæ—¶å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿,
ä½ æœ€ç»ˆå°†è¿­ä»£åˆ°ä¸€ä¸ªæ¯”ä½ æœ€åˆè®¾è®¡çš„ç³»ç»Ÿæ›´å¥½çš„ç‰ˆæœ¬;
ä»¤äººæƒŠè®¶çš„å¿…é¡»,
è¿™å¯¹å¤ªå¤šæ•°äººæ¥è¯´æ˜¯éš¾ä»¥æ¥å—çš„;</p>
<h2 id="ä½ çš„æ•…äº‹å‘¢"><a class="header" href="#ä½ çš„æ•…äº‹å‘¢">ä½ çš„æ•…äº‹å‘¢?</a></h2>
<p>è¿™æ˜¯å…¨éƒ¨äº†, 20å¹´çš„è½¯ä»¶ç”Ÿæ¶¯æç‚¼å‡ºæ¥çš„çš„20æ¡ç²¾è¾Ÿæ–­è¨€;</p>
<p>å¦‚æœæœ‰ä»€ä¹ˆèƒ½å¼•å‘ä½ çš„å…±é¸£,
æˆ‘å¾ˆå¾ˆå¬å¬;
æˆ‘ä¹Ÿå¾ˆæƒ³çŸ¥é“ä½ åœ¨èŒä¸šç”Ÿæºä¸­ç§¯ç´¯çš„æ™ºæ…§å¹¶æ„¿æ„åˆ†äº«å‡ºæ¥;
è¯·åœ¨è¯„è®ºä¸­ç•™è¨€å§;</p>
<h2 id="refer-29"><a class="header" href="#refer-29">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p>å¾ˆæœ‰äººä¸åŒæ„æ‰€æœ‰è§‚ç‚¹: <a href="https://www.simplethread.com/20-things-ive-learned-in-my-20-years-as-a-software-engineer/#comment-142472">January 25, 2023 at 7:25 pm</a></p>
<h3 id="hard-disagree-with-most-of-the-20-items"><a class="header" href="#hard-disagree-with-most-of-the-20-items">Hard disagree with most of the 20 items.</a></h3>
<ol>
<li>
<p>Writing software is difficult, tedious and needs real work. No silver bullet libraries, no methodology, no framework, no IOT, no amount of unit tests will get the work done faster.</p>
</li>
<li>
<p>Developers collect tools, libraries and pet technologies and make projects go over their time and budget by doing it.</p>
</li>
<li>
<p>Code should encapsulate algorithms and not be structured other wise. Code should follow the business logic and be readable and match business requirements easily.</p>
</li>
<li>
<p>Forgetting history keeps the productivity and industry down. Microsoft re-discovering the same old technology which existed on 1960s mainframes for the 7th time just to sell products, trademark buzzwords, training, certification and everything is an anchor around the modern developerâ€™s neck. Think file transfer -&gt; X12 -&gt; serial communication -&gt; raw socket packets -&gt; corba -&gt; xml soap -&gt; xml http -&gt; Rest JSON http -&gt; gRpc as a 50 year journey of rediscovering the same thing repeatedly, each not really that much better than the older technologies, wrapping mounds of interlarded crud on top of fragile, hard to program libraries and the square peg in a round hole mismatch.</p>
</li>
<li>
<p>Refusing to hold W3C and large tech companies accountable for not fixing web HTTP, HTML, CSS and JavaScript for 25+ years.
â€“ How can I create a control which has HTML, CSS, JS which has encapsulated CSS, encapsulated HTML, encapsulated JS without a 10,000 file framework?
â€“ How to match HTML DOM elements with JS without using quoted magic strings? Quoted magic strings were proven anti-productivity and anti-quality in the 1960s
â€“ How to have a UI without the everything is a call back and function pointer? Function pointers with modern wrappings are just as bad as the 1060s computed jump to function tables</p>
</li>
<li>
<p>Forgetting that tech is a business with a 7 year hype cycle, with the new thing being embryonically hyped for 2 years by cutting edge bloggers, then 2 years by sales marketing of companies, then 3 years of disappointment for companies trying to implement it. Followed by, abandonment when the ROI does not work out. Resume driven development, just for business persons.
And yes, thereâ€™s a new hype every 2 years to waste time and money on</p>
</li>
<li>
<p>Not holding tech companies accountable when they release major products, .net core, which have less than a 5 year full support lifecycle. Long term support .net is under 3 years.
That is a forced upgrade every 3 years for every .net system just to pass the IT auditors at a large company</p>
</li>
<li>
<p>Devaluing your own worth and work as a developer by telling everyone that the proposed product/task is easy. Software dev is hard work, less than 1 of a 1000 people can even do it poorly.
I would not go to a brain surgeon that told everyone that what he does is easy.</p>
</li>
<li>
<p>Forgetting that software development is a hard, tedious, isolated job where people desiring lots of human interaction will rapidly leave the field by their own choice and lots of people not getting into the field by their own choice.</p>
</li>
<li>
<p>Not telling people that you as a developer have to say â€œNo, itâ€™s too expensiveâ€ or â€œNo, itâ€™s too riskyâ€ as a regular part of your job. Persons not developing software treating you poorly with career ending consequences just because you wonâ€™t accept the death march cross to bear of impossible requirements of an impossibly short deadline</p>
</li>
<li>
<p>Not helping your fellow developers out. Speak well of your co-developers, team, and industry. Donâ€™t downplay the difficulty, complexity or contribution of software.</p>
</li>
<li>
<p>Not calling people out when they think that more data, metrics for everything will automatically solve problems. Ask for a business case, ask for the questions they want to answer (in written form), get the business case and questions they want to answer from the requestor, make sure they are approved before committing to a tight deadline</p>
</li>
<li>
<p>Not damaging the next developer on your project â€“ too many technologies, framework of the month, just another nuget package, one more class, have another 3 patterns, data on disk, data in database structure and consistency is not important and, yes, this system will never receive/send upstream/downstream data</p>
</li>
<li>
<p>Accepting code without parameter checking, error handling or in-line comment documentation (<em>cough</em> vendorâ€™s happy path â€˜docâ€™ page or <em>cough</em> signature only documentation with no example code or error handling.)</p>
</li>
<li>
<p>Misguided acceptance that best practices are best and not just a short nicely sized blog entry. Best practices, in many cases, do not scale for large 1,000,000+ line of code systems and make maintenance harder.</p>
</li>
<li>
<p>Not challenging the â€˜more technology is betterâ€™ approach</p>
</li>
</ol>
<h2 id="logging-20"><a class="header" href="#logging-20">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230201 ZQ init.</li>
</ul>
<pre><code>            _~âˆ½&amp;`~_
        \) /  â—· â—´  \ \/
          '_   V   _'
          \ '--.--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ"><a class="header" href="#å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ">å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ</a></h1>
<p>åŸæ–‡: <a href="https://rauljordan.com/rust-concepts-i-wish-i-learned-earlier/">rauljordan::blog</a></p>
<h2 id="å¿«è¯‘"><a class="header" href="#å¿«è¯‘">å¿«è¯‘</a></h2>
<p>è¿‡å»ä¸€ä¸ªæœˆé‡Œ, æˆ‘è¢« Rust è¯­è¨€å½»åº•è¿·ä½äº†,
å› ä¸º,å¥¹åœ¨ç¼–å†™å†…å­˜å®‰å…¨çš„ç°ä»£ç¨‹åºæ–¹é¢å…·æœ‰ç‹¬ç‰¹çš„ä¼˜åŠ¿.
å¤šå¹´ä»¥æ¥, æœ‰å‡ ç§è¯­è¨€å·²ç»æˆä¸ºå·¥ç¨‹å¸ˆç¼–å†™å¼¹æ€§åç«¯è½¯ä»¶çš„é¦–é€‰è¯­è¨€.
æ½®æµå·²ç»ä» JAVA/C++ è½¬å‘ Go å’Œ Rust,
å¥¹ä»¬ç»“åˆäº†æ•°åå¹´ç¼–ç¨‹è¯­è¨€ç†è®ºæ¥æ„å»ºæˆ‘ä»¬è¿™ä¸ªæ—¶ä»£æœ€éœ€è¦çš„å·¥å…·.</p>
<p>Rust çš„åœ°ä½ä¸è¨€åˆ™æ˜.
ä½œä¸ºæœ€å—ä¸€æ¬¢è¿çš„è¯­è¨€, è¿ç»­7å¹´åº¦åœ¨è‘—å <code>stack overflow</code> è°ƒæŸ¥ä¸­æ’åç¬¬ä¸€!
æœ€è¿‘è¿˜ä½œä¸º Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†å‘å¸ƒ -- è¿™æ˜¯é™¤ C ä¹‹å¤–ä»»ä½•è¯­è¨€ä¹‹å‰éƒ½æ— æ³•ä½œåˆ°çš„å£®ä¸¾.
å¯¹æˆ‘è€Œè¨€, è¿™é—¨è¯­è¨€ä»¤äººå…´å¥‹çš„åœ°æ–¹åœ¨äº,
å¥¹åœ¨è½¯ä»¶æ„å»ºè‰ºæœ¯æ–¹é¢æä¾›äº†ä¸€äº›çœŸæ­£æ–°é¢–çš„ä¸œè¥¿.</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::thread;
use std::time::Duration;
use std::{collections::VecDeque, sync::Condvar, sync::Mutex};

fn main() {
    let queue = Mutex::new(VecDeque::new());

    thread::scope(|s| {
        let t = s.spawn(|| loop {
            let item = queue.lock().unwrap().pop_front();
            if let Some(item) = item {
                dbg!(item);
            } else {
                thread::park();
            }
        });

        for i in 0.. {
            queue.lock().unwrap().push_back(i);
            t.thread().unpark();
            thread::sleep(Duration::from_secs(1));
        }
    })
}</code></pre></pre>
<p>Rust åœ¨æ•´ä¸ªç³»ç»Ÿç¼–ç¨‹ä¸­è·å¾—äº†ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ä½¿ç”¨, 
ä¹Ÿå› éš¾ä»¥å­¦ä¹ è€Œé—»å. å°½ç®¡å¦‚æ­¤, è¿˜æ˜¯æœ‰å¾ˆå¤šä¼˜ç§€çš„ Rust å†…å®¹å¯ä»¥æ»¡è¶³åˆå­¦è€…å’Œé«˜çº§ç¨‹åºå‘˜çš„éœ€æ±‚.
ç„¶è€Œ, ä»–ä»¬ä¸­å¤ªå¤šäººä¸“æ³¨è§£é‡Šè¯­è¨€çš„æ ¸å¿ƒæœºåˆ¶å’Œæ‰€æœ‰æƒæ¦‚å¿µ, è€Œä¸æ˜¯æ„å»ºåº”ç”¨ç¨‹åº.</p>
<p>ä½œä¸ºä¸€åç¼–å†™é«˜å¹¶å‘ç¨‹åºå¹¶ä¸“æ³¨åœ¨ç³»ç»Ÿç¼–ç¨‹çš„ Go å¼€å‘è€…, 
æˆ‘åœ¨å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Rust æ„å»ºçœŸå®ç¨‹åºçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šéšœç¢. 
ä¹Ÿå°±æ˜¯äº¤ç»‡, å¦‚æœæˆ‘å°†å½“å‰æ­£åœ¨ä»äº‹çš„å·¥ä½œç§»æ¤åˆ° Rust ä¸­, é‚£ä¹ˆæ‰€æœ‰è¿™äº›æ•™ç¨‹çš„æ•ˆæœå¦‚ä½•å‘¢?</p>
<p>æ­¤ç¯‡æ–‡ç« æ—¨åœ¨ä»‹ç»æˆ‘è¿›å…¥ Rust å…”å­æ´çš„ç»å†, 
ä»¥åŠæˆ‘å¸Œæœ›ä¸€äº›å­¦ä¹ èµ„æºå¯ä»¥æ›´å¥½é˜è¿°çš„å†…å®¹. 
å¯¹ä¸ªäººè€Œè¨€, æˆ‘æ— æ³•é€šè¿‡ç®€å•çš„è§‚çœ‹ youtube è§†é¢‘æ¥å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€, 
è€Œæ˜¯å¿…é¡»é€šè¿‡ä¸ºè‡ªå·±å¯»æ‰¾è§£å†³æ–¹æ¡ˆ,çŠ¯é”™ä»¥åŠå¯¹è¿‡ç¨‹æ„Ÿå—è°¦å‘æ¥ç§¯ç´¯ï¼</p>
<h3 id="å…³äºå‚è€ƒ"><a class="header" href="#å…³äºå‚è€ƒ">å…³äºå‚è€ƒ</a></h3>
<p>Rust ä¸­æœ‰ä¸¤ç§å¼•ç”¨, å…±äº«å¼•ç”¨(ä¹Ÿç§°ä¸º <code>å€Ÿç”¨</code>)å’Œå¯å˜å¼•ç”¨(ä¹Ÿç§°ä¸º<code>ç‹¬å å¼•ç”¨</code>).
é€šå¸¸è¿™äº›è¢«è§†ä¸ºå˜é‡ x ä¸Šçš„ &amp;x ä»¥åŠ &amp;mut x . 
ä¸€æ—¦æˆ‘å¼€å§‹å°†åè€…ç§°ä¸º&quot;ç‹¬å®¶å‚è€ƒ&quot;, è¿™ä¸¤ç™½é—´çš„åŒºåˆ«å°±æ›´æœ‰æ„ä¹‰äº†.</p>
<p>Rust çš„å‚è€ƒæ¨¡å‹ç›¸å½“ç®€å•. å€Ÿæ¬¾äººå¯ä»¥æ ¹æ®éœ€è¦æ‹¥æœ‰å¯¹æŸå¯¹è±¡çš„å°½å¯èƒ½å¤šçš„å…±äº«å¼•ç”¨, 
ä½†æ˜¯, ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªç‹¬å å¼•ç”¨. 
å¦åˆ™, ä½ å¯èƒ½ä¼šæœ‰å¾ˆå¤šè°ƒç”¨è€…åŒæ—¶å°è¯•å¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œä¿®æ”¹çš„å›§å¢ƒ;
å¦‚æœå¾ˆå¤šå€Ÿç”¨è€…ä¹Ÿå¯ä»¥æŒæœ‰ç‹¬å è¢­ç”¨, 
ä½ å°†é¢ä¸´æœªå®šä¹‰è¡Œä¸ºé£é™©, 
è€Œå®‰å…¨çš„ Rust åˆ™ä¸å…è®¸è¿™ä¹ˆæŠ˜è…¾.</p>
<p>åœ¨å­¦ä¹  Rust æ—¶, éƒ½ç”¨ &amp;mut ç‹¬å®¶å‚è€ƒå¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Foo {
    x: u64,
}

impl Foo {
    /// Any type that borrows an instance of Foo can
    /// call this method, as it only requires a reference to Foo.
    pub fn total(&amp;self) -&gt; u64 {
        self.x
    }
    /// Only exclusive references to instances of Foo
    /// can call this method, as it requires Foo to be mutable.
    pub fn increase(&amp;mut self) {
        self.x += 1;
    }
}

let foo = Foo { x: 10 };
println!(&quot;{}&quot;, foo.total()) // WORKS.
foo.increase() // ERROR: Foo not declared as mut
<span class="boring">}</span></code></pre></pre>
<h3 id="åŒå‘å¼•ç”¨æ˜¯å¯ä»¥çš„"><a class="header" href="#åŒå‘å¼•ç”¨æ˜¯å¯ä»¥çš„">åŒå‘å¼•ç”¨æ˜¯å¯ä»¥çš„</a></h3>
<blockquote>
<p>Bidirectional references are possible</p>
</blockquote>
<p>åœ¨å…¶å®ƒå…·æœ‰åƒåœ¾æ”¶é›†åŠŸèƒ½çš„è¯­è¨€ä¸­, å¾ˆå®¹æ˜“å®šä¹‰å›¾å½¢æ•°æ®ç»“æ„æˆ–å…¶å®ƒåŒ…å«å¯¹æŸäº›å­é¡¹å¼•ç”¨çš„ç±»å‹, 
å¹¶ä¸”è¿™äº›å¼•ç”¨å¯ä»¥åŒ…å«å¯¹å…¶çˆ¶é¡¹çš„å¼•ç”¨;
åœ¨ Rust ä¸­, å¦‚æœä¸å®Œå…¨ç†è§£å€Ÿç”¨è§„åˆ™, è¿™æ˜¯å¾ˆéš¾ä½œåˆ°çš„;
ä½†æ˜¯, ä»ç„¶å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„æ­£æ³•.</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º Node çš„ç»“æ„, 
åŒ…å«ä¸€ç»„å¯¹å­èŠ‚ç‚¹çš„å¼•ç”¨, ä»¥åŠä¸€ä¸ªå¯¹çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨; 
é€šå¸¸, Rust ä¼šæŠ±æ€¨, ä½†æ˜¯, æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†çˆ¶å¼•ç”¨åŒ…è£…åœ¨ç§°ä¸º <code>å¼±æŒ‡é’ˆ</code> çš„ä¸œè¥¿ä¸­æ¥æ»¡è¶³å€Ÿç”¨æ£€æŸ¥å™¨çš„è¦æ±‚;
è¿™ç§ç±»å‹å‘Šè¯‰ Rust ä¸€ä¸ªèŠ‚ç‚¹æ¶ˆå¤±, æˆ–è€…å…¶å­èŠ‚ç‚¹æ¶ˆå¤±, ä¸åº”è¯¥æ„å‘³ç€çˆ¶èŠ‚ç‚¹ä¹Ÿåº”è¯¥è¢«åˆ é™¤;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::cell::RefCell;
use std::rc::{Rc, Weak};

struct Node {
    value: i32,
    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,
    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ºæˆ‘ä»¬æä¾›äº†æ„å»ºåŒå‘å¼•ç”¨çš„ä¾¿åˆ©åŸè¯­; 
ç„¶è€Œ, æˆ‘å¾ˆå¿«å‘ç°åœ¨ Rust ä¸­æ„å»ºå›¾å½¢æ•°æ®çœŸçš„å¾ˆéš¾, 
é™¤éä½ çœŸçš„çŸ¥é“è‡ªå·±åœ¨ä½œä»€ä¹ˆ, è€ƒè™‘åˆ°ä¸€ä¸ªäººéœ€è¦å›´ç»•æœ‰æ•ˆå»ºæ¨¡æ•°æ®æ¥ä½œå¤§é‡çš„ <code>book-keeping</code> å·¥ä½œä»¥æ»¡è¶³ç¼–è¯‘å™¨.</p>
<p>(æ˜¯ä¹Ÿä¹: ç¼–è¯‘å™¨ä½œä¸º Rust ç”Ÿæ€ä¸­æœ€å¤§çš„ BOSS å¿…é¡»ä¼˜å…ˆæ»¡è¶³.)</p>
<h3 id="å®æ–½-deref-ä»¤ä»£ç æ›´æ¸…æ™°"><a class="header" href="#å®æ–½-deref-ä»¤ä»£ç æ›´æ¸…æ™°">å®æ–½ Deref ä»¤ä»£ç æ›´æ¸…æ™°</a></h3>
<blockquote>
<p>Implement Deref to make your code cleaner</p>
</blockquote>
<p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å°†åŒ…è£…å™¨ç±»å‹è§†ä¹‹ä¸ºå…¶åŒ…å«çš„å†…å®¹;
å¯¹äºå¸¸è§çš„æ•°æ®ç»“æ„(æ¯”å¦‚ vec),æ™ºèƒ½æŒ‡é’ˆ(ä¾‹å¦‚ Box) ç”šè‡³å¼•ç”¨è®¡æ•°ç±»å‹(ç±»ä¼¼ Rc å’Œ Arc) éƒ½æ˜¯å¦‚æ­¤;
æ ‡å‡†åº“åŒ…å«ç§°ä¸º Deref å’Œ DerefMut çš„ç‰¹å¾, 
å¥¹ä»¬å°†æŠ¥æ—¶ä½ å‘Šè¯‰ Rust åº”è¯¥å¦‚ä½•å–æ¶ˆå¼•ç”¨ä¸€ä¸ªç±»å‹;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ops::{Deref, DerefMut};

struct Example&lt;T&gt; {
    value: T
}

impl&lt;T&gt; Deref for Example&lt;T&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;Self::Target {
        &amp;self.value
    }
}

impl&lt;T&gt; DerefMut for Example&lt;T&gt; {
    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {
        &amp;mut self.value
    }
}

let mut x = Example { value: 'a' };
*x = 'b';
assert_eq!('b', x.value);
<span class="boring">}</span></code></pre></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­, æˆ‘ä»¬å¯ä»¥å°† <code>*x</code> è§†ä¸ºå…¶åŸºç¡€å€¼ <code>&quot;a&quot;</code>, 
ç”šè‡³å¯ä»¥æ”¹å˜å®ƒ, å› ä¸º, æˆ‘ä»¬å®šä¹‰äº†åº”è¯¥å¦‚ä½•åœ¨å€Ÿç”¨æˆ–å¯å˜å¼•ç”¨ä¸­å–æ¶ˆå¼•ç”¨çš„è§„åˆ™;
è¿™å¾ˆå¼ºå¤§, ä¹Ÿæ˜¯ä½ æ— éœ€æ‹…å¿ƒåœ¨ Box ç­‰æ™ºèƒ½æŒ‡é’ˆä¸­åŒ…è£…ç±»å‹çš„åŸå› ;</p>
<p>å€¼è¢«è£…ç®±çš„äº‹å®æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚, å¯ä»¥é€šè¿‡è¿™äº›ç‰¹å¾æŠ½è±¡å‡ºæ¥;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
    value: u64,
}
let mut foo = Box::new(Foo { value: 10 });

// Box implements DerefMut, so this will work fine!
*foo = Foo { value: 20 };
// Dot methods will work on foo because Box implements Deref.
// We do not have to worry about the implementation
// detail that Foo is boxed.
assert_eq!(20, foo.value);
<span class="boring">}</span></code></pre></pre>
<h3 id="å°å¿ƒå®ç°-deref-ç±»å‹æ–¹æ³•"><a class="header" href="#å°å¿ƒå®ç°-deref-ç±»å‹æ–¹æ³•">å°å¿ƒå®ç° Deref ç±»å‹æ–¹æ³•</a></h3>
<blockquote>
<p>Be careful with methods on types that implement Deref</p>
</blockquote>
<p>æœ‰æ²¡æœ‰æƒ³è¿‡, ä¸ºä»€ä¹ˆåƒ <code>Arc::clone</code> è¿™ç±»æ–¹æ³•çš„å­˜åœ¨, 
è€Œæˆ‘ä»¬åªèƒ½å¯¹ Arc å€¼æ‰§è¡Œ <code>.clone()</code>?
åŸå› å’Œç±»å‹å¦‚ä½•å®ç° Deref æœ‰å…³, 
è¿™æ˜¯å¼€å‘è€…åº”è¯¥è­¦æƒ•çš„äº‹å„¿;</p>
<p>è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹, æˆ‘ä»¬æ­£åœ¨å°è¯•ä»æ ‡å‡†åº“ä¸­å®ç°æˆ‘ä»¬è‡ªå·±ç‰ˆæœ¬çš„
å¤šç”Ÿäº§è€…/å•ä¸€æ¶ˆè´¹è€…(mpsc)é€šé“:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::sync::{Arc, Mutex, Condvar};

pub struct Sender&lt;T&gt; {
    inner: Arc&lt;Inner&lt;T&gt;&gt;,
}

impl&lt;T&gt; Sender&lt;T&gt; {
    pub fn send(&amp;mut self, t: T) {
        ...
    }
}

impl&lt;T: Clone&gt; Clone for Sender&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        Self {
            // ERROR: Does not know whether to clone Arc or inner!
            inner: self.inner.clone(),
        }
    }
}

struct Inner&lt;T&gt; {
    ...
}

impl&lt;T: Clone&gt; Clone for Inner&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        ...
    }
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­, æˆ‘ä»¬æœ‰ä¸€ä¸ªè¦åœ¨å…¶ä¸Šå®ç° Clone ç‰¹å¾çš„ Sender ç±»å‹;
è¯¥ç»“æ„æœ‰ä¸€ä¸ªåä¸º inner çš„å­—æ®µ, å…¶ç±»å‹ä¸º <code>Arc&lt;Inner&lt;T&gt;&gt;</code> ;
å›æƒ³ä¸€ä¸‹ Arc å·²ç»å®ç°äº† Clone å’Œ Deref ;
æœ€é‡è¦çš„æ˜¯, æˆ‘ä»¬çš„ Inner è¿˜ç°å®äº† Clone ;
å¯¹äºä¸Šé¢çš„ä»£ç , Rust å¹¶ä¸çŸ¥é“æˆ‘ä»¬æ˜¯è¦å…‹éš† Arc è¿˜æ˜¯å®é™…çš„å†…éƒ¨å€¼,
æ‰€ä»¥, ä¸Šé¢ä»£ç ä¼šå¤±è´¥;
åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Arc ä» sync åŒ…ä¸­æä¾›çš„å®é™…æ–¹æ³•;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Clone&gt; Clone for Sender&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        Self {
            // Now Rust knows to use the Clone method of Arc instead of the
            // clone method of inner itself.
            inner: Arc::clone(&amp;self.inner),
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="ç†è§£ä½•æ—¶ä»¥åŠä½•æ—¶ä¸ç”¨å†…éƒ¨å¯å˜æ€§"><a class="header" href="#ç†è§£ä½•æ—¶ä»¥åŠä½•æ—¶ä¸ç”¨å†…éƒ¨å¯å˜æ€§">ç†è§£ä½•æ—¶ä»¥åŠä½•æ—¶ä¸ç”¨å†…éƒ¨å¯å˜æ€§</a></h3>
<blockquote>
<p>Understand when and when not to use interior mutability</p>
</blockquote>
<p>æœ‰æ—¶, ä½ éœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨ Rc æˆ–æ˜¯ Arc ç­‰ç»“æ„, 
åˆæˆ–è€…å®ç°åŒ…è£…ä¸€äº›æ•°æ®ç»“æ„, ç„¶å, åˆæƒ³è¦æ”¹å˜è¢«åŒ…è£…çš„æ•°æ®;
å¾ˆå¿«, ç¼–è¯‘å™¨å°±ä¼šå‘Šè¯‰ä½ , å†…éƒ¨å¯å˜æ€§æ˜¯ä¸å…è®¸çš„, ä¹çœ‹èµ·æ¥è¿™å¾ˆæ£˜æ‰‹;
ç„¶è€Œ, æœ‰ä¸€äº›æ–¹æ³•å…è®¸ Rust ä¸­çš„å†…éƒ¨å¯å˜æ€§, 
ç”šè‡³æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„;</p>
<p>æœ€ç®€å•çš„ä¸€ç§æ˜¯ Cell, å¥¹ä¸ºä½ æä¾›æ•°æ®çš„å†…å¯å˜æ€§;
ä¹Ÿå°±æ˜¯è¯´, å˜¦æ•°æ®å¤åˆ¶æˆæœ¬ä½, 
ä½ å°±å¯ä»¥åœ¨ Rc ä¸­æ”¹å˜æ•°æ®;
ä½ å¯ä»¥é€šè¿‡å°†æ•°æ®åŒ…è£…åœ¨ <code>Rc&lt;Cell&lt;T&gt;&gt;</code> ä¸­æ¥å®ç°è¿™ä¸€ç‚¹;
å¥¹æä¾›äº† get å’Œ set æ–¹æ³•,
ç”šè‡³ä¸éœ€è¦è¢« mut , å› ä¸º, å¥¹ä»¬æ˜¯åœ¨åº•å±‚å¤åˆ¶æ•°æ®çš„:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// impl&lt;T: Copy&gt; Cell&lt;T&gt;
pub fn get(&amp;self) -&gt; T

// impl&lt;T&gt; Cell&lt;T&gt;
pub fn set(&amp;self, val: T)
<span class="boring">}</span></code></pre></pre>
<p>å…¶å®ƒç±»å‹, æ¯”å¦‚ RefCell æœ‰åŠ©äºå°†æŸäº›å€Ÿç”¨æ£€æŸ¥ç§»è‡³è¿è¡Œæ—¶, å¹¶è·³è¿‡ä¸€äº›ç¼–è¯‘å™¨çš„ä¸¥æ ¼è¿‡æ»¤;
ç„¶è€Œ, è¿™æ˜¯æœ‰é£é™©çš„, å› ä¸º, å¦‚æœæ²¡æœ‰å®Œæˆå€Ÿç”¨æ£€æŸ¥, å°±å¯èƒ½åœ¨è¿è¡Œæ—¶è§¦å‘ panic ;
å°†ç¼–è¯‘å™¨å½“æˆæœ‹å‹, ä½ ä¼šè·å¾—å›æŠ¥;
é€šè¿‡è·³è¿‡ç¼–è¯‘å™¨æ£€æŸ¥, æˆ–æ˜¯å°†å¥¹ä»¬æ¨è¿Ÿåˆ°è¿è¡Œæ—¶, 
ç­‰äºå‘Šè¯‰ç¼–è¯‘å™¨&quot;ç›¸ä¿¡æˆ‘ --- æˆ‘ä½œçš„éƒ½æ˜¯æ­£ç¡®çš„&quot;;</p>
<p>è€Œ std::cell åŒ…ç”šè‡³é€šè¿‡ä¸€ä¸ªå¾ˆæœ‰å¸®åŠ©çš„æ¶ˆæ¯è­¦å‘Šæˆ‘ä»¬:</p>
<pre><code>
æ›´å¸¸è§çš„ç»§æ‰¿å¯å˜æ€§, å…¶ä¸­å¿…é¡»å…·æœ‰å”¯ä¸€è®¿é—®æƒé™æ‰èƒ½æ”¹å˜å€¼,
è¿™ä¸€è¯­è¨€å…ƒç´ æ˜¯ä»¤ Rust èƒ½å¼ºåŠ›æ¨ç†æŒ‡é’ˆåˆ«å, é™æ€é˜²æ­¢å´©æºƒé”™è¯¯çš„å…³é”®;
å› æ­¤, ç»§ç»­å¯å˜æ€§æ˜¯é¦–é€‰, å†…éƒ¨å¯å˜æ€§æ˜¯æœ€åçš„æ‰‹æ®µ;
ç”±äº Cell ç±»å‹å¯ä»¥åœ¨ä¸å…è®¸çªå˜çš„åœ°æ–¹å¯ç”¨çªå˜, 
å› æ­¤, åœ¨æŸäº›æƒ…å†µä¸­, å†…éƒ¨å¯å˜æ€§ä¹Ÿè®¸æ˜¯åˆé€‚çš„, ç”šè‡³å¿…é¡»ä½¿ç”¨, ä¾‹å¦‚:

- åœ¨ä¸å¯å˜äº‹ç‰©çš„&quot;å†…éƒ¨&quot;å¼•å…¥å¯å˜æ€§
- é€»è¾‘ä¸å¯å˜æ–¹æ³•çš„å®ç°ç»†èŠ‚
- å…‹éš†çš„å˜å¼‚å®ç°

</code></pre>
<h3 id="get-å’Œ-get-mut-æ–¹æ³•æ˜¯ä¸€å›äº‹å„¿"><a class="header" href="#get-å’Œ-get-mut-æ–¹æ³•æ˜¯ä¸€å›äº‹å„¿">get å’Œ get mut æ–¹æ³•æ˜¯ä¸€å›äº‹å„¿</a></h3>
<blockquote>
<p>Get and get mut methods are a thing</p>
</blockquote>
<p>å¾ˆå¤šç±»å‹, åŒ…å« vec éƒ½å®ç°äº† get ä¸ get_mut æ–¹æ³•,
è®©ä½ å¯ä»¥å€Ÿç”¨å’Œæ”¹å˜ç»“æ„ä¸­çš„å…ƒç´ 
(å‰è€…åªæœ‰åœ¨ä½ æœ‰ä¸€ä¸ªå¯¹é›†ä¼šçš„å¯å˜å¼•ç”¨æ—¶æ‰å¯èƒ½);
æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´, æ‰çŸ¥é“è¿™äº›é€‰é¡¹å¯ç”¨äºè®¸å¤šæ•°æ®ç»“æ„,
å¥¹ä»¬é€šè¿‡æ›´è½»æ¾çš„ç¼–å†™å¹²å‡€çš„ä»£ç , å¸®åŠ©æˆ‘çš„ç”Ÿæ´»æ›´è½»æ¾!</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = &amp;mut [0, 1, 2];

if let Some(elem) = x.get_mut(1) {
    *elem = 42;
}
assert_eq!(x, &amp;[0, 42, 2]);
<span class="boring">}</span></code></pre></pre>
<h3 id="æ‹¥æŠ±ä¸å®‰å…¨ä½†åˆç†çš„ä»£ç "><a class="header" href="#æ‹¥æŠ±ä¸å®‰å…¨ä½†åˆç†çš„ä»£ç ">æ‹¥æŠ±ä¸å®‰å…¨ä½†åˆç†çš„ä»£ç </a></h3>
<blockquote>
<p>Embrace unsafe but sound code</p>
</blockquote>
<p>ä½œä¸ºä¸€å Go å¼€å‘è€…, &quot;unsafe&quot; åŒ…æ€»æ˜¯æ„Ÿè§‰å¾ˆä¸é è°±,
è€Œä¸”æˆ‘å¾ˆå°‘æ¥è§¦;
ç„¶è€Œ, Rust ä¸­ â€œunsafeâ€ çš„æ¦‚å¿µæ˜¯å®Œå…¨ä¸åŒçš„;
äº‹å®ä¸Š, å¾ˆå¤šæ ‡å‡†åº“éƒ½ä½¿ç”¨ <code>â€œunsafeâ€</code> æ¥å–å¾—å·¨å¤§æˆåŠŸ!</p>
<p>è¿™æ€ä¹ˆå¯èƒ½? å°½ç®¡ Rust ä½¿æœªå®šä¹‰çš„è¡Œä¸ºæˆä¸ºä¸å¯èƒ½,
ä½†æ˜¯, è¿™ä¸é€‚ç”¨äºæ ‡è®°ä¸º â€œunsafeâ€ çš„ä»£ç å—;
ç›¸å, ç¼–å†™ â€œunsafeâ€ Rust çš„å¼€å‘è€…å˜¦ä¿è¯å…¶ä½¿ç”¨åˆç†,
å³å¯è·å¾—æ‰€æœ‰å¥½å¤„;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Example taken from the Rustonomicon
fn item_at_index(idx: usize, arr: &amp;[u8]) -&gt; Option&lt;u8&gt; {
    if idx &lt; arr.len() {
        unsafe {
            Some(*arr.get_unchecked(idx))
        }
    } else {
        None
    }
}
<span class="boring">}</span></code></pre></pre>
<p>å˜¦ä½ èƒ½è¯æ˜ä½ çš„ API æ˜¯å¯é çš„,
å°±æ¥å— unsafe, ä½†æ˜¯, è¦é¿å…é€ˆä½ çš„æ¶ˆè´¹è€…æš´éœ² unsafe å‡½æ•°,
é™¤éæ˜¯çœŸæ­£æœ‰ä¿è¯çš„;
å‡ºäºè¿™ä¸ªåŸå› , åœ¨ Rust ä¸­,å¯¹ä½ çš„åŒ…å†…éƒ¨è¿›è¡Œä¸¥æ ¼æ§åˆ¶,
å¯ä»¥è¯æ˜ unsafe ä»£ç å—æ˜¯åˆç†çš„äº†;</p>
<p>é€šå¸¸åœ¨æ€§èƒ½ç»å¯¹é‡è¦çš„æƒ…å†µä¸‹, æ‰ä½¿ç”¨ unsafe,
æˆ–è€…å½“ä½ çŸ¥é“ä½¿ç”¨ unsafe ä»£ç å—æ˜¯è§£å†³é—®é¢˜çš„ç®€å•æ–¹æ³•,
å¹¶ä¸”å¯ä»¥è¯æ˜ä»£ç çš„å¯é æ€§æ—¶;</p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>å®‰å…¨å’Œå¯é åˆ†ç¦», é‚£ä¹ˆ, ä»€ä¹ˆæ˜¯å¯é å‘¢?</p>
<p>)</p>
<h3 id="å°½å¯èƒ½ç”¨-impl-ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯é€šç”¨çº¦æŸ"><a class="header" href="#å°½å¯èƒ½ç”¨-impl-ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯é€šç”¨çº¦æŸ">å°½å¯èƒ½ç”¨ impl ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯é€šç”¨çº¦æŸ</a></h3>
<p>è¿™ç‚¹æ¥è‡ª Golang, æˆ‘è®¤ä¸ºç‰¹å¾å¯ä»¥ä¸€ç›´ç®€å•çš„ä½œä¸ºå‡½æ•°å‚æ•°æ¥æä¾›;
æ¯”å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Meower {
    fn meow(&amp;self);
}

struct Cat {}

impl Meower for Cat {
    fn meow(&amp;self) {
        println!(&quot;meow&quot;);
    }
}

// ERROR: Meower cannot be used as it does not have
// a size at compile time!
fn do_the_meow(meower: Meower) {
    meower.meow();
}
<span class="boring">}</span></code></pre></pre>
<p>...ä½†æ˜¯,ä¸Šè¿°ä»£ç å¤±è´¥äº†,
å› ä¸º, trait å¯¹è±¡åœ¨ç¼–è¯‘æ—¶æ²¡æœ‰ Rust å®Œæˆå·¥ä½œéœ€è¦çš„å†…å­˜å°ºå¯¸;
æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  <code>&amp;dyn Meower</code> æ¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯åŠ¨æ€è°ƒæ•´å¤§å°æ¥ç»•è¿‡,
ä½†æ˜¯, å¾ˆå¿«æˆ‘äº†è§£åˆ°è¿™ä¸æ˜¯ <code>rusty</code>/é”ˆèŒƒå„¿ è§£å†³æ–¹æ¡ˆ;
ç›¸å,å¼€å‘è€…å€¾å‘äºè¡–å—ç‰¹å¾çº¦æŸçš„é€šç”¨å‚æ•°,
ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn do_the_meow&lt;M: Meower&gt;(meower: M) {
    meower.meow();
}
<span class="boring">}</span></code></pre></pre>
<p>...ç°åœ¨èƒ½é€šè¿‡ç¼–è¯‘äº†;
ç„¶è€Œ,éšç€å‡½æ•°è¶Šæ¥è¶Šå¤æ‚, å¦‚æœæˆ‘ä»¬è¿˜åŒ…æ‹¬å…¶å®ƒé€šç”¨å‚æ•°,
å°±å¯èƒ½ä¼šæœ‰ä¸€ä¸ªéå¸¸éš¾ä»¥é˜…è¯»çš„å‡½æ•°å£°æ˜;
åœ¨æ­¤ç¤ºä¾‹ä¸­,å¦‚æœæˆ‘ä»¬åªæƒ³ç”¨ä¸€æ¬¡ meow,
é‚£ä¹ˆ, å®é™…ä¸Šå¹¶ä¸éœ€è¦åŠ¨ç”¨æ³›å‹;
æˆ‘ä»¬ç”šè‡³äºå¹¶ä¸å…³å¿ƒ meow çš„ç»“æœ,
æ‰€ä»¥, å¯ä»¥æ”¹å†™ä¸ºè¿™æ ·:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn do_the_meow(meower: &amp;impl Meower) {
    meower.meow();
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™æ ·å‘Šè¯‰ç¼–è¯‘å™¨:&quot;æˆ‘åªæƒ³è¦å®ç° Meow çš„ä¸œè¥¿&quot;;
å½“ç„¶,è¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„,
å¹¶ä¸”,é¦–å…ˆä¸éœ€è¦å‡½æ•°çš„é€šç”¨è¿”å›ç±»å‹æ—¶,
æ­¤æ¨¡å¼ä¼šæ›´åŠ æ¸…æ™°;</p>
<h3 id="ç”¨-iter-è¿‡ç¨‹ä¸­æƒ³å€Ÿç”¨æ—¶-iter-mut-ç”¨ä»¥ç‹¬å -refsè€Œ-into-iter-æ”¯æŒæ‹¥æœ‰"><a class="header" href="#ç”¨-iter-è¿‡ç¨‹ä¸­æƒ³å€Ÿç”¨æ—¶-iter-mut-ç”¨ä»¥ç‹¬å -refsè€Œ-into-iter-æ”¯æŒæ‹¥æœ‰">ç”¨ iter() è¿‡ç¨‹ä¸­æƒ³å€Ÿç”¨æ—¶, iter mut() ç”¨ä»¥ç‹¬å  refs,è€Œ into iter() æ”¯æŒæ‹¥æœ‰</a></h3>
<p>å¾ˆå¤šæ•™ç¨‹ç«‹å³è·³è½¬åˆ°ä½¿ç”¨ä¸‹é¢çš„ into_iter æ–¹æ³•æ¥è¿­ä»£ vectors/å‘é‡:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let items = vec![1, 2, 3, 4, 5];
for item in items.into_iter() {
    println!(&quot;{}&quot;, item);
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶è€Œ,å½“æˆ‘ä»¬åˆšåˆšå¼€å§‹åœ¨ç»“æ„ä¸­ä½¿ç”¨è¿™ä¸ªè¿­ä»£å™¨æ–¹æ³•æ—¶,
å¾ˆå¤šåˆå­¦è€…(åŒ…æ‹¬ä½œè€…è‡ªå·±)éƒ½ç¢°å£äº†,ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
    bar: Vec&lt;u32&gt;,
}

impl Foo {
    fn all_zeros(&amp;self) -&gt; bool {
        // ERROR: Cannot move out of self.bar!
        self.bar.into_iter().all(|x| x == 0)
    }
}
<span class="boring">}</span></code></pre></pre>
<p>å¹¶ç«‹å³æç¤º:</p>
<pre><code>    error[E0507]: cannot move out of `self.bar` which is behind a shared reference
       --&gt; src/main.rs:9:9
        |
    9   |         self.bar.into_iter().all(|x| x == 0)
        |         ^^^^^^^^ ----------- `self.bar` moved due to this method call
        |         |
        |         move occurs because `self.bar` has
        |         type `Vec&lt;u32&gt;`, which does not implement the `Copy` trait

</code></pre>
<p>ä½œä¸ºèœé¸Ÿå°è¯•äº†å¾ˆå¤šåŠæ³•å, æ‰æ„è¯†åˆ° <code>.into_ter()</code> å–å¾—äº†é›†åˆçš„æ‰€æœ‰æƒ,
è¿™ä¸æ˜¯æˆ‘çš„ç›®æ ‡æ‰€éœ€è¦çš„;
ç›¸å, åœ¨è¿­ä»£å™¨ä¸Šè¿˜æœ‰å¦å¤–ä¸¤ç§æœ‰ç”¨çš„æ–¹æ³•, çœŸå¸Œæœ›å½“æ—¶èƒ½æ—©ç‚¹çŸ¥é“ä¸«ä»¬;</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯ <code>.iter()</code> ,å€Ÿç”¨é›†åˆ, è®©ä½ æ–­è¨€å…³äºå…¶å€¼çš„ä¸œè¥¿,ä½†æ˜¯, ä¸æ‹¥æœ‰æˆ–æ˜¯æ”¹å˜å¥¹ä»¬;
å†æœ‰å°±æ˜¯ <code>iter_mut()</code> å¸®åŠ©ä½ æ”¹å˜é›†åˆå†…éƒ¨å€¼,å˜¦ä½ æ˜¯å”¯ä¸€çš„exclusive reference/ç‹¬å å‚è€ƒ;</p>
<p>æ€»ä¹‹, å½“ä½ åªéœ€è¦å€Ÿç”¨æ—¶ç”¨ <code>.iter()</code>,
å½“ä½ æƒ³è¦è·å¾—æ‰€æœ‰æƒæ—¶ç”¨ <code>.into_iter()</code>,
å½“ä½ éœ€è¦æ”¹å˜è¿­ä»£å¯¹è±¡çš„å…ƒç´ æ—¶ç”¨ <code>.iter_mut()</code>;</p>
<h3 id="phantom-æ•°æ®ä¸ä»…ä»…ç”¨ä»¥å¤„ç†æŒ‡å‘ç±»å‹çš„åŸå§‹æŒ‡é’ˆ"><a class="header" href="#phantom-æ•°æ®ä¸ä»…ä»…ç”¨ä»¥å¤„ç†æŒ‡å‘ç±»å‹çš„åŸå§‹æŒ‡é’ˆ">Phantom æ•°æ®ä¸ä»…ä»…ç”¨ä»¥å¤„ç†æŒ‡å‘ç±»å‹çš„åŸå§‹æŒ‡é’ˆ</a></h3>
<p>å½“ä½ ç¬¬ä¸€æ¬¡é‡åˆ° Phantom data/å¹»æ•°æ®æ—¶,
ä¸€å®šæ„Ÿè§‰å¾ˆå¥‡æ€ª,ä½†æ˜¯, å¾ˆå¿«å°±ä¼šæˆä¸ºä¸€ç§å‘Šè¯‰ç¼–è¯‘å™¨&quot;æ‹¥æœ‰&quot;æŸä¸ªå€¼çš„å¥½æ–¹å¼,
å°½ç®¡åªæœ‰ä¸€ä¸ªæŒ‡å‘å¥¹çš„åŸå§‹æŒ‡é’ˆ;
ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::marker;

struct Foo&lt;'a, T: 'a&gt; {
    bar: *const T,
    _marker: marker::PhantomData&lt;&amp;'a T&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™å„¿å‘Šè¯‰ç¼–è¯‘å™¨ Foo æ‹¥æœ‰ T,
å°½ç®¡åªæœ‰ä¸€ä¸ªæŒ‡å‘å¥¹çš„åŸå§‹æŒ‡é’ˆ;
è¿™å¯¹äºéœ€è¦å¤„ç†åŸå§‹æŒ‡é’ˆå’Œä½¿ç”¨ unsafe Rust çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰å¸®åŠ©;</p>
<p>ä½†æ˜¯, ä¹Ÿå¯ä»¥æ˜¯ä¸€ç§å‘Šè¯‰ç¼–è¯‘å™¨ä½ çš„ç±»å‹è¿˜æ²¡å®ç° Send æˆ–æ˜¯ Sync ç‰¹å¾çš„æ–¹æ³•!
ä½ å¯ä»¥ä½¿ç”¨ PhantomData åŒ…è£…ä»¥ä¸‹ç±»å‹,å¹¶åœ¨ä½ çš„ç»“æ„ä¸­ä½¿ç”¨å¥¹ä»¬,
æ¥ä½œä¸ºä¸€ç§æ–¹å¼å‘Šè¯‰ç¼–è¯‘å™¨ä½ çš„ç»“æ„å³ä¸æ˜¯ Send ä¹Ÿä¸æ˜¯ Sync;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub type PhantomUnsync = PhantomData&lt;Cell&lt;()&gt;&gt;;
pub type PhantomUnsend = PhantomData&lt;MutexGuard&lt;'static, ()&gt;&gt;;
<span class="boring">}</span></code></pre></pre>
<h3 id="ç”¨-rayon-å®ç°å¹¶è¡Œå¢é‡"><a class="header" href="#ç”¨-rayon-å®ç°å¹¶è¡Œå¢é‡">ç”¨ rayon å®ç°å¹¶è¡Œå¢é‡</a></h3>
<p>æœ‰æ—¶, ä½ å¸Œæœ›åœ¨éå†é›†ä¼šæ—¶å¹¶è¡ŒåŒ–å·¥ä½œ,
ä½†æ˜¯, åœ¨å¤„ç†çº¿ç¨‹å’Œç¡®ä¿ç±»å‹å¯ä»¥å®‰å…¨çš„è·¨çº¿ç¨‹å‘é€æ—¶å´ç¢°å£äº†;
æœ‰æ—¶, å¦‚æœé¢å¤–çš„æ ·æ¿æ–‡ä»¶ä»¤ä½ çš„ä»£ç å‡ ä¹ä¸å¯è¯»,é‚£å°±å·²ç»ä¸å€¼å¾—äº†;</p>
<p>ç›¸å, æœ‰ä¸€ä¸ªåä¸º Rayon å¾ˆèµçš„åŒ…, å·²ç»æä¾›äº†ä»¥æ— ç¼æ–¹å¼å¹¶è¡ŒåŒ–è®¡ç®—çš„ä¸Šå¥½å·¥å…·;
ä¾‹å¦‚,å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡ç®—æ•°ç»„å¹³æ–¹å’Œçš„å‡½æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn sum_of_squares(input: &amp;[i32]) -&gt; i32 {
    input.iter()
            .map(|i| i * i)
            .sum()
}
<span class="boring">}</span></code></pre></pre>
<p>ç”±äºä¹˜æ³•å’ŒåŠ æ³•çš„æ€§è´¨, ä¸Šè¿°ä»£ç ç»å¯¹å¯ä»¥å¹¶è¡ŒåŒ–,
Rayon é€šè¿‡è®©æˆ‘ä»¬è‡ªåŠ¨è®¿é—®æ•°ç»„ç­‰é›†ä¼šçš„&quot;å¹¶è¡Œè¿­ä»£å™¨&quot;,
ä½¿å¹¶è¡ŒåŒ–å˜å¾—å¾®ä¸è¶³é“;
è¿™æ˜¯å‡ ä¹é›¶æ ·æ¿çš„ä»£ç ;
è€Œä¸”ä¹Ÿå®Œå…¨ä¸å½±å“å¯è¯»æ€§:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Importing rayon prelude is what gives us access to .par_iter on arrays.
use rayon::prelude::*;

fn sum_of_squares(input: &amp;[i32]) -&gt; i32 {
    // We can use par_iter on our array to let rayon
    // handle the parallelization and reconciliation of
    // results at the end.
    input.par_iter()
            .map(|i| i * i)
            .sum()
}
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p>å·¥ç¨‹ä¸­å¦‚æœè‡ªå·±è¦æ„é€ å„ç§å†…éƒ¨åº“,
ä¹Ÿå€¼å¾—ç»™å‡ºè¿™ç§ä½¿ç”¨ç•Œé¢,
å’Œä»¥å¾€ä½¿ç”¨å†…ç½®åº“çš„ä»£ç å®Œå…¨å…¼å®¹,
åªæ˜¯åœ¨å…³é”®èŠ‚ç‚¹å¤„æ›¿æ¢ä¸ºè‡ªå·±é­”æ”¹/åŠ å¼ºè¿‡çš„...
)</p>
<h3 id="å¼€å‘-rust-åº“æ—¶ç†è§£-æ‹“å±•ç‰¹å¾-çš„æ¦‚å¿µ"><a class="header" href="#å¼€å‘-rust-åº“æ—¶ç†è§£-æ‹“å±•ç‰¹å¾-çš„æ¦‚å¿µ">å¼€å‘ Rust åº“æ—¶ç†è§£ æ‹“å±•ç‰¹å¾ çš„æ¦‚å¿µ</a></h3>
<p>é‚£ä¹ˆ Rayon æ˜¯å¦‚ä½•ä»¥å¦‚æ­¤å¹²å‡€çš„æ–¹å¼å®Œæˆä¸Šè¿°å·¥ä½œçš„å‘¢?
ç­”æ¡ˆåœ¨äº&quot;æ‹“å±•ç‰¹å¾&quot;,
è¿™äº›ç‰¹å¾å¯ä»¥å®šä¹‰ä¸ºå¯¹å…¶å®ƒç‰¹å¾çš„æ‹“å±•,
ä¾‹å¦‚ Iterator;
ä¹Ÿå°±æ˜¯è¯´,æˆ‘ä»¬å¯ä»¥é€ˆé€šå¸¸å®ç° Itertor ç‰¹å¾çš„é¡¹è¿½åŠ å…¶å®ƒæœ‰ç”¨çš„å‡½æ•°,
ä½†æ˜¯, å¥¹ä»¬åªæœ‰åœ¨ç‰¹æ€§èŒƒç•´ä»¥å†…æ—¶æ‰å¯ç”¨,
æ¯”å¦‚é€šè¿‡å°†å…¶å¯¼å…¥æ–‡ä»¶ä¸­;</p>
<p>è¿™ç§æ–¹å¼éå¸¸å¥½,å› ä¸º,è¿™äº›ç‰¹å¾åªæœ‰åœ¨ä½ åœ¨é¡¹ç›®ä¸­å¯¼å…¥æ‹“å±•ç‰¹å¾æ—¶æ‰å¯ç”¨,
å¹¶æä¾›äº†ä¸€ç§ä½¿ç”¨å¹²å‡€çš„ API æ‹“å±•é€šç”¨é›†åˆå’Œç±»å‹çš„å¥½æ–¹æ³•,
å¼€å‘è€…å¯ä»¥åƒä½¿ç”¨æ™®é€š API ä¸€æ ·è½»æ¾çš„ä½¿ç”¨è¿™äº› API;
ç”±äº Rayon çš„æ‹“å±•ç‰¹å¾,
ä½¿ç”¨å¹¶è¡Œè¿­ä»£å™¨å°±åƒåœ¨ Rust ä¸­ä½¿ç”¨æ™®é€šè¿­ä»£å™¨ä¸€æ ·ç®€å•;</p>
<p>äº‹å®ä¸Š,è¿™æœ‰ä¸€ä¸ªä¿¡æ¯é‡å¾ˆå¤§çš„æ¼”è®²,è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ æ‹“å±•ç‰¹å¾ æ¥å¼€å‘ä¸€ä¸ªåœ¨è¿­ä»£å™¨ä¸Šæä¾›è¿›åº¦æ¡çš„åº“;</p>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p><a href="https://www.youtube.com/watch?v=bnnacleqg6k">&quot;Type-Driven API Design in Rust&quot; by Will Crichton - YouTube</a></p>
<p>é…å¥—çœ‹çœ‹ Rayon å®˜æ–¹å¯¹è‡ªå·±å®ç°åŸç†çš„å—¯å“¼: <a href="https://github.com/rayon-rs/rayon/tree/master/src/iter/plumbing">rayon/src/iter/plumbing at master Â· rayon-rs/rayon</a>
ä»¥åŠä¸“é—¨çš„è§£ææ–‡ç« : <a href="https://developers.redhat.com/articles/2023/01/30/run-app-under-openshift-service-mesh">How Rust supports Rayon's data parallelism | Red Hat Developer</a></p>
<p>å¤§çº¦å¯ä»¥æ„Ÿå—åˆ° Rust ä¸–ç•Œçš„ä»»æ€§äº†...
)</p>
<h3 id="æ‹¥æŠ±-option-å’Œ-result-ç±»å‹çš„ä¸€å…ƒæ€§"><a class="header" href="#æ‹¥æŠ±-option-å’Œ-result-ç±»å‹çš„ä¸€å…ƒæ€§">æ‹¥æŠ± Option å’Œ Result ç±»å‹çš„ä¸€å…ƒæ€§</a></h3>
<p>ä½¿ç”¨ Option å’Œ Result ä¹‹å,
äººä»¬ä¼šå¾ˆå¿«çœ‹åˆ°<code>.unwrap()</code> å°†å€¼ä»å¥¹ä»¬ç§»å‡º,
å¦‚æœ Option å’Œ Result æ˜¯å…±äº«å¼•ç”¨(æ¯”å¦‚ struct)çš„ä¸€éƒ¨åˆ†,
å°±å°†å¯¼è‡´å¤±è´¥;
ç„¶è€Œ,æœ‰æ—¶æˆ‘ä»¬æƒ³è¦çš„åªæ˜¯æ–­è¨€ Option åŒ¹é…å†…éƒ¨çš„å€¼æˆ–è·å–å¯¹å…¶å†…éƒ¨çš„å¼•ç”¨;
æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ä½œåˆ°è¿™ç‚¹,
ä½†æ˜¯, è¿˜æœ‰ä¸€ç§æ–¹å¼èƒ½ä¸ç”¨ç¦»å¼€ Option é¢†åŸŸ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn check_five(x: Option&lt;i32&gt;) -&gt; bool {
    // Contains can just check if the Option has what we want.
    x.contains(&amp;5)
}
<span class="boring">}</span></code></pre></pre>
<p>å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯æˆ‘ä»¬æƒ³è¦ç”¨ None å€¼æ›¿æ¢ Option å†…æ•°æ®,
ä¹Ÿå°±æ˜¯å’ŒæŸäº›ç»“æ„äº¤äº’æ—¶;
æˆ‘ä»¬å¯ä»¥ç”¨æŒ‡ä»¤å¼ç¼–ç¨‹çš„æ–¹å¼æ¥ç¼–å†™,
å¹¶æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¯¦ç»†å®Œæˆ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
    data: Option&lt;T&gt;,
}

impl&lt;T&gt; Foo&lt;T&gt; {
    // Takes the value of data and leaves None in its place.
    fn pop(&amp;mut self) -&gt; Option&lt;T&gt; {
        if self.data.is_none() {
            return None;
        }
        let value = self.data.unwrap();
        self.data = None;
        value
    }
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶è€Œ, Option æœ‰ä¸€äº›éå¸¸é…·çš„å±æ€§,
å› ä¸º, å¥¹ä»¬çš„åŸºæœ¬æ€§è´¨æ˜¯å®šä¹‰äº†æœ‰ç”¨çš„æ–¹æ³•,
å¯ä»¥è®©æˆ‘ä»¬çš„ç”Ÿæºæ›´åŠ è½»æ¾;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Takes the value of data and leaves None in its place.
fn pop(&amp;mut self) -&gt; Option&lt;T&gt; {
    self.data.take()
}
<span class="boring">}</span></code></pre></pre>
<p>Rust ä¸­çš„ Option ä»¥å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ç›¸åŒçš„èŒƒä¾‹ä¸ºæ¨¡å‹,
å±äºæ›´å¹¿æ³›çš„æ•°æ®ç±»å‹ç±»åˆ«, ç§°ä¸º Monad;
ä¸ç”¨æ·±å…¥ç†è§£ Monad æ˜¯ä»€ä¹ˆ, è€Œå˜¦å°†å…¶è§†ä¸ºæ•°æ®çš„åŒ…è£…å™¨,
æˆ‘ä»¬å¯ä»¥åœ¨ä¸éœ€è¦ä»ä¸­å–å‡ºä¸œè¥¿çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œæ“ä½œ;
æ¯”å¦‚, æƒ³è±¡ä¸€ä¸ªå°†ä¸¤ä¸ª Option å†…éƒ¨å€¼ç›¸åŠ å¹¶è¿”å›ä¸€ä¸ª Option çš„å‡½æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add(x: Option&lt;i32&gt;, y: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
    if x.is_none() || y.is_none() {
        return None;
    }
    return Some(x.unwrap() + y.unwrap());
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸Šè¿°ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹ç‚¹ç¬¨æ‹™,å› ä¸º,éœ€è¦æ‰§è¡Œ none æ£€éªŒ,
è€Œä¸”æˆ‘ä»¬å¿…é¡»ä»ä¸¤ä¸ª Option ä¸­æå–å€¼å¹¶ä»ä¸­æ„å»ºä¸€ä¸ªæ–° Option å°±å¾ˆå›§;
ç„¶è€Œ, ç”±äº Option çš„ç‰¹æ®Šå±æ€§,
æˆ‘ä»¬å¯ä»¥ä½œçš„æ›´å¥½!
è¿™æ˜¯æˆ‘ä»¬å¯ä»¥è·å¾—çš„:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add(x: Option&lt;i32&gt;, y: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
    x.zip(y).map(|(a, b)| a+b)
}
<span class="boring">}</span></code></pre></pre>
<p>å¯ä»¥å¯¹ option ä½¿ç”¨ zip å’Œ map ,
å°±åƒæˆ‘ä»¬å¯ä»¥å¤„ç†æ•°ç»„å’Œå‘é‡ä¸€æ ·;
æ­¤å±æ€§ä¹Ÿå­˜åœ¨äº Result ç±»å‹ä¸­,
ç”šè‡³å­˜åœ¨äºè¯¸å¦‚ <code>Future</code> ç±»å‹ä¹‹ç±»äº‹ç‰©ä¸­;
å¦‚æœä½ å¯¹ä¸ºä»€ä¹ˆè¿™ä¹ˆä½œæ„Ÿåˆ°å¥½å¥‡,
è¯·ç»§ç»­æŒ–æ˜ Monad çš„æ›´å¤šä¿¡æ¯ -&gt; <a href="https://stackoverflow.com/questions/2704652/monad-in-plain-english-for-the-oop-programmer-with-no-fp-background">functional programming - Monad in plain English? (For the OOP programmer with no FP background) - Stack Overflow</a></p>
<p>æ¥å— Option å’Œ Result ç±»å‹çš„ä¸€å…ƒæ€§è´¨,
ä¸è¦åˆ°å¤„ä½¿ç”¨ unwrap å’Œ if x.is_none() {} else ;
æœ¬èº«å°±åŒ…å«äº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•,
ä½ å¯ä»¥åœ¨æ ‡å‡†åº“ä¸­é˜…è¯»è¿™äº›æ–¹æ³•;</p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>æ‰€ä»¥, æ ‡å‡†åº“çš„é€šè¯»æ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸäº†,
ä¸è¿‡, ç›¸æ¯” Python ç­‰å…¶å®ƒè¯­è¨€çš„å®˜æ–¹æ–‡æ¡£,
docs.rs å®åœ¨å¤ªéº»äº†ç‚¹å„¿,è¿˜è¦ä¹ æƒ¯ä¸€ä¸‹;</p>
<p>)</p>
<h3 id="äº†è§£-drop-åº”è¯¥å¦‚ä½•é’ˆå¯¹ä¸åŒæ•°æ®ç»“æ„å®ç°"><a class="header" href="#äº†è§£-drop-åº”è¯¥å¦‚ä½•é’ˆå¯¹ä¸åŒæ•°æ®ç»“æ„å®ç°">äº†è§£ Drop åº”è¯¥å¦‚ä½•é’ˆå¯¹ä¸åŒæ•°æ®ç»“æ„å®ç°</a></h3>
<p>æ ‡å‡†åº“å°† Drop ç‰¹æ€§æè¿°ä¸º:</p>
<p>å½“ä¸å†éœ€è¦æŸä¸ªå€¼æ—¶, Rust å°†å¯¹è¯¥å€¼è¿è¡Œ&quot;ææ„å‡½æ•°&quot;;
ä¸å†éœ€è¦æŸä¸ªå€¼æœ€å¸¸è§æ–¹å¼æ˜¯è¶…å‡ºä½œç”¨åŸŸ;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Drop {
    fn drop(&amp;mut self);
}
<span class="boring">}</span></code></pre></pre>
<p>åœ¨ Rust ä¸­ç¼–å†™æ•°æ®ç»“æ„æ—¶, Drop æ˜¯è‡³å…³é‡è¦çš„;
äººä»¬å¿…é¡»æœ‰ä¸€ç§åˆç†çš„æ–¹æ³•æ¥å¤„ç†ä¸€æ—¦ä¸å†éœ€è¦å†…å­˜æ—¶å¦‚ä½•ä¸¢å¼ƒ(å®‰å…¨çš„);
ä½¿ç”¨å¼•ç”¨è®¡æ•°ç±»å‹å¯ä»¥æŠ¥æ—¶ä½ å…‹æœè¿™äº›éšœç¢,
ä½†æ˜¯, è¿™å¹¶ä¸æ€»æ˜¯è¶³å¤Ÿçš„;
ä¾‹å¦‚,ç¼–å†™è‡ªå®šä¹‰é“¾è¡¨æˆ–æ˜¯ç¼–å†™ä½¿ç”¨é€šé“çš„ç»“æ„æ—¶,é€šå¸¸è¦å®ç°è‡ªå®šä¹‰ç‰ˆæœ¬çš„ Drop;
å½“ä½ çœ‹åˆ°æ ‡å‡†åº“å®é™…å¦‚ä½•æ‰§è¡Œæ—¶,
å®ç° Drop æ¯”å¹¶çœ‹èµ·æ¥å®¹æ˜“çš„å¤š:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// That's it!
fn drop&lt;T&gt;(t: T) {}
<span class="boring">}</span></code></pre></pre>
<p>å·§å¦™åˆ©ç”¨å¤±å»ä½œç”¨åŸŸæ—¶é”€æ¯çš„è§„åˆ™,
<code>std::mem::drop</code> æœ‰ä¸€ä¸ªç©ºå‡½æ•°ä½“!</p>
<p>è¿™æ˜¯ä¸€ä¸ªæŠ€å·§, ä½ å¯ä»¥åœ¨è‡ªå·±çš„è‡ªå®šä¹‰ Drop å®ç°ä¸­ä½¿ç”¨,
å˜¦ä½ æ¶µç›–æ‰€æœ‰åŸºç±»?å³å¯;</p>
<h3 id="çœŸçš„å¯¹å€Ÿç”¨æ£€æŸ¥å‘˜å¾ˆæ°”-é‚£å°±ç”¨ä¸å¯å˜æ•°æ®ç»“æ„"><a class="header" href="#çœŸçš„å¯¹å€Ÿç”¨æ£€æŸ¥å‘˜å¾ˆæ°”-é‚£å°±ç”¨ä¸å¯å˜æ•°æ®ç»“æ„">çœŸçš„å¯¹å€Ÿç”¨æ£€æŸ¥å‘˜å¾ˆæ°”? é‚£å°±ç”¨ä¸å¯å˜æ•°æ®ç»“æ„</a></h3>
<p>å‡½æ•°å¼ç¨‹åºå‘˜å–œæ¬¢è¯´å…¨å±€çš„/å¯å˜çš„çŠ¶æ€æ˜¯ä¸‡æ¶ä¹‹æº,
å¦‚æœå¯ä»¥é¿å…,é‚£æ¯›è¿˜è¦ä½¿ç”¨å‘¢?
å¤šäºäº† Rust çš„å‡½æ•°å¼ç»“æ„,
æˆ‘ä»¬æ‰èƒ½æ„å»ºä»ä¸€å¼€å§‹å°±ä¸å¯èƒ½çªå˜çš„ç»“æ„ç»“æ„!
å½“ä½ éœ€è¦ç¼–å†™ç±»ä¼¼åœ¨ Haskell/OCaml æˆ–å…¶å®ƒè¯­è¨€ä¸­çœ‹åˆ°çš„çº¯ç²¹å‡½æ•°å¼ä»£ç æ—¶,
è¿™å°¤å…¶æœ‰ç”¨;</p>
<p>é€šè¿‡é“¾æ¥åˆ—è¡¨ç»¼åˆæ•™ç¨‹ä¸­çš„ç¤ºä¾‹,
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä½•æ„å»ºä¸€ä¸ªä¸å¯å˜åˆ—è¡¨,å…¶ä¸­èŠ‚ç‚¹æœ‰å¼•ç”¨è®¡æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::rc::Rc;

pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
}

type Link&lt;T&gt; = Option&lt;Rc&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;T&gt; List&lt;T&gt; {
    pub fn new() -&gt; Self {
        List { head: None }
    }

    pub fn prepend(&amp;self, elem: T) -&gt; List&lt;T&gt; {
        List { head: Some(Rc::new(Node {
            elem: elem,
            next: self.head.clone(),
        }))}
    }

    pub fn tail(&amp;self) -&gt; List&lt;T&gt; {
        List { head: self.head.as_ref().and_then(|node| node.next.clone()) }
    }
    ...
<span class="boring">}</span></code></pre></pre>
<p>è¿™å°±å¾ˆèµ,å› ä¸º,å…¶è¡Œä¸ºç±»ä¼¼äºå‡½æ•°å¼æ•°æ®ç»“æ„,
åœ¨å‡½æ•°å¼æ•°æ®ç»“æ„ä¸­,
äººä»¬ä¸ä¼šé€šè¿‡è¿½åŠ å‰ç¼€æ¥ä¿®æ”¹åˆ—è¡¨,
è€Œæ˜¯é€šè¿‡ä»¥æ–°å…ƒç´ ä½œä¸ºå…¶å¤´éƒ¨å’Œç°æœ‰åˆ—è¡¨ä½œä¸ºå°¾éƒ¨æ¥æ„å»ºåˆ—è¡¨å®Œæˆæ–°æ„å»º;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    [head] ++ tail
<span class="boring">}</span></code></pre></pre>
<p>è¯·æ³¨æ„,ä¸Šè¿°æ–¹æ³•éƒ½ä¸éœ€è¦ mut, å› ä¸º,æˆ‘ä»¬çš„æ•°æ®ç»“æ„æ˜¯ä¸å¯å˜çš„!
è¿™åœ¨å†…å­˜ä¸Šä¹Ÿæ˜¯éå¸¸é«˜æ•ˆçš„,å› ä¸º,è¯¥ç»“æ„æ˜¯å¼•ç”¨è®¡æ•°çš„,
è¿™æ„å‘³ç€å¦‚æœæ­¤æ•°æ®ç»“æ„ä¸Šæœ‰å¤šä¸ªè°ƒç”¨è€…,
æˆ‘ä»¬ä¸ä¼šæµªè´¹ä¸å¿…è¦çš„èµ„æºæ¥å¤åˆ¶èŠ‚ç‚¹çš„åº•å±‚å†…å­˜;</p>
<p>Rust ä¸­çš„çº¯å‡½æ•°ä»£ç å¾ˆç®€æ´,
ä½†æ˜¯,å¤šæ•°æ—¶å€™,éœ€è¦å°¾é€’å½’æ¥äº†æŠŠç”¨æˆ‘å¿«è¿™ç§æ–¹å¼å®ç°çš„é«˜æ€§èƒ½ä»£ç ï¼›
è€Œä¸”ï¼Œè¦å°å¿ƒï¼Œæ¯•ç«Ÿ Rust ç¼–è¯‘å™¨ä¸ä¿è¯å°¾è°ƒç”¨ä¼˜åŒ–ï¼›
å€¼å¾—è¿›ä¸€æ­¥æŒ–æ˜æ›´å¤šä¿¡æ¯ -&gt; <a href="https://stackoverflow.com/questions/59257543/when-is-tail-recursion-guaranteed-in-rust">When is tail recursion guaranteed in Rust? - Stack Overflow</a></p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>è¿™å°±å°´å°¬äº†, åªæ˜¯ä¸ªçœ‹èµ·æ¥å¾ˆç¾çš„æ€è·¯,
æ¯•ç«Ÿ Rust ä¸æ˜¯çº¯å‡½æ•°è¯­è¨€,
é€’å½’å¹¶ä¸æ˜¯ç¬¬ä¸€å…¬æ°‘;</p>
<p>æ‰€ä»¥, è¿™ç§åœºæ™¯ä¸­,è¿˜æ˜¯è€å®å’Œ å€Ÿç”¨ç®¡ç†å‘˜ å¥½å¥½å•†é‡å§...</p>
<p>)</p>
<h3 id="traits-ç¯®æœ‰åŠ©å‡å°‘é‡å¤"><a class="header" href="#traits-ç¯®æœ‰åŠ©å‡å°‘é‡å¤">traits ç¯®æœ‰åŠ©å‡å°‘é‡å¤</a></h3>
<p>æœ‰æ—¶,å¯èƒ½å¸Œæœ›é€šè¿‡å¾ˆå¤šä¸åŒçš„ç‰¹å¾æ¥çº¦æŸæ³›å‹å‚æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo&lt;T: Copy + Clone + Ord + Bar + Baz + Nyan&gt; {
    vals: Vec&lt;T&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>ä½†æ˜¯,ä¸€æ—¦ä½ å¼€å§‹ç¼–å†™ impl è¯­å¥,
æˆ–æ˜¯å½“ä½ æœ‰å¤šä¸ªé€šç”¨å‚æ•°æ—¶,
è¿™å¾ˆå¿«å°±ä¼šå¤±æ§;
ç›¸åä½ å¯æº¶æ€§å®šä¹‰ä¸€ä¸ªæ•´ä½“ç‰¹å¾, ä½¿ä»£ç æ›´åŠ  DRY;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Fooer: Copy + Clone + Ord + Bar + Baz + Nyan {}

struct Foo&lt;F: Fooer&gt; {
    vals: Vec&lt;F&gt;,
}

impl&lt;F: Fooer&gt; Foo&lt;F&gt; { ... }
<span class="boring">}</span></code></pre></pre>
<p>traits ç¯®å¯ä»¥å¸®åŠ©å‡å°‘é‡å¤ï¼Œ
ä½†æ˜¯ï¼Œä¸è¦è®©å…¶å˜å¾—è¿‡å¤§ï¼›
åœ¨å¾ˆå¤šæƒ…å†µä¸­ï¼Œ
è®©ä¸€ä¸ªç±»å‹éœ€è¦å¦‚æ­¤å¤šçš„çº¦æŸå¯èƒ½ä¼šäº§ç”Ÿåå‘³é“,
å› ä¸º,ä½ åˆ›å»ºçš„æŠ½è±¡å¤ªå¤§äº†;
ç›¸å,å¦‚æœä½ å‘ç°çº¦æŸæ— ç¼˜æ— æ•…çš„å˜å¾—å¤ªå¤§,
è¯·ä¼ å…¥å…·ä½“ç±»å‹;
ç„¶è€Œ,æŸäº›åº”ç”¨å’Œè¿œåˆå¯èƒ½å—ç›Šäº blanket traits/ç‰¹å¾ç¯®,
ä¾‹å¦‚æ—¨åœ¨æä¾›å°½å¯èƒ½é€šç”¨çš„ API åº“;</p>
<h3 id="match-è¯­å¥æœ¬è´¨ä¸Šå¾ˆçµæ´»å’Œç»“æ„åŒ–çš„"><a class="header" href="#match-è¯­å¥æœ¬è´¨ä¸Šå¾ˆçµæ´»å’Œç»“æ„åŒ–çš„">Match è¯­å¥æœ¬è´¨ä¸Šå¾ˆçµæ´»å’Œç»“æ„åŒ–çš„</a></h3>
<p>ä¾‹å¦‚,å¯ä»¥å°†å€¼ä½œä¸ºå…ƒç»„ç»„åˆåœ¨ä¸€èµ·å¹¶æ‰§è¡Œä»¥ä¸‹æ“ä½œ,è€Œä¸æ˜¯åµŒå¥—åŒ¹é…è¯­å¥:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn player_outcome(player: &amp;Move, opp: &amp;Move) -&gt; Outcome {
    use Move::*;
    use Outcome::*;
    match (player, opp) {
        // Rock moves.
        (Rock, Rock) =&gt; Draw,
        (Rock, Paper) =&gt; Lose,
        (Rock, Scissors) =&gt; Win,
        // Paper moves.
        (Paper, Rock) =&gt; Win,
        (Paper, Paper) =&gt; Draw,
        (Paper, Scissors) =&gt; Lose,
        // Scissor moves.
        (Scissors, Rock) =&gt; Lose,
        (Scissors, Paper) =&gt; Win,
        (Scissors, Scissors) =&gt; Draw,
    }
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ªç¤ºä¾‹è¶³ä»¥è¯´æ˜ä¸ºä»€ä¹ˆæ¨¡å‹åŒ¹é…æ¯”æŒ‡ä»¤å¼è¯­è¨€ä¸­çš„ switch è¯­å¥æ›´å¼ºå¤§,
è€Œä¸”, åœ¨åŠ³æ¨¡å†…éƒ¨å€¼æ–¹é¢å¯ä»¥ä½œçš„æ›´å¤š.</p>
<h3 id="å¦‚æœåŒ¹é…å¯¹è±¡æ˜¯æœ‰é™ä¸”å·²çŸ¥çš„å«‘ä½¿ç”¨-_--å­å¥"><a class="header" href="#å¦‚æœåŒ¹é…å¯¹è±¡æ˜¯æœ‰é™ä¸”å·²çŸ¥çš„å«‘ä½¿ç”¨-_--å­å¥">å¦‚æœåŒ¹é…å¯¹è±¡æ˜¯æœ‰é™ä¸”å·²çŸ¥çš„,å«‘ä½¿ç”¨ _ =&gt; å­å¥</a></h3>
<p>ä¾‹å¦‚,æˆ‘ä»¬æœ‰ä¸ªæšä¸¾:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Foo {
    Bar,
    Baz,
    Nyan,
    Zab,
    Azb,
    Bza,
}
<span class="boring">}</span></code></pre></pre>
<p>åœ¨ç¼–å†™ match è¯­å¥æ—¶,å¦‚æœå¯èƒ½çš„è¯, åº”è¯¥åŒ¹é…æšä¸¾çš„æ‰€æœ‰ç±»å‹,è€Œä¸æ˜¯æ±‚åŠ©äº catch-all å­å¥:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>match f {
    Bar =&gt; { ... },
    Baz =&gt; { ... },
    Nyan =&gt; { ... },
    Zab =&gt; { ... },
    Azb =&gt; { ... },
    Bza =&gt; { ... },
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™å¯¹ä»£ç ç»´æŠ¤éå¸¸æœ‰å¸®åŠ©,å› ä¸º,å¦‚æœæšä¸¾çš„åŸå§‹ç¼–å†™è€…é€ˆå…¶è¿½åŠ æ›´å¤šå˜ä½“,
å¦‚æœæˆ‘ä»¬å¿˜è®°åœ¨åŒ¹é…è¯­å¥ä¸­å¤„ç†æ–°å˜ä½“, åŠŸèƒ½å°†æ— æ³•ç¼–è¯‘;</p>
<h3 id="match-ä¿æŠ¤æ¡æ¬¾ä¹Ÿå¾ˆå¼ºå¤§"><a class="header" href="#match-ä¿æŠ¤æ¡æ¬¾ä¹Ÿå¾ˆå¼ºå¤§">Match ä¿æŠ¤æ¡æ¬¾ä¹Ÿå¾ˆå¼ºå¤§</a></h3>
<p>å½“ä½ æœ‰æœªçŸ¥æˆ–æ˜¯å¯èƒ½æ— é™æ•°é‡çš„åŒ¹é…é¡¹æ—¶(ä¾‹å¦‚æ•°å­—èŒƒå›´),
åŒ¹é…å®ˆå«å°±å¾ˆæ£’;
ç„¶è€Œ, å¦‚æœä½ çš„èŒƒå›´ä¸èƒ½è¢«å®ˆå«å®Œå…¨åŒ…å«æ—¶,
å°†è¿«ä½¿ä½ ä½¿ç”¨ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„ <code>_ =&gt;</code>,
è¿™åœ¨ç¼–å†™å¯ç»´æŠ¤ä»£ç æ—¶å¯èƒ½å°±æ˜¯ä¸€ä¸ªç¼ºç‚¹;</p>
<p>Rust ä¹¦ä¸­å…¸å‹ç¤ºä¾‹å¦‚ä¸‹:</p>
<pre><pre class="playground"><code class="language-rust edition2021">enum Temperature {
    Celsius(i32),
    Fahrenheit(i32),
}

fn main() {
    let temperature = Temperature::Celsius(35);
    match temperature {
        Temperature::Celsius(t) if t &gt; 30 =&gt; println!(&quot;{}C is above 30 Celsius&quot;, t),
        Temperature::Celsius(t) =&gt; println!(&quot;{}C is below 30 Celsius&quot;, t),
        Temperature::Fahrenheit(t) if t &gt; 86 =&gt; println!(&quot;{}F is above 86 Fahrenheit&quot;, t),
        Temperature::Fahrenheit(t) =&gt; println!(&quot;{}F is below 86 Fahrenheit&quot;, t),
    }
}</code></pre></pre>
<h3 id="éœ€è¦æä¹±åŸå§‹æ±‡ç¼–å˜›-æœ‰ä¸€ä¸ªå®"><a class="header" href="#éœ€è¦æä¹±åŸå§‹æ±‡ç¼–å˜›-æœ‰ä¸€ä¸ªå®">éœ€è¦æä¹±åŸå§‹æ±‡ç¼–å˜›? æœ‰ä¸€ä¸ªå®!</a></h3>
<p>core asm æä¾›äº†ä¸€ä¸ªé—³, å¯ä»¥è®©ä½ åœ¨ Rust ä¸­ç¼–å†™å†…è”æ±‡ç¼–è¯­å¥,
è¿™åœ¨æŠ˜è…¾ä¸€äº›èŠ±å“¨çš„äº‹æƒ…æ—¶å¾ˆæœ‰å¸®åŠ©,
æ¯”å¦‚ç›´æ¥æ‹¦æˆª CPU çš„å †æ ˆ,
æˆ–æ˜¯æƒ³è¦å®ç°é«˜çº§ä¼˜åŒ–;</p>
<p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹,æˆ‘ä»¬ä½¿ç”¨å†…è”æ±‡ç¼–é€šè¿‡ç®€å•çš„å°†å †æ ˆæŒ‡é’ˆç§»åŠ¨åˆ°ç”¨æ¥æ¬ºéª—å¤„ç†å™¨çš„å †æ ˆæ¥æ‰§è¡Œæˆ‘ä»¬çš„å‡½æ•°!</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use core::arch::asm;

const MAX_DEPTH: isize = 48;
const STACK_SIZE: usize = 1024 * 1024 * 2;

#[derive(Debug, Default)]
#[repr(C)]
struct StackContext {
    rsp: u64,
}

fn nyan() -&gt; ! {
    println!(&quot;nyan nyan nyan&quot;);
    loop {}
}

pub fn move_to_nyan() {
    let mut ctx = StackContext::default();
    let mut stack = vec![0u8; MAX as usize];
    unsafe {
        let stack_bottom = stack.as_mut_ptr().offset(MAX_DEPTH);
        let aligned = (stack_bottom as usize &amp; !15) as *mut u8;
        std::ptr::write(aligned.offset(-16) as *mut u64, nyan as u64);
        ctx.rsp = aligned.offset(-16) as u64;
        switch_stack_to_fn(&amp;mut ctx);
    }
}

unsafe fn switch_stack_to_fn(new: *const StackContext) {
    asm!(
        &quot;mov rsp, [{0} + 0x00]&quot;,
        &quot;ret&quot;,
        in(reg) new,
    )
}
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p>æ‰€ä»¥è¯´, æ— æ³•åµŒå…¥å†…è” æ±‡ç¼–ä»£ç  çš„è¯­è¨€, éƒ½ä¸ç®—ç³»ç»Ÿè¯­è¨€?</p>
<p>ç­‰ç­‰, Python å¥½è±¡ä¹Ÿå¯ä»¥å“ª...
)</p>
<h3 id="ä½¿ç”¨-criterion-å¯¹ä»£ç åŠå…¶ååé‡è¿›è¡ŒåŸºå‡†æµ‹è¯•"><a class="header" href="#ä½¿ç”¨-criterion-å¯¹ä»£ç åŠå…¶ååé‡è¿›è¡ŒåŸºå‡†æµ‹è¯•">ä½¿ç”¨ Criterion å¯¹ä»£ç åŠå…¶ååé‡è¿›è¡ŒåŸºå‡†æµ‹è¯•</a></h3>
<p>ç”¨æ¥å¯¹ Rust ä»£ç è¿›è¡ŒåŸºå‡†æµ‹è¯•çš„ Criterion æ˜¯ä¸€é¡¹äº†ä¸èµ·çš„å·¥ç¨‹ä½œå“;
èƒ½å¸®åŠ©ä½ ä½¿ç”¨å›¾å½¢/å›å½’åˆ†æå’Œå…¶å®ƒå¥‡æ€ªçš„å·¥å…·æ¥è®¿é—®ä»¤äººæ•¬ç•çš„åŸºå‡†æµ‹è¯•åŠŸèƒ½;
ç”šè‡³å¯ä»¥ç”¨æ¥è¡¡é‡å‡½æ•°çš„ä¸åŒç»´åº¦,ä¾‹å¦‚æ—¶é—´å’Œååé‡;
åˆæ¯”å¦‚, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒçš„ç›´æ–¹å›¾ä¸­,ä½¿ç”¨æ ‡å‡†åº“çš„è¿­ä»£å™¨æ–¹æ³•æ„é€ /è·å–å’Œæ”¶é›†åŸå§‹å­—èŠ‚çš„é€Ÿåº¦æœ‰å¤šå¿«;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::iter;

use criterion::BenchmarkId;
use criterion::Criterion;
use criterion::Throughput;
use criterion::{criterion_group, criterion_main};

fn from_elem(c: &amp;mut Criterion) {
    static KB: usize = 1024;

    let mut group = c.benchmark_group(&quot;from_elem&quot;);
    for size in [KB, 2 * KB, 4 * KB, 8 * KB, 16 * KB].iter() {
        group.throughput(Throughput::Bytes(*size as u64));
        group.bench_with_input(BenchmarkId::from_parameter(size), size, |b, &amp;size| {
            b.iter(|| iter::repeat(0u8).take(size).collect::&lt;Vec&lt;_&gt;&gt;());
        });
    }
    group.finish();
}

criterion_group!(benches, from_elem);
criterion_main!(benches);
<span class="boring">}</span></code></pre></pre>
<p>å°†ä»¥ä¸‹æ¡ç›®è¿½åŠ åˆ°é¡¹ç›®çš„ Cargo,toml æ–‡ä»¶ä¸­,
å°±å¯ä»¥ç”¨ cargo bench è¿è¡Œäº†:</p>
<pre><code class="language-toml">[dev-dependencies]
criterion = &quot;0.3&quot;

[[bench]]
name = &quot;BENCH_NAME&quot;
harness = false
</code></pre>
<p>criterion ä¸ä»…å¯ä»¥å‘ä½ å±•ç¤ºéå¸¸æ£’çš„å›¾è¡¨å’Œæè¿°æ€§ä¿¡æ¯,
è€Œä¸”,è¿˜èƒ½è®°ä½åŸºå‡†æµ‹è¯•è¿è¡Œçš„å…ˆå‰ç»“æœ,
å‘Šè¯‰ä½ æ€§èƒ½å›å½’çŠ¶æ€;
åœ¨è¿™ç§æƒ…å†µä¸­,æˆ‘åœ¨è¿è¡ŒåŸºå‡†æµ‹è¯•çš„åŒæ—¶, è¿˜èƒ½ç”¨è®¡ç®—æœºä½œå¾ˆå¤šå…¶å®ƒäº‹å„¿,
æ‰€ä»¥, ä¹Ÿèƒ½è‡ªç„¶çš„é€šæŠ¥ä»ä¸Šæ¬¡æµ‹é‡åé€€åŒ–äº†å¤šå°‘;
æ€»ä¹‹,éå¸¸çš„COOL!</p>
<pre><code>    Found 11 outliers among 100 measurements (11.00%)
      2 (2.00%) low mild
      4 (4.00%) high mild
      5 (5.00%) high severe
    from_elem/8192          time:   [79.816 ns 79.866 ns 79.913 ns]
                            thrpt:  [95.471 GiB/s 95.528 GiB/s 95.587 GiB/s]
                     change:
                            time:   [+7.3168% +7.9223% +8.4362%] (p = 0.00 &lt; 0.05)
                            thrpt:  [-7.7799% -7.3407% -6.8180%]
                            Performance has regressed.
    Found 3 outliers among 100 measurements (3.00%)
      2 (2.00%) high mild
      1 (1.00%) high severe
    from_elem/16384         time:   [107.22 ns 107.28 ns 107.34 ns]
                            thrpt:  [142.15 GiB/s 142.23 GiB/s 142.31 GiB/s]
                     change:
                            time:   [+3.1408% +3.4311% +3.7094%] (p = 0.00 &lt; 0.05)
                            thrpt:  [-3.5767% -3.3173% -3.0451%]
                            Performance has regressed.
</code></pre>
<h3 id="é€šè¿‡é˜…è¯»æ ‡å‡†åº“æ¥ç†è§£å…³é”®æ¦‚å¿µ"><a class="header" href="#é€šè¿‡é˜…è¯»æ ‡å‡†åº“æ¥ç†è§£å…³é”®æ¦‚å¿µ">é€šè¿‡é˜…è¯»æ ‡å‡†åº“æ¥ç†è§£å…³é”®æ¦‚å¿µ!</a></h3>
<p>æˆ‘å–œæ¬¢å¾œå¾‰åœ¨æ ‡å‡†åº“ä¸­,å°¤å…¶æ˜¯ std::rc, std::iter, and std::collections;
ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±ä»ä¸­å­¦ä¹ åˆ°çš„ä¸€äº›å¾ˆèµçš„æŠ€å·§:</p>
<ul>
<li>vec æ˜¯å¦‚ä½•åˆ‡å®å®ç°çš„</li>
<li>é€šè¿‡ std::cell å’Œ std::rc ä¸­çš„ä¸åŒæ–¹æ³•, å®ç°å†…éƒ¨å¯å˜æ€§çš„æ–¹å¼</li>
<li>å¦‚ä½•åœ¨ std::sync ä¸­å®ç°é€šé“</li>
<li>std::sync::Arc çš„é­”åŠ›</li>
<li>äº†è§£ Rust ä½œè€…å¯¹å¼€å‘å¯¹åº”åº“æ—¶,å¦‚ä½•ä½œå‡ºè®¾è®¡å†³ç­–çš„è¯¦å°½è§£é‡Š</li>
</ul>
<p>æœ‰å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ä¸ºè¿›å…¥ Rust å¹¶é‡åˆ°ä¸€äº›éšœç¢çš„äººä»¬æä¾›å¯ç”¨ä¿¡æ¯;
æœŸå¾…æ›´å¤š Rust å†…å®¹èƒ½æ¨å‡º,
å°¤å…¶æ˜¯å…³é”®æ›´é«˜çº§ä¸»é¢˜çš„...</p>
<h3 id="shoutout"><a class="header" href="#shoutout">Shoutout</a></h3>
<p>æ„Ÿè°¢ Offchain Labs åŒäº‹ Rachel å’Œ Lee Bousfield å¯¹è¿™é—¨è¯­è¨€çš„å¹¿æ³›äº†è§£;
ä»–ä»¬çš„ä¸€äº›æŠ€å·§å¯å‘äº†è¿™ç¯‡æ–‡ç« ;</p>
<h2 id="refer-30"><a class="header" href="#refer-30">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/">Rust Bug Minimization Patterns - The {pnk}f(eli)x Blog</a></li>
<li><a href="https://www.thecodedmessage.com/posts/default-params/">Rust and Default Parameters :: The Coded Message</a></li>
<li><a href="https://github.com/sger/RustBooks#advanced-books">sger/RustBooks: List of Rust books</a>
<ul>
<li><a href="https://veykril.github.io/tlborm/decl-macros/macros2.html">Macros 2.0 - The Little Book of Rust Macros</a></li>
<li>...</li>
</ul>
</li>
</ul>
<h2 id="logging-21"><a class="header" href="#logging-21">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>230212 ZQ v1 done</li>
<li>230120 ZQ init.</li>
</ul>
<pre><code>          _~-|-~_
      \) /  o -  \ (/
        '_   â¡   _'
        &gt; '--~--' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="btm"><a class="header" href="#btm">btm</a></h1>
<p><a href="https://crates.io/crates/bottom">bottom - crates.io: Rust Package Registry</a></p>
<h2 id="backgroung-8"><a class="header" href="#backgroung-8">backgroung</a></h2>
<p>ä½œä¸ºä¸€åå·¥ç¨‹å¸ˆ, æ€»æ˜¯å¾—æ—¶åˆ»å…³æ³¨ç³»ç»ŸçŠ¶å†µçš„...</p>
<h2 id="goal-25"><a class="header" href="#goal-25">goal</a></h2>
<p>ç”¨å¥½ç”¨å¯¹å¥½å·¥å…·</p>
<h2 id="trace-23"><a class="header" href="#trace-23">trace</a></h2>
<h3 id="layout"><a class="header" href="#layout">layout</a></h3>
<blockquote>
<p>æ²¡æƒ³åˆ°è¿™ä¹ˆç®€å•...</p>
</blockquote>
<p>å¦‚æœåœ¨ linux ä¸­, é‚£ä¹ˆé…ç½®: 
<code>~/.config/bottom/bottom.toml</code></p>
<p>å¦‚æœè¿½åŠ å£°æ˜:</p>
<pre><code class="language-toml">[[row]]
  [[row.child]]
  type=&quot;cpu&quot;
[[row]]
    ratio=3
    [[row.child]]
      ratio=4
      type=&quot;proc&quot;
    [[row.child]]
      ratio=3
      [[row.child.child]]
        ratio=2
        type=&quot;mem&quot;
      [[row.child.child]]
        ratio=2
        type=&quot;net&quot;
      [[row.child.child]]
        ratio=1
        type=&quot;disk&quot;
</code></pre>
<p>ä¿å­˜å, å†æ¬¡è°ƒç”¨ <code>btm</code> åˆ™æ˜¯è¿™æ ·çš„æ’ç‰ˆ:</p>
<p><img src="https://ipic.zoomquiet.top/2023-03-06-zshot%202023-03-06%2011.15.40.jpg" alt="btm" /></p>
<p>å¯¹åº”è§£é‡Šå¾ˆç®€æ´:</p>
<ul>
<li>ç¬¬1è¡Œ
<ul>
<li>ç¬¬1å­è¡Œ</li>
<li>CPU ç‰ˆå—</li>
</ul>
</li>
<li>ç¬¬2è¡Œ
<ul>
<li>å’Œç¬¬1è¡Œæ˜¯ 1:3 æ¯”ä¾‹</li>
<li>ç¬¬1åˆ—
<ul>
<li>å’Œç¬¬2åˆ—/å³åˆ—æ¯”ä¾‹ä¸º 4:3</li>
<li>è¿›ç¨‹ç‰ˆå—</li>
</ul>
</li>
<li>ç¬¬2åˆ—
<ul>
<li>å’Œç¬¬1åˆ—/å·¦åˆ—æ¯”ä¾‹ä¸º 3:4</li>
<li>ç¬¬1è¡Œ
<ul>
<li>å’Œå…¶å®ƒå­è¡Œæ¯”ä¾‹ä¸º 2:2:1</li>
<li>å†…å­˜ç‰ˆå—</li>
</ul>
</li>
<li>ç¬¬2è¡Œ
<ul>
<li>å’Œå…¶å®ƒå­è¡Œæ¯”ä¾‹ä¸º 2:2:1</li>
<li>ç½‘ç»œç‰ˆå—</li>
</ul>
</li>
<li>ç¬¬3è¡Œ
<ul>
<li>å’Œå…¶å®ƒå­è¡Œæ¯”ä¾‹ä¸º 2:2:1</li>
<li>ç¡¬ç›˜ç‰ˆå—</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å› ä¸ºä¸€èˆ¬éƒ½æ˜¯è™šæ‹Ÿæœº, æ¸©åº¦ä»€ä¹ˆçš„æ ¹æœ¬æ²¡æœ‰, æ‰€ä»¥, å€¼å¾—å®šåˆ¶å¹¶ä¼˜åŒ–ä½ç½®, ä»¥ä¾¿ç¬¬ä¸€æ—¶é—´å…³æ³¨åˆ°,
ç›¸æ¯” <a href="https://nmon.sourceforge.net/pmwiki.php">nmon for Linux | Main / HomePage</a> åªèƒ½é€‰æ‹©ä¿¡æ¯ç‰ˆå—,æ— æ³•å®šåˆ¶å…·ä½“æ’ç‰ˆæ¥, btm è¦è‡ªåœ¨çš„å¤š;</p>
<h2 id="refer-31"><a class="header" href="#refer-31">refer.</a></h2>
<p><a href="https://clementtsang.github.io/bottom/nightly/#contribution">Home - bottom</a></p>
<ul>
<li><a href="https://clementtsang.github.io/bottom/nightly/usage/widgets/battery/">General Usage - bottom</a></li>
<li><a href="https://clementtsang.github.io/bottom/nightly/configuration/config-file/data-filtering/">Layout - bottom</a></li>
<li>...</li>
</ul>
<pre><code>        _~`&amp;-~_
    \/ /  - â—•  \ \/
      '_   âµ   _'
      \ '--.--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æŠ€å·§"><a class="header" href="#æŠ€å·§">æŠ€å·§</a></h1>
<blockquote>
<p>tips...é‡è¦ä¹Ÿä¸é‡è¦</p>
</blockquote>
<h2 id="background-20"><a class="header" href="#background-20">background</a></h2>
<blockquote>
<p>æ— å¥ˆèƒŒæ™¯</p>
</blockquote>
<p>åˆšåˆšå¼€å§‹æ„Ÿè§‰å“ªå„¿å“ªå„¿éƒ½è¦æœ‰æŠ€å·§, å…¶å®ä¸ä¸€å®š...</p>
<h2 id="goal-26"><a class="header" href="#goal-26">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>å°†ä¸€å¤´åˆæ ¼ Rustaceans å€¼å¾—è®°å¿†çš„åŸºæœ¬æŠ€å·§,
æ”¶é›†åˆ° 42% å·¦å³...</p>
<h2 id="trace-24"><a class="header" href="#trace-24">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<p>???</p>
<h2 id="refer-32"><a class="header" href="#refer-32">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://rust-lang.github.io/rfcs/introduction.html#when-you-need-to-follow-this-process">Introduction - The Rust RFC Book</a></p>
<ul>
<li><a href="https://evanhahn.com/the-lone-developer-problem/">The lone developer problem</a>
<ul>
<li>...å°å¿ƒ<code>å­¤ç‹¬å¼€å‘è€…ç»¼åˆç—‡</code>...</li>
</ul>
</li>
<li>...</li>
</ul>
<h3 id="gpts"><a class="header" href="#gpts">GPTs</a></h3>
<blockquote>
<p>é€šç”¨ä»»åŠ¡</p>
</blockquote>
<ul>
<li>ChatGPT ç›¸å…³
<ul>
<li>ChatGPT for StackOverflow (https://stackoverflow.gg/) æŸ¥çœ‹ ChatGPT å¯¹ StackOverflow ä¸Šæ¯ä¸ªé—®é¢˜çš„å›å¤ï¼Œç”šè‡³æ˜¯æœªå›ç­”çš„é—®é¢˜</li>
<li>ChatGPT Detector (https://huggingface.co/spaces/Hello-SimpleAI/chatgpt-detector-single) åˆ¤æ–­æ–‡æœ¬æ˜¯å¦æ˜¯AIç”Ÿæˆ</li>
</ul>
</li>
<li>poe (https://quorablog.quora.com/Poe-1) quoraå‡ºå“çš„å¯¹è¯å¼AIå·¥å…·</li>
<li>tweetmonk (https://tweetmonk.com/) AIå¸®ä½ æ‰“ç†ç¤¾äº¤ç½‘ç»œ</li>
</ul>
<blockquote>
<p>å¼€å‘ä»»åŠ¡</p>
</blockquote>
<ul>
<li>README ç”Ÿæˆå™¨ (https://readme.rustc.cloud/zh) ç”¨AIç”Ÿæˆå®Œæ•´çš„GitHub readme</li>
</ul>
<blockquote>
<p>è®¾è®¡ä»»åŠ¡</p>
</blockquote>
<ul>
<li>å›¾åƒ:
<ul>
<li>Galileo AI (https://www.usegalileo.ai/) ç”¨AIè®¾è®¡ç”ŸæˆUIè®¾è®¡</li>
<li>animeai (https://animeai.app/) AIç”Ÿæˆæ¼«ç”»é£æ ¼å›¾ç‰‡</li>
<li>autodraw (https://www.autodraw.com/) AIè¾…åŠ©ç»˜ç”»</li>
<li>latentlabs (https://www.latentlabs.art/) æ ¹æ®æ–‡æœ¬ç”Ÿæˆ 360 åº¦å…¨æ™¯å›¾</li>
<li>playgroudai (https://playgroundai.com/) è·å–AIç»˜å›¾æç¤ºè¯ï¼Œå¸®åŠ©ä½ ç¼–è¾‘å›¾ç‰‡</li>
<li>stockimg (https://stockimg.ai/) AIè®¾è®¡å›¾æ ‡</li>
</ul>
</li>
<li>å£°éŸ³:
<ul>
<li>image-to-sound-fx (https://huggingface.co/spaces/fffiloni/image-to-sound-fx) å›¾ç‰‡è½¬æ¢ä¸ºç›¸å¯¹åº”çš„å£°éŸ³å†…å®¹</li>
<li>MetaVoice Studio (https://studio.themetavoice.xyz/) AIå£°éŸ³ç¼–è¾‘å¹³å°</li>
</ul>
</li>
<li>è§†é¢‘:
<ul>
<li>invideo (https://invideo.io/ai/) æ ¹æ®æ–‡æœ¬ç”Ÿæˆè§†é¢‘</li>
<li>murf (https://murf.ai/) AIç”ŸæˆçœŸäººæ¼”è®²è§†é¢‘</li>
<li>tosummary (https://tosummary.com/) åˆ©ç”¨AIæå–ä¹¦ç±ã€YouTubeè§†é¢‘æ‘˜è¦</li>
</ul>
</li>
</ul>
<blockquote>
<p>åŠå…¬ä»»åŠ¡</p>
</blockquote>
<ul>
<li>æ–‡æ¡£:
<ul>
<li>å‘¨æŠ¥ç”Ÿæˆå™¨ (https://weeklyreport.avemaria.fun/zh) ç®€å•æè¿°å·¥ä½œå†…å®¹ï¼Œå¸®ä½ ç”Ÿæˆå®Œæ•´å‘¨æŠ¥</li>
<li>email-helper (https://email-helper.vercel.app/) AIå¸®ä½ å†™é‚®ä»¶</li>
<li>campbell (https://review.gobudapest.io/) AIç”Ÿæˆè¯„è¯­</li>
<li>penlope (https://penelopeai.com/) AIè¾…åŠ©markdownç¼–è¾‘å™¨</li>
</ul>
</li>
<li>å¤§çº²:
<ul>
<li>bearly (https://bearly.ai/) AIå¸®åŠ©ä½ é˜…è¯»ã€åˆ›ä½œï¼Œæ’°å†™ï¼Œæé«˜ä½ çš„å·¥ä½œæ•ˆç‡</li>
<li>humata (https://app.humata.ai/signin) åˆ©ç”¨AIæ¥åˆ†æè®ºæ–‡å†…å®¹</li>
</ul>
</li>
<li>docuchat (https://www.docuchat.io/) ä¸Šä¼ æ–‡æ¡£ï¼ŒAIå›ç­”å¯¹åº”çš„é—®é¢˜</li>
</ul>
<h2 id="logging-22"><a class="header" href="#logging-22">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>221023 ZQ init.</li>
</ul>
<pre><code>         _~~+âˆ½~_
     \/ /  â† â—´  \ ()
       '_   â¡   _'
       \ '--âŒ„--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="awesomers"><a class="header" href="#awesomers">Awesome.rs</a></h1>
<blockquote>
<p>Rust ä¸–ç•Œä¸­æœ€é”ˆçš„é‚£æ‰¹å¥½ä¸œè¥¿</p>
</blockquote>
<h2 id="background-21"><a class="header" href="#background-21">background</a></h2>
<p>æ— è®ºè¿›å…¥å“ªä¸ªæŠ€æœ¯æ ˆ, éƒ½é¢ä¸´ä¸€ä¸ªé—®é¢˜:</p>
<blockquote>
<p>å¦‚ä½•è±¡è€æ‰‹é‚£æ ·, å¿«é€Ÿå®Œæˆä»»åŠ¡?</p>
</blockquote>
<h2 id="goal-27"><a class="header" href="#goal-27">goal</a></h2>
<ul>
<li>æ”¶é›†/æ•´ç†/ä½“éªŒ/ç§¯ç´¯/...</li>
<li>å„ç§å¸¸è§é¢†åŸŸä¸­, æœ€èˆ’æœçš„ crate  ç»„åˆ</li>
<li>...</li>
</ul>
<h2 id="refer-33"><a class="header" href="#refer-33">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://github.com/JohnBSmith/moss">Awesome Rank for rust-unofficial/awesome-rust</a></li>
<li><a href="https://github.com/rust-unofficial/awesome-rust">rust-unofficial/awesome-rust: A curated list of Rust code and resources.</a></li>
<li><a href="http://zsiciarz.github.io/24daysofrust/index.html">Introduction | 24 days of Rust</a></li>
<li><a href="https://wangchujiang.com/rust-cn-document-for-docker/rust-cookbook/intro.html">æ€»è§ˆ - Rust Cookbook ä¸­æ–‡ç‰ˆ - A Rust Cookbook</a></li>
<li>...</li>
</ul>
<h2 id="logging-23"><a class="header" href="#logging-23">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230301 ZQ init.</li>
</ul>
<pre><code>      _~`+âˆ½~_
  \/ /  * â—´  \ ()
    '_   â©Œ   _'
    / '--.--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="handlebars"><a class="header" href="#handlebars">Handlebars</a></h1>
<blockquote>
<p>Minimal templating on steroids</p>
</blockquote>
<h2 id="background-22"><a class="header" href="#background-22">background</a></h2>
<p>æƒ³å®Œæˆä¸€ä¸ªç®€å•çš„ç»ˆç«¯åŠ¨ç”» crate æ—¶å‘ç° (<a href="tip/./dev/cli_ferris_art.html">Ferrisè‰ºæœ¯</a>)</p>
<h2 id="goal-28"><a class="header" href="#goal-28">goal</a></h2>
<p>20% æœ€å¸¸ç”¨å¯æ”¯æŒ 80% åœºæ™¯ç”¨æ ¸å¿ƒçŸ¥è¯†ç‚¹</p>
<h2 id="notes"><a class="header" href="#notes">notes</a></h2>
<h2 id="refer-34"><a class="header" href="#refer-34">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://doc.rust-lang.org/std/fmt/index.html">std::fmt - Rust</a></p>
<ul>
<li><a href="https://doc.rust-lang.org/std/macro.format_args.html">format_args in std - Rust</a></li>
<li><a href="https://casualhacks.net/blog/2022-06-24/reinventing-rust-fmt/">Reinventing Rust formatting syntax</a></li>
<li>...</li>
</ul>
<p><a href="https://crates.io/crates/handlebars">handlebars - crates.io: Rust Package Registry</a></p>
<ul>
<li><a href="https://docs.rs/handlebars/4.3.6/handlebars/index.html">handlebars - Rust</a>
<ul>
<li><a href="https://github.com/sunng87/handlebars-rust#readme">sunng87/handlebars-rust: Rust templating with Handlebars</a></li>
<li><a href="https://handlebarsjs.com/">Handlebars</a></li>
<li><a href="https://handlebarsjs.com/zh/guide/">ä»‹ç» | Handlebars</a></li>
</ul>
</li>
<li><a href="https://crates.io/crates/tinytemplate">tinytemplate - crates.io: Rust Package Registry</a></li>
<li>...</li>
</ul>
<h2 id="logging-24"><a class="header" href="#logging-24">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230301 ZQ init.</li>
</ul>
<pre><code>      _~`+~~_
  \) /  &gt; *  \ (/
    '_   â™¢   _'
    &gt; '--+--' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tracing-3"><a class="header" href="#tracing-3">tracing</a></h1>
<blockquote>
<p>ä¸€æ­¥åˆ°ä½æ—¥å¿—å·¥å…·?</p>
</blockquote>
<h2 id="background-23"><a class="header" href="#background-23">background</a></h2>
<p>æ— è®ºå“ªç§çº§åˆ«çš„å¼€å‘,
ä¸€ä¸ªæ—¥å¿—å·¥å…·æ˜¯å¿…è¦çš„,
å¦åˆ™,å‘ç”Ÿç‚¹å„¿ä»€ä¹ˆäº‹å„¿, ä¸€ç‚¹å„¿æ•°æ®/é…ç½®/...çš„æ®‹å½±éƒ½æ²¡æœ‰é‚£æ˜¯çœŸä¸€ç‚¹å„¿åŠæ³•ä¹Ÿæ²¡æœ‰...</p>
<h2 id="goal-29"><a class="header" href="#goal-29">goal</a></h2>
<ul>
<li>Rust åŸç”Ÿ</li>
<li>æˆç†Ÿ</li>
<li>æ”¯æŒå¤šç§æ ¼å¼/é…ç½®/å®šåˆ¶/...</li>
<li>æ–‡æ¡£å®Œå¤‡, å®‰è£…æµç•…, æ²¡æœ‰æ€¥è½¬å¼¯....</li>
</ul>
<h2 id="trace-25"><a class="header" href="#trace-25">trace</a></h2>
<h3 id="install"><a class="header" href="#install">install</a></h3>
<p>Cargo.toml ä¸­è¿½åŠ :</p>
<pre><code>[dependencies]
log = &quot;0.4&quot;
tracing = &quot;0.1&quot;
clia-tracing-config = &quot;0.2&quot;
</code></pre>
<blockquote>
<p>$ cargo check </p>
</blockquote>
<p>è‡ªåŠ¨å®‰è£…å¯¹åº” crate</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() -&gt; Result&lt;()&gt;{

    let _guard = clia_tracing_config::build()
        .filter_level(&quot;debug&quot;)//fatal,error,warn,info,debug
        .with_ansi(true)
        .to_stdout(false)
        .directory(&quot;./log&quot;)
        .file_name(&quot;debug.log&quot;)
        .rolling(&quot;daily&quot;)
        .init();

/// ...

    Ok(())

}</code></pre></pre>
<p>åœ¨éœ€è¦çš„åœºæ™¯ä¸­å®šä¹‰ä¸ª <code>_guard</code> å°±å®Œæˆäº†æ‰€æœ‰å…³é”®é…ç½®,
è¿™æ˜¯ç”± <code>clia-tracing-config</code> å®ç°çš„,</p>
<p>ç°åœ¨, å°±å¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>log::debug!(&quot;{}&quot;, foobar);
log::info!(&quot;{}&quot;, foobar);
log::warn!(&quot;{}&quot;, foobar);
log::error!(&quot;{}&quot;, foobar);
<span class="boring">}</span></code></pre></pre>
<p>è¿›è¡Œæ—¥å¿—è¾“å‡º, è€Œä¸”æ¯å¤©è‡ªåŠ¨æ´»åŠ¨, ä½†æ˜¯, æœ‰è‡ªåŠ¨ link ,
å¯ä»¥ä½¿ç”¨ <code>tail -f </code> ä¸€ç›´è¿½è¸ªè§‚å¯Ÿ;</p>
<pre><code>é¡¹ç›®/
    +- Cargo.toml
    +- README.md
    +- src/
    |   +- main.rs
    +- tests/
    |   +- cli.rs
    +- log/
    |   +- debug.log -&gt; debug.log.2023-02-25
    |   +- ...
    |   +- debug.log.2023-02-23
    |   `- debug.log.2023-02-25
    ...
</code></pre>
<h2 id="refer-35"><a class="header" href="#refer-35">refer.</a></h2>
<blockquote>
<p>å„ç§å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://awesomerank.github.io/lists/rust-unofficial/awesome-rust.html#cryptocurrencies">Awesome Rank for rust-unofficial/awesome-rust</a>
<ul>
<li><a href="https://github.com/rust-unofficial/awesome-rust">rust-unofficial/awesome-rust: A curated list of Rust code and resources.</a></li>
<li>å…ˆä»ç¤¾åŒºçŸ¥é“ logging æ¨¡å—çš„å¤§çº¦èŒƒç•´</li>
</ul>
</li>
<li><a href="https://blog.logrocket.com/comparing-logging-tracing-rust/">Comparing logging and tracing in Rust - LogRocket Blog</a>
<ul>
<li><a href="https://privaterookie.github.io/posts/2020-02-03-log4rs-Rust-log%E5%BA%93.html">log4rs-Rust-logåº“ - å¤œé›¨ç§‹ç¯å½•</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10252834">åœ¨ Rust ä¸­ä½¿ç”¨ logï¼š log / slog / tracing - iT é‚¦å¹«å¿™</a></li>
<li>å†ä»å¯¹æ¯”ä¸­å®šä½ç›®æ ‡</li>
</ul>
</li>
<li><a href="https://choosealicense.com/licenses/mit">tracing - crates.io: Rust Package Registry</a>
<ul>
<li><a href="https://course.rs/logs/tracing.html">ä½¿ç”¨ tracing è®°å½•æ—¥å¿— - Rustè¯­è¨€åœ£ç»(Rust Course)</a></li>
<li><a href="https://crates.io/crates/clia-tracing-config">clia-tracing-config - crates.io: Rust Package Registry</a></li>
</ul>
</li>
<li>...</li>
</ul>
<pre><code>           _~âˆ½~^~_
       \) /  â—¶ â†’  \ (/
         '_   â¡   _'
         &gt; '--#--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tracing-4"><a class="header" href="#tracing-4">tracing</a></h1>
<blockquote>
<p>ä¸€æ­¥åˆ°ä½æ—¥å¿—å·¥å…·?</p>
</blockquote>
<h2 id="background-24"><a class="header" href="#background-24">background</a></h2>
<p>ä¸€ä¸ª 5M å·¦å³çš„ toml ç”¨ rust åŠ è½½æ—¶ç«Ÿç„¶æ¯” Python è¿˜è¦æ…¢</p>
<h2 id="goal-30"><a class="header" href="#goal-30">goal</a></h2>
<ul>
<li>Rust åŸç”Ÿ</li>
<li>åˆç†åŠ é€Ÿ</li>
<li>é€šç”¨...</li>
</ul>
<h2 id="trace-26"><a class="header" href="#trace-26">trace</a></h2>
<blockquote>
<p>Q: </p>
</blockquote>
<p>rust ä¸­ File::open() æ‰“å¼€ä¸€ä¸ªå¤§çš„æ–‡æœ¬æ–‡ä»¶æ—¶å¾ˆæ…¢,
æœ‰ä»€ä¹ˆåŠ é€Ÿçš„åŠæ³•?</p>
<blockquote>
<p>A:</p>
</blockquote>
<p>åœ¨ Rust ä¸­ï¼ŒFile::open() ç”¨äºæ‰“å¼€æ–‡ä»¶å¹¶è¿”å› std::fs::File ç±»å‹çš„å¯¹è±¡ã€‚å¦‚æœæ‰“å¼€çš„æ–‡ä»¶éå¸¸å¤§ï¼Œæ‰“å¼€è¿‡ç¨‹å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºç³»ç»Ÿéœ€è¦ä»ç¡¬ç›˜ä¸­è¯»å–å¤§é‡çš„æ•°æ®ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›åŠ é€Ÿæ‰“å¼€å¤§å‹æ–‡æœ¬æ–‡ä»¶çš„æ–¹æ³•ï¼š</p>
<ol>
<li>ä½¿ç”¨ BufReader
Rust ä¸­çš„ BufReader å¯ä»¥å°†æ–‡ä»¶è¯»å–åˆ°å†…å­˜ç¼“å†²åŒºä¸­ï¼Œå¹¶æŒ‰éœ€å°†å…¶è¯»å–åˆ°ç¨‹åºä¸­ã€‚ä½¿ç”¨ BufReader å¯ä»¥åŠ å¿«è¯»å–é€Ÿåº¦ã€‚</li>
</ol>
<pre><pre class="playground"><code class="language-rust edition2021">use std::io::{BufReader, BufRead};
use std::fs::File;

fn main() {
    let file = File::open(&quot;file.txt&quot;).unwrap();
    let reader = BufReader::new(file);

    for line in reader.lines() {
        println!(&quot;{}&quot;, line.unwrap());
    }
}
</code></pre></pre>
<ol>
<li>ä½¿ç”¨å¼‚æ­¥ I/O
Rust ä¸­çš„å¼‚æ­¥ I/O å¯ä»¥ä½¿ç¨‹åºåœ¨è¯»å–æ–‡ä»¶æ—¶ä¸ä¼šè¢«é˜»å¡ã€‚å¼‚æ­¥ I/O å¯ä»¥ä½¿ç”¨ tokio åº“å®ç°ã€‚</li>
</ol>
<pre><pre class="playground"><code class="language-rust edition2021">use tokio::fs::File;
use tokio::io::{self, AsyncBufReadExt};

#[tokio::main]
async fn main() -&gt; io::Result&lt;()&gt; {
    let file = File::open(&quot;file.txt&quot;).await?;
    let reader = io::BufReader::new(file);

    let mut lines = reader.lines();

    while let Some(line) = lines.next_line().await? {
        println!(&quot;{}&quot;, line);
    }

    Ok(())
}
</code></pre></pre>
<ol>
<li>ä½¿ç”¨å¤šçº¿ç¨‹
ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥åŠ é€Ÿæ–‡ä»¶çš„è¯»å–å’Œå¤„ç†ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚å¯ä»¥ä½¿ç”¨ Rust ä¸­çš„ rayon åº“å®ç°å¹¶è¡Œå¤„ç†ã€‚</li>
</ol>
<pre><pre class="playground"><code class="language-rust edition2021">use std::fs::File;
use std::io::{BufRead, BufReader};
use rayon::prelude::*;

fn main() {
    let file = File::open(&quot;file.txt&quot;).unwrap();
    let reader = BufReader::new(file);
    let lines = reader.lines().collect::&lt;Result&lt;Vec&lt;String&gt;, _&gt;&gt;().unwrap();

    let result = lines.par_iter().map(|line| {
        // å¤„ç†æ¯ä¸€è¡Œ
        line.to_uppercase()
    }).collect::&lt;Vec&lt;String&gt;&gt;();

    // å¤„ç†ç»“æœ
    println!(&quot;{:?}&quot;, result);
}
</code></pre></pre>
<h2 id="refer-36"><a class="header" href="#refer-36">refer.</a></h2>
<blockquote>
<p>å„ç§å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://doc.rust-lang.org/stable/std/io/struct.BufReader.html#examples">BufReader in std::io - Rust</a></li>
<li><a href="https://crates.io/crates/tokio">tokio - crates.io: Rust Package Registry</a></li>
<li><a href="https://crates.io/crates/rayon">rayon - crates.io: Rust Package Registry</a></li>
<li>...</li>
</ul>
<pre><code>        _~^~-~_
    () /  = â†’  \ ()
      '_   ğŸ‚   _'
      / '--+--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bmpæœ€å°bugæ¨¡å¼"><a class="header" href="#bmpæœ€å°bugæ¨¡å¼">BMP:æœ€å°bugæ¨¡å¼</a></h1>
<p>åŸæ–‡: <a href="http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/">Rust Bug Minimization Patterns - The {pnk}f(eli)x Blog</a></p>
<blockquote>
<p>Update 19 November 2019: fixed miscellaneous typos and a bug in the invariance example pointed out by readers both privately and on reddit thread. I also added a section near the beginning to draw attention to techniques that are somewhat Rust-specific and may not be broadly known.</p>
</blockquote>
<blockquote>
<p>å¿«è¯‘:</p>
</blockquote>
<p>Hey there again!</p>
<p>I have been pretty busy with Rust compiler tasks, so no there has not been a blog post for a few months. But now, here we are!</p>
<p>While I was working some particularly nasty bugs recently, I put a lot of effort into bug minimization: the process of taking a large test case and finding ways to remove code from the test while preserving the testâ€™s ability to expose the same bug.</p>
<p>As I worked, I realized that I was following a somewhat mechanical process. I was using regular patterns for code transformation. At some point, I said â€œyou know, Iâ€™m not sure if everyone is aware of these patterns. I only remember some of them while I am in the middle of a bug minimization session.â€</p>
<p>Since the Rust compiler team always wants to help newcomers learn ways they can contribute to the project, I realized this could be the ideal subject for a blog post.</p>
<p>And, to try to keep things concrete, Iâ€™m going to try to drive the presentation by showing an actual bug being minimized. (Or rather, Iâ€™m going to recreate the minimization that I already did. So if it seems like I am rather conveniently picking transformations that always seem to work: Youâ€™re right! Iâ€™m cheating and not telling you about all the false paths I went down during my first minimization odyssey on this bug.</p>
<h2 id="the-rust-specifics"><a class="header" href="#the-rust-specifics">The Rust specifics</a></h2>
<p>Oh, and one other thing: A lot of the ideas here are applicable to many languages, and so its possible readers have already heard about them or discovered them independently.</p>
<p>However, a few of the techniques leverage features that are not universal to languages outside of Rust.</p>
<p>Specifically:</p>
<ul>
<li>â€œcfgmentingâ€ makes use of Rustâ€™s attribute system to remove items in a lightway fashion.</li>
<li>â€œloopificationâ€ makes use of the fact that the Rust allows the divergent expression loop { } to be assigned any type.</li>
<li>â€œloopificationâ€ via pretty-printer leverages the compilerâ€™s (unstable) ability to inject loop { } for all function bodies.</li>
<li>Bisecting the module tree makes use of Rustâ€™s support for a mix of inline and out-of-line modules to allow one to quickly swap code in and out.</li>
</ul>
<p>So, without further ado: here is the odyssey of my minimization of rust-lang/rust#65774</p>
<hr />
<h2 id="philosophical-meandering"><a class="header" href="#philosophical-meandering">Philosophical meandering</a></h2>
<h3 id="what-does-minimal-mean-anyway"><a class="header" href="#what-does-minimal-mean-anyway">What does â€œminimalâ€ mean anyway?</a></h3>
<p>The objective of a â€œminimalâ€ test case could mean minimize lines of code; or the number of characters. It is also good to minimize the number of source files: one file, cut-and-pastable into play.rust-lang.org, is especially desirable.</p>
<blockquote>
<p>One could even argue that the number of nodes in the abstract syntax tree is a better metric to use than text-oriented metrics when minimizing.</p>
</blockquote>
<p>Minimizing the source test in this way can yield a good candidate for a regression test to add to the compiler test suite when the bug is (hopefully) eventually fixed.</p>
<p>But those syntactic metrics of minimality overlook something: My own end goal when minimizing the code for a bug is a better understanding of the bug: a better understanding for myself, and for other developers who are reading the test case.</p>
<blockquote>
<p>I am writing this post from the viewpoint of a rustc developer. So I may have a slightly skewed view on what is useful or minimal.And for such understanding, there are other metrics to keep in mind:</p>
</blockquote>
<ul>
<li>Minimize the amount of time the compiler runs before it hits the bug.</li>
</ul>
<p>Minimizing the compilerâ€™s execution time before failure serves two purposes:</p>
<ol>
<li>It makes every future run of this test faster, which can accelerate your pace of minimization.</li>
<li>When the rustc developers themselves examine the behavior of the compiler on the test, they will be grateful to have a shorter execution trace of the compiler to analyze.</li>
</ol>
<p>(Such time reduction often occurs anyway when you remove lines of code and/or dependencies; I just want to point out that it has value in its own right.)</p>
<blockquote>
<p>As a concrete example of how reducing imports may help expose a bugâ€™s root cause: some people will have a bug that occurs with some combination of #[derive(Debug)] and a call to format! or write, and the test showing the problem may be only a few lines long. But it hides a lot of complexity behind those uses of derive, macros, and std::io trait machinery; a longer test that defines its own trait, a local impl of that trait, and a small function illustrating the same bug, may make the bug more immediately apparent to a rustc developer.</p>
</blockquote>
<ul>
<li>Minimize dependencies: reduce the number of language features in use and the number of imports your test uses from other crates (including the std library!).</li>
</ul>
<p>This can help expose the essential cause of the bug, potentially making it immediately apparent what is occurring.</p>
<ul>
<li>Minimize your jumping around in the source code.</li>
</ul>
<p>If you can fit all the code needed to recreate the bug onto your monitor screen at once, by any means necessary, that is a serious accomplishment. Less time spent scrolling through a file or switching editor windows is more time you can spend thinking about the bug itself.</p>
<p>To be clear: Often a minimum amount of code needed for understanding does correlate with a minimum amount of code needed for reproduction. (This explains why using lines-of-code or the size of the syntax tree as a metric can be useful when reporting a bug.)</p>
<p>The over-arching goal in minification is to remove all distractions: to reduce the problematic input (in this case, Rust source code) to its essence: a minimal amount necessary to understand the problem.</p>
<h3 id="why-not-build-it-up-from-scratch"><a class="header" href="#why-not-build-it-up-from-scratch">Why not build it up from scratch?</a></h3>
<p>Its worth pointing out that at some point, maybe even at the outset, you may have a sufficiently rich understanding of the bug that you can go straight to building up a minimal example from scratch. And thatâ€™s great , go for it!</p>
<p>However, this post is dedicated to the problem of what you can do when you havenâ€™t hit that level of understanding. When youâ€™re looking at a set of files that make up over 90,000 lines of code, you want a set of semi-mechanical techniques to take that test input and strip it down to its essence.</p>
<p>To be honest, the most effective methodology is going to use a blend of build-up and tear-down. As you are tearing down the 90,000 lines of code, there should be a voice in the back of your head asking â€œcan we now try what weâ€™ve learned to try to build up a minimal example?â€</p>
<hr />
<h2 id="assumptions-and-conventions"><a class="header" href="#assumptions-and-conventions">Assumptions and Conventions</a></h2>
<blockquote>
<p>Some of the techniques may also be applicable to cases where the compiler is accepting code that it should be rejecting; but I am little wary of advertising these tools for use in that context, which is why youâ€™re reading this in the margin and not the main text.</p>
</blockquote>
<p>The tests I am talking about minimizing in this post are cases where the compiler itself fails in some way: an ICE, a link failure, or rejecting code that it should be accepting. Bugs that are witnessed by actually running the generated code are, for the most part, not covered by the patterns here. In particular: many of the patterns presented here rely on making semantic changes to the input: changing values, or replacing complex expressions with something trivial like loop { }.</p>
<p>I named each transformation, usually with absurd made-up words like â€œunusedificationâ€. They are all in explicit quotation marks to try to make it clear that I am speaking nonsense, deliberately.</p>
<blockquote>
<p>I had originally planned to structure this post so that all transformations for a given theme would be present together, so that youâ€™d see all the transformations for that theme at once. But as I wrote, it became clear over the course of actually doing a reduction, then we often bounce around between transformations, and it usually does not end up being nicely grouped with all transformations for one theme colocated in time. So rather than using that hierarchical presentation, I am instead just going to try to mention the grouping by marking each as transformation being part of a â€œthemeâ€.Several of the transformations serve similar goals, like â€œdelete the unnecessaryâ€. I have attempted to categorize the different tranformations according to what purpose they serve in the minimization process. Over the course of documenting these transformations, I identified the following themes:</p>
</blockquote>
<ul>
<li>Simplify Workflow: Make your own life easier.
<ul>
<li>Enable Incremental Steps</li>
</ul>
</li>
<li>Delete the Unnecessary: Remove items not related to bug!</li>
<li>Identify the Unnecessary: Eliminate accidental necessity.</li>
<li>Trivialize Content: Turn complex expressions to trivial ones.</li>
<li>Eliminate Coupling: Break links between items.</li>
</ul>
<h2 id="notes-on-notation"><a class="header" href="#notes-on-notation">Notes on Notation</a></h2>
<p>In this post, I follow typical notation by using ... as a placeholder for (possibly relevant) code that will be kept approximately the same (modulo mechanical updates like alpha-renaming) by a transformation. However, I also use the non-standard notation of ---- for irrelevant code that removed via a transformation. This is meant to draw attention to the distinct kinds of code, so that you can more easily tell which code is being removed by a particular transformation.</p>
<p>Sometimes I will show an explicit regexp that I am feeding to a tool to do the transformation, but usually I will stick to informal patterns with the aforementioned ... and ---- placeholders.</p>
<p>When a given item or expression can appear within the context of a middle of a sequence (e.g. consider { ... THING ... }), I often use the standard shorthand of just writing { THING ... } or { ... THING }, to simplify the textual presentation and focus attention on the transformation itself.</p>
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h2 id="record-your-steps"><a class="header" href="#record-your-steps">Record your steps</a></h2>
<p>Before you do any reduction, move the test case into its own local git repository (or whatever versioning tool you prefer: SVN, RCS, etc). Being able to backtrack through previous reduction steps is an incredibly important option when doing this kind of of work.</p>
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h2 id="continuously-test-the-test"><a class="header" href="#continuously-test-the-test">Continuously test the test.</a></h2>
<p>Finally: A crucial part of reduction is to continuously double-check that the bug still reproduces after every reduction step. Iâ€™ll show the command line invocation on occasion, but not every command line build invocation (the output is usually the same on every run, so it would just clog up the flow of the presentation here). But even though I donâ€™t show every invocation, you can believe that I was doing the runs. (And in the cases where I tried to skip doing a run, I usually regretted it and had to backtrace my steps to the state before an attempted reduction.)</p>
<p>Make it easy to do your runs. Use your IDE. I use emacs, so I make a M-x compile invocation that runs the compiler with the right arguments, and then you can hit g in the <em>compilation</em> buffer to re-run the compile.</p>
<hr />
<h2 id="the-test-case"><a class="header" href="#the-test-case">The test case</a></h2>
<p>As I mentioned at the start: The presentation here will be driven by referencing a concrete test case that I reduced recently: we have been given a crate graph, and we can observe a bug when we build as follows:</p>
<pre><code>
% ( cd tock/boards/arty-e21/ &amp;&amp; \
    RUSTFLAGS=&quot;-C link-arg=-Tlayout.ld&quot; \
    cargo build --target riscv32imac-unknown-none-elf )
   Compiling tock-registers v0.4.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/tock-register-interface)
   Compiling tock-cells v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/tock-cells)
   Compiling tock_rt0 v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/tock-rt0)
   Compiling enum_primitive v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/enum_primitive)
   Compiling kernel v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/kernel)
   Compiling riscv-csr v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/riscv-csr)
   Compiling rv32i v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/arch/rv32i)
   Compiling capsules v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/capsules)
   Compiling sifive v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/chips/sifive)
   Compiling arty_e21 v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/chips/arty_e21)
   Compiling components v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/boards/components)
   Compiling arty-e21 v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/boards/arty-e21)
error: internal compiler error: src/librustc/traits/codegen/mod.rs:127: Encountered errors `[FulfillmentError(Obligation(predicate=Binder(TraitPredicate(&lt;() as core::fmt::Display&gt;)), depth=1),Unimplemented)]` resolving bounds after type-checking
</code></pre>
<p>In reality the command line was a little more complicated:</p>
<pre><code class="language-shell">
% ( cd tock/boards/arty-e21/ &amp;&amp; \
    RUSTFLAGS=&quot;-C link-arg=-Tlayout.ld -C linker=rust-lld -C linker-flavor=ld.lld -C relocation-model=dynamic-no-pic -C link-arg=-zmax-page-size=512&quot; \
    cargo build --target riscv32imac-unknown-none-elf   )
...
error: internal compiler error: src/librustc/traits/codegen/mod.rs:127: Encountered errors `[FulfillmentError(Obligation(predicate=Binder(TraitPredicate(&lt;() as core::fmt::Display&gt;)), depth=1),Unimplemented)]` resolving bounds after type-checking
</code></pre>
<blockquote>
<p>An eagle-eyed reader might look at that ICE message and immediately consider grepping the source code, such as uses of the trait bound core::fmt::Display. A fine idea, but intuitive jumping to an answer is not what Iâ€™m focusing on here.</p>
</blockquote>
<p>but for the purposes of the experiments presented in this blog post I will use the simplified invocation. (The difference only matters once we hit cases where the bug goes away.)</p>
<p>Remember that 90,000 lines of code number that I mentioned a few paragraphs ago? It didnâ€™t come out of nowhere:</p>
<pre><code class="language-shell">% find tock/ -name *.rs | xargs wc
...
   91958  317229 3150451 total

</code></pre>
<p>So this is an excellent example of an input that we really want to reduce down to something smaller.</p>
<hr />
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h2 id="tactic-reduce-the-driving-code-first"><a class="header" href="#tactic-reduce-the-driving-code-first">Tactic: Reduce the driving code first</a></h2>
<p>We have many input files, and they make up a crate graph with at least 13 crates in it.</p>
<p>We know from our command line invocation that it is the build of boards/arty-e21 that is exposing the ICE. It would be good to remove unnecessary crates from the crate graph for boards/arty-e21. But to do that most effectively, we need to first discard as many imports as possible from boards/arty-e21, and then work our way backwards through the dependency chain.</p>
<p>So, will start by reducing the boards/arty-e21 crate to the minimum necessary to reproduce the bug.</p>
<p>This single crate is a much easier thing to work with:</p>
<pre><code class="language-shell">% find tock/boards/arty-e21/ -name '*.rs' | xargs wc
       4       6     124 tock/boards/arty-e21//build.rs
      27      68     565 tock/boards/arty-e21//src/timer_test.rs
      40     101     959 tock/boards/arty-e21//src/io.rs
     279     667    9135 tock/boards/arty-e21//src/main.rs
     350     842   10783 total

</code></pre>
<p>However, we still want to reduce it as much as we can: Every import we can remove from arty-e21 represents swaths of code that we might be able to remove in the rest of the crate graph.</p>
<hr />
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h2 id="technique-mod-inlining"><a class="header" href="#technique-mod-inlining">Technique: â€œmod-inliningâ€</a></h2>
<p>This technique may surprise some: I like to reduce the number of files involved early in the game, if I can. An easy way to do this is to replace the out-of-line mod foo; item with its inline counterpart: mod foo { ... }. Here the out-of-line module file content has been cut-and-pasted into an inline mod item.</p>
<p>Strictly speaking, moving from mod foo; to mod foo { ... }does not reduce the input: You still have all the same content that you started with, the compiler has to do the same amount of work, et cetera.</p>
<p>However, I still prefer to do it, because I find that it helps with later reduction steps if I can do my transformations on a single file.</p>
<p>There two techniques I use for â€œmod-inliningâ€:</p>
<ol>
<li>Manually cut-and-paste: take each instance of mod foo; in the root file, and find that moduleâ€™s contents. Then replace the ; with { and }, and finally paste the contents in between the curly brackets you just added. You donâ€™t even have to re-indent it if you donâ€™t want to.</li>
</ol>
<blockquote>
<p>Its not like this is Python!</p>
</blockquote>
<p>For a small module tree, such as we find in boards/arty-e21, manually cut-and-pasting is entirely reasonable. But if you have a large module tree, with many directories and files, it can become tedious and error-prone.</p>
<ol start="2">
<li>Alternative: use rustc to expand the module-tree. You can add --verbose to the cargo build invocation to see the actual rustc command line invocation cargo is using, and then you can add -Z unstable-options --pretty=expanded to that rustc invocation, piping the output to a new rust source</li>
</ol>
<blockquote>
<p>Warning: this will not only expand the module tree: it will also expand all the macro invocations, including #[derive] attributes. This can be a bit overwhelming. (I am continually tempted to add a new unstable --pretty variant that just expands the module tree but does not expand the macros otherwise.)</p>
</blockquote>
<p>I will show a concrete example of using rustc in this way later in the blog post. But for now I will just manually cut-and-paste the contents of boards/arty-e21/src/timer_test.rs and boards/arty-e21/src/io.rs into main.rs</p>
<p>After doing the inline, make sure the bug reproduces.</p>
<p>It is up to you whether you want to delete the out-of-line module files. Today, Rust does not treat their presence as some sort of conflict with the inline definition. You will see later in the post cases where keeping them around on the file-system can be useful. But for the case of boards/arty-e21, I will go ahead and delete them.</p>
<blockquote>
<p>Checking for unused out-of-line module files might be a nice lint for someone to add to rustc.</p>
</blockquote>
<pre><code class="language-shell">% find tock/boards/arty-e21/ -name *.rs | xargs wc
       4       6     124 tock/boards/arty-e21//build.rs
     348     840   10665 tock/boards/arty-e21//src/main.rs
     352     846   10789 total

</code></pre>
<p>As expected, this didnâ€™t reduce the line count. But it did make it so we can work with a single file at the leaf. That simplifies my own workflow.</p>
<hr />
<blockquote>
<p>theme: Delete the Unnecessary</p>
</blockquote>
<h2 id="tactic-decommentification"><a class="header" href="#tactic-decommentification">Tactic: â€œDecommentificationâ€</a></h2>
<p>This may be obvious, but it is a step that I often forget to do at the outset of test reduction, even though it is easy and pays off handsomely.</p>
<p>Comments in code are typically there to explain or justify some detail of the implementation. When diagnosing compiler bugs, the purpose of the original code is usually not relevant. You are better off increasing the number of lines of actual code that you can fit on your screen at once.</p>
<p>In short, the transformation looks like this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>^        //...$

<span class="boring">}</span></code></pre></pre>
<p>to <empty-string></p>
<p>In this case, I have used ^ and $ as markers for the beginning and end of lines (just like in regexps).</p>
<p>Or, as an Emacs M-x query-replace-regexp input: ^ <em>//.</em>^J* (and empty string as replacement text).</p>
<blockquote>
<p>The ^J there is a carriage-return inserted via M-x quoted-insert (aka C-q) in Emacs.</p>
</blockquote>
<blockquote>
<blockquote>
<p>Why I use M-x query-replace-regexp: it previews the matches, I verify a few by eye, and then hit ! to do all the remaining replacements.</p>
</blockquote>
</blockquote>
<p>Another related transformation: get rid of the other blank lines that are not preceded by comments. I leave that regexp as an exercise for the reader.</p>
<p>In the case of boards/arty-e21, this got rid of 53 lines of comments (and blank lines succeeding them):</p>
<pre><code class="language-shell">% wc tock/boards/arty-e21/src/main.rs
     295     575    8551 tock/boards/arty-e21/src/main.rs

</code></pre>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h2 id="tactic-body-loopification"><a class="header" href="#tactic-body-loopification">Tactic: â€œBody Loopificationâ€</a></h2>
<blockquote>
<p>see also: â€œnone-defaultingâ€â€œLoopificationâ€ </p>
</blockquote>
<p>removes the body of a given function or method item, replacing it with loop { }.</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(...) -&gt; ReturnType { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(...) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>You might choose to use alternatives like unimplemented!(). I personally like loop { } because its something you almost never see in other peopleâ€™s code, so its easy to search for and be pretty certain that it was introduced as part of reduction. Also loop { } relies on less machinery from the core library than unimplemented! does.</p>
</blockquote>
<p>The use of loop { } is deliberate: since loop { } is known by the compiler to diverge, it can be assigned any type at all. So this transformation can be performed blindly.</p>
<ul>
<li>Note that this does not work for const fn; the compiler currently rejects const fn foo() { loop { } } as invaild syntax.</li>
<li>Also, it generally will not work for impl Trait in return position: the compiler needs a concrete type to assign to the impl Trait, and loop { } will not suffice for that unless you ascribed it a non-! type in some manner.</li>
</ul>
<p>When it comes to replacing a function body with loop { }, you may be able to get help from your IDE. In my own case, I have often used Emacs M-x kill-sexp to delete the { ---- } block in fn foo { ---- }</p>
<blockquote>
<p>More specifically, I have used Emacs to define a keyboard macro (via C-x () that: 1. searches for the next occurrence of fn, 2. searches forward from there for the first {, which often (but not always) corresponds to the start of the functionâ€™s body, 3. runs M-x kill-sexp to delete the { ---- } and 4. types in { loop { } }, replacing the method body. This is incredibly satisfying to watch in action.</p>
</blockquote>
<p>If you want to take a risk, you can ask rustc to do the replacement of fn bodies with loop { } for you as part of pretty-printing via the -Z unpretty=everybody_loops flag. Iâ€™ll speak more on that later.</p>
<p>Once the body has been removed, you can optionally replace all of the formal parameters with _:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(a: A, b: B, ...) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(_: A, _: B, ...) -&gt; ReturnType { loop { } }
<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>These explicit marks can be useful as hints for future reduction steps; see â€œgenertrificationâ€)</p>
</blockquote>
<p>This is essentially a special case of â€œunusedificationâ€; we do not delete the parameters outright yet (see â€œparam-eliminationâ€ for that), but we mark them as completely useless by writing them as _: ParamType.</p>
<p>In the case of board/argy-e21/main.rs, there was one const fn, and you cannot â€œloopifyâ€ that. For the other fnâ€™s, I was able to replace all but the last fn body with loop { }. (Replacing the last one made the bug go away.)</p>
<ul>
<li>In practice, the ICE diangostic often gives me some hint about which fn is the problem, and therefore I can blindly replace the other fn bodies with loop { }.</li>
<li>But even without such a hint, once can often bisect over the set of fnâ€™s to try to identify a maximal subset that can have their bodies replaced with loop { }. We will talk more about how to do such bisection later.</li>
</ul>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>% wc tock/boards/arty-e21/src/main.rs
     262     523    7584 tock/boards/arty-e21/src/main.rs

<span class="boring">}</span></code></pre></pre>
<p>(Okay, only removing 33 lines of code might not be very impressive. The technique will pay off more as we move further along.)</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h2 id="tactic-expr-elimination"><a class="header" href="#tactic-expr-elimination">Tactic: â€œExpr-eliminationâ€</a></h2>
<p>Even if you were not able to replace a whole fn body with loop { }, you can usually simplify the fn bodies that remain now.</p>
<blockquote>
<p>themes: Trivialize Content, Identify the Unnecessary</p>
</blockquote>
<h3 id="technique-suffix-bisection"><a class="header" href="#technique-suffix-bisection">Technique: Suffix-bisection</a></h3>
<p>In this case, I recommend a form of bisection where you first comment out the bottom half of the original fn-body, and see if the problem reproduces.</p>
<ul>
<li>Why comment out the latter half? Well, if you comment out the top half, youâ€™re almost certainly going to comment out let-bindings that the bottom half relies on. The top half very rarely relies on items in the bottom half.</li>
<li>If the fn in question has a return type, then you can usually use a loop { } as a tail-expression at the end of the fn-body to satisfy the return-type; a natural variant of â€œloopificationâ€.</li>
</ul>
<p>If it does reproduce without the bottom half, then you can delete that half, and recursively process the top half.</p>
<p>If it doesnâ€™t reproduce, then the bug relies on something in the bottom half. If youâ€™re lucky, it only relies on stuff in the latter half, and you can try deleting the top half now. But even if youâ€™re â€œunluckyâ€ and the bottom half relies on stuff in the top half, you leave the top half in place (at least for now) and recursively process the bottom half, narrowing the code until you can identify a single statement whose presence or absence is the line between triggering the ICE or not.</p>
<p>If the fn is too large for fit on one screen, then I use M-x forward-sexp to identify the start and end of the fn-body. Then I jump to a line in the middle, and search around for the start of a statment in the body, and then comment out everything from that statement forward in /* ... */</p>
<p>In the case of boards/arty-e21/src/main.rs, this meant commenting out from line 191 through 263.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/*
    let gpio_pins = static_init!(
    ...

    board_kernel.kernel_loop(&amp;artye21, chip, None, &amp;main_loop_cap);
*/

<span class="boring">}</span></code></pre></pre>
<p>And, â€œdarnâ€: It didnâ€™t work. The bug disappeared. But: This is okay! We still have learned something: Something in the latter half is causing the bug. So bisect that latter half (again, favoring commenting out second halves).</p>
<p>Eventually, by recursively processing the suffix statements, we identify that the bug does not reproduce with this code:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{
    ...
/*
    kernel::procs::load_processes(
        board_kernel,
        chip,
        &amp;_sapps as *const u8,
        &amp;mut APP_MEMORY,
        &amp;mut PROCESSES,
        FAULT_RESPONSE,
        &amp;process_mgmt_cap,
    );

    board_kernel.kernel_loop(&amp;artye21, chip, None, &amp;main_loop_cap);
*/
}

<span class="boring">}</span></code></pre></pre>
<p>but does reproduce with this code:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{
    ...
    kernel::procs::load_processes(
        board_kernel,
        chip,
        &amp;_sapps as *const u8,
        &amp;mut APP_MEMORY,
        &amp;mut PROCESSES,
        FAULT_RESPONSE,
        &amp;process_mgmt_cap,
    );

/*
    board_kernel.kernel_loop(&amp;artye21, chip, None, &amp;main_loop_cap);
*/
}

<span class="boring">}</span></code></pre></pre>
<p>So, now we have identified a function call to load_processes that seems to be intimately related to the bug.</p>
<p>Unfortunately, load_processes is an item defined in an external crate. (We will deal with that eventually.)</p>
<p>Now that weâ€™ve identified this function call to load_processes as part of the cause of the bug, the new goal is to simplify the earlier part of the function to the bare minimum necessary to support this function call.</p>
<blockquote>
<p>In all of these cases, if an otherwise unused statement or expression influences the type-inference for the body, you may need to keep it around, or some variant of it.</p>
</blockquote>
<ul>
<li>Get rid of all non-binding statements. (We should not need any side-effecting computations to reproduce the bug.)</li>
<li>Initialize things to their default values (see â€œDefaultificationâ€ below).</li>
<li>Eliminate unused lets (see â€œUnusedificationâ€ below).</li>
</ul>
<p>After applying those steps repeatedly, and further â€œdecommentificationâ€, we are left with this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[no_mangle]
pub unsafe fn reset_handler() {
    let chip = static_init!(arty_e21::chip::ArtyExx, arty_e21::chip::ArtyExx::new());
    let process_mgmt_cap = create_capability!(capabilities::ProcessManagementCapability);
    let board_kernel = static_init!(kernel::Kernel, kernel::Kernel::new(&amp;PROCESSES));

    kernel::procs::load_processes(
        board_kernel,
        chip,
        &amp;0u8 as *const u8,
        &amp;mut [0; 8192], // APP_MEMORY,
        &amp;mut PROCESSES,
        kernel::procs::FaultResponse::Panic,
        &amp;process_mgmt_cap,
    );

}

<span class="boring">}</span></code></pre></pre>
<p>Just checking: the bug still reproduces, and we now have:</p>
<pre><code class="language-shell">% wc tock/boards/arty-e21/src/main.rs
     111     289    2807 tock/boards/arty-e21/src/main.rs

</code></pre>
<p>Its not 100% minimized yet, but its about as far as we can go in changes to fn reset_handler without making changes to crates upstream in dependency graph.</p>
<hr />
<blockquote>
<p>theme: Delete the Unnecessary</p>
</blockquote>
<h2 id="tactic-unusedification"><a class="header" href="#tactic-unusedification">Tactic: â€œUnusedificationâ€</a></h2>
<p>Another way to remove distractions: remove them.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>non_pub_locally_unused_item(----) { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to <empty-string></p>
<p>At this point, after our initial round of â€œloopificationâ€, we should have a lot of unused stuff: variables, struct fields, imports, etc. And even better, the compiler is probably already telling you about all of them!</p>
<p>In the specific case of arty-e21, I am currently seeing 25 warnings: 13 unused import warnings, 4 unused variable warnings, 2 static item is never used warnings, 1 constant item is never used warning, and 5 field is never used warnings.</p>
<p>If youâ€™re doing the compilation runs in your IDE, then you should be able to just jump to each unused item and remove it in some way.</p>
<ul>
<li>In the case of fn parameters, you can replace it with _ as previously discussed.</li>
<li>ADT contents (struct and enum fields) may require more subtlety; see â€œADT-reductionâ€ below. For now, you can prefix their names with _.</li>
<li>Warning: Items with attributes like #[no_mangle] or #[link_section] may also want special treatment: you may be able to remove them without causing the bug to go away, but once the bug does go away, their absence may cause a confusing linker error.</li>
</ul>
<p>Make sure to check periodically that the bug still reproduces (Sometimes supposedly unused things still matter)!</p>
<p>This got boards/arty-e21 down to 95 lines:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>% wc tock/boards/arty-e21/src/main.rs
      95     254    2382 tock/boards/arty-e21/src/main.rs
<span class="boring">}</span></code></pre></pre>
<p>Again, not so impressive yet. But as with optimizations, sometimes the effect of these techniques only becomes apparent when they are combined together.</p>
<hr />
<blockquote>
<p>theme: Delete the Unnecessary</p>
</blockquote>
<h2 id="technique-cfgments"><a class="header" href="#technique-cfgments">Technique: â€œCfgmentsâ€</a></h2>
<p>As a note: As a test run, you can easilly preview the effects of â€œunusedificationâ€ and â€œdemodulificationâ€ (discussed below) transformations without actually deleting code. (After all, you may quickly discover that you need to put it back.) One classic approach for this is a comment block:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/*
non_pub_locally_unused_item(----) { ---- }
*/

<span class="boring">}</span></code></pre></pre>
<p>But it not always easy to toggle such comments on and off, since you need add and remove the /* and matching */ each time you want to toggle it. Some IDEs help with this, but I still prefer to use more local changed if I can.</p>
<p>A less used option that is more specific to Rust (and that I use all the time), is to use a #[cfg] attribute to temporarily remove the code:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unused_or_little_used_item { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(not_now)]
unused_or_little_used_item { ---- }

<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>No, I do not know how to pronounce â€œcfgmentâ€; I have only typed it, never uttered it. IÃ¤! Sheol-Nugganoth!I call this â€œcfgmentingâ€ out code (as opposed to â€œcommenting out codeâ€).</p>
</blockquote>
<p>Whether or not you choose to use comments, â€œcfgmentsâ€, or just delete code outright is up to you, (though I do recommend you eventually delete the lines in question, as discussed in â€œdecommentificationâ€).</p>
<hr />
<blockquote>
<p>theme: Delete the Unnecessary</p>
</blockquote>
<h2 id="tactic-demodulification"><a class="header" href="#tactic-demodulification">Tactic: â€œDemodulificationâ€</a></h2>
<p>In addition to â€œunusedifyingâ€ each identified unused item, you might try this: You may also be lucky enough to be able to just remove whole modules from this crate at this point. If the compiler is telling you that a lot of the items in a given module are unused, maybe you can get rid of the whole module. Go ahead and try it!</p>
<p>There can be a bit of guesswork involved here. For various reasons the compilerâ€™s lints do not identify some definitions as unused even though it may seem obvious that they are not used.</p>
<ul>
<li>This can be a consequence of the impls in the source; see â€œDeimplificationâ€ below.</li>
<li>Also some cases are only identified after doing â€œdepublificationâ€ of the contents of such modules, which is also discussed below.</li>
</ul>
<p>In the case of boards/arty-e21 I was able to identify mod timer_test as entirely unsed.</p>
<p>After â€œcfgmentingâ€ it out and further â€œdecommentificationâ€, we have this:</p>
<pre><code class="language-shell">% wc tock/boards/arty-e21/src/main.rs
      73     191    1967 tock/boards/arty-e21/src/main.rs
</code></pre>
<p>(For now we have to keep the mod io { ... }; it defines a panic-handler, and we wonâ€™t be able to get rid of that until we do more reduction elsewhere.)</p>
<hr />
<blockquote>
<p>theme: Delete the Unnecessary</p>
</blockquote>
<h2 id="technique-adt-reduction"><a class="header" href="#technique-adt-reduction">Technique: â€œADT-reductionâ€</a></h2>
<p>What more is there to reduce here? Well, there is a struct ArtyE21 all of whose fields are unused:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct ArtyE21 {
    _console: &amp;'static capsules::console::Console&lt;'static&gt;,
    _gpio: &amp;'static capsules::gpio::GPIO&lt;'static&gt;,
    _alarm: &amp;'static capsules::alarm::AlarmDriver&lt;
        'static,
        VirtualMuxAlarm&lt;'static, rv32i::machine_timer::MachineTimer&lt;'static&gt;&gt;,
    &gt;,
    _led: &amp;'static capsules::led::LED&lt;'static&gt;,
    _button: &amp;'static capsules::button::Button&lt;'static&gt;,
}

<span class="boring">}</span></code></pre></pre>
<p>We got lucky here: This struct has no lifetime or type parameters, so we can just do a trivial replacement, like so:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S { }

<span class="boring">}</span></code></pre></pre>
<p>This, combined with â€œunusedificationâ€ of a now-unused import, leaves us with:</p>
<pre><code class="language-shell">% wc tock/boards/arty-e21/src/main.rs
      63     170    1549 tock/boards/arty-e21/src/main.rs

</code></pre>
<h3 id="adt-reduction-in-general"><a class="header" href="#adt-reduction-in-general">â€œADT-reductionâ€ in general</a></h3>
<p>In the general case, if there is a generic parameter on the struct, you will need it to retain a field (to allow the compiler to compute the variance of the parameter).</p>
<p>Usually lifetime parameters are (co)variant, in which case this suffices:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a&gt;{ ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a&gt;{ _inner: &amp;'a () }

<span class="boring">}</span></code></pre></pre>
<blockquote>
<p>struct S&lt;'a&gt;(Cell&lt;&amp;'a ()) is another option for encoding invariance, note it imports std::cell::Cell.</p>
</blockquote>
<p>If you need an invariant lifetime parameter to reproduce the bug, then you can do it this way:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a&gt;{ ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a&gt;{ _inner: &amp;'a mut &amp;'a () }

<span class="boring">}</span></code></pre></pre>
<p>Likewise, type parameters can usually be encoded like so:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;T&gt; { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;T&gt; { _inner: Option&lt;T&gt; }

<span class="boring">}</span></code></pre></pre>
<p>If the type parameter has the ?Sized (anti)bound, then you can use this variant:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;T: ?Sized&gt; { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;T&gt; { _inner: Option&lt;Box&lt;T&gt;&gt; }
<span class="boring">}</span></code></pre></pre>
<p>Often if there is both a lifetime and a type parameter, then I will combine them into one field:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a, T&gt; { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a, T&gt; { _inner: Option&lt;&amp;'a T&gt; }

<span class="boring">}</span></code></pre></pre>
<p>but in general that might not reflect the contentsfor example, it implicitly requires that T outlive 'a, which may not have been the case originaly of the original struct, and thus may cause the original bug to be masked. So in general you may have to do:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a, T&gt; { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;'a, T&gt; { _inner1: &amp;'a (), _inner2: Option&lt;T&gt; }

<span class="boring">}</span></code></pre></pre>
<p>or some variation thereof.</p>
<p>Having said that, its pretty rare that struct S&lt;'a, T&gt; { _inner: Option&lt;&amp;'a T&gt; } doesnâ€™t suffice.</p>
<hr />
<blockquote>
<p>themes: Delete the Unnecessary, Identify the Unnecessary</p>
</blockquote>
<h2 id="tactic-deimplificiation"><a class="header" href="#tactic-deimplificiation">Tactic: â€œDeimplificiationâ€</a></h2>
<p>After â€œloopificationâ€, often whole impl blocks can be eliminated.</p>
<p>In the case of arty-e21, we have this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Write for Writer {
    fn write_str(&amp;mut self, _: &amp;str) -&gt; ::core::fmt::Result { loop { } }
}

<span class="boring">}</span></code></pre></pre>
<p>which is entirely unused.</p>
<p>So we can â€œcfgmentâ€ it out, and now the compiler identifies two unused imports (since this impl-block was their only use); more importantly, it now also identifies that the struct Writer is never constructed. (Which we already knew since we were able to revise its fields at will during â€œADT-reductionâ€; but the point is that we couldnâ€™t have removed its definition without first removing all of its associated impl blocks. Thus, â€œdeimplificationâ€ is an important step in our reduction odysssey.</p>
<p>That, plus more â€œunusedificationâ€ gets us to 55 lines:</p>
<pre><code class="language-shell">% wc tock/boards/arty-e21/src/main.rs
      55     146    1396 tock/boards/arty-e21/src/main.rs

</code></pre>
<h3 id="fine-grained-deimplification"><a class="header" href="#fine-grained-deimplification">Fine-grained â€œdeimplificationâ€</a></h3>
<p>In general you may not be able to remove the whole impl block. But you can still try to remove individual items from it, like so:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Foo {
   fn method(----) { ---- }
   ...
}

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Foo {
   ...
}

<span class="boring">}</span></code></pre></pre>
<h4 id="technique-split-impls"><a class="header" href="#technique-split-impls">Technique: â€œsplit-implsâ€</a></h4>
<blockquote>
<p>aka Regroup fn items in inherent impls.</p>
</blockquote>
<p>I sometimes like to employ As a special technique to remove individual methods from an inherent impl: Rust lets you define multiple inherent impls for a given type. So rather than deleting code or using â€œcfgmentsâ€ for each item, I will instead take an impl and break it into two, where one of them is â€œcfgmentedâ€ out:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Foo {
    fn method1(----) { ---- }
    fn method2(...) { ... }
    fn method3(...) { ... }
}

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(not_now)]
impl Foo {
    fn method1(----) { ---- }
}
impl Foo {
    fn method2(...) { ... }
    fn method3(...) { ... }
}

<span class="boring">}</span></code></pre></pre>
<p>Here, you can now move items freely between the â€œcfgmentedâ€-out impl and the still present impl. It has a similar effect to â€œcfgmentingâ€ out the individual items, but in practice it feels a lot more like an easy bisection process, at least for my fingers.</p>
<ul>
<li>Especially since you can start with the whole impl â€œcfgmentedâ€-out, and let the compiler tell you which methods you need to put back (e.g. due to downstream uses.)</li>
</ul>
<p>You can also sometimes do this impl as a way to make more fine-grained impl-blocks that have looser constraints, like so:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;X: Bound&gt; Foo&lt;X&gt; {
    fn method1(...) { ... }
    fn method2(...) { ... }
    fn method3(...) { ... }
}

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;X: Bound&gt; Foo {
    fn method1(...) { ... }
}
impl&lt;X&gt; Foo&lt;X&gt; {
    fn method2(...) { ... }
    fn method3(...) { ... }
}

<span class="boring">}</span></code></pre></pre>
<p>(where here we assume method2 and method3 do not require the X: Bound).</p>
<hr />
<h2 id="a-pause"><a class="header" href="#a-pause">A pause</a></h2>
<p>This is about as far as we can usefully get in reducing arty-e21 on its own.</p>
<p>To make further progress, we need to start making changes to upstream dependencies.</p>
<p>Lets look at the situation there.</p>
<hr />
<blockquote>
<p>theme: Identify the Unnecessary</p>
</blockquote>
<h3 id="tactic-dep-reduction"><a class="header" href="#tactic-dep-reduction">Tactic: â€œdep-reductionâ€</a></h3>
<blockquote>
<blockquote>
<p>aka â€œeliminate upstream dependenciesâ€</p>
</blockquote>
</blockquote>
<p>We have not yet changed anything about the crate graph as a whole. Technicaly, building arty-e21 still builds 12 crates before starting on arty-e21. (Maybe cargo has some flag to inform you about unused dependencies?)</p>
<p>In any case, from inspecting arty-e21, we can see that it directly uses only two dependencies now: kernel and chips/arty_e21.</p>
<p>We can remove other dependencies from the Cargo.toml and see where it gets us:</p>
<pre><code class="language-toml">[dependencies]
kernel = { path = &quot;../../kernel&quot; }
arty_e21 = { path = &quot;../../chips/arty_e21&quot; }

</code></pre>
<p>A build after a cargo clean now shows just nine crates being built before arty-e21</p>
<pre><code class="language-shell">   Compiling tock-registers v0.4.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/tock-register-interface)
   Compiling tock-cells v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/tock-cells)
   Compiling tock_rt0 v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/tock-rt0)
   Compiling arty-e21 v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/boards/arty-e21)
   Compiling riscv-csr v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/libraries/riscv-csr)
   Compiling kernel v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/kernel)
   Compiling rv32i v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/arch/rv32i)
   Compiling sifive v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/chips/sifive)
   Compiling arty_e21 v0.1.0 (/Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/chips/arty_e21)
</code></pre>
<p>If we want to make more progress here, weâ€™ll need to start working on upstream crates.</p>
<p>Looking at chips/arty_e21/Cargo.toml, we can see it also depends on the kernel crate:</p>
<pre><code class="language-toml">[dependencies]
sifive = { path = &quot;../sifive&quot; }
rv32i = { path = &quot;../../arch/rv32i&quot; }
kernel = { path = &quot;../../kernel&quot; }

</code></pre>
<p>So this gives us a hint where to go next: Simplify chips/arty_e21 as much as we can, before we tackle trying to simplify the (hopefully root) kernel crate.</p>
<p>So lets see what we need from chips/arty_e21. It has a very small lib.rs file:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>//! Drivers and chip support for the E21 soft core.

#![feature(asm, concat_idents, const_fn)]
#![feature(exclusive_range_pattern)]
#![no_std]
#![crate_name = &quot;arty_e21&quot;]
#![crate_type = &quot;rlib&quot;]

mod interrupts;

pub mod chip;
pub mod gpio;
pub mod uart;

<span class="boring">}</span></code></pre></pre>
<p>Now I have a choice: do I go ahead and inline these module defintions like we did with boards/arty-e21? Well, lets figure out if we can first isolate its exports to a bare minimum before doing that.</p>
<hr />
<blockquote>
<p>theme: Identify the Unnecessary</p>
</blockquote>
<h3 id="tactic-depublification"><a class="header" href="#tactic-depublification">Tactic: â€œDepublificationâ€</a></h3>
<p>As I already mentioned, the compiler is probably already tellling you about some of these (see â€œunusedificationâ€).</p>
<p>But if you want to maximize the set of unused things that the compiler will identify for you, you might need to help it along the way by removing pub annotations, like so:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod foo { ... }
<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod foo { ... }
<span class="boring">}</span></code></pre></pre>
<p>or</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub use foo;
<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use foo;
<span class="boring">}</span></code></pre></pre>
<p>or struct, enum, type, trait, fn, etc; basically any pub item.</p>
<p>This can help compiler see that items or imports are in fact not used outside of the current crate, and thus can be eliminated.</p>
<p>For chips/arty_e21, I was able to successfully do this replacement:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod chip;
pub mod gpio;
pub mod uart;

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod chip;
mod gpio;
mod uart;

<span class="boring">}</span></code></pre></pre>
<p>and everything still built.</p>
<p>After this point, I attempted blind â€œdemodulificationâ€ each of mod interrupts, mod gpio, and mod uart (since its so easy to try when they are declared as out-of-line modules). Unfortunately, pub mod chip; currently depends on all of them being present.</p>
<p>So thatâ€™s when I went ahead and inlined the module definitions, leaving me with a 371-line lib.rs for chips/arty_e21:</p>
<pre><code class="language-shell">% wc tock/chips/arty_e21/src/lib.rs
     371    1354   12137 tock/chips/arty_e21/src/lib.rs
</code></pre>
<blockquote>
<blockquote>
<p>Maybe this argues for a strategy where one should attempt targetted â€œloopificationâ€ on your reachable (pub) modules in the crate, and then do subsequent â€œdemodulificationâ€ of the out-of-line modules before jumping into â€œmod-inliningâ€. I have not tried that workflow too seriously yet, though; its not that hard to â€œdemodulifyâ€ a module, since its just a matter of â€œcfgmentingâ€ out the mod declaration.</p>
</blockquote>
</blockquote>
<p>Then I â€œloopifiedâ€ it; in this case, I was lucky and was able to loopify everything in chips/arty_e21, and the bug still reproduces.</p>
<p>After â€œloopificationâ€, I was able to successfully â€œdemodulifyâ€ all of mod interrupts, mod gpio, and mod uart.</p>
<p>Finally, I did some â€œdeimplificationâ€, and managed to remove everything except for a impl kernel::Chip for ArtyExx { ... } and one inherent method on struct ArtyExx.</p>
<p>Those steps, plus â€œdecommentificationâ€, removed about 320 lines.</p>
<pre><code class="language-shell">% wc tock/chips/arty_e21/src/lib.rs
      52     163    1180 tock/chips/arty_e21/src/lib.rs
</code></pre>
<p>Perhaps most importantly, it got the source code to the point where it fits on a screen.</p>
<hr />
<blockquote>
<p>themes: Enable Incremental Steps, Identify the Unnecessary</p>
</blockquote>
<h3 id="tactic-simpl-impl"><a class="header" href="#tactic-simpl-impl">Tactic: â€œsimpl-implâ€</a></h3>
<blockquote>
<blockquote>
<p>aka use trait defaults</p>
</blockquote>
</blockquote>
<p>I did just mention that I had to keep an impl kernel::Chip for ArtyExx { ... }.</p>
<p>In general, the impl blocks we are trying to eliminate may be trait impls rather than inherent ones. In those cases, we cannot just remove methods from the impls willy-nilly, as that would cause the compiler to reject the trait implementation.</p>
<blockquote>
<blockquote>
<p>Did you see this coming?</p>
</blockquote>
</blockquote>
<p>So, you have to keep that impl entirely intactâ€¦ unless you do some work up front â€¦</p>
<p>Hereâ€™s the trick around that. First add a trait default implementation:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Tr { ... fn m(); }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Tr { ... fn m() { loop { } } }

<span class="boring">}</span></code></pre></pre>
<p>This enables the subsequent transformation:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Tr for C { ... fn m() { ---- } }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Tr for C { ... }

<span class="boring">}</span></code></pre></pre>
<p>Thats right, you can turn a non-default trait method into a â€œloopifiedâ€ default trait method, and that enables you to freely remove instances of that method from all of that traitâ€™s impls. You can do this transformation piecewise, or for the whole trait definition, as you like.</p>
<p>And (I think) you can do it pretty much as freely as you like: you should not need to worry about changing a trait method to a â€œloopifiedâ€ default causing breakage elsewhere when compiling the crate graph (unless there is some potential interaction with specialization that I have not considered).</p>
<p>If you apply the transformation repeatedly, it can often result in</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Tr { ---- } // all methods loopified
impl Tr for C { }

<span class="boring">}</span></code></pre></pre>
<p>which is simply awesome.</p>
<p>In our specific case, the trait in question is upstream: impl kernel::Chip for ArtyExx { ... }</p>
<p>So we are going to make an exception to our earler rule about trying to work at the leaves first: Here, we are justified in jumping upstream, to kernel/src/platform/mod.rs, and changing the definition of kernel::Chip, doing M-x query-replace of ; with { loop { } } to easily jump through the fn-items and add a â€œloopifiedâ€ body to each one.</p>
<p>(In my case, Iâ€™m going to decommentify the relevant file first too.)</p>
<p>After adding â€œloopifiedâ€ default methods to the traits in kernel::platform, we can return to chips/arty_e21 and further simplify the impl there to this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl kernel::Chip for ArtyExx {
    type MPU = ();
    type UserspaceKernelBoundary = rv32i::syscall::SysCall;
    type SysTick = ();
}

<span class="boring">}</span></code></pre></pre>
<p>Now we need to apply a bit of artistry.</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h3 id="tactic-type-trivialization"><a class="header" href="#tactic-type-trivialization">Tactic: â€œType-trivializationâ€</a></h3>
<p>This associated type in impl kernel::Chip for ArtyExx is forcing dependency on rv32i:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>type UserspaceKernelBoundary = rv32i::syscall::SysCall;

<span class="boring">}</span></code></pre></pre>
<p>But we have removed all the methods! Chances are actually quite good that there is no longer anyone that relies on that type defintion. (Its not a certainty, of course; clients of the trait might be extracting the type directly, and the associated may have trait bounds that will force us to use a non-trivial type there.)</p>
<p>But lets try it and see:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl kernel::Chip for ArtyExx {
    type MPU = ();
    type UserspaceKernelBoundary = ();
    type SysTick = ();
}

<span class="boring">}</span></code></pre></pre>
<p>yields:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>error[E0277]: the trait bound `(): kernel::syscall::UserspaceKernelBoundary` is not satisfied
  --&gt; /Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/chips/arty_e21/src/lib.rs:22:6
   |
22 | impl kernel::Chip for ArtyExx {
   |      ^^^^^^^^^^^^ the trait `kernel::syscall::UserspaceKernelBoundary` is not implemented for `()`

error: aborting due to previous error

<span class="boring">}</span></code></pre></pre>
<p>So, what to do about this?</p>
<p>Honestly, I figure this is another case where we are justified in going upstream and removing the bound in question, just to see what happens:</p>
<pre><code class="language-diff">diff --git a/tock/kernel/src/platform/mod.rs b/tock/kernel/src/platform/mod.rs
index 9544899..dd107dd 100644
--- a/tock/kernel/src/platform/mod.rs
+++ b/tock/kernel/src/platform/mod.rs
@@ -13,7 +13,7 @@ pub trait Platform {
 pub trait Chip {
     type MPU: mpu::MPU;

-    type UserspaceKernelBoundary: syscall::UserspaceKernelBoundary;
+    type UserspaceKernelBoundary;

     type SysTick: systick::SysTick;

</code></pre>
<p>And the answer is:</p>
<pre><code>error[E0277]: the trait bound `&lt;C as platform::Chip&gt;::UserspaceKernelBoundary: syscall::UserspaceKernelBoundary` is not satisfied
   --&gt; /Users/felixklock/Dev/Mozilla/issue65774/demo-minimization/tock/kernel/src/process.rs:468:5
    |
468 | /     stored_state:
469 | |         Cell&lt;&lt;&lt;C as Chip&gt;::UserspaceKernelBoundary as UserspaceKernelBoundary&gt;::StoredState&gt;,
    | |____________________________________________________________________________________________^ the trait `syscall::UserspaceKernelBoundary` is not implemented for `&lt;C as platform::Chip&gt;::UserspaceKernelBoundary`
    |
    = help: consider adding a `where &lt;C as platform::Chip&gt;::UserspaceKernelBoundary: syscall::UserspaceKernelBoundary` bound

error: aborting due to previous error

</code></pre>
<p>Darn. (We could take the compilers advice and add the aforementioned where clause, but that stands a good chance of just shifting the blame around without actually helping us make progress on reduction itself.)</p>
<p>You might think: â€œLets try removing that field from the structâ€; but note that the struct Process lives in the kernel crate, and that code has not yet been â€œloopified.â€ So thereâ€™s a good chance that thereâ€™s existing code that relies on that field being there, and we have to get rid of that code first.</p>
<p>Well, we did a good job getting chips/arty_e21 as small as we did. Let us take this as a sign that we should keep moving up, to now focus on reducing the kernel crate.</p>
<hr />
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h3 id="technique-mod-inlining-and-loopification-via-pretty-printer"><a class="header" href="#technique-mod-inlining-and-loopification-via-pretty-printer">Technique: â€œmod-inliningâ€ and â€œloopificationâ€ via pretty-printer</a></h3>
<p>I want to simplify the kernel crate.</p>
<p>However, its module hierarchy is a bit larger than the other two crates weâ€™ve looked at so far:</p>
<pre><code>% find tock/kernel -name '*.rs'
tock/kernel/src/tbfheader.rs
tock/kernel/src/ipc.rs
tock/kernel/src/memop.rs
tock/kernel/src/lib.rs
tock/kernel/src/platform/mod.rs
tock/kernel/src/platform/systick.rs
tock/kernel/src/platform/mpu.rs
tock/kernel/src/callback.rs
tock/kernel/src/common/static_ref.rs
tock/kernel/src/common/list.rs
tock/kernel/src/common/peripherals.rs
tock/kernel/src/common/queue.rs
tock/kernel/src/common/ring_buffer.rs
tock/kernel/src/common/dynamic_deferred_call.rs
tock/kernel/src/common/mod.rs
tock/kernel/src/common/math.rs
tock/kernel/src/common/deferred_call.rs
tock/kernel/src/common/utils.rs
tock/kernel/src/hil/symmetric_encryption.rs
tock/kernel/src/hil/dac.rs
tock/kernel/src/hil/rng.rs
tock/kernel/src/hil/i2c.rs
tock/kernel/src/hil/pwm.rs
tock/kernel/src/hil/sensors.rs
tock/kernel/src/hil/watchdog.rs
tock/kernel/src/hil/led.rs
tock/kernel/src/hil/time.rs
tock/kernel/src/hil/crc.rs
tock/kernel/src/hil/ninedof.rs
tock/kernel/src/hil/entropy.rs
tock/kernel/src/hil/spi.rs
tock/kernel/src/hil/nonvolatile_storage.rs
tock/kernel/src/hil/mod.rs
tock/kernel/src/hil/usb.rs
tock/kernel/src/hil/adc.rs
tock/kernel/src/hil/gpio_async.rs
tock/kernel/src/hil/analog_comparator.rs
tock/kernel/src/hil/gpio.rs
tock/kernel/src/hil/radio.rs
tock/kernel/src/hil/eic.rs
tock/kernel/src/hil/flash.rs
tock/kernel/src/hil/uart.rs
tock/kernel/src/hil/ble_advertising.rs
tock/kernel/src/driver.rs
tock/kernel/src/component.rs
tock/kernel/src/sched.rs
tock/kernel/src/introspection.rs
tock/kernel/src/debug.rs
tock/kernel/src/process.rs
tock/kernel/src/syscall.rs
tock/kernel/src/returncode.rs
tock/kernel/src/grant.rs
tock/kernel/src/capabilities.rs
tock/kernel/src/mem.rs
</code></pre>
<p>I donâ€™t want to manually-inline all those modules into kernel.</p>
<p>Iâ€™m also not too eager to manually â€œloopifyâ€ it (though that would be easier if the â€œmod-inliningâ€ were done).</p>
<p>Luckily, we can leverage the compiler here.</p>
<hr />
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h3 id="mod-inlining-via-pretty-printer"><a class="header" href="#mod-inlining-via-pretty-printer">â€œmod-inliningâ€ via pretty-printer</a></h3>
<p>As mentioned earlier, we can add -Z unstable-options --pretty=expanded to the relevant rustc invocation (in ths case, the one compiling kernel/src/lib.rs) to get the content of the crate as one module tree.</p>
<ul>
<li>(Unfortunately for our immediate purposes, the macros in it are also expanded. But since macros could expand into mod-declarations, this is tough to avoid in the general case for solving this problem.)</li>
</ul>
<p>Pipe that output to a file, copy that file to tock/kernel/src/lib.rs, and youâ€™re don- â€¦ well, no; youâ€™re not done yet.</p>
<p>If you try to compile that as is, you get a slew of errors. Because some of the macros that expanded came from Rustâ€™s core library, and make use of features that are not available in stable Rust. So you have to add feature-gates to enable each one. Luckily, the nightly compiler tells us which gates to add, so I was able to get away with adding this line to the top of the generated file:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span>#![feature(derive_clone_copy, compiler_builtins_lib, fmt_internals, core_panic, derive_eq)]

<span class="boring">fn main() {
</span><span class="boring">}</span></code></pre></pre>
<p>Then the compilation of this expanded kernel worked, and the downstream problem continued to reproduce. Success!</p>
<p>At least, success if your definition of success is this:</p>
<pre><code>% wc tock/kernel/src/lib.rs
   10238   40254  540987 tock/kernel/src/lib.rs

</code></pre>
<p>Yikes, 10K lines.</p>
<hr />
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h3 id="loopification-via-pretty-printer"><a class="header" href="#loopification-via-pretty-printer">â€œloopificationâ€ via pretty-printer</a></h3>
<blockquote>
<blockquote>
<p>aka -Z everybody_loops</p>
</blockquote>
</blockquote>
<p>Well, thatâ€™s okay: There are some steps we havenâ€™t taken yet. Specifically, we havenâ€™t done â€œloopification.â€</p>
<p>Now, its not so much fun to â€œloopifyâ€ a file like this by hand. The keyboard macro I described above isnâ€™t tha robust; it can end up really messing up the code if you apply it blindly.</p>
<p>But luckily, we have another option:</p>
<p>rustc -Z unpretty=everybody_loops is your friend.</p>
<p>Basically, take the command line we used up above for macro-expanding pretty-printing, but replace the --pretty=expanded with -Zunpretty=everybody_loops.</p>
<p>As before, pipe the output to a temporary file, and then copy that over to kernel/src/lib.rs.</p>
<p>And then we build â€¦ and â€¦ oh. The bug didnâ€™t replicate.</p>
<ul>
<li>This is okay. It is not a disaster.</li>
</ul>
<p>It in fact motivates another technique: bisecting â€œloopificationâ€.</p>
<h3 id="bisecting-the-module-tree"><a class="header" href="#bisecting-the-module-tree">Bisecting the module tree</a></h3>
<p>Warning: this technique may seemâ€¦ strange. But I love it so.</p>
<p>The three steps are as follows:</p>
<ol>
<li>Unify modules into a single source file (which we did up above, via the pretty-printer). But in particular, leave leave the original source files for the mod tree in place. (Youâ€™ll see why in a moment.)</li>
<li>Replace all function bodies with loop { }(which we just did, again via the pretty-printer).</li>
</ol>
<blockquote>
<blockquote>
<p>If after doing this, you still get the same failure again, then congratulations: You have a single file (with a potentially huge module tree) and all of its function bodies are trivial loop { }. But of course, in our case of kernel, we know that we are not in this scenario. </p>
</blockquote>
</blockquote>
<ol start="3">
<li>Finally, swap modules in and out via â€œcfgmentingâ€.</li>
</ol>
<p>Remember up above when I suggested leaving the source files in place? This is where that comes into play.</p>
<p>A relatively tiny (and easily mechanized) change to the source code readily reverts individual modules back to their prior form:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod child_mod_1 {
    use import::stuff;
    fn some_function() -&gt; ReturnType {
        loop { }
    }

    mod even_more_inner {
       ...
    }
}

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod child_mod_1;

#[cfg(commented_out_for_bisection)]
mod child_mod_1 {
    use import::stuff;
    fn some_function() -&gt; ReturnType {
        loop { }
    }

    mod even_more_inner {
       ...
    }
}
<span class="boring">}</span></code></pre></pre>
<p>This effectively puts back in the original code for child_mod_1.</p>
<p>You can search through your single lib.rs (or main.rs) file that holds the whole module tree (where function bodies are replaced with loop { }), and then choose a subset of these modules and apply the above transformation to point them at their original source file.</p>
<p>You can do this for, e.g., the first half the modules, and then re-run the compiler to see if the failure re-arises. If so, huzzah!</p>
<p>I successfully used this methodology to identify which mod in kernel we needed to keep in non-loopified form in order to reproduce the bug: mod process;.</p>
<p>And that gets us down to:</p>
<pre><code>wc tock/kernel/src/lib.rs
    3253   11085  112858 tock/kernel/src/lib.rs

</code></pre>
<p>Yeah, still 3K lines. But thatâ€™s a lot better than 10K, and thereâ€™s plenty more stuff to remove.</p>
<p>First, lets see if we can further narrow down which methods in mod process are the ones that we need for replicating the bug. For this, we can do bisection over the fn items within the (still out-of-line) mod process.</p>
<hr />
<h3 id="reduction-via-bisection"><a class="header" href="#reduction-via-bisection">Reduction via Bisection</a></h3>
<p>Sometimes you cannot simply remove all (or all but one) of the method bodies. For one reason or another (e.g. impl Trait in return position) you need to preserve the bodies of one or more methods that are not directly relevant to the bug at hand.</p>
<p>In this scenario, it can stil be useful to use the techniques above to eliminate irrelevant details in the other methods. But what is the best way to identify which methods are relevant and which arenâ€™t? Well, thatâ€™s a fine segue to our original topic.</p>
<p>(â€¦ a significant amount of time has passed.)</p>
<p>Okay: after spending a lot of time doing pseudo-bisection, I managed to isolate three methods in process.rs that are necessary to reproduce the issue.</p>
<p>Part of my own process here (not process, ha ha) was to switch mindset away from trying to bisect to find the â€œone fn bodyâ€ that causes the faiure. Instead, I had to focus on identifying a minimal subset of bodies that are necessary to cause it to arise.</p>
<p>That is, starting with N fn items, Iâ€™d â€œloopifyâ€ N/2 of them, and if the bug went away on that half, Iâ€™d put back in the previous bodies, cut that set in in half, and repeat until the bug came back. This tended to narrow things down to one fn item that, when â€œloopifiedâ€, made the bug go away.</p>
<p>Then Iâ€™d mark that one fn as strictly necessary, and repeat the process on the N-1 fn-items that still remained.</p>
<p>To be clear: this switch in mindset changes so-called â€œbisectionâ€ from a O(log n) process to an O(n log n) one: because you are going to do a separate O(log n) bisection step on O(n) fn-items. But on the plus side, its still a pretty mindless process (and probably could be mechanically automated).</p>
<p>Eventually, this led me to identify the three functions in process.rs whose non-â€œloopifiedâ€ definitions are needed to witness the bug:</p>
<ul>
<li>load_processes</li>
<li><Process as ProcessType>::process_detail_fmt, and</li>
<li>Process::create.</li>
</ul>
<p>With that done, I redid the â€œmod-inliningâ€ of mod process into kernel.</p>
<h2 id="popping-the-stack"><a class="header" href="#popping-the-stack">Popping the stack</a></h2>
<p>Now, as a reminder: the reason we dived into kernel was to see if we could remove the stored_state field from struct Process:</p>
<pre><code>stored_state:
    Cell&lt;&lt;&lt;C as Chip&gt;::UserspaceKernelBoundary as UserspaceKernelBoundary&gt;::StoredState&gt;,
</code></pre>
<p>The answer is unfortuately still no: two of the three methods we kept from mod process refer to that field.</p>
<p>But we can do some directed editing to see if the bug repreoduces after removing those references:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -3067,12 +3067,6 @@ impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt; {
             flash_start
         ));

-        self.chip.userspace_kernel_boundary().process_detail_fmt(
-            self.sp(),
-            &amp;self.stored_state.get(),
-            writer,
-        );
-
         self.mpu_config.map(|config| {
             let _ = writer.write_fmt(format_args!(&quot;{}&quot;, config));
         });
@@ -3205,7 +3199,7 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {

             process.flash = slice::from_raw_parts(app_flash_address, app_flash_size);

-            process.stored_state = Cell::new(Default::default());
+            // process.stored_state = Cell::new(Default::default());
             process.state = Cell::new(State::Unstarted);
             process.fault_response = fault_response;

@@ -3246,6 +3240,7 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
                 }));
             });

+            /*
             let mut stored_state = process.stored_state.get();
             match chip.userspace_kernel_boundary().initialize_new_process(
                 process.sp(),
@@ -3263,6 +3258,7 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
                     return (None, app_flash_size, 0);
                 }
             };
+             */
</code></pre>
<p>And the answer is: YES. The bug reproduces!</p>
<p>And now we can move forward with removing that fieldâ€¦ YES, still reproduces:</p>
<pre><code class="language-diff">
--- a/tock/kernel/src/lib.rs
+++ b/tock/kernel/src/lib.rs
@@ -2809,9 +2809,6 @@ pub struct Process&lt;'a, C: 'static + Chip&gt; {

     header: tbfheader::TbfHeader,

-    stored_state:
-        Cell&lt;&lt;&lt;C as Chip&gt;::UserspaceKernelBoundary as UserspaceKernelBoundary&gt;::StoredState&gt;,
-
     state: Cell&lt;State&gt;,

     fault_response: FaultResponse,

</code></pre>
<p>And then see about removed the bound on the associated type that sent us on this pathâ€¦ YES</p>
<pre><code class="language-diff">--- a/tock/kernel/src/lib.rs
+++ b/tock/kernel/src/lib.rs
@@ -2525,7 +2525,7 @@ mod platform {
         type
         MPU: mpu::MPU;
         type
-        UserspaceKernelBoundary: syscall::UserspaceKernelBoundary;
+        UserspaceKernelBoundary;
         type
         SysTick: systick::SysTick;
         fn service_pending_interrupts(&amp;self) { loop  { } }

</code></pre>
<p>So now we can pop our stack: We can go back to chips/arty_e21, and apply â€œtype-trivializationâ€:</p>
<pre><code class="language-diff">
--- a/tock/chips/arty_e21/src/lib.rs
+++ b/tock/chips/arty_e21/src/lib.rs
@@ -21,7 +21,7 @@ impl ArtyExx {

 impl kernel::Chip for ArtyExx {
     type MPU = ();
-    type UserspaceKernelBoundary = rv32i::syscall::SysCall;
+    type UserspaceKernelBoundary = ();
     type SysTick = ();
 }
</code></pre>
<p>We did it!</p>
<p>With that in place, we can do more â€œdep-reductionâ€, by removing the rv32i dependency from chips/arty_e21.</p>
<p>At this point, we could continue with the above transformations to further reduce kernel.</p>
<p>But I want to switch to showing a different kind of minimization transformation, one that will let us make further simplifications to boards/arty-e21.</p>
<hr />
<h3 id="simplfying-the-existing-code"><a class="header" href="#simplfying-the-existing-code">Simplfying the existing code</a></h3>
<p>Looking again at boards/arty-e21, we have this method body:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>#[no_mangle]
pub unsafe fn reset_handler() {
    let chip = static_init!(arty_e21::chip::ArtyExx, arty_e21::chip::ArtyExx::new());
    let process_mgmt_cap = create_capability!(capabilities::ProcessManagementCapability);
    let board_kernel = static_init!(kernel::Kernel, kernel::Kernel::new(&amp;PROCESSES));

    kernel::procs::load_processes(
        board_kernel,
        chip,
        &amp;0u8 as *const u8,
        &amp;mut [0; 8192], // APP_MEMORY,
        &amp;mut PROCESSES,
        kernel::procs::FaultResponse::Panic,
        &amp;process_mgmt_cap,
    );
}
<span class="boring">}</span></code></pre></pre>
<p>It would be nice to figure out which parts of this are actually relevant.</p>
<p>Unfortunately, kernel::procs::load_processes was one of the functions where we could not apply â€œloopificationâ€ without masking the rustc bug.</p>
<p>Let us see if we can at least simplfify the API of load_processes itself.</p>
<p>It currently looks like this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn load_processes&lt;C: Chip&gt;(
    kernel: &amp;'static Kernel,
    chip: &amp;'static C,
    start_of_flash: *const u8,
    app_memory: &amp;mut [u8],
    procs: &amp;'static mut [Option&lt;&amp;'static dyn ProcessType&gt;],
    fault_response: FaultResponse,
    _capability: &amp;dyn ProcessManagementCapability,
) {
    let mut apps_in_flash_ptr = start_of_flash;
    let mut app_memory_ptr = app_memory.as_mut_ptr();
    let mut app_memory_size = app_memory.len();
    for i in 0..procs.len() {
        unsafe {
            let (process, flash_offset, memory_offset) = Process::create(
                kernel,
                chip,
                apps_in_flash_ptr,
                app_memory_ptr,
                app_memory_size,
                fault_response,
                i,
            );

            if process.is_none() {
                if flash_offset == 0 &amp;&amp; memory_offset == 0 {
                    break;
                }
            } else {
                procs[i] = process;
            }

            apps_in_flash_ptr = apps_in_flash_ptr.add(flash_offset);
            app_memory_ptr = app_memory_ptr.add(memory_offset);
            app_memory_size -= memory_offset;
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<p>The fact that Process::create was another function that we could not â€œloopifyâ€ gives us a hint has to how to simplfy this further: can we reduce this method body to just a Process::create call, and see if the bug persists?</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -2586,31 +2586,17 @@ pub fn load_processes&lt;C: Chip&gt;(
     let mut apps_in_flash_ptr = start_of_flash;
     let mut app_memory_ptr = app_memory.as_mut_ptr();
     let mut app_memory_size = app_memory.len();
-    for i in 0..procs.len() {
         unsafe {
-            let (process, flash_offset, memory_offset) = Process::create(
+            Process::create(
                 kernel,
                 chip,
                 apps_in_flash_ptr,
                 app_memory_ptr,
                 app_memory_size,
                 fault_response,
-                i,
+                0,
             );
-
-            if process.is_none() {
-                if flash_offset == 0 &amp;&amp; memory_offset == 0 {
-                    break;
-                }
-            } else {
-                procs[i] = process;
-            }
-
-            apps_in_flash_ptr = apps_in_flash_ptr.add(flash_offset);
-            app_memory_ptr = app_memory_ptr.add(memory_offset);
-            app_memory_size -= memory_offset;
         }
-    }
 }
</code></pre>
<p>And yes, the bug still reproduces.</p>
<hr />
<blockquote>
<p>theme: Simplify Workflow</p>
</blockquote>
<h3 id="tactic-rhs-inlining"><a class="header" href="#tactic-rhs-inlining">Tactic: â€œRHS-inliningâ€</a></h3>
<p>This is just the classic transformation of taking the right-hand side of a let or const and copying it into the usage sites for the variable defined by the let or const. Once all uses of the variable have been replaced, you can try removing the let or const itself (i.e. â€œunusedificationâ€)</p>
<p>In our specific case, we can apply this to load_processes:</p>
<pre><code class="language-diff">--- a/tock/kernel/src/lib.rs
+++ b/tock/kernel/src/lib.rs
@@ -2583,16 +2583,13 @@ pub fn load_processes&lt;C: Chip&gt;(
     fault_response: FaultResponse,
     _capability: &amp;dyn ProcessManagementCapability,
 ) {
-    let mut apps_in_flash_ptr = start_of_flash;
-    let mut app_memory_ptr = app_memory.as_mut_ptr();
-    let mut app_memory_size = app_memory.len();
         unsafe {
             Process::create(
                 kernel,
                 chip,
-                apps_in_flash_ptr,
-                app_memory_ptr,
-                app_memory_size,
+                start_of_flash,
+                app_memory.as_mut_ptr(),
+                app_memory.len(),
                 fault_response,
                 0,
             );

</code></pre>
<p>However, this technique on its own does not tend to actually reduce the problem at hand, in terms of making it possible for us to remove imports or simplify fn API signatures.</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h3 id="tactic-defaultification"><a class="header" href="#tactic-defaultification">Tactic: â€œDefaultificationâ€</a></h3>
<blockquote>
<blockquote>
<p>aka â€œScalars Gotta Scaleâ€</p>
</blockquote>
</blockquote>
<p>If you really want to simplify, then you should replace the occurences of the variable with some â€œobviousâ€ value based on its type.</p>
<p>(This is the obvious alternative to â€œloopificationâ€ when it comes to simplifying const fn.)</p>
<p>More specifically: frequently, the return type of a const fn (or the type of a const item) is some scalar type (like u32, f64, or bool). These all have â€œobviousâ€ values that you can just plug in (respectively 0, 0.0, or false).</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const fn cfoo(----) -&gt; u32 { ---- }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const fn cfoo(----) -&gt; u32 { 0 }

<span class="boring">}</span></code></pre></pre>
<p>In the case of load_processes, â€œdefaultificationâ€ yields this:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -2587,9 +2587,9 @@ pub fn load_processes&lt;C: Chip&gt;(
             Process::create(
                 kernel,
                 chip,
-                start_of_flash,
-                app_memory.as_mut_ptr(),
-                app_memory.len(),
+                0 as *const u8,
+                (&amp;mut []).as_mut_ptr(),
+                0,
                 fault_response,
                 0,
             );
</code></pre>
<p>That means weâ€™ve gotten rid of the uses of three fn parameters in the body of load_processes. Lets see what that can buy us for further reduction.</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h3 id="technique-genertrification"><a class="header" href="#technique-genertrification">Technique: â€œGenertrificationâ€</a></h3>
<blockquote>
<blockquote>
<p>aka â€œType Freedomâ€</p>
</blockquote>
</blockquote>
<p>Once you remove all uses of parameter (which is readily identifiable via either lint diagnostics or if the parameter has just _: ParamType for its declaration), you can â€œgenertrifyâ€ it to get rid of the use of ParamType.</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(_: ParamType, ----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo&lt;A&gt;(_: A, ----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>or even more simply (in terms of locality of the transformation):</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(_: impl Sized, ----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>The beauty of this is that it can almost always be applied even if there remain uses of foo elsewhere in the code.</p>
<p>Therefore, I tend to recommend it over â€œparam-eliminationâ€, described below.</p>
<ul>
<li>However, this transformation does not work if fn foo must not carry any generic type parameters; e.g., if fn foo needs to be object-safe, then you cannot add the type parameteter A.</li>
<li>The other case where it cannot be applied is when an existing use is relying on the existing type for inference purposes. We will see an example of this below.</li>
</ul>
<p>In the case of load_processes, â€œgenertrificationâ€ allows this change:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -2577,11 +2577,11 @@ use core::cmp::max;
 pub fn load_processes&lt;C: Chip&gt;(
     kernel: &amp;'static Kernel,
     chip: &amp;'static C,
-    start_of_flash: *const u8,
-    app_memory: &amp;mut [u8],
-    procs: &amp;'static mut [Option&lt;&amp;'static dyn ProcessType&gt;],
+    _: impl Sized,
+    _: impl Sized,
+    _: impl Sized,
     fault_response: FaultResponse,
-    _capability: &amp;dyn ProcessManagementCapability,
+    _: impl Sized,
 ) {
         unsafe {
             Process::create(
</code></pre>
<p>And once we do that, we can revise any calls to load_processes and pass any value we like for the impl Sized arguments. So weâ€™ve opened up new opportunities for â€œexpr-eliminationâ€:</p>
<pre><code class="language-diff">--- INDEX/tock/boards/arty-e21/src/main.rs
+++ WORKDIR/tock/boards/arty-e21/src/main.rs
@@ -39,17 +39,16 @@ impl Platform for ArtyE21 {
 #[no_mangle]
 pub unsafe fn reset_handler() {
     let chip = static_init!(arty_e21::chip::ArtyExx, arty_e21::chip::ArtyExx::new());
-    let process_mgmt_cap = create_capability!(capabilities::ProcessManagementCapability);
     let board_kernel = static_init!(kernel::Kernel, kernel::Kernel::new(&amp;PROCESSES));

     kernel::procs::load_processes(
         board_kernel,
         chip,
-        &amp;0u8 as *const u8,
-        &amp;mut [0; 8192], // APP_MEMORY,
-        &amp;mut PROCESSES,
+        (),
+        (),
+        (),
         kernel::procs::FaultResponse::Panic,
-        &amp;process_mgmt_cap,
+        (),
     );

 }
</code></pre>
<p>We would like to continue simplifying the APIs by applying â€œgenertrificationâ€ elsewhere. For example, load_processes calls Process::create, so it would be useful to simplify its API.</p>
<p>The body of Process::create is currently over 150 lines of code. But after bisection-based â€œexpr-eliminationâ€, coupled with â€œRHS-inliningâ€, â€œdefaultificationâ€, and â€œunusedificationâ€, we can get the body down to this far more managable 20 lines:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
    #[allow(clippy::cast_ptr_alignment)]
    crate unsafe fn create(
        kernel: &amp;'static Kernel,
        chip: &amp;'static C,
        app_flash_address: *const u8,
        remaining_app_memory: *mut u8,
        remaining_app_memory_size: usize,
        fault_response: FaultResponse,
        index: usize,
    ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
            let mut process: &amp;mut Process&lt;C&gt; =
                &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

            process.debug = MapCell::new(ProcessDebug {
                app_heap_start_pointer: None,
                app_stack_start_pointer: None,
                min_stack_pointer: 0 as *const u8,
                syscall_count: 0,
                last_syscall: None,
                dropped_callback_count: 0,
                restart_count: 0,
                timeslice_expiration_count: 0,
            });

            return (
                Some(process),
                0usize,
                0usize,
            );
    }
    ...
}
<span class="boring">}</span></code></pre></pre>
<p>And now we can apply â€œgenertrificationâ€:</p>
<pre><code class="language-diff">
--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -3065,13 +3065,13 @@ fn exceeded_check(size: usize, allocated: usize) -&gt; &amp;'static str { loop { } }
 impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
     #[allow(clippy::cast_ptr_alignment)]
     crate unsafe fn create(
-        kernel: &amp;'static Kernel,
+        kernel: impl Sized,
         chip: &amp;'static C,
-        app_flash_address: *const u8,
+        app_flash_address: impl Sized,
         remaining_app_memory: *mut u8,
-        remaining_app_memory_size: usize,
-        fault_response: FaultResponse,
-        index: usize,
+        remaining_app_memory_size: impl Sized,
+        fault_response: impl Sized,
+        index: impl Sized,
     ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
             let mut process: &amp;mut Process&lt;C&gt; =
                 &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);
</code></pre>
<h4 id="you-cant-always-genertrify-what-you-want"><a class="header" href="#you-cant-always-genertrify-what-you-want">â€œyou canâ€™t always genertrify what you wantâ€</a></h4>
<p>Unfortunately, I was not able to â€œgenertrifyâ€ the remaining_app_memory formal parameter, even though it is unused in the function body. Why is this? Because the current call-site is relying on the type of the formal parameter for inference purposes. So in this case, we need to update the API in tandem with the call site:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -2588,7 +2588,7 @@ pub fn load_processes&lt;C: Chip&gt;(
                 (),
                 chip,
                 (),
-                (&amp;mut []).as_mut_ptr(),
+                (),
                 0,
                 (),
                 0,
@@ -3068,7 +3068,7 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
         kernel: impl Sized,
         chip: &amp;'static C,
         app_flash_address: impl Sized,
-        remaining_app_memory: *mut u8,
+        remaining_app_memory: impl Sized,
         remaining_app_memory_size: impl Sized,
         fault_response: impl Sized,
         index: impl Sized,
</code></pre>
<p>This allows further â€œexpr-eliminationâ€:</p>
<pre><code class="language-diff">
--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -3076,17 +3076,6 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
             let mut process: &amp;mut Process&lt;C&gt; =
                 &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

-            process.debug = MapCell::new(ProcessDebug {
-                app_heap_start_pointer: None,
-                app_stack_start_pointer: None,
-                min_stack_pointer: 0 as *const u8,
-                syscall_count: 0,
-                last_syscall: None,
-                dropped_callback_count: 0,
-                restart_count: 0,
-                timeslice_expiration_count: 0,
-            });
-
             return (
                 Some(process),
                 0usize,
</code></pre>
<p>and we bave gotten Process::create down to something that actually is close to minimal, at least with given the transformations we have covered so far:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
    #[allow(clippy::cast_ptr_alignment)]
    crate unsafe fn create(
        kernel: impl Sized,
        chip: &amp;'static C,
        app_flash_address: impl Sized,
        remaining_app_memory: impl Sized,
        remaining_app_memory_size: impl Sized,
        fault_response: impl Sized,
        index: impl Sized,
    ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
            let mut process: &amp;mut Process&lt;C&gt; =
                &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

            return (
                Some(process),
                0usize,
                0usize,
            );
    }
...
}
<span class="boring">}</span></code></pre></pre>
<p>But of course, we can go further!</p>
<h3 id="once-all-the-code-is-gone-"><a class="header" href="#once-all-the-code-is-gone-">Once all the code is gone â€¦</a></h3>
<p>The applicability of many of the remaining patterns depends on whether you have successfully trivialized all or most method bodies. That is, if you have gotten rid of most of the complex expressions in the program, then you can usually remove things like struct field declarations or any â€œinterestingâ€ types on formal parameters.</p>
<p>So, lets see if we can further reduce the complexity of our example by simplifying the APIs of the functions involved.</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h3 id="technique-param-elimination"><a class="header" href="#technique-param-elimination">Technique: â€œParam-eliminationâ€</a></h3>
<p>If you have successfully eliminated all uses of a method foo, then you can apply this transformation:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(_: ArgType, ----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>In some rare cases, the compiler bug will requires a method signature to keep the same number of arguments; for that scenario, you can instead use â€œtype-trivializationâ€ for the parameter:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(_: ArgType, ----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(_: (), ----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>Either way, these transformations can only be applied if all uses of foo have been eliminated via trivialization of bodies as described above (or if you are willing to update them all accordingly). Thus, I tend to recommend applying â€œgenertrificationâ€ instead: that transformation can be applied without concern about the usage sites.</p>
<p>Of course, if you have already applied â€œgenertrificationâ€ and also updated all call sites to pass something trivial like (), then you can readily apply either â€œparam-eliminationâ€ or â€œtype-trivializationâ€: it really should be easy to update the call-sites in that scenario.</p>
<p>In our particular case of Process::create, we currently have a fn-signature that looks like:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>crate unsafe fn create(
    kernel: impl Sized,
    chip: &amp;'static C,
    app_flash_address: impl Sized,
    remaining_app_memory: impl Sized,
    remaining_app_memory_size: impl Sized,
    fault_response: impl Sized,
    index: impl Sized,
) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
<span class="boring">}</span></code></pre></pre>
<p>And we already updated the single call-site to pass () or 0 for each of the parameters of type impl Sized, so now we can just remove them entirely:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -2585,13 +2585,7 @@ pub fn load_processes&lt;C: Chip&gt;(
 ) {
         unsafe {
             Process::create(
-                (),
                 chip,
-                (),
-                (),
-                0,
-                (),
-                0,
             );
         }
 }
@@ -3065,13 +3059,7 @@ fn exceeded_check(size: usize, allocated: usize) -&gt; &amp;'static str { loop { } }
 impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
     #[allow(clippy::cast_ptr_alignment)]
     crate unsafe fn create(
-        kernel: impl Sized,
         chip: &amp;'static C,
-        app_flash_address: impl Sized,
-        remaining_app_memory: impl Sized,
-        remaining_app_memory_size: impl Sized,
-        fault_response: impl Sized,
-        index: impl Sized,
     ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
             let mut process: &amp;mut Process&lt;C&gt; =
                 &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

</code></pre>
<p>And compiling still hits the same ICE, so this â€œparam-eliminationâ€ was a legitimate reduction of the problem.</p>
<p>Next weâ€™ll consider a related transformation on the fn-signature.</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h3 id="technique-ret-elimination"><a class="header" href="#technique-ret-elimination">Technique: â€œRet-eliminationâ€</a></h3>
<p>If you have successfully eliminated all uses of the value returned from calls to foo, then you can apply this transformation:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) -&gt; ReturnType { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) { loop { } }

<span class="boring">}</span></code></pre></pre>
<p>If fn foo still has a body, then you can just turn every return point in the body into a normal expression:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) -&gt; ReturnType { if A { return B; } TailReturn }

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) { if A { B; } TailReturn; }

<span class="boring">}</span></code></pre></pre>
<p>In our case, the sole call to Process::create now looks like this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    unsafe {
        Process::create(
            chip,
        );
    }

<span class="boring">}</span></code></pre></pre>
<p>So we can directly apply â€œret-eliminationâ€ to the definition of Process::create:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -3060,11 +3060,11 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
     #[allow(clippy::cast_ptr_alignment)]
     crate unsafe fn create(
         chip: &amp;'static C,
-    ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
+    ) {
             let mut process: &amp;mut Process&lt;C&gt; =
                 &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

-            return (
+            (
                 Some(process),
                 0usize,
                 0usize,
</code></pre>
<p>Butâ€¦ Ah ha! Doing this causes the compilation error to disappear!</p>
<p>What happened?</p>
<p>Well, inspecting the return type, we can see that â€œRet-eliminationâ€ in this case has gotten rid of the type: (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize). Nested within that tuple, we see the type &amp;'static dyn ProcessType. So, the attemtpt to return (Some(process), 0, 0) is causing the generated code to coerce the process: &amp;mut Process<C> into a trait-object of type &amp;dyn ProcessType. And apparently this is part of generating the bug!</p>
<p>So, do not look at this reduction-failure as a set-back: It in fact may serve as a clue as to the root cause of the bug.</p>
<hr />
<h3 id="final-reduction-touches-on-processcreate"><a class="header" href="#final-reduction-touches-on-processcreate">Final reduction touches on Process::create</a></h3>
<p>For Process::create, we have:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
    #[allow(clippy::cast_ptr_alignment)]
    crate unsafe fn create(
        chip: &amp;'static C,
    ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
            let mut process: &amp;mut Process&lt;C&gt; =
                &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

            return (
                Some(process),
                0usize,
                0usize,
            );
    }
    ...
}
<span class="boring">}</span></code></pre></pre>
<p>We can simplfy this API by reducing the return type to the core element that matters: the trait object:</p>
<pre><code class="language-diff">--- a/tock/kernel/src/lib.rs
+++ b/tock/kernel/src/lib.rs
@@ -3045,15 +3045,11 @@ impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
     #[allow(clippy::cast_ptr_alignment)]
     crate unsafe fn create(
         chip: &amp;'static C,
-    ) -&gt; (Option&lt;&amp;'static dyn ProcessType&gt;, usize, usize) {
+    ) -&gt; &amp;'static dyn ProcessType {
             let mut process: &amp;mut Process&lt;C&gt; =
                 &amp;mut *((&amp;mut []).as_mut_ptr() as *mut Process&lt;'static, C&gt;);

-            return (
-                Some(process),
-                0usize,
-                0usize,
-            );
+            process
     }

     #[allow(clippy::cast_ptr_alignment)]
</code></pre>
<p>In fact, we can do even better. The initialization expression on the right-hand side of let mut process = ... is ugly, and its actually completely irrelevant.</p>
<p>In cases like these where we are hitting an ICE, we can use a special kind of â€œdefaultificationâ€ to conjure up types without needing any knowledge of their expression.</p>
<hr />
<blockquote>
<p>theme: Trivialize Content</p>
</blockquote>
<h3 id="technique-none-defaulting"><a class="header" href="#technique-none-defaulting">Technique: â€œNone-defaultingâ€</a></h3>
<blockquote>
<blockquote>
<p>This is yet another case where the fact that we are debugging a compile-time issue is crucial. You obviously cannot be tossing None.unwrap() into code you expect to run usefully.</p>
</blockquote>
</blockquote>
<p>The idea of â€œnone-defaultingâ€ is simple: You need the compiler to think you have a value of type T. But the steps to make an instance of T are not relevant to reproducing the bug. So just make a None::<T>, and unwrap it.</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: T = ----;
<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: T = None.unwrap();
<span class="boring">}</span></code></pre></pre>
<p>In our case, applying this technique to Process::create yields this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
    #[allow(clippy::cast_ptr_alignment)]
    crate unsafe fn create(
        chip: &amp;'static C,
    ) -&gt; &amp;'static dyn ProcessType {
            let mut process: &amp;mut Process&lt;C&gt; = None.unwrap();

            process
    }
    ...
}
<span class="boring">}</span></code></pre></pre>
<p>And compiling this, the ICE still reproduces!</p>
<h2 id="so-where-are-we-now"><a class="header" href="#so-where-are-we-now">So, where are we now</a></h2>
<p>Weâ€™ve still got a set of three crates, one of which is over 3,000 lines long.</p>
<p>But weâ€™ve also reduced the set of non-trival functions in that big crate to just three:</p>
<ul>
<li>Process::create,</li>
<li>load_processes, and</li>
<li><Process as ProcessType>::process_detail_fmt.</li>
</ul>
<p>If you think for a momeent, you can see how everything is tying together here: This ICE is occurring in the midst of some step of code-generation. We previously established that in order to observe the ICE, the compiler needs to handle code-generation for the coercion from &amp;Process to a trait object &amp;dyn ProcessType . A method like <Process as ProcessType>::process_detail_fmt is part of the virtual-methods that get their code generated as part of that coercion.</p>
<p>We already showed Process::create is now pretty trivial.</p>
<p>As for load_processes, after doing some additional â€œunusedificationâ€ and â€œparam-eliminationâ€ we can get it down to this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn load_processes&lt;C: Chip&gt;(
    chip: &amp;'static C,
) {
        unsafe {
            Process::create(
                chip,
            );
        }
}
<span class="boring">}</span></code></pre></pre>
<p>which we might as well rewrite into the one-liner:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn load_processes&lt;C: Chip&gt;(chip: &amp;'static C) { unsafe { Process::create(chip); } }

<span class="boring">}</span></code></pre></pre>
<p>That just leaves <Process as ProcessType>::process_detail_fmt, which we have not looked at yet.</p>
<p>As part of the earlier (undocumented) bisection process on the out-of-line mod process;, I already â€œsimpl-impledâ€ the ProcessType trait declaration, so it looks like this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait ProcessType {
    fn appid(&amp;self) -&gt; AppId { loop { } }
    ...
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) { loop { } }
    ...
}
<span class="boring">}</span></code></pre></pre>
<p>This means we can remove all of the irrelevant methods from the impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt;, leaving us with just the single method:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt; {
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) {
        ...
    }
}

<span class="boring">}</span></code></pre></pre>
<p>And since this is now the only impl of ProcessType, we can also remove the other methods from the ProcessType trait itself:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait ProcessType {
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) { loop { } }
}

<span class="boring">}</span></code></pre></pre>
<p>I cannot stress how satisfying it is to be able to retest the ICE in between each of these steps. It gives you excellent points to pause, get up from the keyboard and take a walk (which is another surprisingly effective debugging methodology).</p>
<p>But we still have the body of fn process_detail_fmt itself, which is about 175 lines of code. So lets try to winnow that down.</p>
<p>â€œSuffix-bisectionâ€ ends up revealing that the ICE is triggered by this bit of code in the method.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    self.mpu_config.map(|config| {
        let _ = writer.write_fmt(format_args!(&quot;{}&quot;, config));
    });

<span class="boring">}</span></code></pre></pre>
<p>And so we can â€œexpr-eliminateâ€ all the rest, leaving this defintion of the method:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt; {
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) {
        self.mpu_config.map(|config| {
            let _ = writer.write_fmt(format_args!(&quot;{}&quot;, config));
        });
    }
}

<span class="boring">}</span></code></pre></pre>
<p>That looks pretty simple (after all, its a a three line body). But its still doing some relatively interesting stuff: thereâ€™s that format_args! macro in there, and a closure being constructed.</p>
<p>We might try to simplify the body further: turn the closure body into the main body of process_detail_fmt itself.</p>
<p>The closure takes an input of type config; a quick inspect of the map method shows that should have the same type as is fed into the MapCell here:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mpu_config: MapCell&lt;&lt;&lt;C as Chip&gt;::MPU as MPU&gt;::MpuConfig&gt;,

<span class="boring">}</span></code></pre></pre>
<p>Unfortunately, we quickly discover that just moving the closure body into the process_detail_fmt method is not a valid reduction. That is, I tried compiling with this definition instead:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt; {
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) {
        let config = None::&lt;&lt;&lt;C as Chip&gt;::MPU as MPU&gt;::MpuConfig&gt;.unwrap();
        let _ = writer.write_fmt(format_args!(&quot;{}&quot;, config));
    }
}

<span class="boring">}</span></code></pre></pre>
<p>and got this ICE:</p>
<pre><code>error: internal compiler error: src/librustc/traits/codegen/mod.rs:53: Encountered error `Unimplemented` selecting `Binder(&lt;() as core::fmt::Display&gt;)` during codegen

</code></pre>
<blockquote>
<blockquote>
<p>When reduction uncovers a different bug, it is of course good practice to record that distinct state of the test source code somewhere. E.g. you could make a separate git branch for it, and come back to later.</p>
</blockquote>
</blockquote>
<p>That is certainly a similar looking ICE. But if we want to be sure about our reduction, we really need to see the same error: if we donâ€™t see [FulfillmentError(Obligation(...))], then we should not be satisifed.</p>
<p>So, we apparently have to keep more of the original code from process_detail_fmt.</p>
<p>At this point we must note that MapCell is a type that kernel is pulling in from another crate, tock-cells.</p>
<p>So we might need to go and modify code over in tock-cells if we want to fully reduce this code.</p>
<p>Or we might be able to get away with just copying its definition locally, avoiding the hassle of the full process of reducing the tock-cells crate itself.</p>
<hr />
<blockquote>
<p>themes: Eliminate Coupling, Identify the Unnecessary</p>
</blockquote>
<h3 id="tactic-cut-spaghetti-imports"><a class="header" href="#tactic-cut-spaghetti-imports">Tactic: â€œCut-spaghetti-importsâ€</a></h3>
<p>This is pretty easy: If youâ€™ve â€œloopifiedâ€ most of your code, you can often do this replacement.</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ...::Type;
<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Type;
<span class="boring">}</span></code></pre></pre>
<p>or, if applicable:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>type Type = ();
<span class="boring">}</span></code></pre></pre>
<p>If you havenâ€™t done full â€œloopificationâ€ everywhere (our situation), then you may need to do this.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Type { ... } // (adapt definition from elsewhere, potentially via cut-and-paste).
impl Type { ... }
<span class="boring">}</span></code></pre></pre>
<p>Note: may need to add (potentially artificial) generic parameters, like so:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ...::Type;
<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct&lt;'a, T&gt; Type(&amp;'a (), Option&lt;T&gt;);
<span class="boring">}</span></code></pre></pre>
<p>or</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>type Type&lt;'a, T&gt; = (&amp;'a (), Option&lt;T&gt;);
<span class="boring">}</span></code></pre></pre>
<p>In our case, we are going to make a local version of tock_cells::MapCell.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct MapCell&lt;T&gt; {
    val: core::cell::UnsafeCell&lt;core::mem::MaybeUninit&lt;T&gt;&gt;,
    occupied: Cell&lt;bool&gt;,
}
impl&lt;T&gt; MapCell&lt;T&gt; {
    pub fn is_some(&amp;self) -&gt; bool {
        self.occupied.get()
    }
    pub fn map&lt;F, R&gt;(&amp;self, closure: F) -&gt; Option&lt;R&gt;
    where
        F: FnOnce(&amp;mut T) -&gt; R,
    {
        if self.is_some() {
            self.occupied.set(false);
            let valref = unsafe { &amp;mut *self.val.get() };
            // TODO: change to valref.get_mut() once stabilized [#53491](https://github.com/rust-lang/rust/issues/53491)
            let res = closure(unsafe { &amp;mut *valref.as_mut_ptr() });
            self.occupied.set(true);
            Some(res)
        } else {
            None
        }
    }
}

<span class="boring">}</span></code></pre></pre>
<p>I got this by cut-and-pasting the definiton for struct MapCell<T> (and then fixing its types so I could avoid adding use statements elsewhere), and then cut-and-pasting its fn map method, and finally cut-and-pasting its fn is_some method after a compilation attempt said that was missing.</p>
<p>With that done, compilation continues to show the ICE.</p>
<p>If you â€œloopifyâ€ the body of MapCell::map, the ICE goes away. There is something relevant inside there.</p>
<p>Some intelligent (as in, non-mechanical) â€œexpr-eliminationâ€ and â€œnone-defaultingâ€ gets MapCell::map down to this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T&gt; MapCell&lt;T&gt; {
    pub fn map&lt;F, R&gt;(&amp;self, closure: F) -&gt; Option&lt;R&gt;
    where
        F: FnOnce(&amp;mut T) -&gt; R,
    {
            closure(None::&lt;&amp;mut T&gt;.unwrap());
            loop { }
    }
}

<span class="boring">}</span></code></pre></pre>
<p>Compilation still shows the same ICE here, so we havenâ€™t lost anything yet.</p>
<p>And yet, this version of map does not use self at all!</p>
<p>This brings us to another kind of simplification: going from object methods to top-level functions.</p>
<hr />
<blockquote>
<p>themes: Identify the Unnecessary, Trivialize Content</p>
</blockquote>
<h3 id="tactic-deobjectification"><a class="header" href="#tactic-deobjectification">Tactic: â€œDeobjectificationâ€</a></h3>
<p>The goal of â€œdeobjectificationâ€ is to replace a method defined in an impl with a top-level function. Moving some necessary component for reproducing the bug out of the impl can make the impl itself unnecessary, and thus removable.</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;X&gt; Type&lt;X&gt; {
    pub fn foo&lt;T&gt;(&amp;self, args: ---) -&gt; ReturnType { --- } // where `---` does not use `Self`/`self`
}

<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn top_foo&lt;X, T&gt;(args: ---) -&gt; ReturnType { --- }

<span class="boring">}</span></code></pre></pre>
<p>In our case, lets try to pull MapCell::map out of MapCell:</p>
<pre><code class="language-diff">--- a/tock/kernel/src/lib.rs
+++ b/tock/kernel/src/lib.rs
@@ -2577,6 +2577,13 @@ impl&lt;T&gt; MapCell&lt;T&gt; {
             loop { }
     }
 }
+
+fn mapcell_map&lt;T, F, R&gt;(closure: F) -&gt; Option&lt;R&gt; where F: FnOnce(&amp;mut T) -&gt; R
+{
+    closure(None::&lt;&amp;mut T&gt;.unwrap());
+    loop { }
+}
+
 use crate::common::{Queue, RingBuffer};
 use crate::mem::{AppSlice, Shared};
 use crate::platform::mpu::{self, MPU};
@@ -2719,7 +2726,7 @@ pub struct Process&lt;'a, C: 'static + Chip&gt; {

 impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt; {
     unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) {
-        self.mpu_config.map(|config| {
+        mapcell_map(|config: &amp;mut &lt;&lt;C as Chip&gt;::MPU as MPU&gt;::MpuConfig| {
             let _ = writer.write_fmt(format_args!(&quot;{}&quot;, config));
         });
     }
</code></pre>
<p>Success: compilation still ICEâ€™s in the same way.</p>
<p>And now that weâ€™ve remove the last uses of fields in self for Process, we can simplify its definition considerably:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Process&lt;'a, C: 'static + Chip&gt; {
    chip: &amp;'static C,
    tasks: &amp;'a (),
}

<span class="boring">}</span></code></pre></pre>
<p>(And that simplification lets us remove the struct MapCell we added a few steps ago, since we no longer need it for the now-eliminated mpu_config field.)</p>
<p>So now weâ€™ve reduced all three methods to pretty simple bodies; we had to add a fourth method (mapcell_map) in the process; but that method was always there all along as part of the puzzle. It had just been waiting for us in the upstream tock-cells crate.</p>
<p>Furthermore, we can apply â€œret-eliminationâ€ to mapcell_map, both on the fn mapcell_map itself, and on its closure argument:</p>
<pre><code class="language-diff">--- INDEX/tock/kernel/src/lib.rs
+++ WORKDIR/tock/kernel/src/lib.rs
@@ -2564,10 +2564,9 @@ use core::{mem, ptr, slice, str};

 use crate::callback::{AppId, CallbackId};
 use crate::capabilities::ProcessManagementCapability;
-fn mapcell_map&lt;T, F, R&gt;(closure: F) -&gt; Option&lt;R&gt; where F: FnOnce(&amp;mut T) -&gt; R
+fn mapcell_map&lt;T, F&gt;(closure: F) where F: FnOnce(&amp;mut T)
 {
     closure(None::&lt;&amp;mut T&gt;.unwrap());
-    loop { }
 }

 use crate::common::{Queue, RingBuffer};

</code></pre>
<p>We have now gotten ourself down to the following core set of methods:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>fn mapcell_map&lt;T, F&gt;(closure: F) where F: FnOnce(&amp;mut T)
{
    closure(None::&lt;&amp;mut T&gt;.unwrap());
}

...

pub fn load_processes&lt;C: Chip&gt;(chip: &amp;'static C) { unsafe { Process::create(chip); } }

pub struct Process&lt;'a, C: 'static + Chip&gt; {
    chip: &amp;'static C,
    tasks: &amp;'a (),
}

pub trait ProcessType {
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) { loop { } }
}

...

impl&lt;C: Chip&gt; ProcessType for Process&lt;'a, C&gt; {
    unsafe fn process_detail_fmt(&amp;self, writer: &amp;mut dyn Write) {
        mapcell_map(|config: &amp;mut &lt;&lt;C as Chip&gt;::MPU as MPU&gt;::MpuConfig| {
            let _ = writer.write_fmt(format_args!(&quot;{}&quot;, config));
        });
    }
}

...

impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
    #[allow(clippy::cast_ptr_alignment)]
    crate unsafe fn create(
        chip: &amp;'static C,
    ) -&gt; &amp;'static dyn ProcessType {
            let mut process: &amp;mut Process&lt;C&gt; = None.unwrap();

            process
    }
}
<span class="boring">}</span></code></pre></pre>
<hr />
<blockquote>
<p>theme: Eliminate Coupling</p>
</blockquote>
<h3 id="technique-ret-ascription"><a class="header" href="#technique-ret-ascription">Technique: â€œRet-ascriptionâ€</a></h3>
<p>We could further reduce Process::create a tiny bit: We can remove its return type, as long as we ensure that the coercion implied by the return type still happens in the code.</p>
<p>This is a variant on â€œret-eliminationâ€: we again want to remove the return type from the fn signature, but this time we will also ensure that any coercions implied by the return type still occur:</p>
<p>Change:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) -&gt; ReturnType { if A { return B; } TailReturn }
<span class="boring">}</span></code></pre></pre>
<p>to:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo(----) { if A { let _: ReturnType = B; } let _: ReturnType = TailReturn; }
<span class="boring">}</span></code></pre></pre>
<p>For Process::create, this looks like this:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;C: 'static + Chip&gt; Process&lt;'a, C&gt; {
    #[allow(clippy::cast_ptr_alignment)]
    crate unsafe fn create(
        chip: &amp;'static C,
    ) {
        let mut process: &amp;mut Process&lt;C&gt; = None.unwrap();

        let _: &amp;'static dyn ProcessType = process;
    }
}
<span class="boring">}</span></code></pre></pre>
<p>And furthermore, we can apply â€œdeobjectificationâ€ and â€œparam-eliminationâ€ here; this method doesnâ€™t even have a self parameter.</p>
<p>That gets us here:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn load_processes&lt;C: Chip&gt;(_: &amp;'static C) { process_create::&lt;C&gt;(); }

fn process_create&lt;C: 'static + Chip&gt;() {
    let _: &amp;'static dyn ProcessType = None::&lt;&amp;mut Process&lt;C&gt;&gt;.unwrap();
}
<span class="boring">}</span></code></pre></pre>
<h2 id="take-a-breath"><a class="header" href="#take-a-breath">Take a breath</a></h2>
<p>Now that all of the involved methods seem relatively small, this seems like a good time to take a breath.</p>
<p>At this point, we could try to take these pieces and build-up a new example from scratch, preserving the core elements identified above. Thatâ€™s not a bad idea at all, at this point; it could be worth spending a half-hour or so on. Either building up an example from scratch will work, or it wonâ€™t. Letâ€™s assume for now that we are not able to jump to a minimal example, even with the pieces we have identified as core to the problem up above?</p>
<p>What now?</p>
<p>We could attempt to remove large swaths of code from the example as it stands: After all, we know we just need these methods; can we just comment everything else out?</p>
<p>Well, no. You canâ€™t just comment random things out. The interdependencies in the crate graph will frustrate attempts to do so.</p>
<p>For example, I tried commenting out most of the code after the mod process { ... }, in the lib.rs, and got a slew of â€œunresolved importâ€ errors. So, if you want to continue reducing this exmaple, we need to do it in a more directed fashion.</p>
<p>In the interest of trying to follow a semi-mindless process here, lets look at what we need to do in order to really minimize kernel to its core:</p>
<ol>
<li>We have to finish minimizing the leaves. There are crates unrelated to the ICE still being pulled into the build here, and they rely on things in kernel that we will not be able to remove until those crates are themselves reduced or otherwise eliminated from the crate graph.</li>
</ol>
<p>For us, we can apply some of the other techniques we have learned about to the leaf crates, such as using â€œnone-defaultingâ€ to create an instance of arty_e21::chip::ArtyExx in board/argy-e21/main.rs.</p>
<ol start="2">
<li>We have to reducing the coupling within kernel itself. It can be maddening trying to comment out modules at random. When that madness becomes too much for me, I force myself to adopt a more disciplined approach: I use the â€œcut-spaghetti-importsâ€ tactic to replace the existing use imports with local definitions. (Remember: since most fn-items in every module are â€œloopifiedâ€, the â€œcut-spaghetti-importsâ€ tactic will work fairly often.</li>
<li>This goes hand-in-hand with the general point above about reducing coupling within kernel: We have to finish mimimizing mod process { ... } itself within kernel. All of the interesting functions for reproducing the bug live there, so we know we cannot â€œcfgmentâ€ out that module for now. But if we have to keep mod process, we wonâ€™t be able to remove the other modules until we remove the dependencies that it has on those modules.</li>
</ol>
<p>I hope to return to this richly-documented minimization of rust-lang/rust#65774 the future; and when I do, I hope to cover all three of the points above.</p>
<p>But for now, I hope this was a helpful tour of various minimization technique that you can employ for reducing ICEs and other static analysis bugs in rustc.</p>
<h2 id="refer-37"><a class="header" href="#refer-37">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p>åç»­å€¼å¾—ç»†è¯»çš„:</p>
<ul>
<li><a href="http://blog.pnkfx.org/blog/2022/05/12/linking-rust-crates/">Linking Rust Crates, Part 1 - The {pnk}f(eli)x Blog</a></li>
<li><a href="http://blog.pnkfx.org/blog/2022/01/10/why-i-use-a-debugger/">Why I use a debugger - The {pnk}f(eli)x Blog</a></li>
<li><a href="http://blog.pnkfx.org/blog/2019/06/26/breaking-news-non-lexical-lifetimes-arrives-for-everyone/">Breaking News: Non-Lexical Lifetimes arrives for everyone - The {pnk}f(eli)x Blog</a></li>
<li><a href="http://blog.pnkfx.org/blog/categories/turbowish/">Category: turbowish - The {pnk}f(eli)x Blog</a></li>
<li>...</li>
</ul>
<h2 id="logging-25"><a class="header" href="#logging-25">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230228 ZQ init.</li>
</ul>
<pre><code>     _~^*~~_
 \/ /  * â—·  \ \/
   '_   â¡   _'
   \ '--+--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="crateä¸­åˆç†åˆ’åˆ†ç›®å½•"><a class="header" href="#crateä¸­åˆç†åˆ’åˆ†ç›®å½•">Crateä¸­åˆç†åˆ’åˆ†ç›®å½•</a></h1>
<blockquote>
<p>tips...é‡è¦ä¹Ÿä¸é‡è¦</p>
</blockquote>
<h2 id="background-25"><a class="header" href="#background-25">background</a></h2>
<p><a href="tip//dev/cli_ferris_art.html">Ferrisè‰ºæœ¯</a> ä¸­è§¦å‘çš„çµé­‚é—®é¢˜...</p>
<h2 id="goal-31"><a class="header" href="#goal-31">goal</a></h2>
<p>æ¯”å¦‚å½“å‰ crate ç›®å½•:</p>
<pre><code>foo/
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bar1/
â”‚   â”‚   â””â”€â”€ echo.rs
â”‚   â”œâ”€â”€ bar1.rs
â”‚   â”œâ”€â”€ bar2/
â”‚   â”‚   â””â”€â”€ echo.rs
â”‚   â”œâ”€â”€ bar2.rs
â”‚   â””â”€â”€ main.rs
...
</code></pre>
<p>åœ¨ä¸¤ä¸ª echo.rs ä¸­éƒ½æœ‰ç›¸åŒå‡½æ•°ä¸è¿‡å†…å®¹ä¸åŒ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>//src/bar1/echo.rs:
pub fn bang() {
    println!(&quot;src/bar1/echo.rs: {}&quot;, env!(&quot;CARGO_PKG_VERSION&quot;));
}

//src/bar2/echo.rs:
pub fn bang() {
    println!(&quot;src/bar2/echo.rs: {}&quot;, env!(&quot;CARGO_PKG_VERSION&quot;));
}
<span class="boring">}</span></code></pre></pre>
<p>å¦‚ä½•èƒ½è‡ªå¦‚çš„:</p>
<ul>
<li>åœ¨ main.rs ä¸­è°ƒç”¨ bar1,bar2 ä¸­çš„å¯¹è±¡?</li>
<li>åœ¨ bar1/echo.rs ä¸­åˆå¦‚ä½•è°ƒç”¨ bar2/echo.rs ä¸­çš„å¯¹è±¡?</li>
<li>...ä»¥åŠä¸ºä»€ä¹ˆ?</li>
</ul>
<h2 id="trace-27"><a class="header" href="#trace-27">trace</a></h2>
<p>æŒ‰ç…§ Python ä¸­çš„ç»éªŒ, è¿›è¡Œäº†å°è¯•, è¶Šè°ƒè¶Šä¹±;</p>
<p>ç›´åˆ°æœç´¢åˆ°: <a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html#binaries">Cargo Targets - The Cargo Book</a></p>
<p>æ‰æ˜ä»æ ¹å„¿ä¸Šå°±å¿½ç•¥äº†ä¸€ç‚¹:</p>
<pre><code>ä¸€ä¸ªåŒ…å¯ä»¥åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶ crate é¡¹å’Œä¸€ä¸ªå¯é€‰çš„ crate åº“
</code></pre>
<p>å°±æ˜¯é‚£ä¸ª <code>ä¸€ä¸ª</code> å¯é€‰....</p>
<p>æ‰€ä»¥,å¿…é¡»è¦ä»ä¸€å¼€å§‹å…ˆæ•´ç†å¥½ç›®å½•ç»“æ„, æ‰å¯èƒ½å¼€å±•è‡ªç”±åˆ†ç»„,
è¦è¿½åŠ å”¯ä¸€çš„ <code>lib.rs</code> å˜æˆ:</p>
<pre><code>foo/
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bar1/
â”‚   â”‚   â””â”€â”€ echo.rs
â”‚   â”œâ”€â”€ bar1.rs
â”‚   â”œâ”€â”€ bar2/
â”‚   â”‚   â””â”€â”€ echo.rs
â”‚   â”œâ”€â”€ bar2.rs
â”‚   â”œâ”€â”€ lib.rs       &lt;=== å…³é”®é…ç½®
â”‚   â””â”€â”€ main.rs
...
</code></pre>
<p>åœ¨ Cargo.toml ä¸­è¿½åŠ é…ç½®:</p>
<pre><code class="language-toml">[lib]
path = &quot;src/lib.rs&quot;
</code></pre>
<p>ç„¶å,å…³é”®æŠ€å·§æ¥äº†:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod bar1;
pub mod bar2;

//  ä½¿ç”¨ pub use é‡å¯¼å‡ºåç§°
pub mod echos{
    pub use super::bar1::echo::*;
    pub use super::bar2::echo::*;
}
<span class="boring">}</span></code></pre></pre>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨åˆæ³•çš„ åº“æ–‡ä»¶ä¸­,
å°†ä¸åŒç›®å½•ä¸­çš„æ¨¡å—é€šè¿‡åœ¨ä¸€ä¸ªé‡æ–°å®šä¹‰çš„æ¨¡å—ä¸­,
é‡æ–°æ‹‰åˆ°åç§°ç©ºé—´ä¸­, å¹¶ pub ,
è¿™æ‰, æ‰èƒ½è®©å¹³è¡Œçš„ä¸åŒç›®å½•ä¸­çš„å„æ¨¡å—å¯è§,</p>
<p>è¿™æ—¶, æ‰èƒ½åœ¨ <code>src/bar1/echo.rs</code> ä¸­é€šè¿‡ <code>super::super::bar2</code> å½¢å¼å¼•ç”¨åˆ°éš”å£çš„èµ„æº...</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use super::super::bar2::echo::bang as bar2_echo_bang;

pub fn bang() {
    println!(&quot;src/bar1/echo.rs: {}&quot;, env!(&quot;CARGO_PKG_VERSION&quot;));
    bar2_echo_bang();
}
<span class="boring">}</span></code></pre></pre>
<p>å½“ç„¶, å¦‚æœä¸¤ä¸ª echo ä¸­çš„ bang() ç›¸äº’å¼•ç”¨,å°±å˜æˆäº†ç»å…¸çš„ OOP ä¸­çš„è±å½¢å¾ªç¯å¼•ç”¨:</p>
<pre><code>use super::super::bar2::echo::bang as bar2_echo_bang;
          ^                   +
         /                     \
        /                       V
src/bar1/echo.rs            src/bar2/echo.rs
-&gt; bang()                   -&gt; bang()
        ^                       /
         \                     /
          +                   V
use super::super::bar1::echo::bang as bar1_echo_bang;

</code></pre>
<p>åœ¨ç¼–è¯‘è¿è¡Œåå°†è¿›å…¥æ­»å¾ªç¯, ç›´åˆ° stack overflow çˆ†å‡º:</p>
<pre><code>...
src/bar2/echo.rs: 0.1.42
src/bar1/echo.rs: 0.1.42
src/bar2/echo.rs: 0.1.42
src/bar1/echo.rs: 0.1.42
src/bar2/echo.rs: 0.1.42
src/bar1/echo.rs: 0.1.42
src/bar2/echo.rs: 0.1.42
src/bar1/echo.rs: 0.1.42

thread 'main' has overflowed its stack
fatal runtime error: stack overflow
Abort trap: 6
</code></pre>
<p>ç»¼ä¸Š, åœ¨é¡¹ç›®æ‰©å¤§æ—¶, è¿˜æ˜¯å°†å…³é”®ç»„ä»¶éƒ½ crate åŒ–,
å˜æˆæ ‡å‡†çš„å¤–éƒ¨æˆ–æ˜¯æœ¬åœ° crate ,å†è°ƒæ•™å¥½ build è¿‡ç¨‹,
é‚£ä¹ˆ, æ— è®ºå¤šå¤§çš„å·¥ç¨‹, æœ€åéƒ½å¯ä»¥æ§åˆ¶åœ¨ä¸€å°ç»„æ–‡ä»¶ä¸­, 
ç»„åˆè°ƒç”¨å·²ç»å®‰å…¨æ— å¿§ç¼–è¯‘å¥½çš„ crate ä»¬....</p>
<h2 id="refer-38"><a class="header" href="#refer-38">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p><a href="https://kaisery.github.io/trpl-zh-cn/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html#%E4%BD%BF%E7%94%A8-pub-use-%E9%87%8D%E5%AF%BC%E5%87%BA%E5%90%8D%E7%A7%B0">ä½¿ç”¨ use å…³é”®å­—å°†è·¯å¾„å¼•å…¥ä½œç”¨åŸŸ - Rust ç¨‹åºè®¾è®¡è¯­è¨€ ç®€ä½“ä¸­æ–‡ç‰ˆ</a> -&gt; ä½¿ç”¨ pub use é‡å¯¼å‡ºåç§°</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1899628">Rustä¸­çš„ä»£ç ç»„ç»‡:package/crate/mod - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></li>
<li><a href="http://llever.com/gentle-intro/pain-points.zh.html">æ¨¡å—å’Œè´§ç‰© - Rust çš„ç»…å£«ä»‹ç»</a></li>
<li>...</li>
</ul>
<pre><code>          _~âˆ½|^~_
      () /  - â™¡  \ \/
        '_   âŒ   _'
        \ '--âˆ½--' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-å’Œé»˜è®¤å‚æ•°"><a class="header" href="#rust-å’Œé»˜è®¤å‚æ•°">Rust å’Œé»˜è®¤å‚æ•°</a></h1>
<p>åŸæ–‡: <a href="https://www.thecodedmessage.com/posts/default-params/">Rust and Default Parameters :: The Coded Message</a></p>
<blockquote>
<p>å¿«è¯‘</p>
</blockquote>
<p>Rust ä¸æ”¯æŒå‡½æ•°å£°æ˜ä¸­çš„é»˜è®¤å‚æ•°;
è€Œä¸”å’Œå¾ˆå¤šè¯­è¨€ä¸åŒ, æ— æ³•é€šè¿‡å‡½æ•°é‡è½½æ¥æ¨¡æ‹Ÿ;
è¿™è®©å¾ˆå¤šæ¥è‡ªå…¶å®ƒç¼–ç¨‹è¯­è¨€çš„ Rustacean æ–°äººæ„Ÿåˆ°æ²®ä¸§,
æ‰€ä»¥, å°±æƒ³è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™å…¶å®æ˜¯ä»¶å¥½äº‹å„¿,
ä»¥åŠ,å¦‚æœä½¿ç”¨é»˜è®¤ trait å’Œç»“æ„æ›´æ–°è¯­æ³•æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœ;</p>
<p>é»˜è®¤å‚æ•°(å’Œå‡½æ•°é‡è½½)ä¸æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€éƒ¨åˆ†,
ä½†æ˜¯,åˆæ˜¯è®¸å¤š Rustaceans æ–°äººåŸå…ˆç¼–ç¨‹è¯­è¨€çš„å…±åŒç‰¹å¾;
å› æ­¤, è¿™ç¯‡æ–‡ç« åœ¨æŸäº›æ–¹é¢å’Œæˆ‘æ­£åœ¨è¿›è¡Œçš„å…³äº Rust å¦‚ä½•ä¸æ˜¯é¢å‘å¯¹è±¡çš„ç³»åˆ—æ–‡ç« ç›¸å»åˆ,
æ•…è€Œ, è¢«æ ‡å‡†ä¸ºè¿™ä¸ªç³»åˆ—çš„æ–‡ç« ;
è¿˜å—åˆ° Reddit ä¸­å¯¹æˆ‘ç¬¬ä¸€ç¯‡ OOP ç›¸å…³è´´å­å›å¤çš„å¯å‘;</p>
<h2 id="é»˜è®¤å‚æ•°æ˜¯å¦‚ä½•å·¥ä½œå’¯æ¯”å¦‚-c"><a class="header" href="#é»˜è®¤å‚æ•°æ˜¯å¦‚ä½•å·¥ä½œå’¯æ¯”å¦‚-c">é»˜è®¤å‚æ•°æ˜¯å¦‚ä½•å·¥ä½œå’¯(æ¯”å¦‚ C++)</a></h2>
<p>åœ¨å¼€å§‹è®¨è®ºä¸ºä»€ä¹ˆ Rust æ²¡æœ‰é»˜è®¤å‚æ•°ä»¥åŠæˆ‘ä»¬å¯ä»¥æŠ˜è…¾ä»€ä¹ˆä¹‹å‰,
å¾—å…ˆèŠæ˜ç™½ä»€ä¹ˆæ˜¯é»˜è®¤å‚æ•°ä»¥åŠåœ¨å“ªäº›æƒ…å†µä¸‹æœ‰ç”¨;</p>
<p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¸¦æœ‰å¾ˆå¤šå‚æ•°çš„å‡½æ•°,
æ¯”å¦‚(ä»¥ Reddit å›å¤ä¸­çš„ç¤ºä¾‹)åœ¨ GUI ä¸­åˆ›å»ºä¸€ä¸ªçª—å£:</p>
<pre><code class="language-C++">WindowHandle createWindow(int width, int height, bool visible)

auto handle = createWindow(10, 30, false); // Create invisible window
auto handle2 = createWindow(100, 500, true); // Create visible window
</code></pre>
<p>ç°åœ¨, å‡è®¾ä½ å‡†å¤‡åˆ›å»ºçš„å¤§å¤šæ•°çª—å£éƒ½æ˜¯å¯è§çš„,
å¹¶ä¸”,ä½ ä¸æƒ³è®©ç¨‹åºå‘˜è´Ÿæ‹…å¿…é¡»æŒ‡å®šçª—å£æ˜¯å¦å¯è§çš„æ‹…å¿ƒ --- ç”šè‡³äºä¸æƒ³æ˜ç¡®çš„è€ƒè™‘è¿™äº‹å„¿ --- åœ¨æ­£å¸¸æƒ…å†µä¸‹,
åœ¨æ”¯æŒé»˜è®¤å‚æ•°çš„ç¼–ç¨‹è¯­è¨€ä¸­,ä½ å¯ä»¥ä¸ºå¯è§æ€§æä¾›é»˜è®¤å€¼:</p>
<pre><code class="language-C++">WindowHandle createWindow(int width, int height, bool visible = true)

auto handle = createWindow(10, 30, false); // Create invisible window!

auto handle2 = createWindow(100, 500, true); // Create visible window!

auto handle3 = createWindow(100, 500); // Also create visible window!
auto handle4 = createWindow(100, 500); // Most of the time, that's what
auto handle5 = createWindow(100, 500); // you want, so why have to say it?
Default parameters can also be simulated with function overloading for programming languages where function overloading is available but default parameters are not:

WindowHandle createWindow(int width, int height, bool visible);

WindowHandle createWindow(int width, int height) {
    return createWindow(width, height, true);
}
</code></pre>
<p>Rust ä¹Ÿæ²¡æœ‰å‡½æ•°é‡è½½,è¿™æ˜¯ä¸ªå¤æ‚çš„å¤šçš„é—®é¢˜,
ä½†æ˜¯, å¾ˆå¤šç›¸åŒçš„è®ºç‚¹éƒ½é€‚ç”¨è¿™ä¸ªä¹ æƒ¯ç”¨æ³•çš„ç†è§£;</p>
<h2 id="é»˜è®¤å‚æ•°çš„å¥½å¤„å’Œåå¤„"><a class="header" href="#é»˜è®¤å‚æ•°çš„å¥½å¤„å’Œåå¤„">é»˜è®¤å‚æ•°çš„å¥½å¤„(å’Œåå¤„)</a></h2>
<p>é»˜è®¤å€¼å¾ˆå¥½,è¿™ç§é£æ ¼çš„é»˜è®¤å‚æ•°æ˜¯å®ç°å¹¶ä»ä¸­è·ç›Šçš„ä¸€ç§æ–¹å¼;</p>
<p>é»˜è®¤å€¼æ˜¯å¥½çš„,å› ä¸º,å¥¹ä»¬åšæŒ DRY åŸåˆ™ --- ä¸è¦é‡å¤è‡ªå·±(Donâ€™t Repeat Yourself);
å¦‚æœæˆ‘ä»¬æ²¡æœ‰é»˜è®¤å€¼, å°±ä¸å¾—ä¸é‡å¤é‚£äº›å®é™…ä¸Šå¯¹ç†è§£ä»£ç æ²¡æœ‰å¸®åŠ©çš„å‚æ•°;
å¦‚æœæœ€ä½³é»˜è®¤ç§‹ç²®çš„æ›´æ”¹æ–¹å¼æ¥¼ä¸»æ›´æ–°ä»£ç çš„æœ€ä½³æ–¹æ³•æ˜¯ç»§ç»­ä½¿ç”¨é»˜è®¤å€¼--- ä¹Ÿè®¸å› ä¸ºæœ€ä½³å®è·µå‘ç”Ÿäº†å˜åŒ– ---
æˆ‘ä»¬å°†ä¸å¾—ä¸æ›´æ–°æ¯ä¸ªè°ƒç”¨, è€Œä¸æ˜¯åªè¦æ›´æ”¹ä¸€å¤„, å®šä¹‰äº†é»˜è®¤å‚æ•°é‚£é‡Œ;</p>
<p>é»˜è®¤å¾å¾ˆå¥½,å› ä¸º,å¥¹ä»¬å‡å°‘äº†ç¨‹åºå‘˜çš„è®¤çŸ¥è´Ÿæ‹…;
ç¨‹åºå‘˜å¿…é¡»ä¸€æ¬¡æ€§åœ¨å¤§è„‘ä¸­ä¿ç•™å¤§é‡ä¿¡æ¯,
è€Œé»˜è®¤è®¾ç½®é€šè¿‡ä¸å¼ºè¿«åœ¨æ— å…³åœºæ™¯æ—¶è¦è€ƒè™‘é¢å¤–çš„ç»†èŠ‚æ¥å¸®åŠ©ç¨‹åºå‘˜---è¿™æ˜¯å¤ªå¤šæ•°é»˜è®¤è®¾ç½®çš„å¸¸è§ä½œç”¨åœºæ™¯;</p>
<p>é»˜è®¤ç§‹ç²®ä¹Ÿä½¿ä»£ç æ›´åŠ ç®€æ´,
å› æ­¤, å¾ˆå—æ¬¢è¿;
ä½†æ˜¯,è¿™ä¸æ˜¯ä¸“æœ‰çš„ç‰¹æ®Šä»·å€¼;
æˆ‘ç›¸ä¿¡ DRY åŸåˆ™å¾ˆé‡è¦, è¿™é€šå¸¸æ„å‘³ç€æ›´åŠ ç®€æ´çš„ä»£ç ,
ä½†æ˜¯,è€ƒè™‘åˆ°ç°ä»£ç¼–è¾‘å™¨å’Œ IDE, ä»¥åŠç°ä»£äººåŠä¸ºæŠŠä¸ç”¨åˆå’Œé˜…è¯»é€Ÿåº¦çš„æœŸå¾…,
é€‚åº¦çš„å†—é•¿ä»¥èƒ½æ¢å–å…¶å®ƒå¥½å¤„(æ¯”å¦‚, æ¸…æ™°åº¦å’Œæ˜ç¡®æ€§),
æˆ‘è¿˜æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„;
ç›¸ä¿¡é»˜è®¤å‚æ•°,å› ä¸ºè¿™æ˜¯åœ¨ C++ å’Œ Python ä¸­å®ç°çš„,
åœ¨æ¸…æ™°åº¦å’Œæ˜ç¡®æ€§æ–¹é¢ä»˜å‡ºäº†å·¨å¤§çš„ä»£ä»·,
å› æ­¤,ç®€æ´æ€§å¹¶ä¸æ˜¯è¯æ˜å¥¹ä»¬åˆç†çš„å……åˆ†ç†ç”±;</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸­, è®©æˆ‘ç‰¹åˆ«å›°æ‰°çš„æ˜¯ä»£ç ä¸­çš„ä¸æ¸…æ™°ä¹‹å¤„,
åœ¨äºä»£ç çš„è¯»è€…ä¸çŸ¥é“å¯èƒ½è¿˜æœ‰æ›´å¤šçš„å‚æ•°;
æ²¡æœ‰æš—ç¤ºå¯èƒ½è¿˜æœ‰å…¶å®ƒç§‹ç²®;
å¦‚æœç»´æŠ¤è€…æƒ³æ›´æ”¹å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ä»¥ä¾¿åˆ›å»ºä¸å¯è§çš„çª—å£,
é¢†å¯¼ä½œç”¨å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°åº”è¯¥å…ˆæ£€éªŒ create_window çš„æ–‡æ¡£:
æ¯•ç«Ÿ, ä¼¼ä¹åªæ¥å—ä¸¤ä¸ªå‚æ•°,
è€Œä¸”ä¹Ÿæ²¡æœ‰ä»»ä½•è¿œç¨‹ååº”é’ˆå¯¹ä¸å¯è§çª—å£;</p>
<p>å¹¸è¿çš„æ˜¯, Rust å…·æœ‰æ›¿ä»£ç‰¹æ€§,
ä½¿æˆ‘ä»¬èƒ½åœ¨ä¸ç‰ºç‰²æ˜ç¡®æ€§å’Œæ¸…æ™°æ€§çš„æƒ…å†µä¸‹,
ä¹Ÿè·å¾—è®¤çŸ¥è´Ÿè·å’Œ DRy çš„å¥½å¤„;</p>
<h2 id="rust-ä¸­çš„é»˜è®¤å€¼-é»˜è®¤-trait"><a class="header" href="#rust-ä¸­çš„é»˜è®¤å€¼-é»˜è®¤-trait">Rust ä¸­çš„é»˜è®¤å€¼: é»˜è®¤ trait</a></h2>
<p>Rust ä¸å…è®¸ä½¿ç”¨é»˜è®¤å‚æ•°,
è€Œæ˜¯å…è®¸ä½ ä½¿ç”¨ Default trait æœ‰é€‰æ‹©çš„ä¸ºä½ çš„ç±»å‹æŒ‡å®šé»˜è®¤å€¼;</p>
<p>æ˜¯è¿™æ ·å·¥ä½œçš„:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Foo {
    Bar,
    Baz,
}

impl Default for Foo {
    fn default() -&gt; Self {
        Foo::Bar
    }
}
<span class="boring">}</span></code></pre></pre>
<p>æˆ–æ˜¯, ä½¿ç”¨æ›´åŠ ç®€æ´çš„ æ´¾ç”Ÿ/derive è¯­æ³•ç¼–å†™:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Default)]
enum Foo {
    #[default]
    Bar,

    Baz,
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸€æ—¦å®šä¹‰äº†è¿™ä¸ªé»˜è®¤å€¼,
Foo::default() æˆ–æ˜¯(åœ¨ç±»å‹æ˜ç¡®çš„ä¸Šä¸‹æ–‡ä¸­) Default::default() å°±å¯ä»¥ä»£è¡¨ Foo::Bar ;</p>
<p>å¦‚æœä½ ä¹ æƒ¯ä¸ºä½ çš„å‡½æ•°å‚æ•°é‡ç”¨ç°æœ‰ç±»å‹,
è¿™å¯èƒ½çœ‹èµ·æ¥æ¯”ä¸ç”¨æ›´åŠ ç³Ÿç³•;
æ¯•ç«Ÿ, æˆ‘ä»¬é»˜è®¤çš„å‚æ•°æ˜¯ bool ç±»å‹çš„,
å­¤å„¿è§„åˆ™(åœ¨ Rust çš„ trait ç›¸å…³ç« èŠ‚æœ‰è§£é‡Š) ç¦æ­¢æˆ‘ä»¬åœ¨ bool ä¸Šå®šä¹‰é»˜è®¤ trait ---
æ­£å¦‚æˆ‘åœ¨ä¸Šé¢æåŠçš„, Default å…è®¸ä½ å¯¹ç±»å‹å®šä¹‰é»˜è®¤å€¼;
å³ä¾¿,æˆ‘ä»¬å¯ä»¥ä¸º bool è®¾ç½®é»˜è®¤å€¼ä¹Ÿæ˜¯ä¸€ä»¶è¿‡äºå¼ºå¤§çš„äº‹å„¿,
æ— æ³•ä»…ä»…ä¸ºè¿™ä¸ªå‡½æ•°å‚æ•°æä¾›é»˜è®¤å€¼!
æ¯•ç«Ÿ, å…¶å®ƒä¸€äº›å‡½æ•°ä¹Ÿå¯èƒ½æœ‰ä¸€ä¸ªå…·æœ‰ä¸åŒé»˜è®¤å€¼çš„ bool ç±»å‹å‚æ•°;</p>
<p>ä½†æ˜¯,å¦‚æœåœ¨ Rust ä¸­è€ƒè™‘, è¿™æ›´åŠ æœ‰æ„ä¹‰ --- ç”šè‡³æ˜¯æƒ¯ç”¨çš„å’Œé¦–é€‰çš„ --- ä¸ºé…ç½®å’Œå‡½æ•°å‚æ•°ç­‰ç­‰åˆ›å»ºè‡ªå®šä¹‰ç±»å‹;
æ¯•ç«Ÿ, å¦‚æœä½ ä¸æŸ¥å®æ–‡æ¡£, å¯èƒ½ä¸æ¸…æ¥š true çš„å«ä¹‰;
ç”šè‡³äºä¸æ¸…æ¥šå’Œå¯è§æ€§æœ‰ä»€ä¹ˆå…³ç³»,
æ›´ä¸ç”¨è¯´å¾ˆå®¹æ˜“å°† true å½“å‚æ•°æ—¶æ„å‘³ç€ä¸å¯è§çª—å£æ˜¯å¯è§çš„;</p>
<p>åœ¨ Rust ä¸­,æˆ‘ä»¬æ›´åŠ æ„¿æ„ä¸ºè¿™ä¸€æƒ…å†µå®šä¹‰ä¸€ä¸ªæ–°ç±»å‹, ä¸€ä¸ªåˆ—å‡ºå¯è§æ€§é€‰é¡¹çš„æšä¸¾---å¦‚æœåˆ›å»ºä¸€ä¸ªæ–°çš„å¯è§æ€§é€‰é¡¹,
è¿™æ‰æœ‰æ‰€å¸®åŠ©;
åœ¨è¿™ä¸ªæšä¸¾ä¸Š, å£°æ˜ä¸€ä¸ªé»˜è®¤å€¼æ‰æ˜¯åˆç†çš„:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Default)]
enum WindowVisibility {
    #[default]
    Visible,

    Invisible,
}
<span class="boring">}</span></code></pre></pre>
<p>æ˜¯çš„, è¿™æ¯”æˆ‘ä»¬çš„åŸå§‹ä»£ç æœ‰äº›å†—é•¿, ä½†æ›´æ¸…æ™°,
è€Œä¸”ä¸ä¹ DRY ;
ç®€æ´æœ¬èº«å¹¶ä¸æ˜¯ä¸€ç§ä»·å€¼;
æ˜ç¡®çš„åˆ—å‡ºé€‰é¡¹æ¯”éšå¼é€‰é¡¹æ›´å¯å–;</p>
<p>ç„¶å, å½“æˆ‘ä»¬è°ƒç”¨è¯¥å‡½æ•°æ—¶, å¯ä»¥è¿™ä¹ˆä½¿ç”¨é»˜è®¤å€¼:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn create_window(width: u32, height: u32, visibility: WindowVisibility) -&gt; WindowHandle;

let handle = create_window(10, 30, WindowVisibility::Invisible);
let handle2 = create_window(100, 500, WindowVisibility::Visible);

let handle3 = create_window(100, 500, WindowVisibility::default());
let handle4 = create_window(100, 500, WindowVisibility::default());
let handle5 = create_window(100, 500, Default::default()); // ä¹Ÿå…è®¸
<span class="boring">}</span></code></pre></pre>
<p>æ­£å¦‚æ‰¿è¯ºçš„é‚£æ ·, è¿™æ ·å†—é•¿äº›, åŒæ · DRY,
ä½†æ˜¯, æ›´åŠ æ˜ç¡®å’Œæ¸…æ™°; (æ— æ­§ä¹‰)</p>
<p>æ³¨æ„: æˆ‘ä½¿ç”¨ç‹¬ç«‹å‡½æ•°åªæ˜¯ä¸ºäº†ä¸¾ä¾‹;
å®é™…ä¸Š, è¿™ä¸ªç‰¹å®šå‡½æ•°å¾ˆå¯èƒ½æ˜¯ç±»å‹å†…éƒ¨æ–¹æ³•çš„ä¸€éƒ¨åˆ†,
ä¾‹å¦‚ WindowHandle::new æˆ–æ˜¯ WindowHandle::create_window;</p>
<h3 id="rust-ä¸­é»˜è®¤å€¼ç¼©æ”¾-ç»“æ„æ›´æ–°è¯­æ³•"><a class="header" href="#rust-ä¸­é»˜è®¤å€¼ç¼©æ”¾-ç»“æ„æ›´æ–°è¯­æ³•">Rust ä¸­é»˜è®¤å€¼ç¼©æ”¾: ç»“æ„æ›´æ–°è¯­æ³•</a></h3>
<p>æ‰€ä»¥, è¿™å¯¹äºä¸€ä¸ªé»˜è®¤å€¼æ¥è¯´å½¢å¼ä¸Šæ›´å¥½;
ä½†æ˜¯,æ‹“å±•æ€§å¹¶ä¸å¥½;
å¦‚æœæˆ‘ä»¬æƒ³åœ¨æˆ‘ä»¬çš„çª—å£åˆ›å»ºå‡½æ•°ä¸­è¿½åŠ å¦å¤–3ä¸ªå‚æ•°æ€ä¹ˆåŠ?
åœ¨ C++ ä¸­, å¯ä»¥å¯ä»¥ä¸ºå¥¹ä»¬æä¾›é»˜è®¤å€¼,
è°ƒç”¨è€…ç”šè‡³ä¸éœ€è¦æ›´æ–°(å‚æ•°ä»…ç”¨æ¥ç¤ºä¾‹, å¹¶ä¸ä»£è¡¨åœ¨åˆ›å»ºçª—å£):</p>
<pre><code class="language-C++">WindowHandle createWindow(int width, int height, bool visible = true,
                          WindowStyle windowStyle = WindowStyle::Standard,
                          int z_position = -1,
                          bool autoclose = false);

createWindow(100, 500); // Still works identically
createWindow(100, 500, false); // Also still works
createWindow(100, 500, false, WindowStyle::Standard, 2, true); // Specify everything
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½;
åœ¨ Rust ä¸­,ä½¿ç”¨ç›®å‰è®¨è®ºçš„æŠ€æœ¯,
æ— è®ºå‚æ•°æœ‰å¤šå°‘,æˆ‘ä»¬éƒ½å¿…é¡»é‡å¤ç¼–å†™ Default::default() ;
è¿™æ˜¯ DRY è¿è§„è¡Œä¸º, ä¼šå¹²æŒ è¿½åŠ æ–°å‚æ•°çš„èƒ½åŠ›;</p>
<p>ä½†æ˜¯, æ­¤åŠŸèƒ½ä¹Ÿå­˜åœ¨ç¼ºé™·;
ä½ ç°åœ¨å·²ç»é™åˆ¶è‡ªå·±åœ¨å·¦ä¾§æŒ‡å®šå‚æ•°,
ä»¥ä¾¿åœ¨å³ä¾§è¿½åŠ å‚æ•°;
åœ¨è°ƒç”¨ createWindow æœ€åä¸€ä¸ªç¤ºä¾‹ä¸­, æˆ‘ä»¬é€šè¿‡æ˜¾å¼æŒ‡å®šä¸€ä¸ªå€¼æ¥è¿å DRY,
å½“æ—¶æˆ‘ä»¬å¯èƒ½æƒ³ä½¿ç”¨é»˜è®¤å€¼,ä½†æ˜¯,è¯¥å€¼ä¸å¯ç”¨, å› ä¸º,æˆ‘ä»¬æƒ³ä¸ºä»¥åçš„å‚æ•°è¦†ç›–é»˜è®¤å€¼;</p>
<p>å¹¸è¿çš„æ˜¯, Rust ä¹Ÿæœ‰è¿™ç§ç‰ˆæœ¬;
æ­£å¦‚æˆ‘ä»¬åªæ˜¯ä¸ºäº†è¿™ä¸ªå‡½æ•°è°ƒç”¨è€Œåˆ›å»ºäº†ä¸€ä¸ªæšä¸¾ä¸€æ ·,
åœ¨ Rust ä¸­ä¸ºè¿™ç§é…ç½®å‚æ•°åˆ›å»ºç»“æ„ä¹Ÿæ˜¯æƒ¯ç”¨çš„;
è¯¥ç»“æ„çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct WindowConfig {
    pub width: u32,
    pub height: u32,
    pub visibility: WindowVisibility,
    pub window_style: WindowStyle,
    pub z_position: i32,
    pub autoclose: AutoclosePolicy,
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶å, æˆ‘ä»¬å°±å¯ä»¥ä¸ºæ•´ä¸ªç»“æ„æŒ‡å®š Default:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Default for WindowConfig {
    fn default() -&gt; Self {
        Self {
            width: 100,
            height: 100,
            visibility: WindowVisibility::Visible,
            window_style: WindowStyle::Standard,
            z_position: -1,
            autoclose: AutoclosePolicy::Disable,
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<p>ç°åœ¨, ä¼¼ä¹ä½¿ç”¨èµ·æ¥å¾ˆä¹å‘³;
ä½ å¯èƒ½æƒ³è±¡å¾—è¿™ä¹ˆä½¿ç”¨:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut config = WindowConfig::default();
config.width = 500;
config.z_position = 2;
config.autoclose = AutoclosePolicy::Enable;
let handle = create_window(config);
<span class="boring">}</span></code></pre></pre>
<p>æˆ‘è®¤ä¸ºå³ä¾¿æ˜¯è¿™æ ·ä¹Ÿæ¯”é»˜è®¤ç§‹ç²®å¯å–,
å› ä¸º,è¿™æ ·æ˜¯æ˜ç¡®çš„;
ç„¶è€Œ, Rust æœ‰ä¸€ä¸ªä¸“é—¨ä¸ºè¿™ç§æƒ…å†µè®¾è®¡çš„è¯­æ³•ç»“æ„:
struct update syntax ;
æœ‰äº†è¿™,æˆ‘ä»¬è·å¾—çš„ä¸œè¥¿å’Œé»˜è®¤å‚æ•°éå¸¸ç›¸ä¼¼,
ä½†æ˜¯,æ›´å†—é•¿/æ˜ç¡®/çµæ´»:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let handle = create_window(WindowConfig {
    width: 500,
    z_position: 2,
    autoclose: AutoclosePolicy::Enable,
    ..Default::default()
});
<span class="boring">}</span></code></pre></pre>
<p>ä¸åƒ C++ é£æ ¼çš„è¨€è®ºå‚æ•°,
æˆ‘ä»¬å¯ä»¥å®Œå…¨è¦†ç›–æˆ‘ä»¬æƒ³è¦çš„é»˜è®¤å€¼;
åŒæ ·æ˜ç¡®çš„æ˜¯,
å¦‚æœæˆ‘ä»¬æ„¿æ„, ç”šè‡³å¯ä»¥ä¿®æ”¹å…¶å®ƒå‚æ•°,
è€Œä¸éœ€å¼ºåˆ¶ç»´æŠ¤å¼€å‘è€…æ£€æŸ¥æ–‡æ¡£;</p>
<p>é™¤æ­¤ä¹‹å¤–, è¿™æ ·å…è®¸å®šä¹‰å…¶å®ƒé»˜è®¤å€¼é›†;
é™¤äº† WindowConfig::default ä¹‹æ¸‘, å¯èƒ½è¿˜æœ‰å¦å¤–ä¸€ç»„ç”¨æ¥åˆ›å»ºå¯¹è¯æ¡†çš„é…ç½®å‚æ•°,
ä¾‹å¦‚: like WindowConfig::dialog() æˆ–æ˜¯ WindowConfig::default_dialog ;
ç¨‹åºå‘˜é€šå¸¸åœ¨åˆ›å»ºä¸å¯è§çª—å£, æˆ–æ˜¯é«˜åº¦ç›¸åŒçš„çª—å£åº”ç”¨,
å¯èƒ½ä¼šå®šä¹‰è‡ªå·±çš„é»˜è®¤è®¾ç½®, config::app_local_default_window_config();
è¿™äº›ä¸ä¼šé€šè¿‡ Default ç‰¹æ€§æ¥è°ƒè§£,
ä½†æ˜¯, Default åªæ˜¯ä¸€ä¸ª trait ,
è€Œ Default::default() æ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨;
ä½ å¯ä»¥æ”¹ä¸ºè°ƒç”¨è‡ªå·±çš„æ–¹æ³•,
å¹¶ä»ç„¶ä½¿ç”¨æ­¤<code>ç»“æ„æ›´æ–°è¯­æ³•</code>;</p>
<p>æ‰€ä»¥,ç°åœ¨æˆ‘ä»¬åœ¨ Rust ä¸­æœ‰ä¸€ä¸ªä¹ æƒ¯ç”¨è¯­ç³»ç»Ÿæ¥æ›¿æ¢é»˜è®¤å‚æ•°;
è¿™å’Œ DRY ä¸€æ ·,
å¹¶ä¸”åŒæ ·å‡å°‘äº†è®¤çŸ¥è´Ÿè·;
æ›´åŠ é‡è¦çš„æ˜¯, è¿™æ ·ä½œå¹¶æ²¡æœ‰ç‰ºç‰²å¯¹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆçš„æ˜ç¡®æ€§ä¸æ¸…æ™°æ€§ --- ä¸€ä¸ªç»™å®šçš„å‡½æ•°æ€»æ˜¯é‡‡ç”¨ç›¸åŒæ•°é‡çš„å‚æ•°,
è¿™æ˜¯ Rust ç»´æŠ¤å¼€å‘è€…å¯ä»¥(å¹¶ä¸”æ­£åœ¨)ä¾èµ–çš„ä¸å˜é‡;</p>
<h3 id="æ„å»ºå™¨æ¨¡å¼"><a class="header" href="#æ„å»ºå™¨æ¨¡å¼">æ„å»ºå™¨æ¨¡å¼</a></h3>
<p>åœ¨è¿™ç‚¹ä¸Š, Rustacean è€æ‰‹ä»¬åº”è¯¥èƒ½æ³¨æ„åˆ°è¿˜æ²¡è®¨è®ºä¸€ç§é€šç”¨çš„ Rust æ–¹æ³•æ¥è®¾è®¡è¿™äº›é…ç½®ç»“æ„,
å³:  <code>æ„å»ºå™¨æ¨¡å¼</code> (Builder Pattern);</p>
<p>è¿™æ˜¯æœ‰åŸå› çš„: æˆ‘ä¸å–œæ¬¢ä¸«çš„;
(è¯‘æŒ‰: åƒé‡‘å©ä¹°æˆ‘æ„¿æ„, æ²¡é”™...)
æˆ‘ä¸ªäººæ›´åŠ å–œæ¬¢ä½¿ç”¨ Default å’Œ struct update è¯­æ³•,
å…¶å®ƒäººå¯èƒ½ä¼šä½¿ç”¨  <code>æ„å»ºå™¨æ¨¡å¼</code>  ;
æˆ‘è®¤ä¸ºè¿™ç§æ¨¡å‹ä¸å¤Ÿæ˜ç¡®, è€Œä¸”ç”±äºåœ¨é OOP ç¼–ç¨‹è¯­è¨€æ–¹é¢æœ‰å¾ˆå¤šç»éªŒ,
æ‰€ä»¥,æˆ‘è§‰å¾—è¿™æ˜¯ä¸€ç§æ²¡æœ‰é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ, ä¸»è¦æˆæœåªæ˜¯ä»¤ä»£ç çœ‹èµ·æ¥æ›´åŠ  OOP è€Œå·²;</p>
<p>ä¸è¿‡, è¿™ä¹Ÿæ˜¯ Rust ä¸­å¸¸ç”¨çš„æ¨¡å¼, ä¸€èˆ¬ä½¿ç”¨ <code>æ„å»ºå™¨æ¨¡å¼</code> çš„ crate,
å› è€Œå€¼å¾—ç†Ÿæ‚‰ä¹‹;
è¿™å’Œä»¥å¾€çš„æ¦‚å¿µç›¸åŒ:
ä½¿ç”¨å……æ»¡å‚æ•°çš„ç»“æ„, å°†é…ç½®å‘é€åˆ° æ„å»ºå‡½æ•°æˆ–æ˜¯å‡½æ•°è°ƒç”¨;
æœ‰æ—¶è¿™ç§ä¼šè¢«ç§°ä¸º WindowBuilder è€Œä¸æ˜¯ WindowConfig;</p>
<p>ä½†æ˜¯, ä¸ç›´æ¥ä½¿ç”¨ç»“æ„æ›´æ–°è¯­æ³•, è€Œæ˜¯æ·»åŠ äº†ä¸€å †è¾…åŠ©æ–¹æ³•æ¥æ‰§è¡Œç»“æ„æ›´æ–°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl WindowBuilder {
    fn height(mut self, height: u32) -&gt; Self {
        self.height = height;
        self
    }

    // ...
}
<span class="boring">}</span></code></pre></pre>
<p>æˆ–è€…, æ­£å¦‚æƒ³æŒ‡å‡ºçš„é‚£æ ·:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl WindowBuilder {
    fn height(self, height: u32) -&gt; Self {
        Self {
            height,
            ..self
        }
    }

    // ...
}
<span class="boring">}</span></code></pre></pre>
<p>æœ‰æ—¶, æšä¸¾è¢«æ‹†åˆ†ä¸ºå¤šä¸ªæ›´æ–°æ–¹æ³•:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl WindowBuilder {
    fn autoclose_enable(mut self) -&gt; Self {
        self
        self.autoclose = AutoclosePolicy::Enable;
    }

    fn autoclose_disable(mut self) -&gt; Self {
        self.autoclose = AutoclosePolicy::Disable;
        self
    }
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶å, é€šå¸¸å¹¶ä¸æ˜¯è°ƒç”¨ä¾‹å¦‚: window constructor,
ä½ è°ƒç”¨åœ¨æ„å»ºå™¨ä¸Šå®šä¹‰çš„æ„å»ºæ–¹æ³•
(æ­¤æ—¶,å·²ç»å¯¹å½±å“è®¾è®¡çš„æ— å¿ OOP å“²å­¦æ„Ÿåˆ°ç•ç¼©)</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl WindowBuilder {
    fn build(self) {
        window_create(self)
    }
}
<span class="boring">}</span></code></pre></pre>
<p>å…¶å®,ä¸ç”¨ struct update è¯­æ³•,
è€Œæ˜¯å°†å¯¹è¿™äº›æ–¹æ³•è°ƒç”¨é“¾æ¥åœ¨ä¸€èµ·:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let handle = WindowBuilder::new()
    .width(500)
    .z_position(2)
    .autoclose_enable()
    .build();
<span class="boring">}</span></code></pre></pre>
<p>æˆ‘ä»ç„¶æ›´åŠ å–œæ¬¢è¿™ä¸ª, è€Œä¸æ˜¯é»˜è®¤å‚æ•°,
ä½†æ˜¯, åŒæ—¶ä¹Ÿæ„Ÿè§‰æœ‰ç‚¹ä¿—æ°”;
æˆ‘ä¸å–œæ¬¢è¢«è¿«ä½¿ç”¨åƒ æ„å»ºå™¨ è¿™æ ·çš„æŠ½è±¡&quot;å¯¹è±¡&quot;æ¥æ€è€ƒ,
ä¹Ÿä¸å–œæ¬¢è¿™ç§é£æ ¼ä¸­æ›´ç›´è§‚çš„å‡è®¾;
ä¸ºä»€ä¹ˆ &quot;æ„å»ºå™¨&quot; æ˜¯ä½œæŸä»¶äº‹å„¿çš„å¯¹è±¡?
ä¸ºä»€ä¹ˆå®ƒæ¯”&quot;é…ç½®&quot;ç»“æ„æ›´å—æ¬¢è¿?
OOP ç¨‹åºå‘˜æ˜¯å¦æ„è¯†åˆ°åœ¨ç°å®ç”Ÿæ´»ä¸­, ç»å¤§å¤šæ•°å¯¹è±¡æ ¹æœ¬ä¸ä½œä»»ä½•äº‹å„¿,
å½“ç„¶, ä¹Ÿä¸ä¼šæ„å»ºå…¶å®ƒå¯¹è±¡?</p>
<p>ä½†æ˜¯, å¯¹äºç†Ÿæ‚‰ OOP ä¹ æƒ¯ç”¨æ³•çš„äººæ¥è¯´,
è¿™å¯èƒ½æ›´å¯å–;
è¿™æ˜¯ä¸€ä¸ªæ™®é€šé€‰æ‹©çš„é€‰é¡¹, å› æ­¤, è‡³å°‘è¯†åˆ«è¿™ç§æ¨¡å¼å¾ˆé‡è¦;</p>
<h2 id="ç»“è®ºå’Œåº”ç”¨"><a class="header" href="#ç»“è®ºå’Œåº”ç”¨">ç»“è®ºå’Œåº”ç”¨</a></h2>
<p>Rust æœ‰å¾ˆå¤šä¸åŒäºå…¶å®ƒè¯­è¨€çš„ä¹ æƒ¯;
æˆ‘ç»å¸¸çœ‹åˆ°æ–°çš„ Rustacean æè®®ä¸º Rust æ·»åŠ é»˜è®¤å‚æ•°å’Œå…¶å®ƒç±»ä¼¼çš„åŠŸèƒ½,
è€Œè¿™äº›æ–° Rustacean æ„Ÿåˆ°å›°æƒ‘çš„æ˜¯, 
é¢†å¯¼ä½œç”¨æ„Ÿå—åˆ°çš„å¼ºçƒˆè¦æ±‚åœ¨æ›´å¤§çš„ Rust ç¤¾åŒºä¸­å¹¶æ²¡æœ‰è¢«å¹¿æ³›æ„Ÿå—åˆ°;</p>
<p>é€šå¸¸, è¿™å’Œé»˜è®¤å‚æ•°ç±»ä¼¼;
æœ‰å®ç°ç›¸åŒç›®æ ‡çš„æ›¿ä»£ä¹ è¯­, å˜¦è¿™äº›ç›®æ ‡ç¬¦åˆ Rust çš„ä»·å€¼è§‚:
åœ¨æ­¤åœºæ™¯ä¸­, DRYness å¹¶å‡å°‘å¼€å‘è€…è®¤çŸ¥è´Ÿæ‹…;
æ ¹æ® Rusty çš„ä»·å€¼è§‚, å¥¹ä»¬åœ¨å…¶å®ƒæ–¹é¢ä¹Ÿæ˜¯æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ: é¢å¤–çš„æ˜ç¡®æ€§å€¼å¾—å¤šç‚¹å†—é•¿ä»£ç ;</p>
<p>æ‰€ä»¥, æˆ‘å¸Œæœ›è¿™å¯ä»¥ä½œä¸ºä¸€ä¸ªæ¡ˆä¾‹ç ”ç©¶æ¥æŠ¥æ—¶å¤§å®¶ç†è§£,
é€šå¸¸æ€»æ˜¯æœ‰ Rusty çš„æ–¹æ³•æ¥å®ç° OOP é¢†åŸŸæµè¡ŒåŠŸèƒ½ç›®æ ‡,
ä»¥åŠ, ä¸ºä»€ä¹ˆ Rustacean æ›´åŠ å–œæ¬¢è¿™äº›æ–¹æ¡ˆè€Œä¸æ˜¯ç›²ç›®çš„ç§¯ç´¯æ–°åŠŸèƒ½;</p>
<h2 id="logging-26"><a class="header" href="#logging-26">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230220 ZQ v0 DONE</li>
<li>230212 ZQ init.</li>
</ul>
<pre><code>          _~âˆ½&amp;âˆ½~_
      \/ /  ^ o  \ \/
        '_   â–½   _'
        / '--âŒ„--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-è¶…è¶Šé¢å‘å¯¹è±¡ç¬¬1éƒ¨åˆ†"><a class="header" href="#rust-è¶…è¶Šé¢å‘å¯¹è±¡ç¬¬1éƒ¨åˆ†">Rust è¶…è¶Šé¢å‘å¯¹è±¡,ç¬¬1éƒ¨åˆ†</a></h1>
<p>åŸæ–‡: <a href="https://www.thecodedmessage.com/posts/oop-1-encapsulation/">Rust Is Beyond Object-Oriented, Part 1: Intro and Encapsulation :: The Coded Message</a></p>
<h2 id="å¿«è¯‘-1"><a class="header" href="#å¿«è¯‘-1">å¿«è¯‘</a></h2>
<p>æ˜¯çš„, Rust ä¸æ˜¯ä¸€ç§ OOP ç¼–ç¨‹è¯­è¨€;</p>
<p>Rust å¯èƒ½çœ‹èµ·æ¥åƒä¸€ç§ OOP ç¼–ç¨‹è¯­è¨€:
ç±»å‹å¯ä»¥å’Œ &quot;â€œmethods&quot; å…³è”,
å¯ä»¥æ˜¯ &quot;intrinsic&quot; çš„æˆ–æ˜¯é€šè¿‡ &quot;traits&quot;;
é€šå¸¸å¯ä»¥ä½¿ç”¨ C++ æˆ–æ˜¯ Java é£æ ¼çš„ OOP è¯­æ³•è°ƒç”¨æ–¹å¼:
map.insert(key, value) æˆ– foo.clone();
å°±åƒåœ¨ OOP è¯­è¨€ä¸­ä¸€æ ·,
æ­¤è¯­æ³•æ¶‰åŠæ”¾ç½®åœ¨è°ƒç”¨è€…çš„ <code>.</code> ä¸­, è€Œåœ¨è¢«è°ƒç”¨è€…ä¸­ç§°ä¸º self;</p>
<p>ä½†è¯·ä¸è¦è¯¯ä¼š: å°½ç®¡ Rust å¯èƒ½å€Ÿç”¨äº†ä¸€äº›æŠ€å·§/æœ¯è¯­å’Œè¯­æ³•,
ä½†æ˜¯, Rust å¹¶ä¸æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€;
é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸‰å¤§æ”¯æŸ±ç†å¿µ: å°è£…/å¤šæ€/ç»§æ‰¿;
å…¶ä¸­, Rust å®Œå…¨å¦å†³äº† ç»§æ‰¿,
å› æ­¤, æ°¸è¿œä¸å¯èƒ½æˆä¸º&quot;çœŸæ­£çš„&quot; OOP è¯­è¨€;
ä¸è¿‡, å³ä¾¿å¯¹äºå°è£…å’Œå¤šæ€, Rust å®ç°çš„æ–¹å¼ä¹Ÿå’Œ OOP è¯­è¨€ä¸åŒ --- ç¨åå°†å¯¹æ­¤è¿›è¡Œæ›´åŠ è¯¦ç»†çš„ä»‹ç»;</p>
<p>è¿™ä¸€åˆ‡éƒ½è®©å¾ˆå¤šç¨‹åºå‘˜æ„Ÿåˆ°æƒŠè®¶ä»¥åŠæ— æª;
æˆ‘åœ¨ Reddit ä¸Šçœ‹åˆ° Rust æ–°æ‰‹è¯¢é—®å¦‚ä½•æŒ‰å­—é¢æ„æ€å®ç° OOP è®¾è®¡æ¨¡å¼,
è¯•å›¾è·å¾—åƒâ€œshapesâ€ æˆ–æ˜¯ â€œvehiclesâ€è¿™ç§&quot;ç±»å±‚æ¬¡ç»“æ„&quot;,
ä½¿ç”¨ä½œä¸º&quot;Rust ç‰ˆæœ¬ç»§æ‰¿&quot;çš„ traits --- æ¢å¥è¯è¯´, 
è¯•å›¾è§£å†³ä»–ä»¬æƒ³è±¡ä¸­çš„é—®é¢˜, 
å› ä¸º, ä»–ä»¬è‡´åŠ›äº OOP æ–¹æ³•, å¹¶é€šè¿‡æ„å»ºäººä¸ºçš„ OOP ç¤ºä¾‹æ¥å°è¯•äº†è§£ä»–ä»¬æœŸå¾…çš„åº”è¯¥å­˜åœ¨çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ Rust;</p>
<p>è¿™å¯¹å¾ˆå¤šäººæ¥è¯´æ˜¯ä¸€ä¸ªç»Šè„šçŸ³;
æˆ‘ç»å¸¸çœ‹åˆ° Rust æ–°æ‰‹å’Œæ€€ç–‘è®ºè€…åœ¨äº’è”ç½‘ä¸Šæåˆ°&quot;ç¼ºä¹OOP&quot;,
è¿™æ˜¯ Rust éš¾ä»¥é€‚åº”/ä¸åˆé€‚ä»–ä»¬çš„å…³é”®åŸå› ,
ç”šè‡³æ˜¯ Rust æ°¸è¿œä¸ä¼šæµè¡Œçš„åŸå› ;
å¯¹äºé‚£äº›åœ¨ OOP çš„é«˜åº¦æ¥å­¦ä¹ ç¼–ç¨‹çš„äººæ¥è¯´ --- å½“åƒ C å’Œ ML é‚£æ ·å®Œç¾çš„è¯­è¨€éƒ½å¿…é¡»å˜æˆ Object-C å’Œ OCaML è¿™ç§é¢å‘å¯¹è±¡çš„è¯­è¨€ --- 
å¯¹é OOP è¯­è¨€çš„å¤§é‡ç‚’ä½œæ„Ÿè§‰å°±ä¸å¤ªé¦™äº†;</p>
<p>è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå®¹æ˜“çš„è°ƒæ•´;
å¦‚æ­¤å¤šçš„ç¨‹åºçŒ¿ä»¥æ˜ç¡®çš„é¢å‘å¯¹è±¡çš„æ–¹å¼å­¦ä¹ è½¯ä»¶è®¾è®¡å’Œä½“ç³»ç»“æ„;
æˆ‘çœ‹åˆ°ä¸€ä¸ªåˆä¸€ä¸ªé—®é¢˜,
ä¸€ä¸ªåˆçº§æˆ–ä¸­çº§ Rust ç¨‹åºå‘˜æƒ³è¦ä½œä¸€ä¸ªé¢å‘å¯¹è±¡çš„äº‹å„¿,
å¹¶æƒ³è¦ä¸€ä¸ªå­—é¢ä¸Šçš„ Rust ç­‰ä»·ç‰©;
é€šå¸¸, è¿™äº›éƒ½æ˜¯ç»å…¸çš„ &quot;XY é—®é¢˜&quot; (åŸæ–‡:<a href="https://xyproblem.info/">XY problem</a>, é…·å£³æœ‰ç²¾é‡‡çš„ç¿»è¯‘:<a href="https://coolshell.cn/articles/10804.html">X-Y Problem | é…· å£³ - CoolShell</a>)æ¡ˆä¾‹, ä»–ä»¬å¾ˆéš¾è°ƒå¤´ç”¨æ›´ Rusty çš„æ–¹å¼è§£å†³é—®é¢˜;</p>
<p>è¿™å…¶å®éƒ½ä¸æ˜¯ Rust çš„é”™;
ç­”æ¡ˆè¿˜æ˜¯è¦æˆ‘ä»¬å»è°ƒæ•´,
è™½ç„¶ä¸å®¹æ˜“;
æˆ‘ä»¬è¦æˆä¸ºæ›´å¥½çš„ç¨‹åºå‘˜, ä¸ä»…ç²¾é€šå¤šç§è¯­è¨€,
è€Œä¸”è¦ç²¾é€šä¸åŒçš„ç¼–ç¨‹èŒƒå¼;</p>
<p>è€Œä¸”, ä½œä¸ºä¸€ç§èŒƒå¼, OOP å®é™…ä¸Šéå¸¸å¹³åº¸ --- ä»¥è‡³äºæˆ‘å†™äº†ä¸€æ•´ç¯‡æ–‡ç« æ¥è§£é‡Šä¸ºä»€ä¹ˆ,
ä»¥åŠä¸ºä»€ä¹ˆ Rust çš„æ–¹æ³•æ›´å¥½;</p>
<h3 id="é¢å‘å¯¹è±¡æ€æƒ³"><a class="header" href="#é¢å‘å¯¹è±¡æ€æƒ³">é¢å‘å¯¹è±¡æ€æƒ³</a></h3>
<blockquote>
<p>OOP Ideology</p>
</blockquote>
<p>å—¯å“¼,å¥½è±¡æ˜ç™½äº†;
æˆ‘æ›¾ç»æ˜¯è‡ªå·±ä¸»åŠ¨å˜æˆ OOP ä¿¡å¾’çš„;
è¿˜è®°å¾—å½“å¹´æ˜¯å¦‚ä½•å‘æˆ‘ä»¬æ”¶è´¹çš„:
ä¸ä»…ä»…æ˜¯ä¸€å¥—ä»£ç ç»„ç»‡å®è·µ,æ›´åŠ æ˜¯ç¼–ç¨‹æ–¹é¢çš„ä¸€åœºé©å‘½;
OOP æ–¹æ³•è¢«è®¤ä¸ºæ›´ç›´è§‚,å°¤å…¶å¯¹éç¨‹åºå‘˜è€Œè¨€, å› ä¸ºæ›´åŠ ç¬¦åˆæˆ‘ä»¬å¯¹è‡ªç„¶ä¸–ç•Œçš„çœ‹æ³•;</p>
<p>å¯¹äºè¿™ç§è¥é”€çš„å…¸å‹ç¤ºä¾‹, ä»¥ä¸‹æ˜¯æµè¡Œæ‚å¿—(Byte Magazine, 1981å¹´)ä¸­å…³äº OOP ç¬¬ä¸€ç¯‡å…¬å¼€æ–‡ç« çš„æ‘˜å½•:</p>
<hr />
<blockquote>
<p>è®¸å¤šä¸çŸ¥é“è®¡ç®—æœºå¦‚ä½•å·¥ä½œçš„äººå‘ç° OOP æƒ³æ³•å¾ˆè‡ªç„¶;
ç›¸æ¯”ä¹‹ä¸‹, åè€Œæ˜¯å¾ˆå¤šæœ‰è®¡ç®—æœºç»éªŒçš„äººæœ€åˆè®¤ä¸º OOP ç³»ç»Ÿæœ‰äº›å¥‡æ€ª...</p>
</blockquote>
<hr />
<p>ä¸º OOP ä¹°å¸å¾ˆå®¹æ˜“;
å½“ç„¶, æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæºæ²¡æœ‰ä»»ä½•å­ç¨‹åºæˆ–æ˜¯å˜é‡ä¹‹ç±»çš„ä¸œè¥¿ --- æˆ–è€…,
å³ä¾¿æœ‰, æˆ‘ä»¬ä¹Ÿæ²¡æœ‰æ˜ç¡®çš„è€ƒè™‘å®ƒä»¬!
ä½†æ˜¯, ç”Ÿæ´»ä¸­ç¡®å®æœ‰æˆ‘ä»¬å¯ä»¥ä¸ä¹‹äº¤äº’çš„å¯¹è±¡, æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„åŠŸèƒ½;
æ€ä¹ˆå¯èƒ½ä¸ç›´è§‚å‘¢?</p>
<p>è¿™æ˜¯éå¸¸å¼•äººæ³¨ç›®çš„ä¼ªè®¤çŸ¥ç§‘å­¦,è½»ç ”ç©¶,é‡è¯´æœåŠ›;
è¿™äº› object/å¯¹è±¡ å¯ä»¥è®¤ä¸ºæ˜¯ &quot;agents&quot;, å‡ ä¹è±¡äººä¸€æ ·,
æ‰€ä»¥, ä½ å¯ä»¥åˆ©ç”¨ä½ çš„ç¤¾äº¤æŠ€èƒ½æ¥å¤„ç†å®ƒ,
è€Œä¸ä»…ä»…æ˜¯åˆ†ææ€§æ€ç»´
(å«‘ä»‹æ„ object/å¯¹è±¡ çš„è¡Œä¸ºä¸€ç‚¹å„¿ä¹Ÿä¸åƒäºº,è€Œä¸”,å®é™…ä¸Šåœ¨æŸç§ç¨‹åºä¸Šæ›´åŠ ç¬¨,
è¿™æ—¶ä»ç„¶éœ€è¦åˆ†ææ€ç»´);
æˆ–æ˜¯, ä½ å¯ä»¥å°†å¯¹è±¡å’Œç±»è§†ä¸ºå½¢å¼ä¸–ç•Œæœ¬èº«çš„è¿‘ä¹æŸæ‹‰å›¾å¼çš„è¡¨è¾¾, ä½¿å…¶åœ¨å“²å­¦ä¸Šå¼•äººæ³¨ç›®;</p>
<p>å“¦, å½“å¹´æˆ‘æ˜¯å¦‚ä½•æ¥å—çš„? å°¤å…¶æ˜¯åœ¨è‚†æ„é²è½çš„é’å¹´æ—¶æœŸï¼›
æˆ‘ä¸ªäººå¸æ”¶äº† OOP å’ŒæŸæ‹‰å›¾ä¹‹é—´çš„è”ç³»;
æ·±å…¥ç ”ç©¶äº†å…ƒå¯¹è±¡åè®®, 
ä»¥åŠåœ¨ Smalltalk ä¸­æ¯ä¸ªç±»éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå…ƒç±»çš„äº‹å®;
Smalltalk ä»£ç å…ƒç±»çš„æ¦‚å¿µå¯¹æˆ‘æ¥è¯´å‡ ä¹æ˜¯ç¥ç§˜çš„,
å› ä¸º, ä»»ä½•å€¼éƒ½å¯ä»¥ç»„ç»‡åœ¨åŒä¸€å±‚æ¬¡ç»“æ„ä¸­,
å¯¹è±¡åè€Œä½äºå…¶æ ¹éƒ¨;</p>
<p>æˆ‘èµ¢å¾—åœ¨ä¸€æœ¬ä¹¦ä¸­è¯»åˆ° OOP é£æ ¼çš„å¤šæ€ä½¿å¾— if-else è¯­å¥å˜å¾—å¤šä½™,
å› æ­¤,æˆ‘ä»¬åº”è¯¥åŠªåŠ›æœ€ç»ˆåªä½¿ç”¨ OOP é£æ ¼çš„å¤šæ€;
ä¸çŸ¥ä½•æ•…, è¿™æ²¡è®©æˆ‘å¤±æœ›, è¿™è®©æˆ‘å½“æ—¶å¾ˆå…´å¥‹;
è€Œä¸”,å½“æˆ‘äº†è§£åˆ° Smalltalk å®é™…æ­£æ˜¯è¿™æ ·ä½œçš„,
å°±æ›´åŠ å…´å¥‹äº†
(å¦‚æœä½ å¿½ç•¥ä¼˜åŒ–æ‰æŸäº›æŠ½è±¡çš„å®ç°ç»†èŠ‚):
åœ¨ Smalltalk ä¸­, if-than-else çš„æ¦‚å¿µæ˜¯é€šè¿‡ ifTrue: å’Œ ifElse: ä»¥åŠ ifTrue:ifFalse: ç­‰æ–¹æ³•å®ç°çš„,
è¿˜å¾—é…å¥—å•å®ä¾‹çš„ True å’Œ False ç±»,ä»¥åŠå…¶å…¨å±€å¯¹è±¡ true å’Œ false;</p>
<p>(è¯‘æŒ‰: å…‰æ˜¯å¬èµ·æ¥å°±éå¸¸,å—¯å“¼? è¿™ä¸æ˜¯ä¸€æ ·çš„ä¸œè¥¿å˜›?)</p>
<p>ä½œä¸ºä¸€åæ›´æˆç†Ÿçš„ç¨‹åºå‘˜,æ¥è§¦åˆ°æ„è¯†å½¢æ€è¾ƒå°‘çš„ C++ OOP ä»¥åŠ Haskell ä¸­çš„å‡½æ•°å¼ç¼–ç¨‹æ›¿ä»£æ–¹æ¡ˆå,
æˆ‘çš„ç«‹åœºå°±è½¯åŒ–äº†, ç„¶å, å‘ç”Ÿäº†å·¨å¤§è½¬å˜, ç°åœ¨æˆ‘å‡ ä¹ä¸å†æ˜¯ OOP çš„è„‘æ®‹ç²‰,
å°¤å…¶æ˜¯å½“å…¶æœ€ä½³æ€æƒ³å·²ç»åœ¨ Haskell å’Œ Rust ä¸­è¿›è¡Œäº†æ›´æ–°ç»¼åˆ;
æˆ‘å·²æ„è¯†åˆ°è¿™ç§å¯¹æ–°ç¨‹åºå‘˜çš„ç‚’ä½œå¯¹äºä»»ä½•èŒƒå¼éƒ½æ˜¯å…¸å‹çš„(FUD ~ Fear/Uncertainty/Doubt, æ„ä¸º:æ‡¼ã€æƒ‘ã€ç–‘, ç°åœ¨ç»Ÿç§°ä¸º PUA æŠ€æœ¯);
å¯¹äºæ–°æ‰‹æ¥è¯´, ä»»ä½•æ–°ç¼–ç¨‹èŒƒå¼éƒ½æ¥äº†ä½¿ç”¨ä¸åŒèŒƒå¼çš„èµ„æ·±ç¨‹åºå‘˜æ›´åŠ ç›´è§‚;
å‡½æ•°å¼ç¼–ç¨‹ä¹Ÿæ˜¯å¦‚æ­¤;
ç”šè‡³å¯¹äº Rust ä¹Ÿæœ‰åŒæ ·çš„è¯´æ³•;
å…¶å®å’ŒèŒƒå¼æ˜¯å¦æ›´å¥½å¹¶æ— å¤ªå¤§çš„å…³ç³»;</p>
<p>è‡³äº if-else è¯­å¥å®Œå…¨ç”¨å¤šæ€æ¥æ›¿æ¢,
å¥½å§, å¾ˆå®¹æ˜“æƒ³å‡ºä¸€ç»„å›¾çµå®Œå¤‡çš„å…ƒè¯­;
ä½ ä¸é‚•ä¸ºç”¨å¤šæ€æ¥æ¨¡æ‹Ÿ if è¯­å¥ä»¥åŠ true;
ä½ è¿˜å¯ä»¥æ¨¡æ‹Ÿå¸¦æœ‰é€’å½’çš„ shile å¾ªç¯,
åˆæˆ–æ˜¯å¸¦æœ‰ while å¾ªç¯å’Œå †æ ˆçš„é€’å½’ï¼›
ä½ å¯ä»¥ä½¿ç”¨ while å¾ªç¯æ¨¡æ‹Ÿ if è¯­å¥;</p>
<p>è¿™äº›äº‹å®éƒ½ä¸èƒ½ä½¿ç”¨è¿™ç§æ›¿ä»£æˆä¸ºä¸€ä¸ªå¥½ä¸»æ„;
å¯¹äºä¸åŒçš„æƒ…å†µ, ç¼–ç¨‹è¯­è¨€ä¸­å­˜åœ¨ä¸åŒçš„ç‰¹æ€§,
é€‚åº¦çš„å¯¹åº”ä½¿ç”¨, å®é™…ä¸ŠåŸæœ¬å°±æ˜¯ä¸€ä»¶å¥½äº‹æƒ…;</p>
<p>æ¯•ç«Ÿ,ç¼–ç¨‹çš„ç›®çš„æ˜¯ç¼–å†™ç¨‹åº, è€Œä¸æ˜¯è¯æ˜å›¾çµå®Œå¤‡æ€§/å“²å­¦ç ”ç©¶åˆæˆ–æ˜¯å†™æ¦‚å¿µè¯—;</p>
<p>(è¯‘æŒ‰: ä¸è¿‡, ç°å®ä¸­çš„ç¡®æœ‰è¿™ç±»ç ”ç©¶åƒ§, ä¸»è¦ç¤¾ä¼šè´¡çŒ®å°±æ˜¯åˆ¶é€ æ–°æ¦‚å¿µå“ª...)</p>
<h3 id="å®ç”¨æ€§"><a class="header" href="#å®ç”¨æ€§">å®ç”¨æ€§</a></h3>
<blockquote>
<p>Practicality</p>
</blockquote>
<p>å› æ­¤, åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« ä¸­, æˆ‘æ‰“ç®—ä»å®é™…è§’åº¦è¯„ä¼° OOP,
ä½œä¸ºä¸€åç¨‹åºçŒ¿, åœ¨ä½¿ç¼–ç¨‹è¯­è¨€åœ¨è®¤çŸ¥ä¸Šæ›´æ˜“äºç®¡ç†æˆ–æ˜¯æ›´å®¹æ˜“è¿›è¡ŒæŠ½è±¡æ–¹é¢å…·æœ‰ç»éªŒ;
æˆ‘å°†æ ¹æ®æˆ‘è§£å†³å®é™…ç¼–ç¨‹é—®é¢˜çš„ç»éªŒæ¥è¿›è¡Œè¯„ä¼° --- æˆ‘è®¤ä¸ºè¿™æ˜¯ç§ä¸å¥½çš„è¿¹è±¡,
å¾ˆå¤š OOP æŠ½è±¡å¦‚ä½•å·¥ä½œçš„æ¡ˆä¾‹åªæœ‰åœ¨çœŸæ­£é«˜çº§çš„ç¨‹åºä¸­æ‰æœ‰æ„ä¹‰,
æˆ–æ˜¯å…³äºåŠ¨ç‰©å›­ä¸­ä¸åŒç±»å‹çš„å½¢çŠ¶æˆ–æ˜¯åŠ¨ç‰©çš„äººä¸ºä¾‹å­æ‰æœ‰æ„ä¹‰;</p>
<p>å’Œå¤§å¤šæ•° OOP ä»‹ç»ä¸åŒ, æˆ‘ä¸ä¼šå…³æ³¨ OOP å’Œ OOPã€€ä¹‹å‰çš„ç¼–ç¨‹è¯­è¨€çš„æ¯”è¾ƒï¼›
ç›¸å, æˆ‘å°†ä¸»è¦å’Œ Rust è¿›è¡Œæ¯”è¾ƒ,
Rust ä» OOP ä¸­æ±²å–äº†å¾ˆå¤šå¥½æƒ³æ³•,
ä¹Ÿè®¸è¿˜ä¼šå’Œå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€(æ¯”å¦‚ Haskell)è¿›è¡Œæ¯”è¾ƒ;
è¿™äº›ç¼–ç¨‹è¯­è¨€é‡‡çº³äº† OOP çš„ä¸€äº›å¥½æƒ³æ³•,
ä½†æ˜¯, éƒ½ä»¥ä¸€ç§ä¿®å¤ç¼ºé™·å¹¶è¿›ä¸€æ­¥è¶…è¶Šçš„å§¿æ€, å¯¹åˆç†çš„ OOP è¿›è¡Œäº†æ”¹é€ ;</p>
<p>æˆ‘å°†æ ¹æ®é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸‰ä¸ªä¼ ç»Ÿæ”¯æŸ±: å°è£…/å¤šæ€å’Œç»§æ‰¿æ¥ç»„ç»‡è¿™ç§æ¯”è¾ƒ,
ç¬¬ä¸€ç¯‡å°†é‡ç‚¹æ”¾åœ¨å°è£…ä¸Š;
å¯¹äºæ¯ä¸ªæ”¯æŸ±, å°†è®¨è®º OOP å¦‚ä½•å®šä¹‰, ä»¥åŠåœ¨ OOP ä¸–ç•Œä¹‹å¤–å­˜åœ¨å“ªäº›ç­‰ä»·ç‰©æˆ–æ˜¯æ›¿ä»£å“,
ä»¥åŠè¿™äº›åœ¨å®é™…æ˜“ç”¨æ€§å’Œç¼–ç¨‹èƒ½åŠ›æ–¹é¢è¿›è¡Œå¯¹æ¯”;</p>
<p>ä¸è¿‡,åœ¨å¼€å§‹ä¹‹å‰,æƒ³å…ˆè°ˆè°ˆä¸€ä¸ªç”¨ä¾‹, è¿™ä¸ªç”¨ä¾‹æ›¾é¢ è¦†è¿‡å¤§éƒ¨åˆ†å†…å®¹: å›¾å½¢ç”¨æˆ·ç•Œé¢æˆ–æ˜¯è¯´ GUI;
å°¤å…¶æ˜¯åœ¨æµè§ˆå™¨æ—¶ä»£ä¹‹å‰,
ç¼–å†™ GUI ç¨‹åºä»¥ä¾¿ç›´æ¥åœ¨å°å¼æœº(æˆ–ç¬”è®°æœ¬ç”µè„‘)ä¸Šè¿è¡Œ,
æ˜¯ç¨‹åºå‘˜å·¥ä½œçš„ä¸»è¦éƒ¨åˆ†;
OOP çš„è®¸å¤šæ—©æœŸå¼€å‘æ˜¯å’Œ Xerox PARC çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ç ”ç©¶ä¸€èµ·å®Œæˆçš„,
OOP éå¸¸é€‚åˆè¯¥ç”¨ä¾‹;
å› æ­¤, å€¼å¾—ä¼˜å…ˆè€ƒè™‘ GUI;</p>
<p>ä¾‹å¦‚, äººä»¬é€šå¸¸ä¼šåœ¨å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­æ¨¡æ‹Ÿ OOP;
GTK+ å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­,
å°† OOP å®ç°ä¸º C ä¸­ä¸€ç³»åˆ—å®å’Œçº¦å®š;
è¿™æ ·ä½œçš„åŸå› æœ‰å¾ˆå¤š,åŒ…æ‹¬ç†Ÿæ‚‰ OOP è®¾è®¡å’Œå¸Œæœ›åˆ›å»ºæŸç§è¿è¡Œæ—¶çš„å¤šæ€;
ä½†æ˜¯,æ ¹æ®æˆ‘çš„ç»éªŒ, è¿™åœ¨å®ç° GUI æ¡†æ¶æ—¶æœ€ä¸ºå¸¸è§;</p>
<p>åœ¨æœ¬ç³»åˆ—æ–‡ç« ä¸­, ä¸»è¦å…³æ³¨å°† OOP åº”ç”¨åœ¨å…¶å®ƒç”¨é€”çš„åœºæ™¯,
ä½†æ˜¯,ä¹Ÿä¼šé…Œæƒ…è®¨è®º GUI;
åœ¨è¿™ä¸ªä»‹ç»æ€§éƒ¨, æˆ‘ä»…æŒ‡å‡º GUI æ¡†æ¶åœ¨ä¼ ç»Ÿ OOP è®¾è®¡å’Œç¼–ç¨‹è¯­è¨€ä¹‹å¤–æ˜¾ç„¶æ˜¯å¯èƒ½çš„,
ç”šè‡³äºåœ¨ Rust ä¸­ä¹Ÿæ˜¯å¦‚æ­¤;
æœ‰æ—¶, GUI å¯ä»¥é€šè¿‡å®Œå…¨ä¸åŒçš„æœºåˆ¶å·¥ä½œ,
ä¾‹å¦‚ä¸»è¦åœ¨ Haskell ä¸­å¼€åˆ›æ€§çš„åŠŸèƒ½å“åº”å¼äº†æ¸”çš„å“ª, æˆ‘ä¸ªäººæ›´åŠ å–œæ¬¢ä¼ ç»Ÿçš„åŸºäº OOP çš„ç¼–ç¨‹,
è€Œä¼ ç»Ÿçš„ OOP åŠŸèƒ½å¯¹æ­¤å´å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©;</p>
<p>ç°åœ¨, äº‹ä¸å®œè¿Ÿ, è®©æˆ‘ä»¬ä»å®ç”¨è§’åº¦, é€ä¸€æ¯”è¾ƒ OOP å’Œ Rust ä»¥åŠå…¶åå„ç§ OOP ç¼–ç¨‹è¯­è¨€;
å¯¹äºé¦–ç¯‡æ–‡ç« , å…¶ä½™éƒ¨åˆ†å°†é‡ç‚¹å…³æ³¨å°è£…;</p>
<h3 id="ç¬¬ä¸€æ”¯æŸ±-å°è£…-encapsulation"><a class="header" href="#ç¬¬ä¸€æ”¯æŸ±-å°è£…-encapsulation">ç¬¬ä¸€æ”¯æŸ±: å°è£…/ Encapsulation</a></h3>
<p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­, å°è£…å’Œç±»çš„æ¦‚å¿µå¯†åˆ‡ç›¸å…³,
ç±»æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„åŸºæœ¬æŠ½è±¡å±‚;
æ¯ä¸ªç±»éƒ½åŒ…å«ä¸€äº›è®°å½•æ•°æ®çš„æ ¼å¼/å¸ƒå±€,
å³, æ¯ä¸ªå®ä¾‹åŒ…å«ä¸€å®šæ•°é‡å­—æ®µçš„æ•°æ®ç»“æ„;
è®°å½•ç±»å‹çš„å•ä¸ªå®ä¾‹ç§°ä¸º&quot;å¯¹è±¡&quot;;
æ¯ä¸ªç±»è¿˜åŒ…å«å’Œè¯¥è®°å½•ç±»å‹ç´§å¯†é…å¯¹çš„ä»£ç ,
ç»„ç»‡æˆç§°ä¸ºæ–¹æ³•çš„è¿‡ç¨‹;
æ ¸å¿ƒæƒ³æ³•æ˜¯, æ‰€æœ‰å­—æ®µéƒ½åªèƒ½ä»æ–¹æ³•å†…éƒ¨è®¿é—®,
æ— è®ºæ˜¯é€šè¿‡ OOP æ„è¯†å½¢æ€çš„çº¦å®šè¿˜æ˜¯é€šè¿‡ç¼–ç¨‹è¯­è¨€çš„å¼ºåˆ¶è§„åˆ™;</p>
<p>è¿™é‡Œçš„åŸºæœ¬å¥½å¤„æ˜¯ æ¥å£/interface ,ä¹Ÿå°±æ˜¯ä»£ç å¦‚ä½•å’Œå…¶å®ƒä»£ç äº¤äº’,
æˆ–è€…è¯´ä½ å¿…é¡»çŸ¥é“ä»€ä¹ˆæ‰èƒ½ä½¿ç”¨ä»£ç ,
æ¯” å®ç°/implementation è¦ç®€å•çš„å¤š, å®ç°/implementation æ˜¯ä»£ç å¦‚ä½•å®é™…å®Œæˆ çš„æ›´åŠ æµç•…å˜åŒ–çš„ç»†èŠ‚, å…¶åŸæœ¬çš„å·¥ä½œ;</p>
<p>ä½†æ˜¯, è™½ç„¶è®¸å¤šç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™æ ·çš„æŠ½è±¡;
ä»»ä½•è¶…è¿‡åå‡ è¡Œçš„ç¨‹åºå°±æœ‰å¤ªå¤šçš„éƒ¨åˆ†, æ— æ³•ä¸€æ¬¡å…¨éƒ¨åæ˜ åˆ°ä½ çš„å¤§è„‘ä¸­,
å› æ­¤,æ‰€æœ‰ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½æœ‰å°†ç¨‹åºåˆ’åˆ†ä¸ºæ›´å°ç»„ä»¶çš„æ–¹æ³•,
ä½œä¸ºç®¡ç†å¤æ‚æ€§çš„ä¸€ç§æ–¹å¼,
æ¥å£/interface æ€»æ˜¯æ¯” å®ç°/implementation æ›´åŠ ç®€å•,
æ— è®ºæ˜¯ç”±ç¼–ç¨‹è¯­è¨€å¼ºåˆ¶æ‰§è¡Œ, è¿˜æ˜¯&quot;è£èª‰ç³»ç»Ÿ&quot;çš„é—®é¢˜;
å› æ­¤, ä»å¹¿ä¹‰ä¸Šç›, æ‰€æœ‰ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½æœ‰æŸç§ç‰ˆæœ¬çš„å°è£…;</p>
<p>ä¸€ç§ç®€å•çš„å°è£…å½¢å¼ --- å¤ªå¤šæ•°é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å°†å…¶ä½œä¸ºç±»ä¸­çš„ä¸€å±‚æ¥ç»´æŠ¤ --- å°±æ˜¯è¿‡ç¨‹,
ä¹Ÿç§°ä¸ºå‡½æ•°/å­ä¾‹ç¨‹æˆ–æ˜¯(OOP ä¸­çš„ç§°å‘¼)æ–¹æ³•;
ç°ä»£ç¼–ç¨‹è¯­è¨€ä¸å…è®¸ä»»ä½•ä»£ç è¡Œç›´æ¥è·³è½¬åˆ°ä»»ä½•å…¶å®ƒä»£ç è¡Œ,
è€Œæ˜¯å€¾å‘å°†ä»£ç å—ç»„åˆä¸ºè¿‡ç¨‹,
ç„¶å, ä½ å¯ä»¥åœ¨ä¸å½±å“å¤–éƒ¨ä»£ç çš„æƒ…å†µä¸‹,
æ›´æ”¹è¿‡ç¨‹çš„å†…å®¹, å¹¶æ›´æ”¹å¤–éƒ¨ä»£ç , åŒæ ·åœ¨ä¸å½±å“ç¨‹åºçš„æƒ…å†µä¸‹,
å˜¦éƒ½éµå¾ªç›¸åŒçš„ æ¥å£/interface å’Œ å¥‘çº¦/contract;</p>
<p>å¥‘çº¦/contract é€šå¸¸è‡³å°‘éƒ¨åˆ†æ˜¯äººç±»å±‚é¢çš„çº¦å®š;
ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ä½ é‡‡ç”¨ä¸€ä¸ªåº”è¯¥å¤„ç†ä¸€äº›æ•°æ®çš„è¿‡ç¨‹,
è€Œæ˜¯è®©å…¶æ— é™å¾ªç¯æˆ–æ˜¯ä»¤ç¨‹åºå´©æºƒ;
ä½†æ˜¯, å…¶ä¸­çš„ä¸€äº›, ä¾‹å¦‚è¿‡ç¨‹å’Œç¨‹åºå…¶ä½™éƒ¨åˆ†çš„åˆ†ç¦», 
ä»¥åŠåœ¨è®¸å¤šæƒ…å†µä¸­, å…è®¸åœ¨è°ƒç”¨ä¸­æ¥å—å’Œè¿”å›çš„å€¼çš„æ•°é‡å’Œç±»å‹,
å°†ç”±ç¼–ç¨‹è¯­è¨€å¼ºåˆ¶æ‰§è¡Œ;</p>
<p>ä¾‹å¦‚,åœ¨è¿‡ç¨‹å†…éƒ¨å£°æ˜çš„å˜é‡é€šå¸¸æ˜¯å±€éƒ¨çš„,
è€Œä¸”æ²¡æœ‰åŠæ³•åœ¨è¿‡ç¨‹å¤–éƒ¨å¼•ç”¨;
è¾“å…¥å’Œè¾“å‡ºé€šå¸¸å§´åœ¨è¿‡ç¨‹é¡¶éƒ¨çš„ç­¾åä¸­;
é€šå¸¸, å¤–éƒ¨ä»£ç åªèƒ½åœ¨ç¬¬ä¸€è¡Œè¿›å…¥è¿‡ç¨‹, è€Œä¸èƒ½åœ¨ä¸­é€”çš„ä»»æ„ä¸€è¡Œè¿›å…¥;
æŸäº›ç¼–ç¨‹è¯­è¨€(åŒ…æ‹¬ Rust)ä¸­, è¿‡ç¨‹ç”šè‡³äºå¯ä»¥åŒ…å«å…¶å®ƒè¿‡ç¨‹,
è¿™äº›è¿‡ç¨‹åªèƒ½åœ¨å¤–éƒ¨è¿‡ç¨‹ä¸­è°ƒç”¨;</p>
<p>ä½†æ˜¯,å½“ç„¶ç°ä»£ç¨‹åºé€šå¸¸æ¯”å°‘æ•°ç”¨é”¥ç¨‹åºæ›´å¤æ‚;
å› æ­¤,ç°ä»£ç¼–ç¨‹è¯­è¨€(å†æ¬¡å¼ºè°ƒ: <strong>&quot;ç°ä»£&quot;</strong> ä¸€è¯åœ¨è¿™é‡Œçš„ä½¿ç”¨éå¸¸å®½æ¾)å…·æœ‰å¦ä¸€å±‚å°è£…æŠ½è±¡:æ¨¡å—;</p>
<p>æ¨¡å—é€šå¸¸åŒ…å«ä¸€ç»„è¿‡ç¨‹,æœ‰äº›å¯ä»¥ä»å¤–éƒ¨è®¿é—®, æœ‰äº›åˆ™ä¸èƒ½;
åœ¨é duck ç±»å‹è¯­è¨€ä¸­, é€šå¸¸è¦å®šä¹‰å¾ˆå¤šèšåˆç±»å‹, åŒæ ·æ˜¯æœ‰äº›å¯ä»¥ä»å¤–éƒ¨è®¿é—®,æœ‰äº›ä¸è¡Œ;
é€šå¸¸ç”šè‡³äºå¯ä»¥æŠ½è±¡çš„å…¬å¼€è¿™äº›ç±»å‹,å› æ­¤,ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¯ä»¥è®¿é—®ç±»å‹çš„å®åœ¨,ä½†æ˜¯ä¸èƒ½è®¿é—®è®°å½•å­—æ®µ,
ç”šè‡³äºä¸èƒ½è®¿é—®æ˜¯è®°å½•ç±»å‹çš„äº‹å®;
ç”šè‡³äº C åœ¨å…¶æ¨¡å—ç³»ç»Ÿä¸­ä¹Ÿæœ‰è¿™ç§èƒ½åŠ› --- åè€Œæ˜¯ C++ æ²¡æœ‰å¼•å…¥è¿™ç‚¹, åªæ˜¯è¿½åŠ äº†ä¸€ä¸ªé¢å¤–çš„/æ­£äº¤çº§åˆ«çš„é€å­—æ®µè®¿é—®æ§åˆ¶;</p>
<p>ä»åŠ¡å®çš„è§’åº¦æ¥çœ‹,åŸºäºç±»çš„å°è£…å¹¶ä¸æ˜¯ OOP çš„æŸä¸ªç‰¹æ®Šè§è§£,
è€Œæ˜¯ä¸€ç§ä¸“é—¨çš„---æˆ–æ˜¯æ›´ç¡®åˆ‡çš„è¯´, ä¸¥æ ¼é™åˆ¶çš„---æ¨¡å—å½¢å¼;
åœ¨ OOP ç¼–ç¨‹è¯­è¨€ä¸­, æˆ‘ä»¬æœ‰ç±»çš„æ¦‚å¿µ, æ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„æ¨¡å—
(æœ‰æ—¶æ˜¯å”¯ä¸€å—æ”¯æŒçš„å½¢å¼, æœ‰æ—¶ç”šè‡³äºåœ¨å®Œå…¨ä¸åŒçš„/æ›´åŠ ä¼ ç»Ÿçš„æ¨¡å—æ¦‚å¿µä¸‹åˆ†å±‚,ä»¥ä¾¿å¢åŠ æ¦‚å¿µä¸Šçš„æ··æ·†);
åªæ˜¯,å¯¹äºä¸€ä¸ª&quot;ç±»&quot;,é€šå¸¸åªèƒ½å®šä¹‰ä¸€ä¸ªä¸»è¦ç±»å‹, å’Œæ¨¡å—æœ¬èº«å…±äº«ä¸€ä¸ªåç§°,
è€Œä¸”,è¯¥ç±»å‹çš„å­—æ®µè¢«ç»™äºˆç‰¹æ®Šä¿æŠ¤, ä»¥ä¾¿é˜²æ­¢ç±»å¤–ä»£ç çš„è®¿é—®;</p>
<p>å½“ç„¶, ç±»å’Œæ¨¡å—ä¹‹é—´è¿˜æœ‰å…¶å®ƒåŒºåˆ«,ä½†æ˜¯,è¿™äº›å’Œå…¶æ”¯æŸ±æœ‰å…³, æˆ‘ä»¬ç¨åå°†è®ºåŠ;
ç°åœ¨æˆ‘ä»¬åªè®¨è®ºå’Œå°è£…ç›¸å…³çš„ &quot;ç±»&quot; æ¦‚å¿µ --- å…¶ä¸­, ç±»åªæ˜¯å…·æœ‰ä¸€ç§ç‰¹æƒæŠ½è±¡ç±»å‹çš„ç‰¹æ®Šæ¨¡å—;</p>
<p>è¿™æ˜¯ä¸€ç§ç¼–å†™æ¨¡å—çš„åˆç†æ–¹å¼,ä½†æ˜¯, å¹¶ä¸åƒé¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³æ‰€è¡¨æ˜çš„é‚£æ ·ç‰¹åˆ«
(ç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬è®¨è®ºå…¶å®ƒæ”¯æŸ±çš„æ›¿ä»£æ–¹æ¡ˆæ—¶,ä½†æ˜¯,åŒæ ·ç¨åå†è®¨è®º);
åœ¨æŸäº›æƒ…å†µä¸­,æ¨¡å—æ²¡æœ‰å®šä¹‰ä»»ä½•è®°å½•ç±»å‹,è¿™åœ¨ Java ç­‰ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆå°´å°¬,
æ— è®ºå¦‚ä½•ä½ éƒ½å¿…é¡»å®šä¹‰ä¸€ä¸ªç©ºè®°å½•ç±»å‹, å¹¶ä»ç„¶åˆ›å»ºä¸€ä¸ª &quot;ç±»&quot;;
åœ¨æŸäº›æƒ…å†µä¸­, ä¸€ä¸ªæ¨¡å—å®šä¹‰äº†å¤šä¸ªå¯ä»¥å…¬å¼€è®¿é—®çš„ç±»å‹,
è¿™äº›ç±»å‹ç´§å¯†çš„çº ç¼ åœ¨ä¸€èµ· --- å¹¶ä¸” OOP é£æ ¼é¼“åŠ±ä½ åœ¨è¿™äº›ç±»å‹ä¹‹é—´è¿›è¡Œå°è£…, è¿™æ ·ä¸€æ¥æ›´å¤šçš„é˜»ç¢è€Œä¸æ˜¯å¸®åŠ©;</p>
<p>ä»æ ¹æœ¬ä¸Šè¯´, èƒ½å¤Ÿå¯¹å…¶å®ƒæ¨¡å—éšè—è®°å½•çš„å­—æ®µå¾ˆé‡è¦, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ C ä¹Ÿæ”¯æŒ;
ç”šè‡³å¯¹äºåœ¨ Rust ä¸­å®ç°å¯¹ä¸å®‰å…¨ç‰¹æ€§çš„å®‰å…¨æŠ½è±¡æ˜¯å¿…ä¸å¯å°‘çš„,
ä¾‹å¦‚é›†åˆ/collections, å…¶ä¸­åŸå§‹æŒ‡é’ˆå’Œä¸€åŒè®°å½•çš„å…¶å®ƒå­—æ®µç›¸ç»“åˆå…·æœ‰ä¸å˜é‡;
ä½†æ˜¯, è¿™å¯¹ OOP æ¥è¯´å¹¶ä¸é™Œç”Ÿ,è€Œä¸”, è¿™å¹¶ä¸æ˜¯æ¯ç§å¯èƒ½ç±»å‹çš„æœ€ä½³é€‰æ‹©;</p>
<p>ä½œä¸ºè¿™ç‚¹çš„è¯æ®,åœ¨ Java å’Œ Smalltalk ä¸­,
åœ¨è¾ƒå°ç¨‹åº¦ä¸Šç”šè‡³åœ¨ C++ æˆ–æ˜¯ Python ä¸­,
åšæŒæ¯ä¸€ç§ç±»å‹çš„å°è£…é£æ ¼æ„å‘³ç€ä½ å¯ä»¥è·å¾—è¿™äº›æ ·æ¿æ–¹æ³•,
æ¯”å¦‚è¯´ setFoo å’Œ getFoo;
è¿™äº›æ–¹æ³•ä»€ä¹ˆéƒ½ä¸ä½œ,åªæ˜¯å……å½“ä¸€äº›æœ¬è´¨ä¸Šæ˜¯å“‘è®°å½•ç±»å‹çš„å­—æ®µè®¿é—®å™¨;
ä»ç†è®ºä¸Šè¯´, å¦‚æœä½ æƒ³æ›´æ”¹è®¾ç½®æˆ–æ˜¯è¯»å–è¿™äº›å­—æ®µæ—¶å‘ç”Ÿçš„äº‹æƒ…,
è¿™ä¼šæœ‰æ‰€å¸®åŠ©,å¾—æ˜¯ä¸æ˜¯, å®é™…ä¸Š, è¿™åªæ˜¯åŸå§‹å­—æ®µè®¿é—®å™¨, æœ¬è´¨ä¸Šå°±æ˜¯ å¥‘çº¦/contract çš„ä¸€éƒ¨åˆ†;
ä¾‹å¦‚, å¦‚æœå¥¹ä»¬æ”¹ä¸ºè¿›è¡Œç½‘ç»œè°ƒç”¨è€Œä¸æ˜¯ä»…ä»…è¿”å›ä¸€ä¸ªå€¼,
é‚£ä¹ˆå¯¹äºè¿™ç§ç®€å•å‘½åçš„æ–¹æ³•, å°†å¼ºçƒˆè§¦å‘æƒŠå–œåŸåˆ™:</p>
<p>è¯´èµ·æ¥è¦ç®€å•çš„å¤š:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Point {
    pub x: f64,
    pub y: f64,
    pub z: f64,
}
<span class="boring">}</span></code></pre></pre>
<p>... ç›¸æ¯”ä¿ºè¿˜æ˜¯ Java ç¨‹åºå‘˜æ—¶æƒ¯ç”¨çš„ â€œJavaBeanâ€ ç­‰ä»·ç‰©
(Java ä»é‚£æ—¶èµ·æ˜¾ç„¶å‘ç”Ÿäº†å˜åŒ–,
ä½†æ˜¯, è¿™ä»£è¡¨äº†å¾ˆå¤š OOP ç¼–ç¨‹ç‚,åŒ…æ‹¬ Smalltalk å’Œè®¸å¤šå…³äºå¦‚ä½•ç¼–ç¨‹çš„ä¹¦ç±):</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>class Point {
    private double x;
    private double y;
    private double z;

    double getX() {
        return x;
    }

    double setX(double x) {
        this.x = x;
    }

    double getY() {
        return y;
    }

    double setY(double y) {
        this.y = y;
    }

    double getZ() {
        return z;
    }

    double setZ(double z) {
        this.z = z;
    }
}
<span class="boring">}</span></code></pre></pre>
<p>æ­¤ç±»æ•°æ®ç±»å‹é€šå¸¸ä¸ä½¿ç”¨ OOP ç±»è·å¾—çš„ä»»ä½•å…¶å®ƒåŠŸèƒ½,
ä¾‹å¦‚å¤šæ€æˆ–æ˜¯ç»§æ‰¿;
åœ¨æ­¤ç±» â€œJavaBeanâ€ ç±»ä¸­ä½¿ç”¨æ­¤ç±»åŠŸèƒ½ä¹Ÿå°†è¿åæœ€å°æ„å¤–åŸåˆ™;
&quot;ç±»&quot;æ¦‚å¿µå¯¹äºè¿™äº›è®°å½•ç±»å‹æ¥è¯´,æ ¹æœ¬å°±æ˜¯çŸ«æ‰è¿‡æ­£;</p>
<p>å½“ç„¶, Java å¼€å‘è€…(æˆ–æ˜¯ Smalltalk åˆæˆ– C#) ä¼šè¯´,
åº”è¯¥é€šè¿‡è¿™äº› getter å’Œ setter æ–¹æ³•é—´æ¥è®¿é—®å­—æ®µ, ä»–ä»¬æ˜¯é¢å‘æœªæ¥çš„ç±»,
ä»¥é˜²è®¾è®¡å‘ç”Ÿå˜åŒ–
(äº‹å®ä¸Šæˆ‘æ˜¯å½“ Reddit ä¸Šæœ‰äººæå‡ºè¿™ç‚¹æ—¶,æ‰è¢«æé†’åˆ°, è¿½åŠ äº†è¿™æ®µ);
ä½†æ˜¯,æˆ‘å‘ç°è¿™æ˜¯è™šä¼ªçš„,
æˆ–è€…è•›æ˜¯è¢«è¯¯å¯¼çš„ --- å®ƒé€šå¸¸ç”¨äºç¨‹åºå†…éƒ¨ç»“æ„çš„ä¸€éƒ¨åˆ†,
åœ¨è¿™ç§æƒ…å†µä¸­, æ›´åŠ åˆç†çš„ä½œæ³•æ˜¯å‘ç»“æ„æ‰€æœ‰ç”¨æˆ·å…¬å¼€æ›´æ”¹å­—æ®µ;
é™¤äº†å­—é¢æ„ä¹‰ä¸Šçš„è®¾ç½®æˆ–æ˜¯è·å–å­—æ®µä¹‹å¤–ï¼Œ
ä¹Ÿå¾ˆéš¾æƒ³åˆ°è¿™äº›æ–¹æ³•è¿˜å¯ä»¥ä½œä»€ä¹ˆä¸è¶³ä¸ºå¥‡çš„äº‹å„¿ï¼Œ
æ­£å¦‚æ–¹æ³•åç§°æ‰€æš—ç¤ºçš„é‚£æ · --- ä¾‹å¦‚,
è¿›è¡Œç½‘ç»œè°ƒç”¨å¯¹äºè·å–æˆ–æ˜¯è®¾ç½®æ–¹æ³•æ¥è¯´,
å°†æ˜¯ä¸€ä¸ªä»¤äººéœ‡æƒŠçš„æƒŠå–œ,
å¹¶ä¸”,å› æ­¤è‡³å°‘è¿åäº†éšå«çš„åçº¦;
åœ¨æˆ‘ç¼–å†™ OOP ä»£ç æ—¶,
æˆ‘ä»æ¥æ²¡è§è¿‡é€‚åˆ getter æˆ–æ˜¯ setter æ‰§è¡Œä»»ä½•æ“ä½œçš„æƒ…å†µ,
é™¤äº†å­—é¢ä¸Šçš„è·å–æˆ–æ˜¯è®¾ç½®å­—æ®µ;</p>
<p>å¦‚æœä»£ç ç¡®å®æ›´æ”¹ä¸ºè¦æ±‚ getter æˆ–æ˜¯ setter æ‰§è¡Œå…¶å®ƒæ“ä½œ,
æˆ‘å®æ„¿æ›´æ”¹æ–¹æ³•çš„åç§°ä»¥ä¾¿åæ˜ å…·ä½“è¿˜ä½œäº†ä»€ä¹ˆ,
è€Œä¸æ˜¯å‡è£…è¿™ä¸æ˜¯é‡å¤§å˜æ›´;
fetchZFromNetwork æˆ–æ˜¯ setAndValidateZ ä¼¼ä¹æ¯” getZ æˆ–æ˜¯ setZ æ›´åŠ åˆé€‚,
å®ƒä»¬æ‰€ä½œçš„äº‹å„¿, æ¯”æˆ‘ä»¬å‡è®¾ setter æˆ–æ˜¯ getter æ‰€ä½œçš„ç®€å•å­—æ®µè®¿é—®åˆ°çš„æ›´å¤š;
OOP åšæŒæ¯ä¸ªç±»å‹éƒ½åº”è¯¥æ˜¯å…¶è‡ªå·±çš„ä»£ç æŠ½è±¡è¾¹ç•Œ,
è¿™åœ¨åº”ç”¨è¿™äº›è½»é‡çº§èšåˆç±»å‹æ—¶, å¸¸å¸¸å°±å˜çš„è’è°¬äº†;
è¿™äº›ç±»å‹çš„ getter å’Œ setter ç”¨ä»¥ä¿æŠ¤ä¸åº”è¯¥å­˜åœ¨ä¸”å“ªå°å¾—å°å¦¨ç¢çš„æŠ½è±¡è¾¹ç•Œ,
å¹¶ä¸”,åœ¨æœªæ¥é˜²æ­¢åœ¨ä¸æ›´æ”¹æ¥å£çš„æƒ…å†µä¸­,
ä¸åº”è¯¥è¿›è¡Œçš„å®ç°å˜æ›´;</p>
<p>setter å’Œ setter ç®€è€Œè¨€ä¹‹,
æ˜¯ä¸€ç§åæ¨¡å¼;
å¦‚æœä½ æ‰“ç®—åˆ›å»ºé™¤ &quot;æ•°æ®ç»“æ„&quot; ä¹‹å¤–çš„æŠ½è±¡,
å…¶ä¸­éªŒè¯æˆ–æ˜¯ç½‘ç»œè°ƒç”¨åˆæˆ–åŸå§‹å­—æ®µè®¿é—®ä¹‹å¤–çš„ä»»ä½•å…¶å®ƒå†…å®¹åŠ ç­æ˜¯åˆé€‚çš„,
é‚£ä¹ˆè¿™äº› get å’Œ set åç§°å°±æ˜¯è¯¥æŠ½è±¡çš„é”™è¯¯åç§°;</p>
<p>2023-02-13 è¿½åŠ äº†æ­¤æ®µ:
æ˜ç¡®çš„è¯´, è¿™äº›å¼‚è®®ä¹Ÿé€‚ç”¨äºå±æ€§;
æˆ‘åå¯¹çš„ä¸æ˜¯è¯­æ³•ä¸Šçš„ä¸ä¾¿,
è€Œæ˜¯ä½¿ç”¨ä»£ç é€æ˜çš„æ›¿æ¢å­—æ®µè®¿é—®çš„æ•´ä¸ªæ¦‚å¿µæ˜¯ä¸€ä»¶å€¼å¾—åŠªåŠ›çš„å¥½äº‹,
æˆ–è€…æ˜¯ä¿æŒå¼€æ”¾çš„é‡è¦å¯èƒ½æ€§;
æœ‰å¸Œæœ› foo.bar = 3 æ°¸è¿œä¸ä¼šåœ¨ Rust ä¸­è§¦å‘è¿›è¡Œç½‘ç»œè°ƒç”¨!
å¦‚æœè¿™å¿…é¡»æ˜¯å¼‚æ­¥çš„å‘¢?
å¦‚æœæˆ‘åœ¨è°ƒç”¨å‡½æ•°,åº”è¯¥å¾ˆæ¸…æ¥š;
è€Œ Rust æ˜¯å…³äºæ˜ç¡®æ€§çš„æ€è€ƒæˆæœ;</p>
<p>å®é™…ä¸Š, get å’Œ set å‡½æ•°ä»…ç”¨ä½œåŒ…è£…å™¨ä»¥ä¾¿æ»¡è¶³ OOP æ€æƒ³çš„çº¦æŸ;
é¢†å¯¼ä½œç”¨ç§°æä¾›çš„é¢å‘æœªæ¥çš„è¯æ˜æ˜¯ä¸€ç§å¹»æƒ³;
å¦‚æœä½ åœ¨æŠ½è±¡è¾¹ç•Œä¸Šæä¾›â€œJavaBeanâ€æ ·å¼ç±»å‹æˆ–æ˜¯å…·æœ‰å±æ€§çš„ç±»å‹,
é‚£ä¹ˆä½ å®é™…ä¸Šå°±åƒæä¾›åŸå§‹å­—æ®µè®¿é—®ä¸€æ ·è¢«é”å®š --- ä½ æœ€æœ‰å¯èƒ½å¸Œæœ›å¯¹è¿™äº›ç»“æŸè¿›è¡Œçš„æ›´æ”¹ä¸å…è®¸ç§»åŠ¨ getter å’Œ setter ä»¥ä¿æŒå…¼å®¹æ€§;
å¯¹äºä½ æƒ³è¦è¿›è¡Œçš„æ›´æ”¹,
åˆ©ç”¨è¿™ç§é¢å‘æœªæ¥çš„æ–¹æ³•å¯èƒ½æ˜¯å®Œå…¨ä¸å¯èƒ½çš„,
å……å…¶é‡ä¼šæ¶‰åŠå¯æ€•çš„éª‡å®¢æ”»å‡»;</p>
<p>åœ¨æ‰€æœ‰è¿™äº›æ–¹é¢, Rust ä¼¼ä¹å’Œ OOP è¯­è¨€ç›¸åŒ;
ä»è¡¨é¢ä¸Šçœ‹, åˆå’Œç±»éå¸¸ç›¸ä¼¼;
ä½ å¯ä»¥å®šä¹‰å’Œç»™å®šç±»å‹å…³è”çš„å‡½æ•° --- å®ƒä»¬ç”šè‡³äºè¢«ç§°ä¸ºæ–¹æ³•!
å’Œ OOP æ–¹æ³•ä¸€æ ·,
åœ¨è¯­æ³•ä¸Šä¼˜å…ˆé‡‡ç”¨è¯¥ç±»å‹çš„å€¼
(æˆ–æ˜¯å¯¹è¿™äº›å€¼çš„å¼•ç”¨)ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°,
ç§°ä¸ºç‰¹æ®Šåç§° self;
ä½ ç”šè‡³äºå¯ä»¥å°†è®°å½•ç±»å‹(åœ¨ Rust ä¸­ç§°ä¸ºç»“æ„)çš„å­—æ®µæ ‡è®°ä¸ºå…¬å…±æˆ–
(é»˜è®¤æƒ…å†µä¸‹)ç§æœ‰,
å°±åƒåœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ä¸€æ ·é¼“åŠ±ç§æœ‰å­—æ®µ;</p>
<p>æ ¹æ®è¿™ä¸ªæ”¯æŸ±, Rust ä¼¼ä¹éå¸¸æ¥è¿‘ OOP;
å¯¹äºè¿™ä¸ªæ”¯æŸ±æ¥è¯´, è¿™æ˜¯ä¸ªå…¬å¹³çš„è¯„ä¼°,
ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ„çš„é€‰æ‹©,ç›®çš„æ˜¯è®©ä¹ æƒ¯äº† C++
(æˆ–æ˜¯ Java åˆæˆ– JavaScript) OOP ç¼–ç¨‹æ—¥å¸¸è¯­æ³•çš„äººä»¬æ›´å®¹æ˜“ä½¿ç”¨
Rust ç¼–ç¨‹;</p>
<p>ä½†æ˜¯, ç›¸ä¼¼ä¹‹å¤„åªæ˜¯è‚¤æµ…çš„;
å°è£…å…¶å®æ˜¯ OOP ä¸­æœ€ä¸æ˜æ˜¾çš„æ”¯æŸ±
(æ¯•ç«Ÿ, æ‰€æœ‰ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½æœ‰æŸç§å½¢å¼çš„å°è£…),
Rust ä¸­çš„å®ç°ä¸å—ç±»å‹çº¦æŸ;
å½“ä½ åœ¨ Rust ä¸­å£°æ˜ä¸€ä¸ªå­—æ®µç§æœ‰æ—¶(é€šè¿‡ä¸æŒ‡å®š pub),
è¿™å¹¶ä¸æ„å‘³ç€å¯¹å…¶æ–¹æ³•ç§æœ‰,
è¿™åªæ˜¯æ„å‘³ç€å¯¹æ¨¡å—ç§æœ‰;
ä¸€ä¸ªæ¨¡å—å¯ä»¥æä¾›å¤šç§ç±»å‹,
å¹¶ä¸”è¯¥æ¨¡å—ä¸­çš„ä»»ä½•å‡½æ•°, æ— è®ºæ˜¯å¦æ˜¯è¯¥ç±»å‹çš„&quot;æ–¹æ³•&quot;,
éƒ½å¯ä»¥è®¿é—®è¯¥ç±»å‹ä¸­å®šä¹‰çš„æ‰€æœ‰å­—æ®µ;
åœ¨é€‚å½“çš„æ—¶å€™é¼“åŠ±ä¼ é€’è®°å½•,
è€Œä¸æ˜¯é¼“åŠ±è®¿é—®è€…è¢«å¼ºåˆ¶è®¿é—®,
å³ä¾¿åœ¨ç´§å¯†ç»‘å®šçš„ç›¸å…³ä»£ç ä¸­ä¹Ÿæ˜¯å¦‚æ­¤;</p>
<p>è¿™æ˜¯æˆ‘ä»¬çœ‹åˆ° Rust çš„ç¬¬ä¸€ä¸ªè¿¹è±¡,
å°½ç®¡è¯­æ³•å¾ˆç®€æ´, ä½†æ˜¯, å¹¶ä¸æ˜¯ä¸€ç§ OOP ç¼–ç¨‹è¯­è¨€;</p>
<p>This is the first sign we see that Rust, in spite of its superficial syntax, is not an OOP programming language.</p>
<h3 id="æ¥ä¸‹æ¥"><a class="header" href="#æ¥ä¸‹æ¥">æ¥ä¸‹æ¥</a></h3>
<p>åœ¨è¿™ç‚¹ä¸Š, ä»Šå¤©ä¸å¾—ä¸æš‚åœä¸€ä¸‹;</p>
<p>å½“ç„¶, å°è£…å¹¶ä¸æ˜¯ OOP é£æ ¼ç±»æ‰€èƒ½ä½œçš„å”¯ä¸€å¥‡ç‰¹çš„äº‹å„¿;
å¦‚æœæ˜¯è¿™æ ·, é‚£ä¹ˆç±»å°±ä¸ä¼šè¿·æƒ‘è¿™ä¹ˆå¤šäººè¿™ä¹ˆå¤šå¹´äº†:
æ¯ä¸ªäººéƒ½ä¼šæ˜ç™½,ç±»ä¸è¿‡æ˜¯ç¾åŒ–çš„æ¨¡å—,
è€Œæ–¹æ³•ä¸è¿‡æ˜¯ç¾åŒ–çš„è¿‡ç¨‹;</p>
<p>åœ¨æœ¬ç³»åˆ—ä¸‹ç¯‡æ–‡ç« ä¸­,
æˆ‘ä»¬å°†è®¨è®ºå’Œ OOP ç›¸å…³çš„å…¶å®ƒç‰¹æ€§,
OOP å‰©ä¸‹çš„ä¸¤å¤§ä¼ ç»Ÿæ”¯æŒ,
å¤šæ€å’Œç»§æ‰¿,
ä»å®è·µçš„è§’åº¦åˆ†æ,
å¹¶äº†è§£ Rust å’Œ OOP åœ¨æ€§èƒ½æ–¹é¢çš„æ¯”è¾ƒ, é’ˆå¯¹é‚£äº›æ”¯æŸ±æ¦‚å¿µ;</p>
<p>æ¥ä¸‹æ¥å°†æ˜¯ å¤šæ€!</p>
<h2 id="logging-27"><a class="header" href="#logging-27">logging</a></h2>
<ul>
<li>230225 ZQ v1 done</li>
<li>230220 ZQ re-start</li>
<li>230215 ZQ init.</li>
</ul>
<pre><code>         _~^|^~_
     \/ /  â—µ â—·  \ ()
       '_   â–³   _'
       ( '--âˆ½--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-è¶…è¶Šé¢å‘å¯¹è±¡ç¬¬2éƒ¨åˆ†"><a class="header" href="#rust-è¶…è¶Šé¢å‘å¯¹è±¡ç¬¬2éƒ¨åˆ†">Rust è¶…è¶Šé¢å‘å¯¹è±¡,ç¬¬2éƒ¨åˆ†</a></h1>
<p>åŸæ–‡:<a href="https://www.thecodedmessage.com/posts/oop-2-polymorphism/">Rust Is Beyond Object-Oriented, Part 2: Polymorphism :: The Coded Message</a></p>
<h2 id="å¿«è¯‘-2"><a class="header" href="#å¿«è¯‘-2">å¿«è¯‘</a></h2>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­, é€šè¿‡è®¨è®º OOP ä¸‰å¤§ä¼ ç»Ÿæ”¯æŸ±ä¸­çš„ç¬¬äºŒä¸ª: å¤šæ€,
ç»§ç»­ç³»åˆ—æ–‡ç« :å…³äº Rust å’Œä¼ ç»Ÿ OOP èŒƒå¼çš„ä¸åŒ;</p>
<p>å¤šæ€æ€§æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªç‰¹åˆ«é‡è¦çš„è¯é¢˜ï¼Œ
ä¹Ÿè®¸æ˜¯å…¶ä¸‰å¤§æ”¯æŸ±ä¸­æœ€é‡è¦çš„ä¸€ä¸ª;
å…³äºå¤šæ€æ€§æ˜¯ä»€ä¹ˆ, å„ç§ç¼–ç¨‹è¯­è¨€å¦‚ä½•å®ç°(åœ¨ OOP ä¸–ç•Œå†…å¤–---æ˜¯çš„,å¤šæ€æ€§ä¹Ÿå­˜åœ¨äº OOP å®‡å®™ä¹‹å¤–),
å¦‚ä½•æœ‰æ•ˆçš„ä½¿ç”¨, ä»¥åŠæ›´åŠ å…³é”®çš„ä½•æ—¶å«‘ä½¿ç”¨;
å¯ä»¥å†™ä¸€äº›å…³äºå¦‚ä½•å•ç‹¬ä½¿ç”¨å¤šæ€çš„ Rust ç‰ˆæœ¬çš„ä¹¦äº†;</p>
<p>ä¸å¹¸çš„æ˜¯, è¿™åªæ˜¯ä¸€ç¯‡ blog,æ‰€ä»¥,
æˆ‘æ— æ³•åƒæˆ‘æƒ³çš„é‚£æ ·è¯¦ç»†æˆ–æ˜¯å¤šæ ·æ€§çš„ä»‹ç»å¤šæ€;
ç›¸å,æˆ‘å°†ç‰¹åˆ«å…³æ³¨ Rust å’Œ OOP æ¦‚å¿µçš„ä¸åŒä¹‹å¤„;
æˆ‘å°†ä»æè¿°å…¶åœ¨ OOP ä¸­çš„å·¥ä½œæ–¹å¼å¼€å§‹,
ç„¶å, è®¨è®ºå¦‚ä½•åœ¨ Rust ä¸­å®ç°ç›¸åŒçš„ç›®æ ‡;</p>
<p>åœ¨ OOP ä¸­,å¤šæ€æ€§å°±æ˜¯ä¸€åˆ‡;
è¯•å›¾é‡‡å–æ‰€æœ‰å†³ç­–(æˆ–æ˜¯å°½å¯èƒ½å¤šçš„å†³ç­–)å¹¶å°†å…¶ç»Ÿä¸€åœ¨ä¸€ä¸ªé€šç”¨çš„ç‹­ä¹‰æœºåˆ¶ä¸­:
è¿è¡Œæ—¶å¤šæ€;
ä½†æ˜¯, ä¸å¹¸çš„æ˜¯, å¹¶ä¸æ˜¯ä»»æ„è¿è¡Œæ—¶å¤šæ€, è€Œæ˜¯ä¸€ç§ç‰¹å®šçš„/ç‹­ä¹‰çš„è¿è¡Œæ—¶å¤šæ€å½¢å¼,
å—åˆ° OOP å“²å­¦å’Œå®ç°å¦‚ä½•å·¥ä½œç»†èŠ‚çš„é™åˆ¶:</p>
<ul>
<li>é—´æ¥éœ€æ±‚: æ¯ä¸ªå¯¹è±¡é€šå¸¸éƒ½å¿…é¡»å­˜å‚¨åœ¨å †ä¸Š,æ‰èƒ½ä½¿è¿è¡Œæ—¶å¤šæ€ç”Ÿæ•ˆ, å› ä¸º,ä¸åŒçš„&quot;è¿è¡Œæ—¶ç±»å‹&quot;å…·æœ‰ä¸åŒçš„å°ºå¯¸; è¿™é¼“åŠ±äº†å¯å˜å¯¹è±¡çš„åˆ«åä½¿ç”¨;ä¸ä»…å¦‚æ­¤,è¦çœŸæ­£è°ƒç”¨ä¸€ä¸ªæ–¹æ³•,å¿…é¡»ç©¿è¿‡ä¸‰å±‚é—´æ¥:
<ul>
<li>è§£å¼•ç”¨å¯¹è±¡å¼•ç”¨</li>
<li>è§£å¼•ç”¨ç±»æŒ‡é’ˆæˆ–æ˜¯ â€œvtableâ€ æŒ‡é’ˆ</li>
<li>æœ€åå®Œæˆé—´æ¥å‡½æ•°è°ƒç”¨</li>
</ul>
</li>
<li>æ’æ–¥ä¼˜åŒ–: é™¤äº†é—´æ¥å‡½æ•°è°ƒç”¨çš„å†…åœ¨æˆæœ¬ä¹‹å¤–, è°ƒç”¨æ˜¯é—´æ¥çš„è¿™ä¸€äº‹å®, æ„å‘³ç€å†…è”æ˜¯ä¸å¯èƒ½çš„ï¼›é€šå¸¸,å¤šæ€æ–¹æ³•å¾ˆå°,ç”šè‡³äºå¾®ä¸è¶³é“,ä¾‹å¦‚è¿”å›å¸¸é‡/è®¾ç½®å­—æ®µæˆ–æ˜¯é‡æ–°æ’åˆ—å‚æ•°å¹¶è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•, å› æ­¤, å†…è”ä¼šå¾ˆæœ‰ç”¨; å†…è”å¯¹äºå…è®¸ä¼˜åŒ–è·¨å†…è”è¾¹ç•Œä¹Ÿå¾ˆé‡è¦;</li>
<li>ä»…èƒ½åœ¨å•ä¸€å‚æ•°ä¸Šå¤šæ€: ç‰¹æ®Šçš„æ¥æ”¶è€…å‚æ•°,ç§°ä¸º self æˆ–æ˜¯ this, æ˜¯è¿è¡Œæ—¶å¤šæ€ä¹Ÿçš„å¹¶ä¸Šé€šå¸¸å¯èƒ½é€šè¿‡çš„å”¯ä¸€å‚æ•°; å…¶å®ƒå‚æ•°çš„å¤šæ€å¯ä»¥ç”¨é‚£äº›ç±»å‹ä¸­çš„è¾…åŠ©æ–¹å¼æ¥æ¨¡æ‹Ÿ, è¿™å°±å¾ˆå°´å°¬, è€Œä¸”, è¿”å›ç±»å‹çš„å¤šæ€ä¹Ÿæ˜¯ä¸å¯èƒ½çš„;</li>
<li>æ¯ä¸ªå€¼éƒ½æ˜¯ç‹¬ç«‹å¤šæ€çš„: åœ¨è¿è¡Œæ—¶å¤šæ€ä¸­, é€šå¸¸æ²¡æœ‰åŠæ³•è¯´é›†åˆçš„æ‰€æœ‰å…ƒç´ éƒ½å±äºå®ç°ç›¸åŒæ¥å£/interface çš„æŸç§ç±»å‹ T,ä½†æ˜¯, è¯¥ç±»å‹æ˜¯ä»€ä¹ˆåˆåº”è¯¥åœ¨è¿è¡Œæ—¶èƒ½ç¡®å®š;</li>
<li>å’Œå…¶å®ƒ OOP ç‰¹æ€§çº ç¼ åœ¨ä¸€èµ·: åœ¨ C++ ä¸­,è¿è¡Œæ—¶å¤šæ€å’Œç»§æ‰¿ç´§å¯†è€¦åˆï¼›ã€€åœ¨å¾ˆå¤š OOP è¯­è¨€ä¸­, å¤šæ€ä»…é€‚ç”¨äºç±»çš„ç±»å‹, æ­£å¦‚æˆ‘åœ¨ä¸Šç¯‡ blog ä¸­è®¨è®ºçš„é‚£æ ·, ç±»ç±»å‹æ˜¯ä¸€ç§å—çº¦æŸçš„æ¨¡å—å½¢å¼;</li>
</ul>
<p>å…¶å®æˆ‘å®Œå…¨å¯ä»¥é’ˆå¯¹ä»¥ä¸Šæ¯æ¡åç³Ÿå•ç‹¬å†™ä¸€å¤§ç¯‡æ–‡ç«  --- ä¹Ÿè®¸æœ‰ä¸€å¤©çœŸçš„ä¼š;</p>
<p>ä¸è¿‡,å°½ç®¡æœ‰è¿™ä¹ˆå¤šé™åˆ¶, å¤šæ€ä»ç„¶è¢«è§†ä¸ºä½¿ç”¨ OOP è¯­è¨€è¿›è¡Œå†³ç­–çš„é¦–é€‰æ–¹å¼,
å¹¶ä¸”, ç‰¹åˆ«ç›´è§‚ä¸”æ˜“äºè®¿é—®;
å—è¿‡è®­ç»ƒçš„ç¨‹åºå‘˜, å˜¦å¯èƒ½å°±ä¸€å®šä½¿ç”¨æ­¤å·¥å…·,
æ— è®ºæ˜¯å¦æ˜¯æ‰‹ä¸Šå†³ç­–æ˜¯æœ€ä½³å·¥å…·, å³ä¾¿å½“å‰ä¸éœ€è¦ç”¨å¤šæ€è¿›è¡Œè¿è¡Œæ—¶å†³ç­–;
æœ‰äº›ç¼–ç¨‹è¯­è¨€,ä¾‹å¦‚ Smalltalk ç”šè‡³æŠ˜å äº† &quot;if-then&quot; é€»è¾‘,
å¹¶å¾ªç¯åˆ° this è¿™ä¸ªå¥‡æ€ªçš„ç‰¹å®šå†³ç­–ç»“æ„ä¸­,
é€šè¿‡å¤šæ€æ–¹æ³•(å¦‚: ifTrue:idFalse)æœ€ç»ˆå®ç°,
è¿™äº›æ–¹æ³•å°†åœ¨ True å’Œ False ç±»ä¸­ä»¥ä¸åŒæ–¹å¼å†å®ç°
(å’Œ therefore åœ¨ true ä»¥åŠ false å¯¹è±¡ä¸Šé…å¥—);</p>
<p>éœ€è¦æ˜ç¡®çš„æ˜¯, æ‹¥æœ‰åŸºäº vtable çš„è¿è¡Œæ—¶å¤šæ€æ€§æœºåˆ¶æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä»¶åäº‹å„¿ --- Rust ç”šè‡³æœ‰ä¹Ÿä¸€ä¸ª
(å’Œä¸Šè¿° OOP ç‰ˆæœ¬ç›¸ä¼¼,ä½†æ˜¯,å¹¶ä¸å®Œå…¨å¯¹ç­‰);
ä½†æ˜¯, Rust ç‰ˆæœ¬åªç”¨ä»¥ç›¸å¯¹ç½•è§çš„æƒ…å†µ, åœ¨è¿™ç§æƒ…å†µä¸­,
è¯¥æœºåˆ¶æœ€é€‚åˆæ•´ä¸ªå„¿ palette æœºåˆ¶;
åœ¨ OOP ä¸­, å°†è¿™ç§ä¸¥æ ¼çº¦æŸä¸”å¿¾å’Œç”¨ä½ä¸‹çš„å†³ç­–åˆ¶å®šå½¢å¼æå‡åˆ°æ‰€æœ‰å…¶å®ƒå½¢å¼ä¹‹ä¸Š,
ä»¥åŠä½¿ç”¨å¤šæ€æ˜¯è¡¨è¾¾ç¨‹åºæ³¨é‡Šå’Œä¸šåŠ¡ç¼–è¾‘çš„æœ€ä½³æ–¹å¼ä»¥åŠæœ€ç›´è§‚æ–¹å¼çš„å“²å­¦æ–­è¨€,
æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜;</p>
<p>äº‹å®è¯æ˜,å½“ä½ é€‰æ‹©æœ€é€‚åˆæ‰‹å¤´æƒ…å†µçš„å·¥å…·æ—¶, ç¼–ç¨‹æ›´åŠ å»åˆäººä½“å·¥ç¨‹å­¦ --- è€Œ OOP è¿è¡Œæ—¶å¤šæ€æ€§,
åªæ˜¯å¶å°”æ‰æ˜¯æœ€åˆé€‚å®Œæˆå½“å‰å·¥ä½œçš„å®æ•ˆå·¥å…·;</p>
<p>å› æ­¤, è®©æˆ‘ä»¬çœ‹çœ‹åœ¨ OOP ä½¿ç”¨è¿è¡Œæ—¶å¤šæ€æ€§æ—¶, å¯ä»¥ä½¿ç”¨çš„ Rust ç‰ˆå››ç§æ›¿ä»£æ–¹æ¡ˆ;</p>
<h3 id="å¤‡é€‰æ–¹æ¡ˆ0æšä¸¾"><a class="header" href="#å¤‡é€‰æ–¹æ¡ˆ0æšä¸¾">å¤‡é€‰æ–¹æ¡ˆ#0ï¼šæšä¸¾</a></h3>
<p>ä¸ä»…æœ‰å…¶å®ƒå½¢å¼çš„å¤šæ€æ€§, è€Œä¸”å…·æœ‰æ›´å°‘çš„ä¸¥æ ¼çº¦æŸ
(ä¾‹å¦‚ Haskell çš„ç±»å‹ç±»)æˆ–ä¸€ç»„ä¸åŒçš„æƒè¡¡
(ä¾‹å¦‚ Rust çš„ trait,ä¸»è¦åŸºäº Haskell ç±»å‹ç±»),
Rust ä¸­è¿˜æœ‰å¦å¤–ä¸€ä¸ªå†³ç­–ç³»ç»Ÿ, å³:ä»£æ•°æ•°æ®ç±»å‹(ADTs, algebraic data types)
æˆ–æ›°æ±‚åˆ/sum ç±»å‹,
ä¹Ÿèƒ½æ¥ç®¡ OOP æ ·å¼å¤šæ€çš„å¾ˆå¤šåº”ç”¨ç¨‹åº;</p>
<p>åœ¨ Rust ä¸­, è¿™äº›è¢«ç§°ä¸º æšä¸¾/enums;
å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­çš„æšä¸¾æ˜¯å­˜å‚¨åœ¨æ•´æ•°å°ºå¯¸ç±»å‹ä¸­çš„å¸¸é‡åˆ—è¡¨,
æœ‰æ—¶ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼å®ç°(æ¯”å¦‚åœ¨ Java ä¸­),
æœ‰æ—¶ä¸æ˜¯(æ¯”å¦‚åœ¨ C ä¸­),
æœ‰æ—¶å¯ä»¥ä½¿ç”¨ä»»ä½•ä¸€ç§é€‰é¡¹(æ¯”å¦‚,åœ¨ C++ ä¸­æšä¸¾å’Œæšä¸¾ç±»ä¹‹é—´å°±æœ‰åŒºåˆ«);</p>
<p>Rust æšä¸¾æ”¯æŒè¿™ç§ç†Ÿæ‚‰çš„ç”¨ä¾‹, è€Œä¸”å…·æœ‰ç±»å‹å®‰å…¨:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub enum Visibility {
    Visible,
    Invisible,
}
<span class="boring">}</span></code></pre></pre>
<p>ä½†æ˜¯, è¿˜æ”¯æŒå’Œæ¯ä¸ªé€‰é¡¹å…³è”çš„é™„åŠ å­—æ®µ,
åˆ›å»ºç±»å‹ç†è®ºä¸­ç§°ä¸º&quot;æ€»å’Œç±»å‹&quot;(sum type)çš„ä¸œè¥¿,
ä½†åœ¨ C æˆ–æ˜¯ C++ ç¨‹åºå‘˜ä¸­æ›´åŠ å¹¿ä¸ºäººçŸ¥è¯†çš„å«&quot;è”åˆæ ‡è®°&quot;(tagged union)
--- ä¸åŒä¹‹å¤„åœ¨äº, Rust ä¸­, ç¼–è¯‘å™¨çŸ¥é“å¹¶èƒ½å¼ºåˆ¶æ‰§è¡Œæ ‡è®°;</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›æšä¸¾å£°æ˜çš„ç¤ºä¾‹:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub enum UserId {
    Username(String),
    Anonymous(IpAddress),
    // ^^ This isn't supposed to be a real network type,
    // just an example.
}

let user1 = User::Username(&quot;foo&quot;.to_string());
let user2 = User::Anonymous(parse_ip(&quot;127.0.0.1&quot;)?);

pub enum HostIdentifier {
    Dns(DomainName),
    Ipv4Addr(Ipv4Addr),
    Ipv6Addr(Ipv6Addr),
}

pub enum Location {
    Nowhere,
    Address(Address),
    Coordinates {
        lat: f64,
        long: f64,
    }
}

let loc1 = Location::Nowhere;
let loc2 = Location::Coordinates {
    lat: 80.0,
    long: 40.0,
};
<span class="boring">}</span></code></pre></pre>
<p>ä½ å¯èƒ½ä¼šé—®,è¿™äº›<code>è”åˆæ ‡è®°</code>å’Œå¤šæ€æœ‰ä»€ä¹ˆå…³ç³»?
å¥½å§, å¤§å¤šæ•° OOP è¯­è¨€å¯¹äºè¿™äº› æ±‚åˆç±»å‹/sum type æ²¡ä»€ä¹ˆå¥½åŠæ³•,
ä½†æ˜¯, å¥¹ä»¬ç¡®å®æœ‰å¼ºå¤§çš„è¿è¡Œæ—¶å¤šæ€æœºåˆ¶,
æ‰€ä»¥, ä½ ä¼šçœ‹åˆ°è¿è¡Œæ—¶å¤šæ€ç”¨ Rust æšä¸¾å®ç°ä¹Ÿæ˜¯ä¸€æ ·çš„é€‚åˆ
(æˆ‘å¯èƒ½è¿›ä¸€æ­¥äº‰è¾©: æ›´åŠ åˆé€‚):
æ¯å½“æœ‰ä¸€äº›å°å…³äºå¦‚ä½•åå•†ä¼šè®®å€¼çš„é€‰é¡¹, ä½†æ˜¯,è¿™äº›é€‰é¡¹åˆåŒ…å«ä¸åŒç»†èŠ‚æ—¶;</p>
<p>æ¯”å¦‚, è¿™æ˜¯ä¸€ç§ä½¿ç”¨ç»§æ‰¿å’Œè¿è¡Œæ—¶å¤šæ€åœ¨ Java ä¸­è¡¨ç¤º UserId ç±»å‹çš„æ–¹æ³• --- å½“æˆ‘è¿˜æ˜¯å­¦ç”Ÿæ—¶, 
è‚¯å®šä¼šè¿™ä¹ˆæ¥(å°†æ¯ä¸ªç±»æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­):</p>
<pre><code class="language-java">class UserId {
}

class Username extends UserId {
    private String username;
    public Username(String username) {
        this.username = username;
    }

    // ... getters, setters, etc.
}

class AnonymousUser extends UserId {
    private Ipv4Address ipAddress;
    
    // ... constructor, getters, setters, etc.
}

UserId user1 = new Username(&quot;foo&quot;);
UserId user2 = new AnonymousUser(new Ipv4Address(&quot;127.0.0.1&quot;));
</code></pre>
<p>é‡è¦çš„æ˜¯, å°±åƒåœ¨æšä¸¾ç¤ºä¾‹ä¸­ä¸€æ ·,
æˆ‘ä»¬å¯ä»¥å°† user1 å’Œ user2 ç»™å®šç›¸åŒç±»å‹çš„å˜é‡,
å¹¶å°†å¥¹ä»¬å¾—ç‹®ç»™ç›¸åŒç±»å‹çš„å‡½æ•°, å¹¶é€šå¸¸å¯¹å¥¹ä»¬æ‰§è¡Œç›¸åŒçš„æ“ä½œ;</p>
<p>ç°åœ¨è¿™äº› OOP é£æ ¼çš„ç±»çœ‹èµ·æ¥è½»é£˜åˆ°é£æº…çš„ç¨‹åº¦,
ä½†æ˜¯, è¿™ä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸ºè¿™ç§æƒ…å†µæ·»åŠ ä»»ä½•çœŸæ­£çš„æ“ä½œä»£ç  --- åªæœ‰æ•°æ®å’Œç»“æ„, 
ä»¥åŠä¸€äº›å˜é‡å®šä¹‰å’Œæ¨¡æ¿;
è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹, å¦‚æœæˆ‘ä»¬çœŸçš„å¯¹ç”¨æˆ· ID å°è¯•è¿›è¡Œä»»ä½•æ“ä½œæ—¶ä¼šæ€ä¹ˆæ ·?</p>
<p>ä¾‹å¦‚,æˆ‘ä»¬å¯èƒ½æƒ³ç¡®è®¤å¥¹ä»¬æ˜¯å¦ä¸ºç®¡ç†å‘˜;
åœ¨æˆ‘ä»¬çš„å‡è®¾ä¸­, å‡è®¾åŒ¿åç”¨æˆ·æ°¸è¿œä¸æ˜¯ç®¡ç†å‘˜,
è€Œæ‹¥æœ‰ç”¨æˆ·åçš„ç”¨æˆ·åªæœ‰åœ¨ç”¨æˆ·åä»¥å­—ç¬¦ä¸² admin_ å¼€å¤´æ—¶,æ‰æ˜¯ä½ç®¡ç†å‘˜;</p>
<p>ç†è®ºä¸Šè®¤å¯çš„ OOP æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ªæ–¹æ³•,
æ¯”å¦‚: administrator;
ä¸ºäº†è®©è¿™ä¸ªæ–¹æ³•èµ·ä½œç”¨, æˆ‘ä»¬å¿…é¡»å°†å…¶è¿½åŠ åˆ°æ‰€æœ‰ä¸‰ä¸ªç±»: åŸºæ•°ä»¥åŠä¸¤ä¸ªå­ç±»:</p>
<pre><code class="language-java">class UserId {
    // ...
    public abstract bool isAdministrator();
}

class Username extends UserId {
    // ...
    public bool isAdministrator() {
        return username.startsWith(&quot;admin_&quot;);
    }
}

class AnonymousUser extends UserId {
    // ...
    public bool isAdminstrator() {
        return false;
    }
}
</code></pre>
<p>å› æ­¤, ä¸ºäº†åœ¨ Java ä¸­ä¸ºè¿™ç§ç±»å‹æ·»åŠ è¿™ç§ç®€å•çš„æ“ä½œ,å¦‚æ­¤ç®€å•çš„èƒ½åŠ›,
æˆ‘ä»¬å´å¿…é¡»ä½¿ç”¨ä¸‰ä¸ªç±»,
è€Œä¸”å¿…é¡»å­˜å‚¨åœ¨ä¸‰ä¸ªæ–‡ä»¶ä¸­;
ä¸«ä»¬æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæ–¹æ³•æ¥ä½œä¸€äº›ç®€å•çš„äº‹å„¿,
ä½†æ˜¯, åœ¨ä»»ä½•ç¾Œæ—éƒ½çœ‹ä¸åˆ°è°æ˜¯ç®¡ç†å‘˜, åˆæˆ–è€…ä¸æ˜¯ç®¡ç†å‘˜çš„å®Œæ•´é€»è¾‘ --- æœ‰äººå¯èƒ½ä¼šå¾ˆä¸åˆæ—¶å®œçš„é—®å‡ºè¿™ä¸ªé—®é¢˜;</p>
<p>Rust åˆ™ä¸ºè¿™ç§æ“ä½œä½¿ç”¨ match,
å°†æœ‰å…³æ‰€æœ‰ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹å®Œæˆåˆ¤å®š:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn is_administrator(user: &amp;UserId) -&gt; bool {
    match user {
        UserId::Username(name) =&gt; name.starts_with(&quot;admin_&quot;),
        UserId::AnonymousUser(_) =&gt; false,
    }
}
<span class="boring">}</span></code></pre></pre>
<p>è¯šç„¶, è¿™å°†äº§ç”Ÿæ›´åŠ å¤æ‚çš„å•ä¸ªå‡½æ•°,
ä½†æ˜¯,å…·æœ‰æ˜ç¡®çš„æ‰€æœ‰é€»è¾‘;
è®©ç¼–è¾‘æ˜æ˜¾è€Œä¸æ˜¯éšå«åœ¨ç»§æ‰¿å±¡æ¬¡ç»“æ„ä¸­, 
è¿™å°±è¿åäº† OOP åŸåˆ™, 
åœ¨ OOP å®‡å®™ä¸­, æ–¹æ³•åº”è¯¥ç®€å•, å¤šæ€æ€§ç”¨äºéšå«çš„è¡¨è¾¾é€»è¾‘;
ä½†æ˜¯,è¿™å¹¶ä¸èƒ½ä¿è¯ä»»ä½•äº‹å„¿, åªæ˜¯å°†å…¶æ‰«åˆ°åœ°æ¯¯ä¸‹è€Œå·²:
äº‹å®è¯æ˜, éšè—å¤æ‚æ€§ä¼šä»¤å…¶æ›´éš¾åº”å¯¹, è€Œä¸æ˜¯ç›¸å;</p>
<p>è®©çš„æˆ‘ä»¬æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­;
æˆ‘ä»¬å·²ç»ç”¨äº†ä¸€æ®µæ—¶é—´çš„ UserId ä»£ç ,
ä½ çš„ä»»åŠ¡æ˜¯ä¸ºè¿™ä¸ªç³»ç»Ÿç¼–å†™ä¸€ä¸ªæ–°çš„ Web å‰ç«¯;
ä½ éœ€è¦æŸç§æ–¹å¼, ä»¥ HTML æ ¼å¼æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯,
è¦ä¹ˆæ˜¯æŒ‡å‘ç”¨æˆ·é…ç½®æ–‡ä»¶çš„é“¾æ¥(å¯¹äºæŒ‡å®šç”¨æˆ·),
è¦ä¹ˆæ˜¯å°† IP åœ°å€å­—ç¬¦ä¸²åŒ–ä¸ºçº¢è‰²(å¯¹äºåŒ¿åç”¨æˆ·);
å› æ­¤, ä½ å†³å®šä¸ºè¿™ä¸ªå°å‹ç±»å‹è¿½åŠ ä¸€ä¸ªæ–°æ“ä½œ toHTML,
å°†è¾“å‡ºæ–°å‰ç«¯çš„ä¸“ç”¨ DOM ç±»å‹;
(ä¹Ÿè®¸ Java è¢«ç¼–è¯‘ä¸º WebAssembly å‘¢? æˆ‘ä¹Ÿä¸ç¡®å®š,ä¸è¿‡ç»†èŠ‚ä¸é‡è¦;-)</p>
<p>ä½ é€ˆåç«¯æ ¸å¿ƒåº“æ·±å…¥çš„ UserId ç±»å±¡æ¬¡ç»“æ„çš„ç»´æŠ¤è€…æäº¤äº† pull request;
ç„¶å, ä»–ä»¬æ‹’ç»äº†;</p>
<p>äº‹å®ä¸Š, ä»–ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±, ä½ å¿…é¡»å‹‰å¼ºæ‰¿è®¤;
ä»–ä»¬è¯´:&quot;è¿™æ˜¯ä¸€ç§è’è°¬çš„å…³æ³¨ç‚¹åˆ†ç¦»&quot;;
æ­¤å¤–, å…¬å¸ä¹Ÿæ— æ³•ä»ä½ çš„å‰ç«¯è·å¾—æ­¤æ ¸å¿ƒåº“å¤„ç†ç±»å‹;</p>
<p>æ‰€ä»¥, ä½ å¹äº†å£æ°”, å†™äº†ä¸ª Rust åŒ¹é…è¡¨è¾¾å¼çš„ç­‰ä»·ç‰©, ä½†æ˜¯ç”¨çš„æ˜¯ Java
(è¯·åŸè°…æˆ‘è’è°¬çš„å‡è®¾æœ‰ä¸ª HTML åº“):</p>
<pre><code class="language-java">Html userIdToHtml(UserId userId) {
    if (userId instanceof Username) {
        Username username = (Username)userId;
        String usernameString = username.getUsername();
        Url url = ProfileHandler.getProfileForUsername(usernameString);
        return Link.createTextLink(url, username.getUsername());
    } else if (userId instanceof AnonymousUser) {
        AnonymousUser anonymousUser = (AnonymousUser)userId;
        return Span.createColoredText(anonymousUser.getIp().formatString(), &quot;red&quot;);
    } else {
        throw new RuntimeException(&quot;IDK, man&quot;);
    }
}
</code></pre>
<p>ä½ çš„è€æ¿ä»¬åœ¨ä»£ç å®¡æŸ¥æ—¶æ‹’ç»äº†è¿™æ®µä»£ç ,
ä½ ä½ ä½¿ç”¨äº† instanceof åæ¨¡å¼,
ä½†æ˜¯, åæ¥åœ¨ä½ è®©ä»–ä»¬å’Œä¸æ¥å—ä½ çš„å…¶å®ƒè¡¥ä¸çš„æ ¸å¿ƒåº“ç»´æŠ¤è€…äº‰è®ºä¹‹å,
ä¸«ä»¬å‹‰å¼ºæ¥å—äº†è¿™æ®µä»£ç ;</p>
<p>ä½†æ˜¯, çœ‹çœ‹é‚£å¨ instanceof ä»£ç æœ‰å¤šéš¾çœ‹!
éš¾æ€ª Java ç¨‹åºå‘˜è®¤ä¸ºè¿™æ˜¯ä¸€ç§åæ¨¡å¼!
ä½†æ˜¯, åœ¨è¿™ç§æƒ…å†µä¸­, å·²ç»æ˜¯æœ€åˆç†çš„äº‹å„¿äº†,
å®é™…ä¸Š, æ˜¯é™¤äº†å®æ–½è§‚å¯Ÿè€…ä¸œè¥¿æ–¹æˆ–æ˜¯è®¿é—®è€…æ¨¡å¼åˆæˆ–æ˜¯å…¶å®ƒç›¸å½“äºåŸºç¡€è®¾æ–½çš„ä¸œè¥¿ä¹‹å¤–,
å”¯ä¸€å¯èƒ½çš„å®ç°, åªæ˜¯ç”¨æ¥åˆ›é€ å…·æœ‰æ§åˆ¶åè½¬çš„å®ä¾‹è€Œå·²;</p>
<p>å½“æ“ä½œé›†æœ‰ç•Œ(æˆ–æ˜¯æ¥è¿‘æœ‰é™)å¹¶ä¸”è¯¥ç±»çš„å­ç±»æ•°é‡å¯èƒ½ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼å¢é•¿æ—¶,
é€šè¿‡å‘æ¯ä¸ªå­ç±»è¿½åŠ ä¸€ä¸ªæ–¹æ³•æ¥å®ç°æ“ä½œæ˜¯æœ‰æ„ä¹‰çš„;
å¯æ˜¯,é€šå¸¸æƒ…å†µä¸­, æ“ä½œçš„æ•°é‡åˆä¼šä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼å¢é•¿,
è€Œå­ç±»çš„æ•°é‡æ€»æ˜¯æœ‰é™çš„(åˆæˆ–æ˜¯æ¥è¿‘æœ‰é™);</p>
<p>å¯¹äºåä¸€ç§æƒ…å†µ, è¿™ç§æƒ…å†µæ¯” OOP æ‹¥æŠ¤è€…æƒ³è±¡çš„æ›´åŠ å¸¸è§,
Rust æšä¸¾ --- ä»¥åŠä¸€èˆ¬çš„ æ±‚å’Œç±»å‹ --- æ˜¯å®Œç¾çš„;
ä¸€ä½†ä½ ä¹ æƒ¯äº†å¥¹ä»¬, ä½ å°±ä¼šå‘ç°è‡ªå·±ä¸€ç›´åœ¨ä½¿ç”¨;</p>
<p>æˆ‘è¦éƒ‘é‡å£°æ˜,
åœ¨æ‰€æœ‰é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­,éƒ½æ²¡æœ‰è¿™ä¹ˆç³Ÿç³•;
åœ¨æŸäº›æƒ…å†µä¸­, ä½ å¯ä»¥æŒ‰ä»»ä½•é¡ºåºç¼–å†™ä»»æ„ç±»æ–¹æ³•ç»„åˆ,
å› æ­¤,å¦‚æœä½ æ„¿æ„, å¯ä»¥å°†æ‰€æœ‰ä¸‰ä¸ªå®ç°å†™åœ¨ä¸€ä¸ªåœ°æ–¹;
Smalltalk ä¼ ç»Ÿä¸Šå…è®¸ä½ åœ¨ä¸€ä¸ªç‰¹æ®Šçš„æµè§ˆå™¨ä¸­æ¸¸è§ˆä»£ç åº“,
ä½ å¯ä»¥åœ¨å…¶ä¸­çœ‹åˆ°ä¸€ä¸ªç±»å®ç°çš„æ–¹æ³•åˆ—è¡¨,
æˆ–è€…ä¸€ä¸ªæ¥å—ç»™å®š&quot;æ¶ˆæ¯&quot;çš„ç±»åˆ—è¡¨,
æ­£å¦‚ Smalltalk æ‰€è¯´çš„é‚£æ ·,
è¿™æ ·ä½ å°±å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æ“å¼„å¯¹è±¡äº†;</p>
<p>(è¯‘æŒ‰: å½“ç„¶, ä½ å¿…é¡»åœ¨ Salltalk å¯¹åº”è§£é‡Šå™¨çš„ IDE ç¯å¢ƒä¸­, ä¸€ä½†å‡ºäº†è¿™ä¸ªå¯¹è±¡é•œåƒ, å°†å¤±å»ä¸€åˆ‡è§‚å¯Ÿèƒ½åŠ›, è¿™å¯¼è‡´ Smalltalk æ²¡åŠæ³•ä½¿ç”¨å…¶å®ƒä¼ ç»Ÿ IDE)</p>
<h3 id="å¤‡é€‰æ–¹æ¡ˆ-1-é—­åŒ…"><a class="header" href="#å¤‡é€‰æ–¹æ¡ˆ-1-é—­åŒ…">å¤‡é€‰æ–¹æ¡ˆ #1: é—­åŒ…</a></h3>
<blockquote>
<p>Alternative #1: Closures</p>
</blockquote>
<p>æœ‰æ—¶, ä¸€ä¸ª OOP æ¥å£æˆ–æ˜¯å¤šæ€å†³ç­–åªæ¶‰åŠä¸€ä¸ªå®é™…æ“ä½œ;
åœ¨è¿™ç§æƒ…å†µä¸­,åªèƒ½ä½¿ç”¨é—­åŒ…;</p>
<p>æˆ‘ä¸æƒ³åœ¨è¿™æ–¹é¢èŠ±å¤ªå¤šæ—¶é—´,
å› ä¸º, å¤§å¤šæ•° OOP ç¨‹åºå‘˜å·²ç»æ„è¯†åˆ°è¿™ç‚¹,
å¹¶ä¸”, è‡ªä»ä»–ä»¬çš„ OOP è¯­è¨€å·²ç»èµ¶ä¸Šäº†å‡½æ•°å¼è¯­è¨€,
å¹¶è·å¾—äº† lambda è¯­æ³• --- Java ä¸­çš„ Java 8 ,
C++ ä¸­çš„, C++11;
å› æ­¤, åƒ Java çš„ Comparator è¿™ç§æ„šè ¢çš„å•ä¸€æ–¹æ³•æ¥å£ ---
å¹¸è¿çš„æ˜¯ --- åŸºæœ¬ä¸Šå·²ç»éƒ½æ„ŸæŸ“è¿‡å»å¼äº†;</p>
<p>æ­¤å¤–, Rust ä¸­çš„é—­åŒ…åœ¨æŠ€æœ¯ä¸Šæ¶‰åŠ traits,
å› æ­¤,ä½¿ç”¨å’Œæ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ›¿ä»£æ–¹æ¡ˆç›¸åŒçš„æœºåˆ¶æ¥ç«€,
æ‰€ä»¥,ä¹Ÿæœ‰äººå¯èƒ½ä¼šäº‰è¾©è¯´è¿™åœ¨ Rust ä¸­å¹¶ä¸æ˜¯çœŸæ­£çš„ç‹¬ç«‹é€‰é¡¹;
ç„¶è€Œ,åœ¨æˆ‘çœ‹æ¥ lambda/é—­åŒ…å’Œ
FnMut/FnOnce/Fn ç­‰ trait ä»¬åœ¨ç¾å­¦ä¸Šå’Œæƒ…å¢ƒä¸Šéƒ½éå¸¸ç‰¹åˆ«,
å€¼å¾—èŠ±ç‚¹æ—¶é—´æŒæ¡;</p>
<p>å› æ­¤, æˆ‘å°†èŠ±äº›æ—¶æ—¶é—´æ¥è¯´æ˜è¿™ç‚¹:
å¦‚æœä½ å‘ç°è‡ªå·±åªä½¿ç”¨ä¸€ç§æ–¹æ³•ç¼–å†™ trait 
(Java æ¥å£æˆ–æ˜¯ C++ ç±»),
è¯·è€ƒè™‘ä½ æ˜¯å¦åº”è¯¥æ”¹ç”¨æŸç§é—­åŒ…æˆ–æ˜¯ lambda ç±»å‹;
æ¯•ç«Ÿåªæœ‰ä½ è‡ªå·±æ‰èƒ½é˜²æ­¢è¿‡åº¦è®¾è®¡;</p>
<h3 id="å¤‡é€‰æ–¹æ¡ˆ2-å…·æœ‰traitsçš„å¤šæ€"><a class="header" href="#å¤‡é€‰æ–¹æ¡ˆ2-å…·æœ‰traitsçš„å¤šæ€">å¤‡é€‰æ–¹æ¡ˆ#2: å…·æœ‰Traitsçš„å¤šæ€</a></h3>
<p>å°±åƒ Rust æœ‰ä¸ªæ¯” OOP ç±»æ¦‚å¿µæ›´åŠ çµæ´»/å¼ºå¤§çš„å°è£…ç‰ˆæœ¬,
æ­£å¦‚åœ¨ä¸Šç¯‡æ–‡ç« ä¸­è®¨è®ºçš„é‚£æ ·,
Rust æœ‰ä¸€ä¸ªæ¯” OOP å‡è®¾æ›´åŠ å¼ºå¤§çš„å¤šæ€ç‰ˆæœ¬: trait;</p>
<p>trait å°±åƒæ¥è‡ª Java çš„æ¥å£
(åˆæˆ–æ˜¯ C++ ä¸­çš„å…¨æŠ½è±¡è¶…ç±»),
ä½†æ˜¯,å¹¶æ²¡æœ‰æˆ‘åœ¨æ–‡ç« å¼€å¤´æŒ‡å‡ºçš„å¤§éƒ¨åˆ†é™åˆ¶;
trait å³æ²¡æœ‰è¯­ä¹‰çº¦æŸ, ä¹Ÿæ²¡æœ‰æ€§èƒ½çº¦æŸ;
trait åœ¨è¯­ä¹‰å’ŒåŸç†æ–¹é¢æ·±å— C++ æ¨¡æ¿çš„å¯å‘;
C++ ç¨‹åºå‘˜å¯ä»¥å°†å…¶è§†ä¸ºå¸¦æœ‰concepts/æ¦‚å¿µçš„æ¨¡æ¿
(é™¤éè®¾è®¡çš„,ä»ä¸€å¼€å§‹å°±èå…¥ç¼–ç¨‹è¯­è¨€,
è€Œä¸”ä¸å¿…è¦å¤„ç†æ‰€æœ‰ä¸ä½¿ç”¨å®ƒçš„ä»£ç ;)</p>
<p>è®©æˆ‘ä»¬ä»è¯­ä¹‰å¼€å§‹:
ä½ å¯ä»¥ä½¿ç”¨ trait å®Œæˆé‚£äº›æ— æ³•ä½¿ç”¨çº¯ OOP å®Œæˆçš„,
å³ä¾¿ä½ å°†ä¸–ç•Œä¸Šæ‰€æœ‰çš„é—´æ¥è°ƒç”¨éƒ½ä¸¢ç»™å¥¹?
å¥½å§, åœ¨çº¯ç²¹çš„ OOP æœ¯è¯­ä¸­,
æ˜¯æ— æ³•ç¼–å†™åƒ Rust Eq å’Œ Ord è¿™æ ·çš„æ¥å£,
è¿™é‡Œç»™å‡ºäº†éå¸¸ç®€å•çš„å®šä¹‰
(Eq å’Œ Ord çš„çœŸæ­£å®šä¹‰åœ¨äºæ‹“å±•äº†å…¶å®ƒå…è®¸ä¸åŒç±»å‹ä¹‹é—´çš„éƒ¨åˆ†ç­‰ä»·å’Œæ’åºçš„ç±»,
ä½†æ˜¯, åƒè¿™ç§ç®€åŒ–å®šä¹‰,
ééƒ¨åˆ† Eq å’Œ Ord çš„ Rust æ ‡å‡†åº“ç‰ˆæœ¬ç¡®å®šæ¶µç›–äº†ç›¸åŒç±»å‹å€¼ä¹‹é—´çš„ç­‰ä»·å’Œæ’åº):</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Eq {
    fn eq(self, other: &amp;Self) -&gt; bool;
}

pub enum Ordering {
    Less,
    Equal,
    Greater,
}

trait Ord: Eq {
    fn cmp(&amp;self, other: &amp;Self) -&gt; Ordering;
}
<span class="boring">}</span></code></pre></pre>
<p>çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆ?
å°±åƒåœ¨ OOP é£æ ¼çš„æ¥å£ä¸­ä¸€æ ·,
è¿™äº›æ— æ³•é‡‡ç”¨ Self ç±»å‹çš„â€œæ¥å—è€…â€ç±»å‹,
ä¸€ä¸ª self ç§‹ç²® -- ä¹Ÿå°±æ˜¯è¯´,ä»»ä½•å®ç° trait çš„å…·ä½“ç±»å‹
(æŠ€æœ¯ä¸Šè¿™é‡Œæ˜¯å¯¹ Self æˆ– &amp;Self çš„å¼•ç”¨);
ä½†æ˜¯, å’Œ OOP é£æ ¼çš„æ¥å£ä¸åŒ,
è¿™é‡Œè¿˜èƒ½é‡‡ç”¨å¦å¤–ä¸€ä¸ª &amp;Self ç±»å‹çš„å‚æ•°;
ä¸ºäº†å®ç° Eq å’Œ Ord,
ç±»å‹ T æä¾›äº†ä¸€ä¸ªå‡½æ•°,
è¯¥å‡½æ•°æ¥å—å¯¹ T çš„ä¸¤ä¸ªå¼•ç”¨;
å­—é¢ä¸Šçš„æ„æ€æ˜¯: å¯¹ T çš„ä¸¤ä¸ªå¼•ç”¨, è€Œä¸æ˜¯å¯¹ T çš„ä¸€ä¸ªå¼•ç”¨å’Œå¯¹ T æˆ–æ˜¯ä»»ä½•å­ç±»çš„ä¸€ä¸ªå¼•ç”¨
(è¿™æ ·çš„äº‹æƒ…åœ¨ Rust ä¸­å¹¶ä¸å­˜åœ¨),
ä¸æ˜¯å¯¹ T çš„ä¸€ä¸ªå¼•ç”¨å’Œå¯¹å®ç° Eq çš„ä»»ä½•å…¶å®ƒå€¼çš„ä¸€ä¸ªå¼•ç”¨,
è€Œæ˜¯å¯¹åŒä¸€å…·ä½“ç±»å‹çš„ä¸¤ä¸ªçœŸæ­£çš„éå¼‚æ„å¼•ç”¨,
ç„¶åï¼Œå‡½æ•°å°±å¯ä»¥æ¯”è¾ƒå¥¹ä»¬æ˜¯å¦ç›¸ç­‰(æˆ–æ˜¯è¿›è¡Œæ’åº);</p>
<p>è¿™ç‚¹å¾ˆå°±å°†è¦,å› ä¸º,
æˆ‘ä»¬æƒ³ç”¨è¿™ç§èƒ½åŠ›æ¥å®ç°åƒæ’åºè¿™ç±»æ–¹æ³•:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Vec&lt;T&gt; {
    pub fn sort(&amp;mut self) where T: Ord {
        // ...
    }
}
<span class="boring">}</span></code></pre></pre>
<p>OOP-style polymorphism is ideal for heterogeneous containers, where each element has its own runtime type and its own implementation of the interfaces. But sort doesnâ€™t work like that. You canâ€™t sort a collection like [3, &quot;Hello&quot;, true]; thereâ€™s no reasonable ordering across all types.</p>
<p>Instead, sort operates on homogeneous containers. All the elements have to match in type, so that they can be mutually compared. They donâ€™t each need to have different implementations of the operations.</p>
<p>Nevertheless, sort is still polymorphic. A sorting algorithm is the same for integers or strings, but comparing integers is a completely different operation than comparing strings. The sorting algorithm needs a way of invoking an operation on its items â€“ the comparison operation â€“ differently for different types, while still having the same overall structure of code.</p>
<p>This can be done by injecting a comparison function, but many types have an intrinsic, default ordering, and sort should default to it. Thus, polymorphism â€“ but not an OOP-friendly variety.</p>
<p>See the contrivance Java goes through to define sort:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>static &lt;T extends Comparable&lt;? super T&gt;&gt; 
void sort(List&lt;T&gt; list)
<span class="boring">}</span></code></pre></pre>
<p>There is no simple trait that can require T to be comparable to other Ts, for T to be ordered. Instead, as far as the programming language is concerned, the idea that T is comparable to itself, rather than to any other random type, is only articulated as an accident to this method. Nothing is stopping someone from implementing the Comparable interface in an inconsistent way, like having Integer implement Comparable<String>.</p>
<p>Additionally, when it actually looks up the implementation of Comparable, it decides what implementation to use based on the first argument of any comparison, not based on the type. Normally, they will all be the same type, but theoretically, this list could be heterogeneous, as long as all the objects â€œextendâ€ T, and they could implement Comparable differently. The computer has to do extra work to indulge this possibility, even though it would certainly be a mistake.</p>
<p>As weâ€™re now drifting outside of the realm of semantics, and into the realm of performance, letâ€™s discuss the performance implementations of this fully.</p>
<p>The Java sort method, as we mentioned, requires every item in the collection to be a full object type, which means that instead of storing the values directly in the array, the values are stored in the heap, and references are stored in the array. This is unnecessary with a traits-based approach â€“ the values can live directly in the array.</p>
<p>This means that different arrays will have different element sizes, so this has to be handled by a trait as well. And it is: The size of the values is also parameterized via the Sized trait. The size does have to be consistent among all the items of the array, but this is enforceable because we can express that all the elements are actually the exact same type â€“ unlike Javaâ€™s List<T> which only expresses that theyâ€™re of type T or some subtype of T.</p>
<p>Rustâ€™s sort method could have been implemented by passing the size information (from the Sized trait) and the ordering function (from the Ord trait) at runtime as an integer value and a function pointer. This is how typeclasses work in Haskell, which was the inspiration for Rust traits. This would still be more efficient than the Java, as there would be a single ordering function, rather than a different indirect lookup for every left side of the comparison, allowing indirect branch prediction to work in the processor.</p>
<p>But Rust goes even further than that, and implements its traits instead via monomorphization. This is similar to C++ template instantiation, but semantically better constrained. The premise is that while sort is only one method semantically, in the outputted, compiled code, a different version of sort is outputted for every type T that it is called with.</p>
<p>C++ templates create infamously bad error messages and are difficult to reason about, because they are essentially macros, and awkward ones. Even Rust cannot create great error messages with its macro system. But also, writing them requires expertise, and means that the programmer is forgoing many of the benefits of the type system â€“ templates are often called, in my opinion rightly so, a form of compile time duck-typing. For these reasons, template programming in C++ is often considered more advanced (read as harder and less convenient rather than more powerful) than OOP-style polymorphism.</p>
<p>In Rust, however, traits provide an organized and more coherent way of accessing similar technology, getting the performance benefits of templates while still giving the structure of a solid type system.</p>
<h3 id="alternative-3-dynamic-trait-objects"><a class="header" href="#alternative-3-dynamic-trait-objects">Alternative #3: Dynamic Trait Objects</a></h3>
<p>Sometimes, however, you do need full run-time polymorphism. You have the opposite of the scenario with the enum: You have a closed set of operations that can be performed on a value, but what those operations actually do will change dynamically in a way that cannot be bounded ahead of time.</p>
<p>In such situations, Rust has you covered with the dyn keyword. Please donâ€™t overuse it, though. In almost all situations where Iâ€™ve thought it might be appropriate, static polymorphism combined with other design elements have worked out better.</p>
<p>Legitimate use cases for dyn tend to come up in situations involving inversion of control, where a framework library takes on a main loop, and the client code says how to handle various events. In network programming, the framework library says how to juggle all the sockets and register them with the operating system, but the application needs to say what to actually do with the data. In GUI programming, the framework code can say what widget was being clicked on, but very different things happen if that widget is a button versus a text box versus a custom widget you invented for this particular app.</p>
<p>Now, you donâ€™t strictly need run-time polymorphism for this. You could use closures (or even raw function pointers) instead, creating struct of closures (or function pointers) if multiple operations are called for â€“ which amounts to basically doing what dyn does the hard way by hand. For example, I fully expected tokio to use Rustâ€™s run-time polymorphism feature internally to handle this inversion of control in task scheduling. Instead, for what I imagine are performance reasons, tokio implements dyn by hand, even calling its struct of function pointers Vtable.</p>
<p>But dyn does all of this work for you, for your trait. The only requirement is that your trait be object-safe, and the list of requirements may seem familiar, especially when it comes to the requirements for an associated function (e.g. a method) to be â€œdispatchableâ€:</p>
<hr />
<ul>
<li>Not have any type parameters (although lifetime parameters are allowed),</li>
<li>Be a method that does not use Self except in the type of the receiver.</li>
<li>Have a receiver with one of the following types:
<ul>
<li>&amp;Self (i.e. &amp;self)</li>
<li>&amp;mut Self (i.e &amp;mut self)</li>
<li>Box<Self></li>
<li>Rc<Self></li>
<li>Arc<Self></li>
<li>Pin<P> where P is one of the types above</li>
</ul>
</li>
<li>Does not have a where Self: Sized bound (receiver type of Self (i.e. self) implies this).</li>
</ul>
<hr />
<p>That is to say, it can be polymorphic in exactly one parameter, and that parameter must be by reference â€“ more or less the exact requirements for methods to support run-time polymorphism in OOP.</p>
<p>This is of course because dyn uses almost exactly the same mechanism as OOP to implement run-time polymorphism: the â€œvtable.â€ Box<dyn Foo> really contains two pointers rather than one, one to the object in question, and the pointer to the â€œvtable,â€ the automatically-generated structure of function pointers for that type. The one-parameter requirement is because that is the parameter whose vtable is used to look up which concrete implementation of a method to call, and the indirection requirement is because the concrete type might be different sizes, with the size only known at run-time.</p>
<p>To be clear, these are limitations on one particular implementation strategy for run-time polymorphism. Alternative strategies exist that fully decouple the vtable from individual values of the type, as in Haskell.</p>
<p>There are still a few advantages of Rustâ€™s version of run-time polymorphism with traits as opposed to OOP-style interfaces.</p>
<p>Performance-wise, itâ€™s something done alongside a type, rather than intrinsic to the type. Normal values donâ€™t store a vtable, spreading the cost of this throughout the program, but rather, the vtables are only referenced when a dyn pointer is created. If you never create a dyn pointer to a value of a given type, that typeâ€™s vtable doesnâ€™t even have to be created. Certainly, you donâ€™t have 8 bytes of extra gunk in every allocation for all the vtable pointers! This also means thereâ€™s one fewer level of indirection.</p>
<p>Semantically, itâ€™s also a good thing that itâ€™s just one option among many, and that itâ€™s not the strongly preferred option that the entire programming language is trying to push you towards. Often, even usually, static polymorphism, enums, or even just good old-fashioned closures more accurately represent the problem at hand, and should be used instead.</p>
<p>Finally, the fact that run-time and static polymorphism in Rust both use traits makes it easier to transition from one system to another. If you find yourself using dyn for a trait, you donâ€™t have to use it everywhere that trait is used. You can use the mechanisms of static polymorphism (like type parameters and impl Trait) instead, freely mixing and matching with the same traits.</p>
<p>Unlike in C++, you donâ€™t have to learn two completely different sets of syntax for concepts vs parent classes, and vastly different semantics. Really, in Rust, dynamic polymorphism is just a special case of static polymorphism, and the only differences are the things that actually are different.</p>
<h2 id="logging-28"><a class="header" href="#logging-28">logging</a></h2>
<ul>
<li>230215 ZQ init.</li>
</ul>
<pre><code>         _~^&amp;âˆ½~_
     \/ /  O ^  \ \/
       '_   v   _'
       / '--#--' )

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-è¿ç®—ç¬¦é‡è½½å…­ä»¶è¶£äº‹"><a class="header" href="#rust-è¿ç®—ç¬¦é‡è½½å…­ä»¶è¶£äº‹">Rust è¿ç®—ç¬¦é‡è½½å…­ä»¶è¶£äº‹</a></h1>
<p>åŸæ–‡: <a href="https://wishawa.github.io/posts/fun-rust-operators/">Six fun things to do with Rust operator overloading | Wisha Wanichwecharungruang</a></p>
<p><img src="https://wishawa.github.io/posts/fun-rust-operators/dot-product-pooh.jpg" alt="dot-product-pooh" /></p>
<h2 id="å¿«è¯‘-3"><a class="header" href="#å¿«è¯‘-3">å¿«è¯‘</a></h2>
<h3 id="c-è¾“å…¥å‡º"><a class="header" href="#c-è¾“å…¥å‡º">C++ è¾“å…¥/å‡º</a></h3>
<p>æƒ³æ›¿ä»£:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>stdin().read_line(&amp;mut buffer).unwrap();
println!(&quot;Hello I am {name}!!!&quot;);
<span class="boring">}</span></code></pre></pre>
<p>å¯ä»¥é‡è½½ cin å’Œ count ä¸Šçš„ç§»ä½è¿ç®—ç¬¦æ¥è¾¾æˆ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>cin &gt;&gt; &amp;mut buffer;
cout &lt;&lt; &quot;Hello I am &quot; &lt;&lt; name &lt;&lt; &quot;!!!&quot; &lt;&lt; endl;
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>çœ‹èµ·æ¥æ„ä¹‰æ›´åŠ ä¸æ˜äº†äº†?
)</p>
<h3 id="å¯å˜å‡½æ•°"><a class="header" href="#å¯å˜å‡½æ•°">å¯å˜å‡½æ•°</a></h3>
<p>æƒ³æ›¿ä»£</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>std::cmp::max(x, y);
[w, x, y, z].into_iter().max();
<span class="boring">}</span></code></pre></pre>
<p>å¯ä»¥ææˆ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// max+ is like std::cmp::max but better
// it supports &gt;2 arguments
max+(x, y);
max+(w, x, y, z);
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>å†…ç½®æ ‡å‡†åº“å¤ªä¸°å¯Œäº†...ç®€ç›´å¿…é¡»è¦æœ‰ä¸€ä¸ªä¿¡ä»°è¿‡ç¨‹</p>
<p>)</p>
<h3 id="æ›´ç®€æ´çš„æ„å»ºå™¨"><a class="header" href="#æ›´ç®€æ´çš„æ„å»ºå™¨">æ›´ç®€æ´çš„æ„å»ºå™¨</a></h3>
<p>è¿™æ˜¯ä¸€ä¸ªæ›´ä¸¥é‡çš„é—®é¢˜;
æ„å»ºå™¨æ¨¡å¼æœ‰æ—¶æ¶‰åŠå¤§é‡é‡å¤çš„æ–¹æ³•è°ƒç”¨;
ä»¥ warp web æ¡†æ¶çš„è¿™ç§ç”¨æ³•ä¸ºä¾‹:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let hi = warp::path(&quot;hello&quot;)
    .and(warp::path::param())
    .and(warp::header(&quot;user-agent&quot;))
    .map(|param: String, agent: String| {
        format!(&quot;Hello {}, whose agent is {}&quot;, param, agent)
    });
<span class="boring">}</span></code></pre></pre>
<p>å¦‚æœ API çœ‹èµ·æ¥åƒè¿™æ ·å‘¢?</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let hi = warp::path(&quot;hello&quot;)
	+	warp::path::param()
	+	warp::header(&quot;user-agent&quot;)
	&gt;&gt;	|param: String, agent: String| {
			format!(&quot;Hello {}, whose agent is {}&quot;, param, agent)
		};
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>ç­‰ç­‰, è¿™å°±æ˜¯è¯­æ³•ç³–äº†å§?
)</p>
<h3 id="ä¸­ç¼€å‡½æ•°"><a class="header" href="#ä¸­ç¼€å‡½æ•°">ä¸­ç¼€å‡½æ•°</a></h3>
<p>æƒ³æ›¿ä»£:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>x.pow(y);
dot_product(a, b);
a.cross(b.cross(c).cross(d))
<span class="boring">}</span></code></pre></pre>
<p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ¥:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>x ^pow^ y;
a *dot* b;
a *cross* (b *cross* c *cross* d);
<span class="boring">}</span></code></pre></pre>
<p>å¾ˆå¤šäººå°±æƒ³è¦è¿™ä¸ª!</p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>å—¯å“¼? çš„ç¡®æµç•…å¾ˆå¤šå“ª...
)</p>
<h3 id="doublefish"><a class="header" href="#doublefish">Doublefish</a></h3>
<p>std::mem æä¾›æœ‰è¿™äº›åŠŸèƒ½:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>size_of::&lt;T&gt;();
size_of_val(&amp;value);
<span class="boring">}</span></code></pre></pre>
<p>Turbofish çˆ±å¥½è€…ä¼šå–œæ¬¢ size_of,
ä½†æ˜¯å¯¹ size_of_val æ²¡ä»€ä¹ˆæ„Ÿè§‰;
æ‰€ä»¥, æˆ‘ä»¬å¯ä»¥è‡ªè¡Œæ”¹é€ å‡ºæ–°ç‰ˆæœ¬çš„ size_of_val ,
çœ‹èµ·æ¥æ›´è±¡ turbofishy:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>size_of::&lt;T&gt;();
size_of_val&lt;&lt;&amp;value&gt;&gt;();
<span class="boring">}</span></code></pre></pre>
<h3 id="join-å’Œ-race"><a class="header" href="#join-å’Œ-race">Join å’Œ Race</a></h3>
<p>ç‰¹æ€§ç»„åˆå™¨å¯èƒ½å…·æœ‰çŸ­è·¯è¡Œä¸ºèƒ½åŠ›;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// quit if any of the 3 errors
(fut1, fut2, fut3).try_join().await;

// quit if any of the 3 succeeds
(fut4, fut5, fut6).race_ok().await;
<span class="boring">}</span></code></pre></pre>
<p>å¯ä»¥é€šè¿‡ &amp; å’Œ | åœ¨å½¢å¼ä¸Šè¡¨è¾¾å‡ºè¿™ç‚¹:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>(TryJoin &gt;&gt; fut1 &amp; fut2 &amp; fut3).await;
(RaceOk &gt;&gt; fut4 | fut5 | fut6).await;
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p>è¿™æ˜¯ä»å½¢å¼ä¸Šå’Œè¯­ä¹‰åŒæ­¥äº†.
)</p>
<h2 id="useful-links"><a class="header" href="#useful-links">Useful Links</a></h2>
<ul>
<li><a href="https://www.reddit.com/r/rust/comments/10golkq">Discuss this on Reddit</a></li>
<li><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=71da59351b0988249a69014e6b191353">Playground</a> containing the implementations behind some of the code shown here</li>
<li><a href="https://doc.rust-lang.org/std/ops/index.html">std::ops docs</a></li>
<li><a href="https://doc.rust-lang.org/reference/expressions.html#expression-precedence">Rust operators precedence table</a></li>
</ul>
<h2 id="refer-39"><a class="header" href="#refer-39">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<h2 id="logging-29"><a class="header" href="#logging-29">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>230212 ZQ v1 done</li>
<li>230125 ZQ init.</li>
</ul>
<pre><code>           _~^&amp;-~_
       \) /  * ?  \ (/
         '_   â©Œ   _'
         ( '--~--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ç¬”è®°"><a class="header" href="#ç¬”è®°">ç¬”è®°</a></h1>
<blockquote>
<p>logging</p>
</blockquote>
<h2 id="background-26"><a class="header" href="#background-26">background</a></h2>
<blockquote>
<p>æ— å¥ˆèƒŒæ™¯</p>
</blockquote>
<p>ä»»ä½•è‡ªå­¦éƒ½éœ€è¦æ¢ç´¢+å†…çœ, åŒæ—¶æ¥, å¦åˆ™, å¾ˆå®¹æ˜“ä¸çŸ¥é“åœ¨æŠ˜è…¾ä»€ä¹ˆ...</p>
<h2 id="goal-32"><a class="header" href="#goal-32">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<ul>
<li>æ˜¯è°?</li>
<li>åœ¨å“ª?</li>
<li>å»å“ª?</li>
</ul>
<p>éšæ—¶å—¯å“¼æ˜ç™½...</p>
<h2 id="trace-28"><a class="header" href="#trace-28">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
åŸºæœ¬ç¯å¢ƒ
<ul>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬è¯­æ³•</li>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬ std</li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
åŸºæœ¬é¡¹ç›®ç»“æ„</li>
<li><input disabled="" type="checkbox" checked=""/>
åŸºæœ¬ç»å…¸å·¥ç¨‹</li>
<li><input disabled="" type="checkbox"/>
åŸºæœ¬...ä¹ æƒ¯ä»¬?</li>
</ul>
<h2 id="refer-40"><a class="header" href="#refer-40">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="https://www.ainavpro.com/">Aiå¯¼èˆª | æœ€æ–°æœ€å‰æ²¿çš„aiäº§å“</a></li>
</ul>
<h2 id="logging-30"><a class="header" href="#logging-30">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>221023 ZQ init.</li>
</ul>
<pre><code>          _~`~âˆ½~_
      \/ /  o â—·  \ \/
        '_   âˆ§   _'
        \ '--#--' &lt;

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-è¯¾ç¨‹ç¬”è®°"><a class="header" href="#rust-è¯¾ç¨‹ç¬”è®°">Rust è¯¾ç¨‹ç¬”è®°</a></h1>
<h2 id="background-27"><a class="header" href="#background-27">background</a></h2>
<p>Rust ç¤¾åŒºå¾ˆç»™åŠ›å„ç§æ¸ é“ä¸­,æœ‰å„ç§æ•™ç¨‹,
åªæ˜¯, æ¯ä¸ªæ•™ç¨‹éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹å’Œç›²åŒº...</p>
<h2 id="goal-33"><a class="header" href="#goal-33">goal</a></h2>
<p>é«˜é€Ÿåˆ·è¿‡æ—¶, è§åˆ°æœ‰è¶£/æœ‰ç”¨/æœ‰ç§çš„ç‰‡æ®µ, æ”¶é›†æ‘˜å½•åœ¨ä¸€èµ·, å½¢æˆè‡ªå·±çš„å°æŠ„...</p>
<h2 id="trace-29"><a class="header" href="#trace-29">trace</a></h2>
<h3 id="init"><a class="header" href="#init">init.</a></h3>
<p>Recommended tools:</p>
<ul>
<li><input disabled="" type="checkbox"/>
cargo readme - to regenerate README.md based on template and lib.rs comments</li>
<li><input disabled="" type="checkbox"/>
cargo insta - to review test snapshots</li>
<li><input disabled="" type="checkbox"/>
cargo edit - to add/remove dependencies</li>
<li><input disabled="" type="checkbox"/>
cargo fmt - to format code</li>
<li><input disabled="" type="checkbox"/>
cargo clippy - for all insights and tips
<ul>
<li>å®‰è£…ï¼šrustup component add clippy</li>
<li>å‚è€ƒ: <a href="https://skyao.io/learning-rust/docs/build/rustup/rustup-book.html">Rustup Bookå­¦ä¹ ç¬”è®° | Rustå­¦ä¹ ç¬”è®°</a></li>
<li>å¦‚æœå‡ºé—®é¢˜:
<ul>
<li><a href="https://github.com/rust-lang/rustup/issues/1558">Fresh install on macos can't install rustfmt and clippy using rustup Â· Issue #1558 Â· rust-lang/rustup</a></li>
<li>rustup toolchain remove stable &amp;&amp; rustup toolchain install stable</li>
<li>...</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>info: syncing channel updates for 'stable-x86_64-apple-darwin'
info: latest update on 2023-02-09, rust version 1.67.1 (d5a82bbd2 2023-02-07)
info: downloading component 'cargo'
info: downloading component 'clippy'
info: downloading component 'rust-docs'
info: downloading component 'rust-std'

...

  stable-x86_64-apple-darwin installed - rustc 1.67.1 (d5a82bbd2 2023-02-07)

info: checking for self-updates
</code></pre>
<ul>
<li><input disabled="" type="checkbox"/>
cargo fix - for fixing warnings</li>
</ul>
<h4 id="æ£€éªŒå’Œåˆ‡æ¢å·¥å…·é“¾"><a class="header" href="#æ£€éªŒå’Œåˆ‡æ¢å·¥å…·é“¾">æ£€éªŒå’Œåˆ‡æ¢å·¥å…·é“¾</a></h4>
<p>~ <a href="https://github.com/gavadinov/Learn-Rust-by-Building-Real-Applications/tree/master/memory_management">Learn-Rust-by-Building-Real-Applications/memory_management at master Â· gavadinov/Learn-Rust-by-Building-Real-Applications</a></p>
<p>æŸ¥å®å½“å‰ä½¿ç”¨çš„å·¥å…·é“¾:</p>
<blockquote>
<p>rustup toolchain list</p>
</blockquote>
<p>å®‰è£…æŒ‡å®šå·¥å…·é“¾:</p>
<blockquote>
<p>rustup toolchain install nightly-x86_64-unknown-linux-gnu</p>
</blockquote>
<h4 id="å®æŸ¥é˜…"><a class="header" href="#å®æŸ¥é˜…">å®æŸ¥é˜…</a></h4>
<p>~ <a href="https://github.com/dtolnay/cargo-expand">dtolnay/cargo-expand: Subcommand to show result of macro expansion</a></p>
<p>ä½¿ç”¨:</p>
<blockquote>
<p>crago expand</p>
</blockquote>
<p>åœ¨ç»ˆç«¯ä¸­å±•å¼€å®å¹¶æ‰“å°...å¦‚æœå·¥ç¨‹å¤§ç‚¹å„¿, å°±ä¸å¯çœ‹äº†...</p>
<h3 id="project"><a class="header" href="#project">project</a></h3>
<h4 id="cli"><a class="header" href="#cli">CLI</a></h4>
<p>~ <a href="https://rust-cli.github.io/book/tutorial/index.html">A command line app in 15 minutes - Command Line Applications in Rust</a></p>
<p>è¿˜æ˜¯è€ä¹ æƒ¯, CLI-&gt;RESTful-&gt;GUI-&gt; ...</p>
<h3 id="debug"><a class="header" href="#debug">debug</a></h3>
<h4 id="dbg"><a class="header" href="#dbg">dbg!()</a></h4>
<p>ç±»ä¼¼ ic çš„å·¥å…·, å¯ä»¥éšæ—¶æ’å…¥ä»£ç , å¹¶åœ¨è¿è¡Œæ—¶æ‰“å°å¯¹åº”å˜é‡åå’Œå€¼...</p>
<h3 id="testting"><a class="header" href="#testting">testting</a></h3>
<h3 id="coding"><a class="header" href="#coding">coding</a></h3>
<h2 id="refer-41"><a class="header" href="#refer-41">refer:</a></h2>
<blockquote>
<p>Udemy</p>
</blockquote>
<ul>
<li><a href="https://www.udemy.com/course/rust-programming-the-complete-guide/">The Complete Rust Programming Course | Udemy</a></li>
<li><a href="https://www.udemy.com/course/rust-fundamentals/">Learn Rust by Building Real Applications | Udemy</a>
<ul>
<li>ç”¨äº†ä¸€åŠç¯‡å¹…æ¥ä»‹ç»å†…å­˜ç®¡ç†æ¨¡å‹,ä»¥åŠ GDB è§‚å¯Ÿè¿‡ç¨‹...</li>
</ul>
</li>
</ul>
<blockquote>
<p>Youtube</p>
</blockquote>
<ul>
<li>110+<a href="https://www.youtube.com/playlist?list=PL3azK8C0kje1DUJbaOqce19j3R_-tIc4_">Rust ç¼–ç¨‹è¯­è¨€å…¥é—¨æ•™ç¨‹ [2021] - YouTube</a>
<ul>
<li>42+<a href="https://www.youtube.com/playlist?list=PLVvjrrRCBy2JSHf9tGxGKJ-bYAN_uDCUL">RUST PROGRAMMING TUTORIALS - YouTube</a></li>
<li>44+<a href="https://www.youtube.com/playlist?list=PLJbE2Yu2zumDF6BX6_RdPisRVHgzV02NW">Intro to Rust - YouTube</a></li>
<li>14+<a href="https://www.youtube.com/playlist?list=PLKkEWK6xRmes17LQUEA5bNjYISuCEOTXx">Rust For Starters - YouTube</a></li>
</ul>
</li>
<li>44+<a href="https://www.youtube.com/playlist?list=PLai5B987bZ9CoVR-QEIN9foz4QCJ0H2Y8">The Rust Lang Book - YouTube</a></li>
<li>25+<a href="https://www.youtube.com/playlist?list=PLJbE2Yu2zumDD5vy2BuSHvFZU0a6RDmgb">Rust Projects - YouTube</a>
<ul>
<li>24+<a href="https://www.youtube.com/playlist?list=PL5dTjWUk_cPYuhHm9_QImW7_u4lr5d6zO">50 RUST Projects - YouTube</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/@jonhoo">Jon Gjengset - YouTube</a>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLqbS7AVVErFgY2faCIYjJZv_RluGkTlKt">Rust live-coding - YouTube</a>
<ul>
<li>éƒ½æ˜¯å‡ ä¸ªå°æ—¶çš„è¿ç»­è°ƒè¯•è¿‡ç¨‹</li>
</ul>
</li>
<li><a href="https://www.youtube.com/playlist?list=PLqbS7AVVErFiWDOAVrPt7aYmnuuOLYvOa">Crust of Rust - YouTube</a></li>
</ul>
</li>
</ul>
<pre><code>      _~`|-~_
  \/ /  - =  \ \/
    '_   â   _'
    ( '--~--' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-ä¸‘å¥æ³•"><a class="header" href="#rust-ä¸‘å¥æ³•">Rust ä¸‘å¥æ³•</a></h1>
<p>åŸæ–‡: <a href="https://matklad.github.io/2023/01/26/rusts-ugly-syntax.html#Rust-s-Ugly-Syntax">Rust's Ugly Syntax</a></p>
<h2 id="å¿«è¯‘-4"><a class="header" href="#å¿«è¯‘-4">å¿«è¯‘</a></h2>
<p>å¤§å®¶æŠ±æ€¨ Rust çš„è¯­æ³•;
ä¸è¿‡,ä¿ºæƒ³å¤§å¤šæ•°æ—¶å€™,
å½“äººä»¬è®¤ä¸ºåœ¨å¯¹ Rust è¯­æ³•æœ‰ç–‘é—®æ—¶,
å®é™…ä¸Šåœ¨åæŠ—å¯¹åº”è¯­ä¹‰;
åœ¨è¿™ç¯‡æœ‰ç‚¹å„¿å¼‚æƒ³å¤©å¼€çš„æ–‡ç« ä¸­,
ä¿ºå°†å°è¯•ç†æ¸…è¿™ä¸¤ç‚¹;</p>
<p>å…ˆä»ä¸€ä¸ªä¸‘é™‹çš„è¯­æ³•ç¤ºä¾‹å¼€å§‹:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {
  fn inner(path: &amp;Path) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {
    let mut file = File::open(path)?;
    let mut bytes = Vec::new();
    file.read_to_end(&amp;mut bytes)?;
    Ok(bytes)
  }
  inner(path.as_ref())
}
<span class="boring">}</span></code></pre></pre>
<p>æ­¤å‡½æ•°è¯»å–ç»™å®šäºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹;
è¿™æ˜¯ç›´æ¥ä»æ ‡å‡†åº“ä¸­æå–çš„, æ‰€ä»¥, ä¸ç®—æ˜¯ç¨»è‰äººå¼æ— ç”¨ç¤ºä¾‹;
è€Œä¸”,è‡³å°‘å¯¹ä¿ºæ¥è¯´, è¿™ç»å¯¹ä¸ç®—æ¼‚äº®;</p>
<p>è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹,å¦‚æœ Rust æœ‰æ›´å¥½çš„è¯­æ³•, è¿™ä¸ªå‡½æ•°åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å„¿;
å¦‚æœå’ŒçœŸæ­£çš„ç¼–ç¨‹è¯­è¨€æœ‰ä»»ä½•ç›¸ä¼¼ä¹‹å¤„, æ— è®ºçœŸå‡, çº¯å±è¯•åˆ!</p>
<p>ä» Rs++ å¼€å§‹:</p>
<pre><code class="language-c++">template&lt;std::HasConstReference&lt;std::Path&gt; P&gt;
std::io::outcome&lt;std::vector&lt;uint8_t&gt;&gt;
std::read(P path) {
    return read_(path.as_reference());
}

static
std::io::outcome&lt;std::vector&lt;uint8_t&gt;&gt;
read_(&amp;auto const std::Path path) {
    auto file = try std::File::open(path);
    std::vector bytes;
    try file.read_to_end(&amp;bytes);
    return okey(bytes);
}
</code></pre>
<p>Rhodes å˜ä½“:</p>
<pre><code class="language-ruby">public io.Result&lt;ArrayList&lt;Byte&gt;&gt; read&lt;P extends ReferencingFinal&lt;Path&gt;&gt;(
        P path) {
    return myRead(path.get_final_reference());
}

private io.Result&lt;ArrayList&lt;Byte&gt;&gt; myRead(
        final reference lifetime var Path path) {
    var file = try File.open(path);
    ArrayList&lt;Byte&gt; bytes = ArrayList.new();
    try file.readToEnd(borrow bytes);
    return Success(bytes);
}
</code></pre>
<p>ç»å…¸ RhodesScript:</p>
<pre><code class="language-js">public function read&lt;P extends IncludingRef&lt;Path&gt;&gt;(
    path: P,
): io.Result&lt;Array&lt;byte&gt;&gt; {
    return myRead(path.included_ref());
}

private function myRead(
    path: &amp;const Path,
): io.Result&lt;Array&lt;byte&gt;&gt; {
    let file = try File.open(path);
    Array&lt;byte&gt; bytes = Array.new()
    try file.readToEnd(&amp;bytes)
    return Ok(bytes);
}
</code></pre>
<p>å“å°¾è›‡/Rattlesnake:</p>
<pre><code class="language-python">def read[P: Refing[Path]](path: P): io.Result[List[byte]]:
    def inner(path: @Path): io.Result[List[byte]]:
        file := try File.open(path)
        bytes := List.new()
        try file.read_to_end(@: bytes)
        return Ok(bytes)
    return inner(path.ref)
</code></pre>
<p>ä»¥åŠ, CrabML:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>read :: 'p  ref_of =&gt; 'p -&gt; u8 vec io.either.t
let read p =
  let
    inner :: &amp;path -&gt; u8 vec.t io.either.t
    inner p =
      let mut file = try (File.open p) in
      let mut bytes = vec.new () in
      try (file.read_to_end (&amp;mut bytes)); Right bytes
  in
    ref_op p |&gt; inner
;;
<span class="boring">}</span></code></pre></pre>
<p>ä½œä¸ºä¸€ä¸ªç¨å¾®ä¸¥è‚ƒå’Œæœ‰ç”¨çš„ç»ƒä¹ ,
è®©æˆ‘ä»¬ä½œç›¸åçš„å°è¯•--ä¿ç•™ Rust è¯­æ³•,
ä½†æ˜¯, å°è¯•ç®€åŒ–è¯­ä¹‰ç›´åˆ°æœ€ç»ˆç»“æœ, çœ‹ä¼šæ˜¯ä»€ä¹ˆæ ·å„¿;</p>
<p>è¿™æ˜¯æˆ‘ä»¬çš„èµ·ç‚¹:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {
  fn inner(path: &amp;Path) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {
    let mut file = File::open(path)?;
    let mut bytes = Vec::new();
    file.read_to_end(&amp;mut bytes)?;
    Ok(bytes)
  }
  inner(path.as_ref())
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™æ—¶, æœ€å¤§çš„å™ªéŸ³æºæ˜¯åµŒå¥—å‡½æ•°;
åŠ¨æœºæœ‰ç‚¹å„¿æ·±å¥¥;
å¤–éƒ¨å‡½æ•°æ˜¯é€šç”¨çš„,è€Œå†…éƒ¨ä¸æ˜¯;
ä½¿ç”¨ç¼–è¯‘æ¨¡å¼,è¿™æ„å‘³ç€å¤–éƒ¨å‡½æ•°å’Œç”¨æˆ·ä»£ç ä¸€èµ·ç¼–è¯‘,
è€ŒåµŒçš„å°†ä¼˜åŒ–;
ç›¸æ¯”ä¹‹ä¸‹, å†…éƒ¨å‡½æ•°æ˜¯åœ¨ç¼–è¯‘ std æœ¬èº«æ—¶ç¼–è¯‘çš„,
ä»è€ŒèŠ‚çœäº†ç¼–è¯‘ç”¨æˆ·ä»£ç çš„æ—¶é—´;
ç®€åŒ–è¿™ä¸€ç‚¹(æŸå¤±ä¸€äº›æ€§èƒ½)çš„ä¸€ç§æ–¹æ³•,
è¯´æ˜¯æ³›å‹å‡½æ•°æ€»æ˜¯å•ç‹¬ç¼–è¯‘,
ä½†æ˜¯,èƒ½åœ¨å¹•åæ¥å—ä¸€ä¸ªé¢å¤–çš„è¿è¡Œæ—¶ç§‹ç²®, å¯ä»¥æè¿°ç‰©ç†ç»´åº¦ä¸Šçš„è¾“å…¥å‚æ•°;</p>
<p>è¿™æ ·æˆ‘ä»¬è·å¾—:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {
  let mut file = File::open(path.as_ref())?;
  let mut bytes = Vec::new();
  file.read_to_end(&amp;mut bytes)?;
  Ok(bytes)
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸‹ä¸ªå™ªéŸ³å…ƒç´ æ˜¯ <code>&lt;P: AsRef&lt;Path&gt;&gt;</code> çº¦æŸ;
è¿™æ˜¯å¿…éœ€çš„,å› ä¸º Rust å–œæ¬¢å°†å†…å­˜ä¸­å­—èŠ‚çš„ç‰©ç†å¸ƒå±€ä½œä¸ºæ¥å£å…¬å¼€,
ç‰¹åˆ«æ˜¯å¯¹å¯ä»¥å¸¦æ¥æ€§èƒ½çš„æƒ…å†µ;
ç‰¹æ®Šçš„, Path çš„å«ä¹‰å¹¶ä¸æ˜¯æ–‡ä»¶è·¯å¾„çš„æŸç§æŠ½è±¡,
è¿™é‡Œåªæ˜¯å­—é¢æ„ä¹‰ä¸Šå†…å­˜ä¸­çš„ä¸€å †è¿ç»­å­—èŠ‚;
æ‰€ä»¥, æˆ‘ä»¬éœ€è¦ AsRef æ¥å°†å…¶å’Œä»»ä½•èƒ½å¤Ÿè¡¨ç¤ºè¿™ç§å­—èŠ‚ç‰‡çš„æŠ½è±¡ä¸€èµ·å·¥ä½œ;
ä½†æ˜¯, å¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒæ€§èƒ½,
å°±å¯ä»¥è¦æ±‚æ‰€æœ‰æ¥å£éƒ½ç›¸å½“æŠ½è±¡,å¹¶é€šè¿‡è™šå‡½æ•°è°ƒç”¨è¿›è¡Œè°ƒè§£,
è€Œä¸æ˜¯ç›´æ¥è®¿é—®å†…å­˜;
é‚£ä¹ˆ, æˆ‘ä»¬å°±ä¸éœ€è¦ AsRef è¿™å †ä¸œè¥¿äº†:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read(path: &amp;Path) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {
  let mut file = File::open(path)?;
  let mut bytes = Vec::new();
  file.read_to_end(&amp;mut bytes)?;
  Ok(bytes)
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™æ ·ç®€åŒ–å,æˆ‘ä»¬å®é™…ä¸Šä¹Ÿå¯ä»¥æ‘†è„± <code>Vec&lt;u8&gt;</code> -- å¦‚æœæˆ‘ä»¬ä¸å†ä½¿ç”¨æ³›å‹æ¥è¡¨è¾¾è¯­è¨€æœ¬èº«çš„é«˜æ•ˆå¯å¢é•¿å­—èŠ‚æ•°ç»„;
æˆ‘ä»¬å¿…é¡»ä½¿ç”¨è¿è¡Œæ—¶æä¾›çš„ä¸€äº›ä¸é€æ˜å­—èŠ‚ç±»å‹:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read(path: &amp;Path) -&gt; io::Result&lt;Bytes&gt; {
  let mut file = File::open(path)?;
  let mut bytes = Bytes::new();
  file.read_to_end(&amp;mut bytes)?;
  Ok(bytes)
}
<span class="boring">}</span></code></pre></pre>
<p>ä»æŠ€æœ¯ä¸Šè®²,æˆ‘ä»¬ä»ç„¶éšèº«æºå¸¦æ‰€æœ‰æƒå’Œå¤‡ç”¨ç³»ç»Ÿ,
ä½†æ˜¯,ç”±äºæ— æ³•ç›´æ¥æ§åˆ¶ç±»å‹çš„å†…å­˜å¸ƒå±€,
å°±æ— æ³•å¸¦æ¥å·¨å¤§çš„æ€§èƒ½ä¼˜åŠ¿;
ä»ç„¶æœ‰åŠ©äºé¿å… GC,é˜²æ­¢è¿­ä»£å™¨å¤±æ•ˆ,
å¹¶é™æ€æ£€éªŒéçº¿ç¨‹å®‰å…¨ä»£ç æ˜¯å¦å®é™…ä¸Šæ²¡æœ‰è·¨çº¿ç¨‹ä½¿ç”¨;
ä¸è¿‡, å¦‚æœæˆ‘ä»¬åªåˆ‡æ¢åˆ° GC, æˆ‘ä»¬å¯ä»¥è½»æ¾æ‘†è„±é‚£äº› &amp;æŒ‡é’ˆ;
æˆ‘ä»¬ç”šè‡³äºä¸éœ€è¦å¤ªæ‹…å¿ƒå¹¶å‘æ€§--å› ä¸º,æˆ‘ä»¬çš„å¯¹è±¡æ˜¯å•ç‹¬åˆ†é…çš„,è€Œä¸”æ€»æ˜¯åœ¨æŒ‡é’ˆåé¢,
æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨æ„åˆ°æŒ‡é’ˆå¤§å°,
æ— è®ºæ˜¯å¦åœ¨ x86 ç³»ç»Ÿä¸Šéƒ½æ˜¯åŸå­æ“ä½œæ¥æ¶ˆé™¤æ•°æ®ç«äº‰;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read(path: Path) -&gt; io::Result&lt;Bytes&gt; {
  let file = File::open(path)?;
  let bytes = Bytes::new();
  file.read_to_end(bytes)?;
  Ok(bytes)
}
<span class="boring">}</span></code></pre></pre>
<p>æœ€å,æˆ‘ä»¬åœ¨è¿™å¯¹é”™è¯¯çš„å¤„ç†è¿‡äºè¿‚è… -- æˆ‘ä»¬å¹¶ä»…è¦å…³æ³¨è¿”å›ç±»å‹å¤±è´¥çš„å¯èƒ½,
ç”šè‡³äºè¦ç”¨ ? æ¥çªå‡ºæŒ‡ç¤ºä»»ä½•å¯èƒ½å¤±è´¥çš„ç‰¹å®šè¡¨è¾¾å¼;
å®Œå…¨ä¸è€ƒè™‘é”™è¯¯å¤„ç†,
è®©ä¸€äº›é¡¶å±‚å¤„ç†ç¨‹åºæ¥å¤„ç†:
(æ¯”å¦‚: try { } catch (...) { /* intentionally empty */ })</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn read(path: Path) -&gt; Bytes {
  let file = File::open(path);
  let bytes = Bytes::new();
  file.read_to_end(bytes);
  bytes
}
<span class="boring">}</span></code></pre></pre>
<p>ç°åœ¨æ˜¯å¦å¥½å¤šäº†?</p>
<h2 id="ps"><a class="header" href="#ps">PS:</a></h2>
<p>çš„ç¡®æ˜¯ç¯‡å¥‡æƒ³, è¿™æ ·ç®€åŒ–å, å‡ ä¹å°±æ˜¯ å¤šäº†ä¸€äº›æ§åˆ¶ç¬¦å·çš„ Python äº†,
åˆæˆ–æ˜¯æ ¹æœ¬å¯ä»¥è§†ä¸º TypeScript äº†;
å½“ç„¶, å¦‚æœæœ‰è¿™ç§ä½æ•ˆç‰ˆ Rust å¤šæ•°ç¨‹åºå‘˜è¿˜æ˜¯æ„¿æ„ä½¿ç”¨çš„;
å°±è±¡å½“å¹´ CoffeeScript çš„å°è¯•;</p>
<h2 id="logging-31"><a class="header" href="#logging-31">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230206 ZQ init.</li>
</ul>
<pre><code>       _~^*`~_
   \) /  &gt; #  \ (/
     '_   â   _'
     | '-----' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å›¾å½¢æè¿°-rust-ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨"><a class="header" href="#å›¾å½¢æè¿°-rust-ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨">å›¾å½¢æè¿° Rust ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨</a></h1>
<p>åŸæ–‡: <a href="https://rufflewind.com/2017-02-15/rust-move-copy-borrow">Graphical depiction of ownership and borrowing in Rust - Rufflewind's Scratchpad</a></p>
<h2 id="å¿«è¯‘-5"><a class="header" href="#å¿«è¯‘-5">å¿«è¯‘:</a></h2>
<p>ä»¥ä¸‹æ˜¯ Rust è¯­è¨€ä¸­ moving, copying, å’Œ borrowing çš„å›¾å½¢æè¿°;
è¿™äº›æ¦‚å¿µä¸­çš„å¤§å¤šæ•°æ˜¯ Rust æŒæœ‰çš„,
å› æ­¤, ä¹Ÿæ˜¯å¾ˆå¤šå­¦ä¹ è€…å¸¸è§ç»Šè„šçŸ³;</p>
<p>ä¸ºäº†é¿å…å›¾å½¢æ··ä¹±, å°½é‡å‡å°‘äº†æ–‡å­—;
å¹¶ä¸æ˜¯è¦å–ä»£ç°æœ‰å„ç§æ•™ç¨‹, è€Œæ˜¯ä¸ºå–œæ¬¢ç›´è§‚ç†è§£æ¦‚å¿µçš„ç¨‹åºå‘˜æä¾›ä¸åŒçš„è§†è§’;
å¦‚æœä½ æ­£åœ¨å­¦ä¹  Rust å¹¶å‘ç°è¿™äº›å›¾å½¢æœ‰æŠ¥æ—¶,
å»ºè®®ä½ ä½¿ç”¨è¿™ç±»å›¾è¡¨æ³¨é‡Šè‡ªå·±çš„ä»£ç ä»¥ä¾¿å¸®åŠ©å·©å›ºæ¦‚å¿µ ;-)</p>
<h2 id="rust-ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨"><a class="header" href="#rust-ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨">Rust ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨</a></h2>
<p><img src="https://rufflewind.com/img/rust-move-copy-borrow.png" alt="" /></p>
<p>å¯ä»¥é€šè¿‡ç‚¹å‡»å›¾åƒæ¥æ”¾å¤§, ä¹Ÿå¯ä»¥ä¸‹è½½ <a href="https://rufflewind.com/img/rust-move-copy-borrow.svg">SVG</a>
å’Œ <a href="https://rufflewind.com/img/rust-move-copy-borrow.pdf">PDF</a> ç‰ˆæœ¬åœ¨æœ¬åœ°æ”¾å¤§;</p>
<p>ä¸Šé¢çš„å›¾å½¢æè¿°äº†ä½ æ‹¥æœ‰æ•°æ®çš„ä¸¤ç§ä¸»è¦è¯­ä¹‰: ç§»åŠ¨æˆ–æ˜¯å¤åˆ¶;</p>
<p>å…³äºç§»åŠ¨çš„è§£é‡Š(~&gt;)çœ‹èµ·æ¥å¤ªç®€å•äº†;
è¿™é‡Œæ²¡æœ‰æŠŠæˆ: ç§»åŠ¨è¯­ä¹‰æœ¬èº«å°±å¾ˆå¥‡æ€ª,å› ä¸º,å¤§å¤šæ•°è¯­è¨€å…è®¸å˜é‡è¢«ç¨‹åºå‘˜éšæ„ä½¿ç”¨å¤šæ¬¡;
è¿™å’Œç°å®ä¸–ç•Œçš„å¤§éƒ¨åˆ†æƒ…å†µå½¢æˆé²œæ˜å¯¹æ¯”:
æˆ‘ä¸èƒ½æŠŠæˆ‘çš„ç¬”ç»™åˆ«äºº,ç„¶å,ä»ç„¶ç”¨å®ƒç»§ç»­å†™å­—!
åœ¨ Rust ä¸­,ä»»ä½•ç±»å‹æœªå®ç° Copy trait çš„å˜é‡éƒ½å…·æœ‰ç§»åŠ¨è¯­ä¹‰,
å¹¶ä¸”ä¼šåƒæ‰€ç¤ºé‚£æ ·è¿è¡Œ;</p>
<p>å¤åˆ¶è¯­ä¹‰(â˜)æ˜¯ä¸ºå®ç° Copy trait çš„ç±»å‹ä¿ç•™çš„;
åœ¨è¿™ç§æƒ…å†µä¸­, å¯¹è±¡çš„æ¯æ¬¡ä½¿ç”¨éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå‰¯æœ¬, æ­£å¦‚æ‰€ç¤ºåˆ†å‰; ä¸­é—´çš„ä¸¤ä¸ªæ•°å­—æç»˜äº†ä½ å¯ä»¥å€Ÿç”¨ä½ æ‹¥æœ‰ç‰©å“çš„ä¸¤ç§æ–¹å¼,
ä»¥åŠæ¯ç§æ–¹å¼æä¾›çš„æ“ä½œ;</p>
<p>å¯¹äºå¯å˜å€Ÿç”¨, æˆ‘ä½¿ç”¨äº†é”ç¬¦å·(ğŸ”’)æ¥è¡¨ç¤ºåŸå§‹å¯¹è±¡åœ¨å€Ÿç”¨æœŸé—´è¢«æœ‰æ•ˆé”å®š,
ä»¤å…¶æ— æ³•ä½¿ç”¨;</p>
<p>ç›¸å,å¯¹äºéå¯å˜å¤‡ç”¨, æˆ‘ä½¿ç”¨äº†é›ªèŠ±ç¬¦å·(â„)æ¥è¡¨ç¤ºåŸå§‹å¯¹è±¡åªæ˜¯è¢«å†»ç»“äº†:
ä½ ä»ç„¶å¯ä»¥è·å–æ›´å¤šéå¯å˜å¼•ç”¨, ä½†æ˜¯, ä½ ä¸èƒ½ç§»åŠ¨æˆ–æ˜¯è·å–å…¶å¯å˜å¼•ç”¨;</p>
<p>åœ¨è¿™ä¸¤ä¸ªå›¾ä¸­, <code>'Ï</code> æ˜¯æˆ‘ä¸ºå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸé€‰æ‹©çš„åç§°;
æˆ‘æ•…æ„ä½¿ç”¨å¸Œè…Šå­—æ¯æ˜¯å› ä¸ºç›®å‰ Rust ä¸­è¿˜æ²¡æœ‰å…·ä½“ç”Ÿå‘½å‘¨æœŸçš„è¯­æ³•;</p>
<p>æœ€åä¸¤ä¸ªå›¾ä»¥å›¾å½¢å’Œæ–‡æœ¬å½¢å¼æ€»ç»“äº†ä¸¤ç§å¼•ç”¨ä¹‹é—´çš„ä¸»è¦åŒºåˆ«å’Œç›¸ä¼¼ä¹‹å¤„;
åœ¨è¿™ç§åœºæ™¯ä¸­&quot;å¤–éƒ¨(<a href="https://doc.rust-lang.org/beta/book/mutability.html#interior-vs-exterior-mutability">exteriorly</a>)&quot;é™å®šè¯å¾ˆé‡è¦,
å› ä¸º, ä½ ä»ç„¶å¯ä»¥é€šè¿‡ç±»ä¼¼ <a href="https://doc.rust-lang.org/std/cell/">Cell</a> çš„ä¸œè¥¿æ‹¥æœ‰å†…éƒ¨å¯å˜æ€§;</p>
<h2 id="logging-32"><a class="header" href="#logging-32">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>230220 ZQ init.</li>
</ul>
<pre><code>      _~-|`~_
  () /  * *  \ ()
    '_   â•   _'
    | '--âˆ½--' \

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="0åŸºç¡€å…¥é—¨c"><a class="header" href="#0åŸºç¡€å…¥é—¨c">0åŸºç¡€å…¥é—¨C?</a></h1>
<blockquote>
<p>çªç„¶è¢«é—®</p>
</blockquote>
<h2 id="background-28"><a class="header" href="#background-28">background</a></h2>
<p>ä¸æ˜¯é—®æ€ä¹ˆä¿®ç”µè„‘å°±ä¸é”™äº†</p>
<h2 id="goal-34"><a class="header" href="#goal-34">goal</a></h2>
<blockquote>
<p>å¿…è¦ç›®æ ‡</p>
</blockquote>
<p>æœ€å°æœ€å¿«æœ€æœ‰æ•ˆæœçš„è‡ªå­¦...</p>
<h2 id="trace-30"><a class="header" href="#trace-30">trace</a></h2>
<blockquote>
<p>å…·ä½“æ¨è¿›</p>
</blockquote>
<p>TBD...</p>
<h2 id="refer-42"><a class="header" href="#refer-42">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<p>ç§äººæ¨èå›¾ä¹¦:</p>
<ul>
<li>å…¥é—¨:
<ul>
<li><a href="https://book.douban.com/subject/25703412/">å—¨ç¿»Cè¯­è¨€ (Head First C)</a></li>
<li>é…å¥—: 
<ul>
<li><a href="https://book.douban.com/subject/23779374/">æ˜è§£Cè¯­è¨€ (æŸ´ç”°æœ›æ´‹)</a></li>
<li><a href="https://wizardforcel.gitbooks.io/lcthw/content/">ç¬¨åŠæ³•å­¦C ä¸­æ–‡ç‰ˆ Â· ç¬¨åŠæ³•å­¦C</a></li>
</ul>
</li>
</ul>
</li>
<li>è¿›ä¸€æ­¥çš„:
<ul>
<li><a href="https://book.douban.com/subject/1139336/">Cç¨‹åºè®¾è®¡è¯­è¨€ï¼ˆç¬¬2ç‰ˆÂ·æ–°ç‰ˆ)</a></li>
<li><a href="https://book.douban.com/subject/3012360/">Cå’ŒæŒ‡é’ˆ</a></li>
<li><a href="https://book.douban.com/subject/3775842/">Cæ ‡å‡†åº“</a></li>
<li><a href="https://book.douban.com/subject/4141733/">Linux Cç¼–ç¨‹ä¸€ç«™å¼å­¦ä¹  (è±†ç“£)</a>
<ul>
<li><a href="https://linux-c-learning-all-in-one.readthedocs.io/zh_CN/latest/">Linux Cç¼–ç¨‹ä¸€ç«™å¼å­¦ä¹  â€” Linux Cç¼–ç¨‹ä¸€ç«™å¼å­¦ä¹  rc æ–‡æ¡£</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>è¶³å¤Ÿäº†,åŸºæœ¬ä¸Šéƒ½æœ‰å…è´¹ç”µå­ç‰ˆæœ¬...</p>
<h2 id="logging-33"><a class="header" href="#logging-33">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>..</li>
<li>221023 ZQ init.</li>
</ul>
<pre><code>           _~âˆ½|^~_
       \/ /  â—· â—µ  \ (/
         '_   ğŸ‚   _'
         &gt; '--âŒ„--' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>

                    <div id="giscus-container"></div>
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->


                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">

        </nav>

    </div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="book.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var pagePath = "print.md"
    </script>


    <!-- Custom JS scripts -->
    <script type="text/javascript" src="assets/custom.js"></script>
    <script type="text/javascript" src="assets/bigPicture.js"></script>

    <script type="text/javascript">
        window.addEventListener('load', function () {
            window.setTimeout(window.print, 100);
        });
    </script>
    <hr />

    <p style="text-align:center">

        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®"
                style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
        æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯;-)
][ <b>
    <a href="/rss.xml">RSS</a>
    </b>

    </p>
    <hr />

    <script src="https://utteranc.es/client.js" repo="zhrust/comments" issue-term="pathname" label="âœ¨ğŸ’¬âœ¨"
        theme="github-light" crossorigin="anonymous" async>
        </script>

</body>

</html>