<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ - be Rustaceans</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="å¦‚ä½•æˆä¸ºä¸€ååˆæ ¼çš„ Rustacean ? è‚¯å®šæœ‰ä¸ªè¿‡ç¨‹, è¿™å„¿è®°å½•äº†ç§äººè¿™ä¸ªè½¬åŒ–è¿‡ç¨‹...">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../favicon.svg">
    <link rel="shortcut icon" href="../favicon.png">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/chrome.css">
    <link rel="stylesheet" href="../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../highlight.css">
    <link rel="stylesheet" href="../tomorrow-night.css">
    <link rel="stylesheet" href="../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../theme/style.css">


</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');
            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }
            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded "><a href="../abt/index.html"><strong aria-hidden="true">1.</strong> æˆä¸º Rustacean</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../abt/gh-pages.html"><strong aria-hidden="true">1.1.</strong> gh-pages</a></li><li class="chapter-item "><a href="../abt/zhrust.html"><strong aria-hidden="true">1.2.</strong> zhrust</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">è‡ªå­¦ç»ƒä¹ </li><li class="spacer"></li><li class="chapter-item expanded "><a href="../101/index.html"><strong aria-hidden="true">2.</strong> Rust å­¦ä¹ </a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../101/chatgpt101.html"><strong aria-hidden="true">2.1.</strong> ä¼´å­¦ChatGPT</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../101/chat_dyn101.html"><strong aria-hidden="true">2.1.1.</strong> dyn åˆæ­¥</a></li></ol></li><li class="chapter-item "><a href="../101/idioms.html"><strong aria-hidden="true">2.2.</strong> idioms</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../101/idiom325_create_a_queue.html"><strong aria-hidden="true">2.2.1.</strong> idiom#325:æ„é€ é˜Ÿåˆ—</a></li></ol></li><li class="chapter-item "><a href="../101/quiz.html"><strong aria-hidden="true">2.3.</strong> Quiz.rs</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../101/quiz_1.html"><strong aria-hidden="true">2.3.1.</strong> Quiz#1</a></li></ol></li><li class="chapter-item "><a href="../101/exercism.html"><strong aria-hidden="true">2.4.</strong> Exercism</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../101/ex42all-your-base.html"><strong aria-hidden="true">2.4.1.</strong> 42:all-your-base</a></li><li class="chapter-item "><a href="../101/ex43Allergies.html"><strong aria-hidden="true">2.4.2.</strong> 43:Allergies</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">å®è·µğŸŒšğŸŒ˜ğŸŒ—ğŸŒ–ğŸŒ</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../dev/index.html"><strong aria-hidden="true">3.</strong> Rust å¼€å‘</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/dama-projects.html"><strong aria-hidden="true">3.1.</strong> å°ä½œå“</a></li><li class="chapter-item "><a href="../dev/tui4cli.html"><strong aria-hidden="true">3.2.</strong> TUI</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/cli_nnera.html"><strong aria-hidden="true">3.2.1.</strong> ğŸŒ NNera</a></li><li class="chapter-item "><a href="../dev/cli_ferris_art.html"><strong aria-hidden="true">3.2.2.</strong> ğŸŒ– Ferrisè‰ºæœ¯</a></li><li class="chapter-item "><a href="../dev/cli_bxmr.html"><strong aria-hidden="true">3.2.3.</strong> ğŸŒ– BXMr</a></li><li class="chapter-item "><a href="../dev/cli_rss4mdbook.html"><strong aria-hidden="true">3.2.4.</strong> ğŸŒš RSS4mdbook</a></li><li class="chapter-item "><a href="../dev/cli_yuzu.html"><strong aria-hidden="true">3.2.5.</strong> ğŸŒš Yuzu</a></li></ol></li><li class="chapter-item "><a href="../dev/web4async.html"><strong aria-hidden="true">3.3.</strong> å¼‚æ­¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/tokio.html"><strong aria-hidden="true">3.3.1.</strong> Tokio</a></li><li class="chapter-item "><a href="../dev/graphql.html"><strong aria-hidden="true">3.3.2.</strong> GraphQL</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.4.</strong> TTD</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/rust-unit-test-everything-wanted-know.html"><strong aria-hidden="true">3.4.1.</strong> Rust å•å…ƒæµ‹è¯•å¾—çŸ¥é“çš„ä¸€åˆ‡</a></li></ol></li><li class="chapter-item "><a href="../dev/gui4web.html"><strong aria-hidden="true">3.5.</strong> GUI</a></li><li class="chapter-item "><a href="../dev/embedded_rs.html"><strong aria-hidden="true">3.6.</strong> åµŒå…¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/emb_rp2040pico.html"><strong aria-hidden="true">3.6.1.</strong> Pico</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.7.</strong> CI/CD</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/cross-compiling.html"><strong aria-hidden="true">3.7.1.</strong> äº¤å‰ç¼–è¯‘?</a></li></ol></li><li class="chapter-item expanded "><a href="../dev/20-things-ive-learned-in-my-20-years-as-a-software-engineer.html"><strong aria-hidden="true">3.8.</strong> 20å¹´æ¥ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆå­¦åˆ°çš„10ä»¶äº‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dev/concepts-i-wish-i-learned-earlier.html" class="active"><strong aria-hidden="true">3.8.1.</strong> å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">3.9.</strong> å®ç”¨å·¥å…·æ¨è...</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/cli_btm.html"><strong aria-hidden="true">3.9.1.</strong> Bottom</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">å·¥ç¨‹ç»éªŒ</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../tip/index.html"><strong aria-hidden="true">4.</strong> Rust æŠ€èƒ½</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tip/awesome4rs.html"><strong aria-hidden="true">4.1.</strong> Awesome.rs</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tip/aw4rs_handlebars.html"><strong aria-hidden="true">4.1.1.</strong> Handlebars</a></li><li class="chapter-item "><a href="../tip/tracing.html"><strong aria-hidden="true">4.1.2.</strong> tracing åˆæ­¥</a></li><li class="chapter-item "><a href="../tip/open_big_file_speed.html"><strong aria-hidden="true">4.1.3.</strong> æ–‡ä»¶åŠ é€Ÿæ‰“å¼€</a></li></ol></li><li class="chapter-item "><a href="../tip/rust_min_bug_patterns.html"><strong aria-hidden="true">4.2.</strong> BMP:æœ€å°bugæ¨¡å¼</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tip/manag_growing_proj_with_crates_modules.html"><strong aria-hidden="true">4.2.1.</strong> Crateä¸­åˆç†åˆ’åˆ†ç›®å½•</a></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">4.3.</strong> anti-OOP</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tip/default-params.html"><strong aria-hidden="true">4.3.1.</strong> OOP:Rust å’Œé»˜è®¤å‚æ•°</a></li><li class="chapter-item "><a href="../tip/oop-1-encapsulation.html"><strong aria-hidden="true">4.3.2.</strong> Rust è¶…è¶ŠOOP,ç¬¬1éƒ¨åˆ†</a></li><li class="chapter-item "><a href="../tip/oop-2-polymorphism.html"><strong aria-hidden="true">4.3.3.</strong> Rust è¶…è¶ŠOOP,ç¬¬2éƒ¨åˆ†</a></li></ol></li><li class="chapter-item "><a href="../tip/rust6fun-operator-overloading.html"><strong aria-hidden="true">4.4.</strong> è¿ç®—ç¬¦é‡è½½å…­ä»¶è¶£äº‹</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">ç¬”è®°å—¯å“¼</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../log/index.html"><strong aria-hidden="true">5.</strong> ç¬”è®°</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../log/rust101logging.html"><strong aria-hidden="true">5.1.</strong> Rust è¯¾ç¨‹ç¬”è®°</a></li><li class="chapter-item "><a href="../log/rust-s-ugly-syntax.html"><strong aria-hidden="true">5.2.</strong> Rust ä¸‘å¥æ³•</a></li><li class="chapter-item "><a href="../log/graph-rust-move-copy-borrow.html"><strong aria-hidden="true">5.3.</strong> å›¾å½¢æè¿° Rust ä¸­æ‰€æœ‰æƒå’Œå€Ÿç”¨</a></li><li class="chapter-item "><div><strong aria-hidden="true">5.4.</strong> Choaså—¯å“¼</div><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../log/c101.html"><strong aria-hidden="true">5.4.1.</strong> 0åŸºç¡€å…¥é—¨C?</a></li><li class="spacer"></li></ol></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">be Rustaceans</h1>

                <div class="right-buttons">
                    <a href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/zhrust/rustacean/tree/main/src" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <a href="https://github.com/zhrust/rustacean/edit/master/src/dev/concepts-i-wish-i-learned-earlier.md" title="Suggest an edit" aria-label="Suggest an edit">
                        <i id="git-edit-button" class="fa fa-edit"></i>
                    </a>

                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <main>
                    <h1 id="å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ"><a class="header" href="#å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ">å¸Œæœ›ä¸€æ—©çŸ¥é“çš„å…³é”®æ¦‚å¿µ</a></h1>
<p>åŸæ–‡: <a href="https://rauljordan.com/rust-concepts-i-wish-i-learned-earlier/">rauljordan::blog</a></p>
<h2 id="å¿«è¯‘"><a class="header" href="#å¿«è¯‘">å¿«è¯‘</a></h2>
<p>è¿‡å»ä¸€ä¸ªæœˆé‡Œ, æˆ‘è¢« Rust è¯­è¨€å½»åº•è¿·ä½äº†,
å› ä¸º,å¥¹åœ¨ç¼–å†™å†…å­˜å®‰å…¨çš„ç°ä»£ç¨‹åºæ–¹é¢å…·æœ‰ç‹¬ç‰¹çš„ä¼˜åŠ¿.
å¤šå¹´ä»¥æ¥, æœ‰å‡ ç§è¯­è¨€å·²ç»æˆä¸ºå·¥ç¨‹å¸ˆç¼–å†™å¼¹æ€§åç«¯è½¯ä»¶çš„é¦–é€‰è¯­è¨€.
æ½®æµå·²ç»ä» JAVA/C++ è½¬å‘ Go å’Œ Rust,
å¥¹ä»¬ç»“åˆäº†æ•°åå¹´ç¼–ç¨‹è¯­è¨€ç†è®ºæ¥æ„å»ºæˆ‘ä»¬è¿™ä¸ªæ—¶ä»£æœ€éœ€è¦çš„å·¥å…·.</p>
<p>Rust çš„åœ°ä½ä¸è¨€åˆ™æ˜.
ä½œä¸ºæœ€å—ä¸€æ¬¢è¿çš„è¯­è¨€, è¿ç»­7å¹´åº¦åœ¨è‘—å <code>stack overflow</code> è°ƒæŸ¥ä¸­æ’åç¬¬ä¸€!
æœ€è¿‘è¿˜ä½œä¸º Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†å‘å¸ƒ -- è¿™æ˜¯é™¤ C ä¹‹å¤–ä»»ä½•è¯­è¨€ä¹‹å‰éƒ½æ— æ³•ä½œåˆ°çš„å£®ä¸¾.
å¯¹æˆ‘è€Œè¨€, è¿™é—¨è¯­è¨€ä»¤äººå…´å¥‹çš„åœ°æ–¹åœ¨äº,
å¥¹åœ¨è½¯ä»¶æ„å»ºè‰ºæœ¯æ–¹é¢æä¾›äº†ä¸€äº›çœŸæ­£æ–°é¢–çš„ä¸œè¥¿.</p>
<pre><pre class="playground"><code class="language-rust edition2021">use std::thread;
use std::time::Duration;
use std::{collections::VecDeque, sync::Condvar, sync::Mutex};

fn main() {
    let queue = Mutex::new(VecDeque::new());

    thread::scope(|s| {
        let t = s.spawn(|| loop {
            let item = queue.lock().unwrap().pop_front();
            if let Some(item) = item {
                dbg!(item);
            } else {
                thread::park();
            }
        });

        for i in 0.. {
            queue.lock().unwrap().push_back(i);
            t.thread().unpark();
            thread::sleep(Duration::from_secs(1));
        }
    })
}</code></pre></pre>
<p>Rust åœ¨æ•´ä¸ªç³»ç»Ÿç¼–ç¨‹ä¸­è·å¾—äº†ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ä½¿ç”¨, 
ä¹Ÿå› éš¾ä»¥å­¦ä¹ è€Œé—»å. å°½ç®¡å¦‚æ­¤, è¿˜æ˜¯æœ‰å¾ˆå¤šä¼˜ç§€çš„ Rust å†…å®¹å¯ä»¥æ»¡è¶³åˆå­¦è€…å’Œé«˜çº§ç¨‹åºå‘˜çš„éœ€æ±‚.
ç„¶è€Œ, ä»–ä»¬ä¸­å¤ªå¤šäººä¸“æ³¨è§£é‡Šè¯­è¨€çš„æ ¸å¿ƒæœºåˆ¶å’Œæ‰€æœ‰æƒæ¦‚å¿µ, è€Œä¸æ˜¯æ„å»ºåº”ç”¨ç¨‹åº.</p>
<p>ä½œä¸ºä¸€åç¼–å†™é«˜å¹¶å‘ç¨‹åºå¹¶ä¸“æ³¨åœ¨ç³»ç»Ÿç¼–ç¨‹çš„ Go å¼€å‘è€…, 
æˆ‘åœ¨å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Rust æ„å»ºçœŸå®ç¨‹åºçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šéšœç¢. 
ä¹Ÿå°±æ˜¯äº¤ç»‡, å¦‚æœæˆ‘å°†å½“å‰æ­£åœ¨ä»äº‹çš„å·¥ä½œç§»æ¤åˆ° Rust ä¸­, é‚£ä¹ˆæ‰€æœ‰è¿™äº›æ•™ç¨‹çš„æ•ˆæœå¦‚ä½•å‘¢?</p>
<p>æ­¤ç¯‡æ–‡ç« æ—¨åœ¨ä»‹ç»æˆ‘è¿›å…¥ Rust å…”å­æ´çš„ç»å†, 
ä»¥åŠæˆ‘å¸Œæœ›ä¸€äº›å­¦ä¹ èµ„æºå¯ä»¥æ›´å¥½é˜è¿°çš„å†…å®¹. 
å¯¹ä¸ªäººè€Œè¨€, æˆ‘æ— æ³•é€šè¿‡ç®€å•çš„è§‚çœ‹ youtube è§†é¢‘æ¥å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€, 
è€Œæ˜¯å¿…é¡»é€šè¿‡ä¸ºè‡ªå·±å¯»æ‰¾è§£å†³æ–¹æ¡ˆ,çŠ¯é”™ä»¥åŠå¯¹è¿‡ç¨‹æ„Ÿå—è°¦å‘æ¥ç§¯ç´¯ï¼</p>
<h3 id="å…³äºå‚è€ƒ"><a class="header" href="#å…³äºå‚è€ƒ">å…³äºå‚è€ƒ</a></h3>
<p>Rust ä¸­æœ‰ä¸¤ç§å¼•ç”¨, å…±äº«å¼•ç”¨(ä¹Ÿç§°ä¸º <code>å€Ÿç”¨</code>)å’Œå¯å˜å¼•ç”¨(ä¹Ÿç§°ä¸º<code>ç‹¬å å¼•ç”¨</code>).
é€šå¸¸è¿™äº›è¢«è§†ä¸ºå˜é‡ x ä¸Šçš„ &amp;x ä»¥åŠ &amp;mut x . 
ä¸€æ—¦æˆ‘å¼€å§‹å°†åè€…ç§°ä¸º&quot;ç‹¬å®¶å‚è€ƒ&quot;, è¿™ä¸¤ç™½é—´çš„åŒºåˆ«å°±æ›´æœ‰æ„ä¹‰äº†.</p>
<p>Rust çš„å‚è€ƒæ¨¡å‹ç›¸å½“ç®€å•. å€Ÿæ¬¾äººå¯ä»¥æ ¹æ®éœ€è¦æ‹¥æœ‰å¯¹æŸå¯¹è±¡çš„å°½å¯èƒ½å¤šçš„å…±äº«å¼•ç”¨, 
ä½†æ˜¯, ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªç‹¬å å¼•ç”¨. 
å¦åˆ™, ä½ å¯èƒ½ä¼šæœ‰å¾ˆå¤šè°ƒç”¨è€…åŒæ—¶å°è¯•å¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œä¿®æ”¹çš„å›§å¢ƒ;
å¦‚æœå¾ˆå¤šå€Ÿç”¨è€…ä¹Ÿå¯ä»¥æŒæœ‰ç‹¬å è¢­ç”¨, 
ä½ å°†é¢ä¸´æœªå®šä¹‰è¡Œä¸ºé£é™©, 
è€Œå®‰å…¨çš„ Rust åˆ™ä¸å…è®¸è¿™ä¹ˆæŠ˜è…¾.</p>
<p>åœ¨å­¦ä¹  Rust æ—¶, éƒ½ç”¨ &amp;mut ç‹¬å®¶å‚è€ƒå¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Foo {
    x: u64,
}

impl Foo {
    /// Any type that borrows an instance of Foo can
    /// call this method, as it only requires a reference to Foo.
    pub fn total(&amp;self) -&gt; u64 {
        self.x
    }
    /// Only exclusive references to instances of Foo
    /// can call this method, as it requires Foo to be mutable.
    pub fn increase(&amp;mut self) {
        self.x += 1;
    }
}

let foo = Foo { x: 10 };
println!(&quot;{}&quot;, foo.total()) // WORKS.
foo.increase() // ERROR: Foo not declared as mut
<span class="boring">}</span></code></pre></pre>
<h3 id="åŒå‘å¼•ç”¨æ˜¯å¯ä»¥çš„"><a class="header" href="#åŒå‘å¼•ç”¨æ˜¯å¯ä»¥çš„">åŒå‘å¼•ç”¨æ˜¯å¯ä»¥çš„</a></h3>
<blockquote>
<p>Bidirectional references are possible</p>
</blockquote>
<p>åœ¨å…¶å®ƒå…·æœ‰åƒåœ¾æ”¶é›†åŠŸèƒ½çš„è¯­è¨€ä¸­, å¾ˆå®¹æ˜“å®šä¹‰å›¾å½¢æ•°æ®ç»“æ„æˆ–å…¶å®ƒåŒ…å«å¯¹æŸäº›å­é¡¹å¼•ç”¨çš„ç±»å‹, 
å¹¶ä¸”è¿™äº›å¼•ç”¨å¯ä»¥åŒ…å«å¯¹å…¶çˆ¶é¡¹çš„å¼•ç”¨;
åœ¨ Rust ä¸­, å¦‚æœä¸å®Œå…¨ç†è§£å€Ÿç”¨è§„åˆ™, è¿™æ˜¯å¾ˆéš¾ä½œåˆ°çš„;
ä½†æ˜¯, ä»ç„¶å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„æ­£æ³•.</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º Node çš„ç»“æ„, 
åŒ…å«ä¸€ç»„å¯¹å­èŠ‚ç‚¹çš„å¼•ç”¨, ä»¥åŠä¸€ä¸ªå¯¹çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨; 
é€šå¸¸, Rust ä¼šæŠ±æ€¨, ä½†æ˜¯, æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†çˆ¶å¼•ç”¨åŒ…è£…åœ¨ç§°ä¸º <code>å¼±æŒ‡é’ˆ</code> çš„ä¸œè¥¿ä¸­æ¥æ»¡è¶³å€Ÿç”¨æ£€æŸ¥å™¨çš„è¦æ±‚;
è¿™ç§ç±»å‹å‘Šè¯‰ Rust ä¸€ä¸ªèŠ‚ç‚¹æ¶ˆå¤±, æˆ–è€…å…¶å­èŠ‚ç‚¹æ¶ˆå¤±, ä¸åº”è¯¥æ„å‘³ç€çˆ¶èŠ‚ç‚¹ä¹Ÿåº”è¯¥è¢«åˆ é™¤;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::cell::RefCell;
use std::rc::{Rc, Weak};

struct Node {
    value: i32,
    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,
    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ºæˆ‘ä»¬æä¾›äº†æ„å»ºåŒå‘å¼•ç”¨çš„ä¾¿åˆ©åŸè¯­; 
ç„¶è€Œ, æˆ‘å¾ˆå¿«å‘ç°åœ¨ Rust ä¸­æ„å»ºå›¾å½¢æ•°æ®çœŸçš„å¾ˆéš¾, 
é™¤éä½ çœŸçš„çŸ¥é“è‡ªå·±åœ¨ä½œä»€ä¹ˆ, è€ƒè™‘åˆ°ä¸€ä¸ªäººéœ€è¦å›´ç»•æœ‰æ•ˆå»ºæ¨¡æ•°æ®æ¥ä½œå¤§é‡çš„ <code>book-keeping</code> å·¥ä½œä»¥æ»¡è¶³ç¼–è¯‘å™¨.</p>
<p>(æ˜¯ä¹Ÿä¹: ç¼–è¯‘å™¨ä½œä¸º Rust ç”Ÿæ€ä¸­æœ€å¤§çš„ BOSS å¿…é¡»ä¼˜å…ˆæ»¡è¶³.)</p>
<h3 id="å®æ–½-deref-ä»¤ä»£ç æ›´æ¸…æ™°"><a class="header" href="#å®æ–½-deref-ä»¤ä»£ç æ›´æ¸…æ™°">å®æ–½ Deref ä»¤ä»£ç æ›´æ¸…æ™°</a></h3>
<blockquote>
<p>Implement Deref to make your code cleaner</p>
</blockquote>
<p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å°†åŒ…è£…å™¨ç±»å‹è§†ä¹‹ä¸ºå…¶åŒ…å«çš„å†…å®¹;
å¯¹äºå¸¸è§çš„æ•°æ®ç»“æ„(æ¯”å¦‚ vec),æ™ºèƒ½æŒ‡é’ˆ(ä¾‹å¦‚ Box) ç”šè‡³å¼•ç”¨è®¡æ•°ç±»å‹(ç±»ä¼¼ Rc å’Œ Arc) éƒ½æ˜¯å¦‚æ­¤;
æ ‡å‡†åº“åŒ…å«ç§°ä¸º Deref å’Œ DerefMut çš„ç‰¹å¾, 
å¥¹ä»¬å°†æŠ¥æ—¶ä½ å‘Šè¯‰ Rust åº”è¯¥å¦‚ä½•å–æ¶ˆå¼•ç”¨ä¸€ä¸ªç±»å‹;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ops::{Deref, DerefMut};

struct Example&lt;T&gt; {
    value: T
}

impl&lt;T&gt; Deref for Example&lt;T&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;Self::Target {
        &amp;self.value
    }
}

impl&lt;T&gt; DerefMut for Example&lt;T&gt; {
    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {
        &amp;mut self.value
    }
}

let mut x = Example { value: 'a' };
*x = 'b';
assert_eq!('b', x.value);
<span class="boring">}</span></code></pre></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­, æˆ‘ä»¬å¯ä»¥å°† <code>*x</code> è§†ä¸ºå…¶åŸºç¡€å€¼ <code>&quot;a&quot;</code>, 
ç”šè‡³å¯ä»¥æ”¹å˜å®ƒ, å› ä¸º, æˆ‘ä»¬å®šä¹‰äº†åº”è¯¥å¦‚ä½•åœ¨å€Ÿç”¨æˆ–å¯å˜å¼•ç”¨ä¸­å–æ¶ˆå¼•ç”¨çš„è§„åˆ™;
è¿™å¾ˆå¼ºå¤§, ä¹Ÿæ˜¯ä½ æ— éœ€æ‹…å¿ƒåœ¨ Box ç­‰æ™ºèƒ½æŒ‡é’ˆä¸­åŒ…è£…ç±»å‹çš„åŸå› ;</p>
<p>å€¼è¢«è£…ç®±çš„äº‹å®æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚, å¯ä»¥é€šè¿‡è¿™äº›ç‰¹å¾æŠ½è±¡å‡ºæ¥;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
    value: u64,
}
let mut foo = Box::new(Foo { value: 10 });

// Box implements DerefMut, so this will work fine!
*foo = Foo { value: 20 };
// Dot methods will work on foo because Box implements Deref.
// We do not have to worry about the implementation
// detail that Foo is boxed.
assert_eq!(20, foo.value);
<span class="boring">}</span></code></pre></pre>
<h3 id="å°å¿ƒå®ç°-deref-ç±»å‹æ–¹æ³•"><a class="header" href="#å°å¿ƒå®ç°-deref-ç±»å‹æ–¹æ³•">å°å¿ƒå®ç° Deref ç±»å‹æ–¹æ³•</a></h3>
<blockquote>
<p>Be careful with methods on types that implement Deref</p>
</blockquote>
<p>æœ‰æ²¡æœ‰æƒ³è¿‡, ä¸ºä»€ä¹ˆåƒ <code>Arc::clone</code> è¿™ç±»æ–¹æ³•çš„å­˜åœ¨, 
è€Œæˆ‘ä»¬åªèƒ½å¯¹ Arc å€¼æ‰§è¡Œ <code>.clone()</code>?
åŸå› å’Œç±»å‹å¦‚ä½•å®ç° Deref æœ‰å…³, 
è¿™æ˜¯å¼€å‘è€…åº”è¯¥è­¦æƒ•çš„äº‹å„¿;</p>
<p>è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹, æˆ‘ä»¬æ­£åœ¨å°è¯•ä»æ ‡å‡†åº“ä¸­å®ç°æˆ‘ä»¬è‡ªå·±ç‰ˆæœ¬çš„
å¤šç”Ÿäº§è€…/å•ä¸€æ¶ˆè´¹è€…(mpsc)é€šé“:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::sync::{Arc, Mutex, Condvar};

pub struct Sender&lt;T&gt; {
    inner: Arc&lt;Inner&lt;T&gt;&gt;,
}

impl&lt;T&gt; Sender&lt;T&gt; {
    pub fn send(&amp;mut self, t: T) {
        ...
    }
}

impl&lt;T: Clone&gt; Clone for Sender&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        Self {
            // ERROR: Does not know whether to clone Arc or inner!
            inner: self.inner.clone(),
        }
    }
}

struct Inner&lt;T&gt; {
    ...
}

impl&lt;T: Clone&gt; Clone for Inner&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        ...
    }
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­, æˆ‘ä»¬æœ‰ä¸€ä¸ªè¦åœ¨å…¶ä¸Šå®ç° Clone ç‰¹å¾çš„ Sender ç±»å‹;
è¯¥ç»“æ„æœ‰ä¸€ä¸ªåä¸º inner çš„å­—æ®µ, å…¶ç±»å‹ä¸º <code>Arc&lt;Inner&lt;T&gt;&gt;</code> ;
å›æƒ³ä¸€ä¸‹ Arc å·²ç»å®ç°äº† Clone å’Œ Deref ;
æœ€é‡è¦çš„æ˜¯, æˆ‘ä»¬çš„ Inner è¿˜ç°å®äº† Clone ;
å¯¹äºä¸Šé¢çš„ä»£ç , Rust å¹¶ä¸çŸ¥é“æˆ‘ä»¬æ˜¯è¦å…‹éš† Arc è¿˜æ˜¯å®é™…çš„å†…éƒ¨å€¼,
æ‰€ä»¥, ä¸Šé¢ä»£ç ä¼šå¤±è´¥;
åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Arc ä» sync åŒ…ä¸­æä¾›çš„å®é™…æ–¹æ³•;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Clone&gt; Clone for Sender&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        Self {
            // Now Rust knows to use the Clone method of Arc instead of the
            // clone method of inner itself.
            inner: Arc::clone(&amp;self.inner),
        }
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="ç†è§£ä½•æ—¶ä»¥åŠä½•æ—¶ä¸ç”¨å†…éƒ¨å¯å˜æ€§"><a class="header" href="#ç†è§£ä½•æ—¶ä»¥åŠä½•æ—¶ä¸ç”¨å†…éƒ¨å¯å˜æ€§">ç†è§£ä½•æ—¶ä»¥åŠä½•æ—¶ä¸ç”¨å†…éƒ¨å¯å˜æ€§</a></h3>
<blockquote>
<p>Understand when and when not to use interior mutability</p>
</blockquote>
<p>æœ‰æ—¶, ä½ éœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨ Rc æˆ–æ˜¯ Arc ç­‰ç»“æ„, 
åˆæˆ–è€…å®ç°åŒ…è£…ä¸€äº›æ•°æ®ç»“æ„, ç„¶å, åˆæƒ³è¦æ”¹å˜è¢«åŒ…è£…çš„æ•°æ®;
å¾ˆå¿«, ç¼–è¯‘å™¨å°±ä¼šå‘Šè¯‰ä½ , å†…éƒ¨å¯å˜æ€§æ˜¯ä¸å…è®¸çš„, ä¹çœ‹èµ·æ¥è¿™å¾ˆæ£˜æ‰‹;
ç„¶è€Œ, æœ‰ä¸€äº›æ–¹æ³•å…è®¸ Rust ä¸­çš„å†…éƒ¨å¯å˜æ€§, 
ç”šè‡³æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„;</p>
<p>æœ€ç®€å•çš„ä¸€ç§æ˜¯ Cell, å¥¹ä¸ºä½ æä¾›æ•°æ®çš„å†…å¯å˜æ€§;
ä¹Ÿå°±æ˜¯è¯´, å˜¦æ•°æ®å¤åˆ¶æˆæœ¬ä½, 
ä½ å°±å¯ä»¥åœ¨ Rc ä¸­æ”¹å˜æ•°æ®;
ä½ å¯ä»¥é€šè¿‡å°†æ•°æ®åŒ…è£…åœ¨ <code>Rc&lt;Cell&lt;T&gt;&gt;</code> ä¸­æ¥å®ç°è¿™ä¸€ç‚¹;
å¥¹æä¾›äº† get å’Œ set æ–¹æ³•,
ç”šè‡³ä¸éœ€è¦è¢« mut , å› ä¸º, å¥¹ä»¬æ˜¯åœ¨åº•å±‚å¤åˆ¶æ•°æ®çš„:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// impl&lt;T: Copy&gt; Cell&lt;T&gt;
pub fn get(&amp;self) -&gt; T

// impl&lt;T&gt; Cell&lt;T&gt;
pub fn set(&amp;self, val: T)
<span class="boring">}</span></code></pre></pre>
<p>å…¶å®ƒç±»å‹, æ¯”å¦‚ RefCell æœ‰åŠ©äºå°†æŸäº›å€Ÿç”¨æ£€æŸ¥ç§»è‡³è¿è¡Œæ—¶, å¹¶è·³è¿‡ä¸€äº›ç¼–è¯‘å™¨çš„ä¸¥æ ¼è¿‡æ»¤;
ç„¶è€Œ, è¿™æ˜¯æœ‰é£é™©çš„, å› ä¸º, å¦‚æœæ²¡æœ‰å®Œæˆå€Ÿç”¨æ£€æŸ¥, å°±å¯èƒ½åœ¨è¿è¡Œæ—¶è§¦å‘ panic ;
å°†ç¼–è¯‘å™¨å½“æˆæœ‹å‹, ä½ ä¼šè·å¾—å›æŠ¥;
é€šè¿‡è·³è¿‡ç¼–è¯‘å™¨æ£€æŸ¥, æˆ–æ˜¯å°†å¥¹ä»¬æ¨è¿Ÿåˆ°è¿è¡Œæ—¶, 
ç­‰äºå‘Šè¯‰ç¼–è¯‘å™¨&quot;ç›¸ä¿¡æˆ‘ --- æˆ‘ä½œçš„éƒ½æ˜¯æ­£ç¡®çš„&quot;;</p>
<p>è€Œ std::cell åŒ…ç”šè‡³é€šè¿‡ä¸€ä¸ªå¾ˆæœ‰å¸®åŠ©çš„æ¶ˆæ¯è­¦å‘Šæˆ‘ä»¬:</p>
<pre><code>
æ›´å¸¸è§çš„ç»§æ‰¿å¯å˜æ€§, å…¶ä¸­å¿…é¡»å…·æœ‰å”¯ä¸€è®¿é—®æƒé™æ‰èƒ½æ”¹å˜å€¼,
è¿™ä¸€è¯­è¨€å…ƒç´ æ˜¯ä»¤ Rust èƒ½å¼ºåŠ›æ¨ç†æŒ‡é’ˆåˆ«å, é™æ€é˜²æ­¢å´©æºƒé”™è¯¯çš„å…³é”®;
å› æ­¤, ç»§ç»­å¯å˜æ€§æ˜¯é¦–é€‰, å†…éƒ¨å¯å˜æ€§æ˜¯æœ€åçš„æ‰‹æ®µ;
ç”±äº Cell ç±»å‹å¯ä»¥åœ¨ä¸å…è®¸çªå˜çš„åœ°æ–¹å¯ç”¨çªå˜, 
å› æ­¤, åœ¨æŸäº›æƒ…å†µä¸­, å†…éƒ¨å¯å˜æ€§ä¹Ÿè®¸æ˜¯åˆé€‚çš„, ç”šè‡³å¿…é¡»ä½¿ç”¨, ä¾‹å¦‚:

- åœ¨ä¸å¯å˜äº‹ç‰©çš„&quot;å†…éƒ¨&quot;å¼•å…¥å¯å˜æ€§
- é€»è¾‘ä¸å¯å˜æ–¹æ³•çš„å®ç°ç»†èŠ‚
- å…‹éš†çš„å˜å¼‚å®ç°

</code></pre>
<h3 id="get-å’Œ-get-mut-æ–¹æ³•æ˜¯ä¸€å›äº‹å„¿"><a class="header" href="#get-å’Œ-get-mut-æ–¹æ³•æ˜¯ä¸€å›äº‹å„¿">get å’Œ get mut æ–¹æ³•æ˜¯ä¸€å›äº‹å„¿</a></h3>
<blockquote>
<p>Get and get mut methods are a thing</p>
</blockquote>
<p>å¾ˆå¤šç±»å‹, åŒ…å« vec éƒ½å®ç°äº† get ä¸ get_mut æ–¹æ³•,
è®©ä½ å¯ä»¥å€Ÿç”¨å’Œæ”¹å˜ç»“æ„ä¸­çš„å…ƒç´ 
(å‰è€…åªæœ‰åœ¨ä½ æœ‰ä¸€ä¸ªå¯¹é›†ä¼šçš„å¯å˜å¼•ç”¨æ—¶æ‰å¯èƒ½);
æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´, æ‰çŸ¥é“è¿™äº›é€‰é¡¹å¯ç”¨äºè®¸å¤šæ•°æ®ç»“æ„,
å¥¹ä»¬é€šè¿‡æ›´è½»æ¾çš„ç¼–å†™å¹²å‡€çš„ä»£ç , å¸®åŠ©æˆ‘çš„ç”Ÿæ´»æ›´è½»æ¾!</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = &amp;mut [0, 1, 2];

if let Some(elem) = x.get_mut(1) {
    *elem = 42;
}
assert_eq!(x, &amp;[0, 42, 2]);
<span class="boring">}</span></code></pre></pre>
<h3 id="æ‹¥æŠ±ä¸å®‰å…¨ä½†åˆç†çš„ä»£ç "><a class="header" href="#æ‹¥æŠ±ä¸å®‰å…¨ä½†åˆç†çš„ä»£ç ">æ‹¥æŠ±ä¸å®‰å…¨ä½†åˆç†çš„ä»£ç </a></h3>
<blockquote>
<p>Embrace unsafe but sound code</p>
</blockquote>
<p>ä½œä¸ºä¸€å Go å¼€å‘è€…, &quot;unsafe&quot; åŒ…æ€»æ˜¯æ„Ÿè§‰å¾ˆä¸é è°±,
è€Œä¸”æˆ‘å¾ˆå°‘æ¥è§¦;
ç„¶è€Œ, Rust ä¸­ â€œunsafeâ€ çš„æ¦‚å¿µæ˜¯å®Œå…¨ä¸åŒçš„;
äº‹å®ä¸Š, å¾ˆå¤šæ ‡å‡†åº“éƒ½ä½¿ç”¨ <code>â€œunsafeâ€</code> æ¥å–å¾—å·¨å¤§æˆåŠŸ!</p>
<p>è¿™æ€ä¹ˆå¯èƒ½? å°½ç®¡ Rust ä½¿æœªå®šä¹‰çš„è¡Œä¸ºæˆä¸ºä¸å¯èƒ½,
ä½†æ˜¯, è¿™ä¸é€‚ç”¨äºæ ‡è®°ä¸º â€œunsafeâ€ çš„ä»£ç å—;
ç›¸å, ç¼–å†™ â€œunsafeâ€ Rust çš„å¼€å‘è€…å˜¦ä¿è¯å…¶ä½¿ç”¨åˆç†,
å³å¯è·å¾—æ‰€æœ‰å¥½å¤„;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Example taken from the Rustonomicon
fn item_at_index(idx: usize, arr: &amp;[u8]) -&gt; Option&lt;u8&gt; {
    if idx &lt; arr.len() {
        unsafe {
            Some(*arr.get_unchecked(idx))
        }
    } else {
        None
    }
}
<span class="boring">}</span></code></pre></pre>
<p>å˜¦ä½ èƒ½è¯æ˜ä½ çš„ API æ˜¯å¯é çš„,
å°±æ¥å— unsafe, ä½†æ˜¯, è¦é¿å…é€ˆä½ çš„æ¶ˆè´¹è€…æš´éœ² unsafe å‡½æ•°,
é™¤éæ˜¯çœŸæ­£æœ‰ä¿è¯çš„;
å‡ºäºè¿™ä¸ªåŸå› , åœ¨ Rust ä¸­,å¯¹ä½ çš„åŒ…å†…éƒ¨è¿›è¡Œä¸¥æ ¼æ§åˆ¶,
å¯ä»¥è¯æ˜ unsafe ä»£ç å—æ˜¯åˆç†çš„äº†;</p>
<p>é€šå¸¸åœ¨æ€§èƒ½ç»å¯¹é‡è¦çš„æƒ…å†µä¸‹, æ‰ä½¿ç”¨ unsafe,
æˆ–è€…å½“ä½ çŸ¥é“ä½¿ç”¨ unsafe ä»£ç å—æ˜¯è§£å†³é—®é¢˜çš„ç®€å•æ–¹æ³•,
å¹¶ä¸”å¯ä»¥è¯æ˜ä»£ç çš„å¯é æ€§æ—¶;</p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>å®‰å…¨å’Œå¯é åˆ†ç¦», é‚£ä¹ˆ, ä»€ä¹ˆæ˜¯å¯é å‘¢?</p>
<p>)</p>
<h3 id="å°½å¯èƒ½ç”¨-impl-ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯é€šç”¨çº¦æŸ"><a class="header" href="#å°½å¯èƒ½ç”¨-impl-ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯é€šç”¨çº¦æŸ">å°½å¯èƒ½ç”¨ impl ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯é€šç”¨çº¦æŸ</a></h3>
<p>è¿™ç‚¹æ¥è‡ª Golang, æˆ‘è®¤ä¸ºç‰¹å¾å¯ä»¥ä¸€ç›´ç®€å•çš„ä½œä¸ºå‡½æ•°å‚æ•°æ¥æä¾›;
æ¯”å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Meower {
    fn meow(&amp;self);
}

struct Cat {}

impl Meower for Cat {
    fn meow(&amp;self) {
        println!(&quot;meow&quot;);
    }
}

// ERROR: Meower cannot be used as it does not have
// a size at compile time!
fn do_the_meow(meower: Meower) {
    meower.meow();
}
<span class="boring">}</span></code></pre></pre>
<p>...ä½†æ˜¯,ä¸Šè¿°ä»£ç å¤±è´¥äº†,
å› ä¸º, trait å¯¹è±¡åœ¨ç¼–è¯‘æ—¶æ²¡æœ‰ Rust å®Œæˆå·¥ä½œéœ€è¦çš„å†…å­˜å°ºå¯¸;
æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  <code>&amp;dyn Meower</code> æ¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯åŠ¨æ€è°ƒæ•´å¤§å°æ¥ç»•è¿‡,
ä½†æ˜¯, å¾ˆå¿«æˆ‘äº†è§£åˆ°è¿™ä¸æ˜¯ <code>rusty</code>/é”ˆèŒƒå„¿ è§£å†³æ–¹æ¡ˆ;
ç›¸å,å¼€å‘è€…å€¾å‘äºè¡–å—ç‰¹å¾çº¦æŸçš„é€šç”¨å‚æ•°,
ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn do_the_meow&lt;M: Meower&gt;(meower: M) {
    meower.meow();
}
<span class="boring">}</span></code></pre></pre>
<p>...ç°åœ¨èƒ½é€šè¿‡ç¼–è¯‘äº†;
ç„¶è€Œ,éšç€å‡½æ•°è¶Šæ¥è¶Šå¤æ‚, å¦‚æœæˆ‘ä»¬è¿˜åŒ…æ‹¬å…¶å®ƒé€šç”¨å‚æ•°,
å°±å¯èƒ½ä¼šæœ‰ä¸€ä¸ªéå¸¸éš¾ä»¥é˜…è¯»çš„å‡½æ•°å£°æ˜;
åœ¨æ­¤ç¤ºä¾‹ä¸­,å¦‚æœæˆ‘ä»¬åªæƒ³ç”¨ä¸€æ¬¡ meow,
é‚£ä¹ˆ, å®é™…ä¸Šå¹¶ä¸éœ€è¦åŠ¨ç”¨æ³›å‹;
æˆ‘ä»¬ç”šè‡³äºå¹¶ä¸å…³å¿ƒ meow çš„ç»“æœ,
æ‰€ä»¥, å¯ä»¥æ”¹å†™ä¸ºè¿™æ ·:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn do_the_meow(meower: &amp;impl Meower) {
    meower.meow();
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™æ ·å‘Šè¯‰ç¼–è¯‘å™¨:&quot;æˆ‘åªæƒ³è¦å®ç° Meow çš„ä¸œè¥¿&quot;;
å½“ç„¶,è¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„,
å¹¶ä¸”,é¦–å…ˆä¸éœ€è¦å‡½æ•°çš„é€šç”¨è¿”å›ç±»å‹æ—¶,
æ­¤æ¨¡å¼ä¼šæ›´åŠ æ¸…æ™°;</p>
<h3 id="ç”¨-iter-è¿‡ç¨‹ä¸­æƒ³å€Ÿç”¨æ—¶-iter-mut-ç”¨ä»¥ç‹¬å -refsè€Œ-into-iter-æ”¯æŒæ‹¥æœ‰"><a class="header" href="#ç”¨-iter-è¿‡ç¨‹ä¸­æƒ³å€Ÿç”¨æ—¶-iter-mut-ç”¨ä»¥ç‹¬å -refsè€Œ-into-iter-æ”¯æŒæ‹¥æœ‰">ç”¨ iter() è¿‡ç¨‹ä¸­æƒ³å€Ÿç”¨æ—¶, iter mut() ç”¨ä»¥ç‹¬å  refs,è€Œ into iter() æ”¯æŒæ‹¥æœ‰</a></h3>
<p>å¾ˆå¤šæ•™ç¨‹ç«‹å³è·³è½¬åˆ°ä½¿ç”¨ä¸‹é¢çš„ into_iter æ–¹æ³•æ¥è¿­ä»£ vectors/å‘é‡:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let items = vec![1, 2, 3, 4, 5];
for item in items.into_iter() {
    println!(&quot;{}&quot;, item);
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶è€Œ,å½“æˆ‘ä»¬åˆšåˆšå¼€å§‹åœ¨ç»“æ„ä¸­ä½¿ç”¨è¿™ä¸ªè¿­ä»£å™¨æ–¹æ³•æ—¶,
å¾ˆå¤šåˆå­¦è€…(åŒ…æ‹¬ä½œè€…è‡ªå·±)éƒ½ç¢°å£äº†,ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
    bar: Vec&lt;u32&gt;,
}

impl Foo {
    fn all_zeros(&amp;self) -&gt; bool {
        // ERROR: Cannot move out of self.bar!
        self.bar.into_iter().all(|x| x == 0)
    }
}
<span class="boring">}</span></code></pre></pre>
<p>å¹¶ç«‹å³æç¤º:</p>
<pre><code>    error[E0507]: cannot move out of `self.bar` which is behind a shared reference
       --&gt; src/main.rs:9:9
        |
    9   |         self.bar.into_iter().all(|x| x == 0)
        |         ^^^^^^^^ ----------- `self.bar` moved due to this method call
        |         |
        |         move occurs because `self.bar` has
        |         type `Vec&lt;u32&gt;`, which does not implement the `Copy` trait

</code></pre>
<p>ä½œä¸ºèœé¸Ÿå°è¯•äº†å¾ˆå¤šåŠæ³•å, æ‰æ„è¯†åˆ° <code>.into_ter()</code> å–å¾—äº†é›†åˆçš„æ‰€æœ‰æƒ,
è¿™ä¸æ˜¯æˆ‘çš„ç›®æ ‡æ‰€éœ€è¦çš„;
ç›¸å, åœ¨è¿­ä»£å™¨ä¸Šè¿˜æœ‰å¦å¤–ä¸¤ç§æœ‰ç”¨çš„æ–¹æ³•, çœŸå¸Œæœ›å½“æ—¶èƒ½æ—©ç‚¹çŸ¥é“ä¸«ä»¬;</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯ <code>.iter()</code> ,å€Ÿç”¨é›†åˆ, è®©ä½ æ–­è¨€å…³äºå…¶å€¼çš„ä¸œè¥¿,ä½†æ˜¯, ä¸æ‹¥æœ‰æˆ–æ˜¯æ”¹å˜å¥¹ä»¬;
å†æœ‰å°±æ˜¯ <code>iter_mut()</code> å¸®åŠ©ä½ æ”¹å˜é›†åˆå†…éƒ¨å€¼,å˜¦ä½ æ˜¯å”¯ä¸€çš„exclusive reference/ç‹¬å å‚è€ƒ;</p>
<p>æ€»ä¹‹, å½“ä½ åªéœ€è¦å€Ÿç”¨æ—¶ç”¨ <code>.iter()</code>,
å½“ä½ æƒ³è¦è·å¾—æ‰€æœ‰æƒæ—¶ç”¨ <code>.into_iter()</code>,
å½“ä½ éœ€è¦æ”¹å˜è¿­ä»£å¯¹è±¡çš„å…ƒç´ æ—¶ç”¨ <code>.iter_mut()</code>;</p>
<h3 id="phantom-æ•°æ®ä¸ä»…ä»…ç”¨ä»¥å¤„ç†æŒ‡å‘ç±»å‹çš„åŸå§‹æŒ‡é’ˆ"><a class="header" href="#phantom-æ•°æ®ä¸ä»…ä»…ç”¨ä»¥å¤„ç†æŒ‡å‘ç±»å‹çš„åŸå§‹æŒ‡é’ˆ">Phantom æ•°æ®ä¸ä»…ä»…ç”¨ä»¥å¤„ç†æŒ‡å‘ç±»å‹çš„åŸå§‹æŒ‡é’ˆ</a></h3>
<p>å½“ä½ ç¬¬ä¸€æ¬¡é‡åˆ° Phantom data/å¹»æ•°æ®æ—¶,
ä¸€å®šæ„Ÿè§‰å¾ˆå¥‡æ€ª,ä½†æ˜¯, å¾ˆå¿«å°±ä¼šæˆä¸ºä¸€ç§å‘Šè¯‰ç¼–è¯‘å™¨&quot;æ‹¥æœ‰&quot;æŸä¸ªå€¼çš„å¥½æ–¹å¼,
å°½ç®¡åªæœ‰ä¸€ä¸ªæŒ‡å‘å¥¹çš„åŸå§‹æŒ‡é’ˆ;
ä¾‹å¦‚:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::marker;

struct Foo&lt;'a, T: 'a&gt; {
    bar: *const T,
    _marker: marker::PhantomData&lt;&amp;'a T&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™å„¿å‘Šè¯‰ç¼–è¯‘å™¨ Foo æ‹¥æœ‰ T,
å°½ç®¡åªæœ‰ä¸€ä¸ªæŒ‡å‘å¥¹çš„åŸå§‹æŒ‡é’ˆ;
è¿™å¯¹äºéœ€è¦å¤„ç†åŸå§‹æŒ‡é’ˆå’Œä½¿ç”¨ unsafe Rust çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰å¸®åŠ©;</p>
<p>ä½†æ˜¯, ä¹Ÿå¯ä»¥æ˜¯ä¸€ç§å‘Šè¯‰ç¼–è¯‘å™¨ä½ çš„ç±»å‹è¿˜æ²¡å®ç° Send æˆ–æ˜¯ Sync ç‰¹å¾çš„æ–¹æ³•!
ä½ å¯ä»¥ä½¿ç”¨ PhantomData åŒ…è£…ä»¥ä¸‹ç±»å‹,å¹¶åœ¨ä½ çš„ç»“æ„ä¸­ä½¿ç”¨å¥¹ä»¬,
æ¥ä½œä¸ºä¸€ç§æ–¹å¼å‘Šè¯‰ç¼–è¯‘å™¨ä½ çš„ç»“æ„å³ä¸æ˜¯ Send ä¹Ÿä¸æ˜¯ Sync;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub type PhantomUnsync = PhantomData&lt;Cell&lt;()&gt;&gt;;
pub type PhantomUnsend = PhantomData&lt;MutexGuard&lt;'static, ()&gt;&gt;;
<span class="boring">}</span></code></pre></pre>
<h3 id="ç”¨-rayon-å®ç°å¹¶è¡Œå¢é‡"><a class="header" href="#ç”¨-rayon-å®ç°å¹¶è¡Œå¢é‡">ç”¨ rayon å®ç°å¹¶è¡Œå¢é‡</a></h3>
<p>æœ‰æ—¶, ä½ å¸Œæœ›åœ¨éå†é›†ä¼šæ—¶å¹¶è¡ŒåŒ–å·¥ä½œ,
ä½†æ˜¯, åœ¨å¤„ç†çº¿ç¨‹å’Œç¡®ä¿ç±»å‹å¯ä»¥å®‰å…¨çš„è·¨çº¿ç¨‹å‘é€æ—¶å´ç¢°å£äº†;
æœ‰æ—¶, å¦‚æœé¢å¤–çš„æ ·æ¿æ–‡ä»¶ä»¤ä½ çš„ä»£ç å‡ ä¹ä¸å¯è¯»,é‚£å°±å·²ç»ä¸å€¼å¾—äº†;</p>
<p>ç›¸å, æœ‰ä¸€ä¸ªåä¸º Rayon å¾ˆèµçš„åŒ…, å·²ç»æä¾›äº†ä»¥æ— ç¼æ–¹å¼å¹¶è¡ŒåŒ–è®¡ç®—çš„ä¸Šå¥½å·¥å…·;
ä¾‹å¦‚,å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡ç®—æ•°ç»„å¹³æ–¹å’Œçš„å‡½æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn sum_of_squares(input: &amp;[i32]) -&gt; i32 {
    input.iter()
            .map(|i| i * i)
            .sum()
}
<span class="boring">}</span></code></pre></pre>
<p>ç”±äºä¹˜æ³•å’ŒåŠ æ³•çš„æ€§è´¨, ä¸Šè¿°ä»£ç ç»å¯¹å¯ä»¥å¹¶è¡ŒåŒ–,
Rayon é€šè¿‡è®©æˆ‘ä»¬è‡ªåŠ¨è®¿é—®æ•°ç»„ç­‰é›†ä¼šçš„&quot;å¹¶è¡Œè¿­ä»£å™¨&quot;,
ä½¿å¹¶è¡ŒåŒ–å˜å¾—å¾®ä¸è¶³é“;
è¿™æ˜¯å‡ ä¹é›¶æ ·æ¿çš„ä»£ç ;
è€Œä¸”ä¹Ÿå®Œå…¨ä¸å½±å“å¯è¯»æ€§:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Importing rayon prelude is what gives us access to .par_iter on arrays.
use rayon::prelude::*;

fn sum_of_squares(input: &amp;[i32]) -&gt; i32 {
    // We can use par_iter on our array to let rayon
    // handle the parallelization and reconciliation of
    // results at the end.
    input.par_iter()
            .map(|i| i * i)
            .sum()
}
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p>å·¥ç¨‹ä¸­å¦‚æœè‡ªå·±è¦æ„é€ å„ç§å†…éƒ¨åº“,
ä¹Ÿå€¼å¾—ç»™å‡ºè¿™ç§ä½¿ç”¨ç•Œé¢,
å’Œä»¥å¾€ä½¿ç”¨å†…ç½®åº“çš„ä»£ç å®Œå…¨å…¼å®¹,
åªæ˜¯åœ¨å…³é”®èŠ‚ç‚¹å¤„æ›¿æ¢ä¸ºè‡ªå·±é­”æ”¹/åŠ å¼ºè¿‡çš„...
)</p>
<h3 id="å¼€å‘-rust-åº“æ—¶ç†è§£-æ‹“å±•ç‰¹å¾-çš„æ¦‚å¿µ"><a class="header" href="#å¼€å‘-rust-åº“æ—¶ç†è§£-æ‹“å±•ç‰¹å¾-çš„æ¦‚å¿µ">å¼€å‘ Rust åº“æ—¶ç†è§£ æ‹“å±•ç‰¹å¾ çš„æ¦‚å¿µ</a></h3>
<p>é‚£ä¹ˆ Rayon æ˜¯å¦‚ä½•ä»¥å¦‚æ­¤å¹²å‡€çš„æ–¹å¼å®Œæˆä¸Šè¿°å·¥ä½œçš„å‘¢?
ç­”æ¡ˆåœ¨äº&quot;æ‹“å±•ç‰¹å¾&quot;,
è¿™äº›ç‰¹å¾å¯ä»¥å®šä¹‰ä¸ºå¯¹å…¶å®ƒç‰¹å¾çš„æ‹“å±•,
ä¾‹å¦‚ Iterator;
ä¹Ÿå°±æ˜¯è¯´,æˆ‘ä»¬å¯ä»¥é€ˆé€šå¸¸å®ç° Itertor ç‰¹å¾çš„é¡¹è¿½åŠ å…¶å®ƒæœ‰ç”¨çš„å‡½æ•°,
ä½†æ˜¯, å¥¹ä»¬åªæœ‰åœ¨ç‰¹æ€§èŒƒç•´ä»¥å†…æ—¶æ‰å¯ç”¨,
æ¯”å¦‚é€šè¿‡å°†å…¶å¯¼å…¥æ–‡ä»¶ä¸­;</p>
<p>è¿™ç§æ–¹å¼éå¸¸å¥½,å› ä¸º,è¿™äº›ç‰¹å¾åªæœ‰åœ¨ä½ åœ¨é¡¹ç›®ä¸­å¯¼å…¥æ‹“å±•ç‰¹å¾æ—¶æ‰å¯ç”¨,
å¹¶æä¾›äº†ä¸€ç§ä½¿ç”¨å¹²å‡€çš„ API æ‹“å±•é€šç”¨é›†åˆå’Œç±»å‹çš„å¥½æ–¹æ³•,
å¼€å‘è€…å¯ä»¥åƒä½¿ç”¨æ™®é€š API ä¸€æ ·è½»æ¾çš„ä½¿ç”¨è¿™äº› API;
ç”±äº Rayon çš„æ‹“å±•ç‰¹å¾,
ä½¿ç”¨å¹¶è¡Œè¿­ä»£å™¨å°±åƒåœ¨ Rust ä¸­ä½¿ç”¨æ™®é€šè¿­ä»£å™¨ä¸€æ ·ç®€å•;</p>
<p>äº‹å®ä¸Š,è¿™æœ‰ä¸€ä¸ªä¿¡æ¯é‡å¾ˆå¤§çš„æ¼”è®²,è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ æ‹“å±•ç‰¹å¾ æ¥å¼€å‘ä¸€ä¸ªåœ¨è¿­ä»£å™¨ä¸Šæä¾›è¿›åº¦æ¡çš„åº“;</p>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p><a href="https://www.youtube.com/watch?v=bnnacleqg6k">&quot;Type-Driven API Design in Rust&quot; by Will Crichton - YouTube</a></p>
<p>é…å¥—çœ‹çœ‹ Rayon å®˜æ–¹å¯¹è‡ªå·±å®ç°åŸç†çš„å—¯å“¼: <a href="https://github.com/rayon-rs/rayon/tree/master/src/iter/plumbing">rayon/src/iter/plumbing at master Â· rayon-rs/rayon</a>
ä»¥åŠä¸“é—¨çš„è§£ææ–‡ç« : <a href="https://developers.redhat.com/articles/2023/01/30/run-app-under-openshift-service-mesh">How Rust supports Rayon's data parallelism | Red Hat Developer</a></p>
<p>å¤§çº¦å¯ä»¥æ„Ÿå—åˆ° Rust ä¸–ç•Œçš„ä»»æ€§äº†...
)</p>
<h3 id="æ‹¥æŠ±-option-å’Œ-result-ç±»å‹çš„ä¸€å…ƒæ€§"><a class="header" href="#æ‹¥æŠ±-option-å’Œ-result-ç±»å‹çš„ä¸€å…ƒæ€§">æ‹¥æŠ± Option å’Œ Result ç±»å‹çš„ä¸€å…ƒæ€§</a></h3>
<p>ä½¿ç”¨ Option å’Œ Result ä¹‹å,
äººä»¬ä¼šå¾ˆå¿«çœ‹åˆ°<code>.unwrap()</code> å°†å€¼ä»å¥¹ä»¬ç§»å‡º,
å¦‚æœ Option å’Œ Result æ˜¯å…±äº«å¼•ç”¨(æ¯”å¦‚ struct)çš„ä¸€éƒ¨åˆ†,
å°±å°†å¯¼è‡´å¤±è´¥;
ç„¶è€Œ,æœ‰æ—¶æˆ‘ä»¬æƒ³è¦çš„åªæ˜¯æ–­è¨€ Option åŒ¹é…å†…éƒ¨çš„å€¼æˆ–è·å–å¯¹å…¶å†…éƒ¨çš„å¼•ç”¨;
æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ä½œåˆ°è¿™ç‚¹,
ä½†æ˜¯, è¿˜æœ‰ä¸€ç§æ–¹å¼èƒ½ä¸ç”¨ç¦»å¼€ Option é¢†åŸŸ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn check_five(x: Option&lt;i32&gt;) -&gt; bool {
    // Contains can just check if the Option has what we want.
    x.contains(&amp;5)
}
<span class="boring">}</span></code></pre></pre>
<p>å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯æˆ‘ä»¬æƒ³è¦ç”¨ None å€¼æ›¿æ¢ Option å†…æ•°æ®,
ä¹Ÿå°±æ˜¯å’ŒæŸäº›ç»“æ„äº¤äº’æ—¶;
æˆ‘ä»¬å¯ä»¥ç”¨æŒ‡ä»¤å¼ç¼–ç¨‹çš„æ–¹å¼æ¥ç¼–å†™,
å¹¶æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¯¦ç»†å®Œæˆ:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo {
    data: Option&lt;T&gt;,
}

impl&lt;T&gt; Foo&lt;T&gt; {
    // Takes the value of data and leaves None in its place.
    fn pop(&amp;mut self) -&gt; Option&lt;T&gt; {
        if self.data.is_none() {
            return None;
        }
        let value = self.data.unwrap();
        self.data = None;
        value
    }
}
<span class="boring">}</span></code></pre></pre>
<p>ç„¶è€Œ, Option æœ‰ä¸€äº›éå¸¸é…·çš„å±æ€§,
å› ä¸º, å¥¹ä»¬çš„åŸºæœ¬æ€§è´¨æ˜¯å®šä¹‰äº†æœ‰ç”¨çš„æ–¹æ³•,
å¯ä»¥è®©æˆ‘ä»¬çš„ç”Ÿæºæ›´åŠ è½»æ¾;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Takes the value of data and leaves None in its place.
fn pop(&amp;mut self) -&gt; Option&lt;T&gt; {
    self.data.take()
}
<span class="boring">}</span></code></pre></pre>
<p>Rust ä¸­çš„ Option ä»¥å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ç›¸åŒçš„èŒƒä¾‹ä¸ºæ¨¡å‹,
å±äºæ›´å¹¿æ³›çš„æ•°æ®ç±»å‹ç±»åˆ«, ç§°ä¸º Monad;
ä¸ç”¨æ·±å…¥ç†è§£ Monad æ˜¯ä»€ä¹ˆ, è€Œå˜¦å°†å…¶è§†ä¸ºæ•°æ®çš„åŒ…è£…å™¨,
æˆ‘ä»¬å¯ä»¥åœ¨ä¸éœ€è¦ä»ä¸­å–å‡ºä¸œè¥¿çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œæ“ä½œ;
æ¯”å¦‚, æƒ³è±¡ä¸€ä¸ªå°†ä¸¤ä¸ª Option å†…éƒ¨å€¼ç›¸åŠ å¹¶è¿”å›ä¸€ä¸ª Option çš„å‡½æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add(x: Option&lt;i32&gt;, y: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
    if x.is_none() || y.is_none() {
        return None;
    }
    return Some(x.unwrap() + y.unwrap());
}
<span class="boring">}</span></code></pre></pre>
<p>ä¸Šè¿°ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹ç‚¹ç¬¨æ‹™,å› ä¸º,éœ€è¦æ‰§è¡Œ none æ£€éªŒ,
è€Œä¸”æˆ‘ä»¬å¿…é¡»ä»ä¸¤ä¸ª Option ä¸­æå–å€¼å¹¶ä»ä¸­æ„å»ºä¸€ä¸ªæ–° Option å°±å¾ˆå›§;
ç„¶è€Œ, ç”±äº Option çš„ç‰¹æ®Šå±æ€§,
æˆ‘ä»¬å¯ä»¥ä½œçš„æ›´å¥½!
è¿™æ˜¯æˆ‘ä»¬å¯ä»¥è·å¾—çš„:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add(x: Option&lt;i32&gt;, y: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; {
    x.zip(y).map(|(a, b)| a+b)
}
<span class="boring">}</span></code></pre></pre>
<p>å¯ä»¥å¯¹ option ä½¿ç”¨ zip å’Œ map ,
å°±åƒæˆ‘ä»¬å¯ä»¥å¤„ç†æ•°ç»„å’Œå‘é‡ä¸€æ ·;
æ­¤å±æ€§ä¹Ÿå­˜åœ¨äº Result ç±»å‹ä¸­,
ç”šè‡³å­˜åœ¨äºè¯¸å¦‚ <code>Future</code> ç±»å‹ä¹‹ç±»äº‹ç‰©ä¸­;
å¦‚æœä½ å¯¹ä¸ºä»€ä¹ˆè¿™ä¹ˆä½œæ„Ÿåˆ°å¥½å¥‡,
è¯·ç»§ç»­æŒ–æ˜ Monad çš„æ›´å¤šä¿¡æ¯ -&gt; <a href="https://stackoverflow.com/questions/2704652/monad-in-plain-english-for-the-oop-programmer-with-no-fp-background">functional programming - Monad in plain English? (For the OOP programmer with no FP background) - Stack Overflow</a></p>
<p>æ¥å— Option å’Œ Result ç±»å‹çš„ä¸€å…ƒæ€§è´¨,
ä¸è¦åˆ°å¤„ä½¿ç”¨ unwrap å’Œ if x.is_none() {} else ;
æœ¬èº«å°±åŒ…å«äº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•,
ä½ å¯ä»¥åœ¨æ ‡å‡†åº“ä¸­é˜…è¯»è¿™äº›æ–¹æ³•;</p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>æ‰€ä»¥, æ ‡å‡†åº“çš„é€šè¯»æ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸäº†,
ä¸è¿‡, ç›¸æ¯” Python ç­‰å…¶å®ƒè¯­è¨€çš„å®˜æ–¹æ–‡æ¡£,
docs.rs å®åœ¨å¤ªéº»äº†ç‚¹å„¿,è¿˜è¦ä¹ æƒ¯ä¸€ä¸‹;</p>
<p>)</p>
<h3 id="äº†è§£-drop-åº”è¯¥å¦‚ä½•é’ˆå¯¹ä¸åŒæ•°æ®ç»“æ„å®ç°"><a class="header" href="#äº†è§£-drop-åº”è¯¥å¦‚ä½•é’ˆå¯¹ä¸åŒæ•°æ®ç»“æ„å®ç°">äº†è§£ Drop åº”è¯¥å¦‚ä½•é’ˆå¯¹ä¸åŒæ•°æ®ç»“æ„å®ç°</a></h3>
<p>æ ‡å‡†åº“å°† Drop ç‰¹æ€§æè¿°ä¸º:</p>
<p>å½“ä¸å†éœ€è¦æŸä¸ªå€¼æ—¶, Rust å°†å¯¹è¯¥å€¼è¿è¡Œ&quot;ææ„å‡½æ•°&quot;;
ä¸å†éœ€è¦æŸä¸ªå€¼æœ€å¸¸è§æ–¹å¼æ˜¯è¶…å‡ºä½œç”¨åŸŸ;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Drop {
    fn drop(&amp;mut self);
}
<span class="boring">}</span></code></pre></pre>
<p>åœ¨ Rust ä¸­ç¼–å†™æ•°æ®ç»“æ„æ—¶, Drop æ˜¯è‡³å…³é‡è¦çš„;
äººä»¬å¿…é¡»æœ‰ä¸€ç§åˆç†çš„æ–¹æ³•æ¥å¤„ç†ä¸€æ—¦ä¸å†éœ€è¦å†…å­˜æ—¶å¦‚ä½•ä¸¢å¼ƒ(å®‰å…¨çš„);
ä½¿ç”¨å¼•ç”¨è®¡æ•°ç±»å‹å¯ä»¥æŠ¥æ—¶ä½ å…‹æœè¿™äº›éšœç¢,
ä½†æ˜¯, è¿™å¹¶ä¸æ€»æ˜¯è¶³å¤Ÿçš„;
ä¾‹å¦‚,ç¼–å†™è‡ªå®šä¹‰é“¾è¡¨æˆ–æ˜¯ç¼–å†™ä½¿ç”¨é€šé“çš„ç»“æ„æ—¶,é€šå¸¸è¦å®ç°è‡ªå®šä¹‰ç‰ˆæœ¬çš„ Drop;
å½“ä½ çœ‹åˆ°æ ‡å‡†åº“å®é™…å¦‚ä½•æ‰§è¡Œæ—¶,
å®ç° Drop æ¯”å¹¶çœ‹èµ·æ¥å®¹æ˜“çš„å¤š:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// That's it!
fn drop&lt;T&gt;(t: T) {}
<span class="boring">}</span></code></pre></pre>
<p>å·§å¦™åˆ©ç”¨å¤±å»ä½œç”¨åŸŸæ—¶é”€æ¯çš„è§„åˆ™,
<code>std::mem::drop</code> æœ‰ä¸€ä¸ªç©ºå‡½æ•°ä½“!</p>
<p>è¿™æ˜¯ä¸€ä¸ªæŠ€å·§, ä½ å¯ä»¥åœ¨è‡ªå·±çš„è‡ªå®šä¹‰ Drop å®ç°ä¸­ä½¿ç”¨,
å˜¦ä½ æ¶µç›–æ‰€æœ‰åŸºç±»?å³å¯;</p>
<h3 id="çœŸçš„å¯¹å€Ÿç”¨æ£€æŸ¥å‘˜å¾ˆæ°”-é‚£å°±ç”¨ä¸å¯å˜æ•°æ®ç»“æ„"><a class="header" href="#çœŸçš„å¯¹å€Ÿç”¨æ£€æŸ¥å‘˜å¾ˆæ°”-é‚£å°±ç”¨ä¸å¯å˜æ•°æ®ç»“æ„">çœŸçš„å¯¹å€Ÿç”¨æ£€æŸ¥å‘˜å¾ˆæ°”? é‚£å°±ç”¨ä¸å¯å˜æ•°æ®ç»“æ„</a></h3>
<p>å‡½æ•°å¼ç¨‹åºå‘˜å–œæ¬¢è¯´å…¨å±€çš„/å¯å˜çš„çŠ¶æ€æ˜¯ä¸‡æ¶ä¹‹æº,
å¦‚æœå¯ä»¥é¿å…,é‚£æ¯›è¿˜è¦ä½¿ç”¨å‘¢?
å¤šäºäº† Rust çš„å‡½æ•°å¼ç»“æ„,
æˆ‘ä»¬æ‰èƒ½æ„å»ºä»ä¸€å¼€å§‹å°±ä¸å¯èƒ½çªå˜çš„ç»“æ„ç»“æ„!
å½“ä½ éœ€è¦ç¼–å†™ç±»ä¼¼åœ¨ Haskell/OCaml æˆ–å…¶å®ƒè¯­è¨€ä¸­çœ‹åˆ°çš„çº¯ç²¹å‡½æ•°å¼ä»£ç æ—¶,
è¿™å°¤å…¶æœ‰ç”¨;</p>
<p>é€šè¿‡é“¾æ¥åˆ—è¡¨ç»¼åˆæ•™ç¨‹ä¸­çš„ç¤ºä¾‹,
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä½•æ„å»ºä¸€ä¸ªä¸å¯å˜åˆ—è¡¨,å…¶ä¸­èŠ‚ç‚¹æœ‰å¼•ç”¨è®¡æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::rc::Rc;

pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
}

type Link&lt;T&gt; = Option&lt;Rc&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;T&gt; List&lt;T&gt; {
    pub fn new() -&gt; Self {
        List { head: None }
    }

    pub fn prepend(&amp;self, elem: T) -&gt; List&lt;T&gt; {
        List { head: Some(Rc::new(Node {
            elem: elem,
            next: self.head.clone(),
        }))}
    }

    pub fn tail(&amp;self) -&gt; List&lt;T&gt; {
        List { head: self.head.as_ref().and_then(|node| node.next.clone()) }
    }
    ...
<span class="boring">}</span></code></pre></pre>
<p>è¿™å°±å¾ˆèµ,å› ä¸º,å…¶è¡Œä¸ºç±»ä¼¼äºå‡½æ•°å¼æ•°æ®ç»“æ„,
åœ¨å‡½æ•°å¼æ•°æ®ç»“æ„ä¸­,
äººä»¬ä¸ä¼šé€šè¿‡è¿½åŠ å‰ç¼€æ¥ä¿®æ”¹åˆ—è¡¨,
è€Œæ˜¯é€šè¿‡ä»¥æ–°å…ƒç´ ä½œä¸ºå…¶å¤´éƒ¨å’Œç°æœ‰åˆ—è¡¨ä½œä¸ºå°¾éƒ¨æ¥æ„å»ºåˆ—è¡¨å®Œæˆæ–°æ„å»º;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>    [head] ++ tail
<span class="boring">}</span></code></pre></pre>
<p>è¯·æ³¨æ„,ä¸Šè¿°æ–¹æ³•éƒ½ä¸éœ€è¦ mut, å› ä¸º,æˆ‘ä»¬çš„æ•°æ®ç»“æ„æ˜¯ä¸å¯å˜çš„!
è¿™åœ¨å†…å­˜ä¸Šä¹Ÿæ˜¯éå¸¸é«˜æ•ˆçš„,å› ä¸º,è¯¥ç»“æ„æ˜¯å¼•ç”¨è®¡æ•°çš„,
è¿™æ„å‘³ç€å¦‚æœæ­¤æ•°æ®ç»“æ„ä¸Šæœ‰å¤šä¸ªè°ƒç”¨è€…,
æˆ‘ä»¬ä¸ä¼šæµªè´¹ä¸å¿…è¦çš„èµ„æºæ¥å¤åˆ¶èŠ‚ç‚¹çš„åº•å±‚å†…å­˜;</p>
<p>Rust ä¸­çš„çº¯å‡½æ•°ä»£ç å¾ˆç®€æ´,
ä½†æ˜¯,å¤šæ•°æ—¶å€™,éœ€è¦å°¾é€’å½’æ¥äº†æŠŠç”¨æˆ‘å¿«è¿™ç§æ–¹å¼å®ç°çš„é«˜æ€§èƒ½ä»£ç ï¼›
è€Œä¸”ï¼Œè¦å°å¿ƒï¼Œæ¯•ç«Ÿ Rust ç¼–è¯‘å™¨ä¸ä¿è¯å°¾è°ƒç”¨ä¼˜åŒ–ï¼›
å€¼å¾—è¿›ä¸€æ­¥æŒ–æ˜æ›´å¤šä¿¡æ¯ -&gt; <a href="https://stackoverflow.com/questions/59257543/when-is-tail-recursion-guaranteed-in-rust">When is tail recursion guaranteed in Rust? - Stack Overflow</a></p>
<p>(<code>æ˜¯ä¹Ÿä¹:</code></p>
<p>è¿™å°±å°´å°¬äº†, åªæ˜¯ä¸ªçœ‹èµ·æ¥å¾ˆç¾çš„æ€è·¯,
æ¯•ç«Ÿ Rust ä¸æ˜¯çº¯å‡½æ•°è¯­è¨€,
é€’å½’å¹¶ä¸æ˜¯ç¬¬ä¸€å…¬æ°‘;</p>
<p>æ‰€ä»¥, è¿™ç§åœºæ™¯ä¸­,è¿˜æ˜¯è€å®å’Œ å€Ÿç”¨ç®¡ç†å‘˜ å¥½å¥½å•†é‡å§...</p>
<p>)</p>
<h3 id="traits-ç¯®æœ‰åŠ©å‡å°‘é‡å¤"><a class="header" href="#traits-ç¯®æœ‰åŠ©å‡å°‘é‡å¤">traits ç¯®æœ‰åŠ©å‡å°‘é‡å¤</a></h3>
<p>æœ‰æ—¶,å¯èƒ½å¸Œæœ›é€šè¿‡å¾ˆå¤šä¸åŒçš„ç‰¹å¾æ¥çº¦æŸæ³›å‹å‚æ•°:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo&lt;T: Copy + Clone + Ord + Bar + Baz + Nyan&gt; {
    vals: Vec&lt;T&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>ä½†æ˜¯,ä¸€æ—¦ä½ å¼€å§‹ç¼–å†™ impl è¯­å¥,
æˆ–æ˜¯å½“ä½ æœ‰å¤šä¸ªé€šç”¨å‚æ•°æ—¶,
è¿™å¾ˆå¿«å°±ä¼šå¤±æ§;
ç›¸åä½ å¯æº¶æ€§å®šä¹‰ä¸€ä¸ªæ•´ä½“ç‰¹å¾, ä½¿ä»£ç æ›´åŠ  DRY;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Fooer: Copy + Clone + Ord + Bar + Baz + Nyan {}

struct Foo&lt;F: Fooer&gt; {
    vals: Vec&lt;F&gt;,
}

impl&lt;F: Fooer&gt; Foo&lt;F&gt; { ... }
<span class="boring">}</span></code></pre></pre>
<p>traits ç¯®å¯ä»¥å¸®åŠ©å‡å°‘é‡å¤ï¼Œ
ä½†æ˜¯ï¼Œä¸è¦è®©å…¶å˜å¾—è¿‡å¤§ï¼›
åœ¨å¾ˆå¤šæƒ…å†µä¸­ï¼Œ
è®©ä¸€ä¸ªç±»å‹éœ€è¦å¦‚æ­¤å¤šçš„çº¦æŸå¯èƒ½ä¼šäº§ç”Ÿåå‘³é“,
å› ä¸º,ä½ åˆ›å»ºçš„æŠ½è±¡å¤ªå¤§äº†;
ç›¸å,å¦‚æœä½ å‘ç°çº¦æŸæ— ç¼˜æ— æ•…çš„å˜å¾—å¤ªå¤§,
è¯·ä¼ å…¥å…·ä½“ç±»å‹;
ç„¶è€Œ,æŸäº›åº”ç”¨å’Œè¿œåˆå¯èƒ½å—ç›Šäº blanket traits/ç‰¹å¾ç¯®,
ä¾‹å¦‚æ—¨åœ¨æä¾›å°½å¯èƒ½é€šç”¨çš„ API åº“;</p>
<h3 id="match-è¯­å¥æœ¬è´¨ä¸Šå¾ˆçµæ´»å’Œç»“æ„åŒ–çš„"><a class="header" href="#match-è¯­å¥æœ¬è´¨ä¸Šå¾ˆçµæ´»å’Œç»“æ„åŒ–çš„">Match è¯­å¥æœ¬è´¨ä¸Šå¾ˆçµæ´»å’Œç»“æ„åŒ–çš„</a></h3>
<p>ä¾‹å¦‚,å¯ä»¥å°†å€¼ä½œä¸ºå…ƒç»„ç»„åˆåœ¨ä¸€èµ·å¹¶æ‰§è¡Œä»¥ä¸‹æ“ä½œ,è€Œä¸æ˜¯åµŒå¥—åŒ¹é…è¯­å¥:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn player_outcome(player: &amp;Move, opp: &amp;Move) -&gt; Outcome {
    use Move::*;
    use Outcome::*;
    match (player, opp) {
        // Rock moves.
        (Rock, Rock) =&gt; Draw,
        (Rock, Paper) =&gt; Lose,
        (Rock, Scissors) =&gt; Win,
        // Paper moves.
        (Paper, Rock) =&gt; Win,
        (Paper, Paper) =&gt; Draw,
        (Paper, Scissors) =&gt; Lose,
        // Scissor moves.
        (Scissors, Rock) =&gt; Lose,
        (Scissors, Paper) =&gt; Win,
        (Scissors, Scissors) =&gt; Draw,
    }
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™ä¸ªç¤ºä¾‹è¶³ä»¥è¯´æ˜ä¸ºä»€ä¹ˆæ¨¡å‹åŒ¹é…æ¯”æŒ‡ä»¤å¼è¯­è¨€ä¸­çš„ switch è¯­å¥æ›´å¼ºå¤§,
è€Œä¸”, åœ¨åŠ³æ¨¡å†…éƒ¨å€¼æ–¹é¢å¯ä»¥ä½œçš„æ›´å¤š.</p>
<h3 id="å¦‚æœåŒ¹é…å¯¹è±¡æ˜¯æœ‰é™ä¸”å·²çŸ¥çš„å«‘ä½¿ç”¨-_--å­å¥"><a class="header" href="#å¦‚æœåŒ¹é…å¯¹è±¡æ˜¯æœ‰é™ä¸”å·²çŸ¥çš„å«‘ä½¿ç”¨-_--å­å¥">å¦‚æœåŒ¹é…å¯¹è±¡æ˜¯æœ‰é™ä¸”å·²çŸ¥çš„,å«‘ä½¿ç”¨ _ =&gt; å­å¥</a></h3>
<p>ä¾‹å¦‚,æˆ‘ä»¬æœ‰ä¸ªæšä¸¾:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Foo {
    Bar,
    Baz,
    Nyan,
    Zab,
    Azb,
    Bza,
}
<span class="boring">}</span></code></pre></pre>
<p>åœ¨ç¼–å†™ match è¯­å¥æ—¶,å¦‚æœå¯èƒ½çš„è¯, åº”è¯¥åŒ¹é…æšä¸¾çš„æ‰€æœ‰ç±»å‹,è€Œä¸æ˜¯æ±‚åŠ©äº catch-all å­å¥:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>match f {
    Bar =&gt; { ... },
    Baz =&gt; { ... },
    Nyan =&gt; { ... },
    Zab =&gt; { ... },
    Azb =&gt; { ... },
    Bza =&gt; { ... },
}
<span class="boring">}</span></code></pre></pre>
<p>è¿™å¯¹ä»£ç ç»´æŠ¤éå¸¸æœ‰å¸®åŠ©,å› ä¸º,å¦‚æœæšä¸¾çš„åŸå§‹ç¼–å†™è€…é€ˆå…¶è¿½åŠ æ›´å¤šå˜ä½“,
å¦‚æœæˆ‘ä»¬å¿˜è®°åœ¨åŒ¹é…è¯­å¥ä¸­å¤„ç†æ–°å˜ä½“, åŠŸèƒ½å°†æ— æ³•ç¼–è¯‘;</p>
<h3 id="match-ä¿æŠ¤æ¡æ¬¾ä¹Ÿå¾ˆå¼ºå¤§"><a class="header" href="#match-ä¿æŠ¤æ¡æ¬¾ä¹Ÿå¾ˆå¼ºå¤§">Match ä¿æŠ¤æ¡æ¬¾ä¹Ÿå¾ˆå¼ºå¤§</a></h3>
<p>å½“ä½ æœ‰æœªçŸ¥æˆ–æ˜¯å¯èƒ½æ— é™æ•°é‡çš„åŒ¹é…é¡¹æ—¶(ä¾‹å¦‚æ•°å­—èŒƒå›´),
åŒ¹é…å®ˆå«å°±å¾ˆæ£’;
ç„¶è€Œ, å¦‚æœä½ çš„èŒƒå›´ä¸èƒ½è¢«å®ˆå«å®Œå…¨åŒ…å«æ—¶,
å°†è¿«ä½¿ä½ ä½¿ç”¨ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„ <code>_ =&gt;</code>,
è¿™åœ¨ç¼–å†™å¯ç»´æŠ¤ä»£ç æ—¶å¯èƒ½å°±æ˜¯ä¸€ä¸ªç¼ºç‚¹;</p>
<p>Rust ä¹¦ä¸­å…¸å‹ç¤ºä¾‹å¦‚ä¸‹:</p>
<pre><pre class="playground"><code class="language-rust edition2021">enum Temperature {
    Celsius(i32),
    Fahrenheit(i32),
}

fn main() {
    let temperature = Temperature::Celsius(35);
    match temperature {
        Temperature::Celsius(t) if t &gt; 30 =&gt; println!(&quot;{}C is above 30 Celsius&quot;, t),
        Temperature::Celsius(t) =&gt; println!(&quot;{}C is below 30 Celsius&quot;, t),
        Temperature::Fahrenheit(t) if t &gt; 86 =&gt; println!(&quot;{}F is above 86 Fahrenheit&quot;, t),
        Temperature::Fahrenheit(t) =&gt; println!(&quot;{}F is below 86 Fahrenheit&quot;, t),
    }
}</code></pre></pre>
<h3 id="éœ€è¦æä¹±åŸå§‹æ±‡ç¼–å˜›-æœ‰ä¸€ä¸ªå®"><a class="header" href="#éœ€è¦æä¹±åŸå§‹æ±‡ç¼–å˜›-æœ‰ä¸€ä¸ªå®">éœ€è¦æä¹±åŸå§‹æ±‡ç¼–å˜›? æœ‰ä¸€ä¸ªå®!</a></h3>
<p>core asm æä¾›äº†ä¸€ä¸ªé—³, å¯ä»¥è®©ä½ åœ¨ Rust ä¸­ç¼–å†™å†…è”æ±‡ç¼–è¯­å¥,
è¿™åœ¨æŠ˜è…¾ä¸€äº›èŠ±å“¨çš„äº‹æƒ…æ—¶å¾ˆæœ‰å¸®åŠ©,
æ¯”å¦‚ç›´æ¥æ‹¦æˆª CPU çš„å †æ ˆ,
æˆ–æ˜¯æƒ³è¦å®ç°é«˜çº§ä¼˜åŒ–;</p>
<p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹,æˆ‘ä»¬ä½¿ç”¨å†…è”æ±‡ç¼–é€šè¿‡ç®€å•çš„å°†å †æ ˆæŒ‡é’ˆç§»åŠ¨åˆ°ç”¨æ¥æ¬ºéª—å¤„ç†å™¨çš„å †æ ˆæ¥æ‰§è¡Œæˆ‘ä»¬çš„å‡½æ•°!</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use core::arch::asm;

const MAX_DEPTH: isize = 48;
const STACK_SIZE: usize = 1024 * 1024 * 2;

#[derive(Debug, Default)]
#[repr(C)]
struct StackContext {
    rsp: u64,
}

fn nyan() -&gt; ! {
    println!(&quot;nyan nyan nyan&quot;);
    loop {}
}

pub fn move_to_nyan() {
    let mut ctx = StackContext::default();
    let mut stack = vec![0u8; MAX as usize];
    unsafe {
        let stack_bottom = stack.as_mut_ptr().offset(MAX_DEPTH);
        let aligned = (stack_bottom as usize &amp; !15) as *mut u8;
        std::ptr::write(aligned.offset(-16) as *mut u64, nyan as u64);
        ctx.rsp = aligned.offset(-16) as u64;
        switch_stack_to_fn(&amp;mut ctx);
    }
}

unsafe fn switch_stack_to_fn(new: *const StackContext) {
    asm!(
        &quot;mov rsp, [{0} + 0x00]&quot;,
        &quot;ret&quot;,
        in(reg) new,
    )
}
<span class="boring">}</span></code></pre></pre>
<p>(<code>æ˜¯ä¹Ÿä¹</code>:</p>
<p>æ‰€ä»¥è¯´, æ— æ³•åµŒå…¥å†…è” æ±‡ç¼–ä»£ç  çš„è¯­è¨€, éƒ½ä¸ç®—ç³»ç»Ÿè¯­è¨€?</p>
<p>ç­‰ç­‰, Python å¥½è±¡ä¹Ÿå¯ä»¥å“ª...
)</p>
<h3 id="ä½¿ç”¨-criterion-å¯¹ä»£ç åŠå…¶ååé‡è¿›è¡ŒåŸºå‡†æµ‹è¯•"><a class="header" href="#ä½¿ç”¨-criterion-å¯¹ä»£ç åŠå…¶ååé‡è¿›è¡ŒåŸºå‡†æµ‹è¯•">ä½¿ç”¨ Criterion å¯¹ä»£ç åŠå…¶ååé‡è¿›è¡ŒåŸºå‡†æµ‹è¯•</a></h3>
<p>ç”¨æ¥å¯¹ Rust ä»£ç è¿›è¡ŒåŸºå‡†æµ‹è¯•çš„ Criterion æ˜¯ä¸€é¡¹äº†ä¸èµ·çš„å·¥ç¨‹ä½œå“;
èƒ½å¸®åŠ©ä½ ä½¿ç”¨å›¾å½¢/å›å½’åˆ†æå’Œå…¶å®ƒå¥‡æ€ªçš„å·¥å…·æ¥è®¿é—®ä»¤äººæ•¬ç•çš„åŸºå‡†æµ‹è¯•åŠŸèƒ½;
ç”šè‡³å¯ä»¥ç”¨æ¥è¡¡é‡å‡½æ•°çš„ä¸åŒç»´åº¦,ä¾‹å¦‚æ—¶é—´å’Œååé‡;
åˆæ¯”å¦‚, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒçš„ç›´æ–¹å›¾ä¸­,ä½¿ç”¨æ ‡å‡†åº“çš„è¿­ä»£å™¨æ–¹æ³•æ„é€ /è·å–å’Œæ”¶é›†åŸå§‹å­—èŠ‚çš„é€Ÿåº¦æœ‰å¤šå¿«;</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::iter;

use criterion::BenchmarkId;
use criterion::Criterion;
use criterion::Throughput;
use criterion::{criterion_group, criterion_main};

fn from_elem(c: &amp;mut Criterion) {
    static KB: usize = 1024;

    let mut group = c.benchmark_group(&quot;from_elem&quot;);
    for size in [KB, 2 * KB, 4 * KB, 8 * KB, 16 * KB].iter() {
        group.throughput(Throughput::Bytes(*size as u64));
        group.bench_with_input(BenchmarkId::from_parameter(size), size, |b, &amp;size| {
            b.iter(|| iter::repeat(0u8).take(size).collect::&lt;Vec&lt;_&gt;&gt;());
        });
    }
    group.finish();
}

criterion_group!(benches, from_elem);
criterion_main!(benches);
<span class="boring">}</span></code></pre></pre>
<p>å°†ä»¥ä¸‹æ¡ç›®è¿½åŠ åˆ°é¡¹ç›®çš„ Cargo,toml æ–‡ä»¶ä¸­,
å°±å¯ä»¥ç”¨ cargo bench è¿è¡Œäº†:</p>
<pre><code class="language-toml">[dev-dependencies]
criterion = &quot;0.3&quot;

[[bench]]
name = &quot;BENCH_NAME&quot;
harness = false
</code></pre>
<p>criterion ä¸ä»…å¯ä»¥å‘ä½ å±•ç¤ºéå¸¸æ£’çš„å›¾è¡¨å’Œæè¿°æ€§ä¿¡æ¯,
è€Œä¸”,è¿˜èƒ½è®°ä½åŸºå‡†æµ‹è¯•è¿è¡Œçš„å…ˆå‰ç»“æœ,
å‘Šè¯‰ä½ æ€§èƒ½å›å½’çŠ¶æ€;
åœ¨è¿™ç§æƒ…å†µä¸­,æˆ‘åœ¨è¿è¡ŒåŸºå‡†æµ‹è¯•çš„åŒæ—¶, è¿˜èƒ½ç”¨è®¡ç®—æœºä½œå¾ˆå¤šå…¶å®ƒäº‹å„¿,
æ‰€ä»¥, ä¹Ÿèƒ½è‡ªç„¶çš„é€šæŠ¥ä»ä¸Šæ¬¡æµ‹é‡åé€€åŒ–äº†å¤šå°‘;
æ€»ä¹‹,éå¸¸çš„COOL!</p>
<pre><code>    Found 11 outliers among 100 measurements (11.00%)
      2 (2.00%) low mild
      4 (4.00%) high mild
      5 (5.00%) high severe
    from_elem/8192          time:   [79.816 ns 79.866 ns 79.913 ns]
                            thrpt:  [95.471 GiB/s 95.528 GiB/s 95.587 GiB/s]
                     change:
                            time:   [+7.3168% +7.9223% +8.4362%] (p = 0.00 &lt; 0.05)
                            thrpt:  [-7.7799% -7.3407% -6.8180%]
                            Performance has regressed.
    Found 3 outliers among 100 measurements (3.00%)
      2 (2.00%) high mild
      1 (1.00%) high severe
    from_elem/16384         time:   [107.22 ns 107.28 ns 107.34 ns]
                            thrpt:  [142.15 GiB/s 142.23 GiB/s 142.31 GiB/s]
                     change:
                            time:   [+3.1408% +3.4311% +3.7094%] (p = 0.00 &lt; 0.05)
                            thrpt:  [-3.5767% -3.3173% -3.0451%]
                            Performance has regressed.
</code></pre>
<h3 id="é€šè¿‡é˜…è¯»æ ‡å‡†åº“æ¥ç†è§£å…³é”®æ¦‚å¿µ"><a class="header" href="#é€šè¿‡é˜…è¯»æ ‡å‡†åº“æ¥ç†è§£å…³é”®æ¦‚å¿µ">é€šè¿‡é˜…è¯»æ ‡å‡†åº“æ¥ç†è§£å…³é”®æ¦‚å¿µ!</a></h3>
<p>æˆ‘å–œæ¬¢å¾œå¾‰åœ¨æ ‡å‡†åº“ä¸­,å°¤å…¶æ˜¯ std::rc, std::iter, and std::collections;
ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±ä»ä¸­å­¦ä¹ åˆ°çš„ä¸€äº›å¾ˆèµçš„æŠ€å·§:</p>
<ul>
<li>vec æ˜¯å¦‚ä½•åˆ‡å®å®ç°çš„</li>
<li>é€šè¿‡ std::cell å’Œ std::rc ä¸­çš„ä¸åŒæ–¹æ³•, å®ç°å†…éƒ¨å¯å˜æ€§çš„æ–¹å¼</li>
<li>å¦‚ä½•åœ¨ std::sync ä¸­å®ç°é€šé“</li>
<li>std::sync::Arc çš„é­”åŠ›</li>
<li>äº†è§£ Rust ä½œè€…å¯¹å¼€å‘å¯¹åº”åº“æ—¶,å¦‚ä½•ä½œå‡ºè®¾è®¡å†³ç­–çš„è¯¦å°½è§£é‡Š</li>
</ul>
<p>æœ‰å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ä¸ºè¿›å…¥ Rust å¹¶é‡åˆ°ä¸€äº›éšœç¢çš„äººä»¬æä¾›å¯ç”¨ä¿¡æ¯;
æœŸå¾…æ›´å¤š Rust å†…å®¹èƒ½æ¨å‡º,
å°¤å…¶æ˜¯å…³é”®æ›´é«˜çº§ä¸»é¢˜çš„...</p>
<h3 id="shoutout"><a class="header" href="#shoutout">Shoutout</a></h3>
<p>æ„Ÿè°¢ Offchain Labs åŒäº‹ Rachel å’Œ Lee Bousfield å¯¹è¿™é—¨è¯­è¨€çš„å¹¿æ³›äº†è§£;
ä»–ä»¬çš„ä¸€äº›æŠ€å·§å¯å‘äº†è¿™ç¯‡æ–‡ç« ;</p>
<h2 id="refer"><a class="header" href="#refer">refer.</a></h2>
<blockquote>
<p>å…³é”®å‚è€ƒ</p>
</blockquote>
<ul>
<li><a href="http://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/">Rust Bug Minimization Patterns - The {pnk}f(eli)x Blog</a></li>
<li><a href="https://www.thecodedmessage.com/posts/default-params/">Rust and Default Parameters :: The Coded Message</a></li>
<li><a href="https://github.com/sger/RustBooks#advanced-books">sger/RustBooks: List of Rust books</a>
<ul>
<li><a href="https://veykril.github.io/tlborm/decl-macros/macros2.html">Macros 2.0 - The Little Book of Rust Macros</a></li>
<li>...</li>
</ul>
</li>
</ul>
<h2 id="logging"><a class="header" href="#logging">logging</a></h2>
<blockquote>
<p>ç‰ˆæœ¬è®°è¦</p>
</blockquote>
<ul>
<li>230212 ZQ v1 done</li>
<li>230120 ZQ init.</li>
</ul>
<pre><code>          _~-|-~_
      \) /  o -  \ (/
        '_   â¡   _'
        &gt; '--~--' |

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
</code></pre>

                    <div id="giscus-container"></div>
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../dev/20-things-ive-learned-in-my-20-years-as-a-software-engineer.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../dev/cli_btm.html" class="mobile-nav-chapters next"
                        title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../dev/20-things-ive-learned-in-my-20-years-as-a-software-engineer.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../dev/cli_btm.html" class="nav-chapters next" title="Next chapter"
                aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>




    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

    <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../book.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var pagePath = "dev/concepts-i-wish-i-learned-earlier.md"
    </script>


    <!-- Custom JS scripts -->
    <script type="text/javascript" src="../assets/custom.js"></script>
    <script type="text/javascript" src="../assets/bigPicture.js"></script>

    <hr />

    <p style="text-align:center">

        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®"
                style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
        æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯;-)

    </p>
    <hr />

    <script src="https://utteranc.es/client.js" repo="zhrust/comments" issue-term="pathname" label="âœ¨ğŸ’¬âœ¨"
        theme="github-light" crossorigin="anonymous" async>
        </script>

</body>

</html>