# å…‹æœ "& é©±åŠ¨å¼€å‘"
åŸæ–‡: [Getting Past â€œAmpersand-Driven Developmentâ€ in Rust - Blog](https://fiberplane.com/blog/getting-past-ampersand-driven-development-in-rust)

## background

[RR23W10 - é”ˆå‘¨åˆŠ -> Weekly :: China<Rustaceans>](https://weekly.rs.101.so/abt/index.html) ä¸­å‘ç°å¥½æ–‡,
è¯‘æ¥ç»†è¯»....

## å¿«è¯‘
> A little mental model for ownership and borrowing

æ‰€æœ‰æƒå’Œå€Ÿç”¨çš„å°å°å¿ƒæ™ºæ¨¡å‹.

æˆ‘æ˜¯åœ¨ä¸€æ¬¡ [Tad Lispy](https://www.youtube.com/watch?v=lsnksAMpUvM)
çš„æ¼”è®²ä¸­å¬åˆ° "& ç¬¦å·é©±åŠ¨å¼€å‘"è¿™è¯å„¿çš„,
éå¸¸ç²¾ç¡®çš„æ•æ‰åˆ°äº†å¾ˆå¤š Rust æ–°äººå¼€å‘æ—¶,
ä¸‹æ„è¯†çš„éšæœºæ’å…¥ & ç¬¦å·æ¥å®‰æŠšç¼–è¯‘çš„è¡Œä¸º.

æ­¤æ–‡, æè¿°äº†æˆ‘æƒ³å‘ Rust æ–°æ‰‹è§£é‡Šçš„ä¸€ä¸ªå¿ƒæ™ºæ¨¡å‹ï¼Œ
æ¶‰åŠ &,&mut,æ‰€æœ‰æƒ, Rcs å’Œ Arcs ä¹‹é—´çš„åŒºåˆ«;
æˆ‘å¸Œæœ›ä½ æˆ–æ˜¯å…¶å®ƒæœ‰æŠ±è´Ÿçš„ Rustacean ä»¬å¯¹æ­¤æ„Ÿè§‰æœ‰ç”¨.

### å¼•ç”¨ (&variable)

è®©æˆ‘ä»¬ä» & ç¬¦å·å¼€å§‹,
çœŸæ˜¯ä¸ªå¯æ€•çš„ç¬¦å·;
åœ¨ Rust ä¸­éšå¤„å¯è§ --- å¦‚æœä½ é¦–æ¬¡å°è¯•ç¼–å†™ä¸€äº› Rust ä»£ç ,
å¯èƒ½ä¸åˆ° 10 åˆ†é’Ÿ,
Rust ç¼–è¯‘å™¨å°±ä¼šçƒ¦äººçš„æˆ–æ˜¯æœ‰ç”¨çš„å‘Šè¯‰ä½ ,
åœ¨å“ªå„¿éœ€è¦æ”¾ç½®ä¸€ä¸ª &;

æƒ³è±¡ä¸€ä¸‹,æˆ‘ä»¬æœ‰ä¸ªè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦çš„ç®€å•å‡½æ•°;
æ­¤å‡½æ•°éœ€è¦æŸ¥é˜…å­—ç¬¦ä¸²;
ä½†æ˜¯, éœ€è¦æ‰€æœ‰æƒè¿›è¡Œä¿®æ”¹å˜›?ä¸;
å½“é•¿åº¦å‡½æ•°å®Œæˆæ—¶,æˆ‘ä»¬åº”è¯¥ä»å†…å­˜ä¸­åˆ é™¤å­—ç¬¦ä¸²å˜›? ä¹Ÿä¸éœ€è¦;
è¿™æ„å‘³ç€é•¿åº¦å‡½æ•°å˜¦è¯»å–è®¿é—®æƒ,
åªæ˜¯è¦å­—ç¬¦ä¸²çš„ä¸´æ—¶è§†å›¾è€Œä¸æ˜¯æ°¸ä¹…ç‰ˆæœ¬;

è¿™å°±æ˜¯ &å˜é‡ ç¬¦å·åœ¨ Rust ä¸­çš„å«ä¹‰;
æƒ³æƒ³ä¸€ä¸ªå°å­©å­å°†æœ€å–œæ¬¢çš„ç©å…·å€Ÿç»™å¦å¤–ä¸€ä¸ªå­©å­æ—¶è¯´:
"ä½ å¯ä»¥çœ‹, ä½†æ˜¯, ä¸èƒ½æ‘¸; å½“ä½ çœ‹å®Œå, æˆ‘æƒ³ç«‹å³æ‹¿å›æ¥;"
è¿™å°±æ˜¯å…±äº«å¼•ç”¨;

![Midjourney](https://framerusercontent.com/images/5LwiCYhw088dpelWzFCkp9MWSo.png)


> å›¾ç‰‡ç”± Evan Schwartz ä½¿ç”¨ Midjourney åˆ›ä½œ


### å¯å˜å¼• (&mut variable)

é‚£ä¹ˆ &mut å˜é‡åˆæ˜¯æ€ä¹ˆå›äº‹å„¿?

è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹åœ¨ç»™å®šå­—ç¬¦ä¸²å‰è¿½åŠ  "hello" çš„å‡½æ•°,
è€Œä¸æ˜¯æˆ‘ä»¬çš„å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°;
åœ¨è¿™ç§æƒ…å†µä¸­,
æˆ‘ä»¬ç¡¬éª¨å¤´å¸Œæœ›å‡½æ•°ä¿®æ”¹ç»™è¿›æ¥çš„æ•°æ®;
è¿™æ—¶,æˆ‘ä»¬å°±éœ€è¦ &mut æˆ–è¯´ å¯å˜å¼•ç”¨;

æƒ³æƒ³æˆ‘ä»¬çš„å°å­©å­å€Ÿä¸€æœ¬æ¶‚è‰²ä¹¦ç»™æœ‹å‹,
è®©ä»–åœ¨ä¸€é¡µä¸Šè‰²,è¯´:"ä½ å¯ä»¥çœ‹ä»¥åŠæ‘¸---ä½†æ˜¯,
å½“ä½ å®Œæˆå, æˆ‘ä»ç„¶æƒ³è¦å›æ¥";


![Evan Schwartz](https://framerusercontent.com/images/0Y2RBZro7ESbqJzViLGIqfvccY.png)

> å›¾ç‰‡ç”± Evan Schwartz ä½¿ç”¨ Midjourney åˆ›ä½œ


#### å¯å˜å¼•ç”¨æ˜¯ç‹¬å çš„

è¿™é‡Œè§£é‡Šå…³äº Rust å¾®å¦™åˆéå¸¸èªæ˜çš„è®¾è®¡æœ€å¥½çš„åœºæ™¯ä¹‹ä¸€;

å¦‚æœæŸäºº(æˆ–æ˜¯ä½ çš„ä»£ç çš„æŸéƒ¨åˆ†)æœ‰ä¸€ä¸ªå¯¹æŸä¸ªå€¼çš„å¯å˜è¢­ç”¨,
Rust ç¼–è¯‘å™¨ä¼šç¡®ä¿ç»å¯¹æ²¡æœ‰å…¶å®ƒäººå¯ä»¥å†æ¬¡å¼•ç”¨;
ä¸ºä»€ä¹ˆ?
å› ä¸º, å¦‚æœä½ æ­£åœ¨æŸ¥çœ‹æŸä¸ªä½ è®¤ä¸ºä¸å¯å˜çš„å€¼,
å½“ç„¶ä¸ä¼šåœ¨ä½ ä½¿ç”¨å…¶è¿‡ç¨‹ä¸­åˆå’Œç»´å…¶å®ƒäººæ„å¤–çš„å˜æ›´è¿™ä¸ªå¯¹è±¡
(å¯¹äºæˆ‘ä»¬ä¸Šé¢æåŠçš„å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°,
ä½ å°±çŸ¥é“å¦‚æœå…è®¸, é‚£å¾—å¤šä»¤äººå›°æƒ‘?)

å¦å¤–ä¸€å±‚å«ä¹‰æ˜¯,
å¦‚æœä»»ä½•äººå¯¹ä¸€ä¸ªå€¼æœ‰ä¸€ä¸ªä¸å¯å˜è¢­ç”¨,
æˆ‘ä»¬å°±ä¸èƒ½æ›´æ”¹å®ƒ, åˆæˆ–æ˜¯ç»™å‡ºå¦å¤–ä¸€ä¸ªå¯å˜å¼•ç”¨;


### å€¼çš„æ‹¥æœ‰ (variable)

æ¥ä¸‹æ¥,æˆ‘ä»¬å°†è®¨è®º å€¼çš„æ‹¥æœ‰;

Rust çš„å¦å¤–ä¸€ä¸ªèªæ˜ä¹‹å¤„,
åœ¨äºå¦‚ä½•ç¡®å®šä½•æ—¶åº”è¯¥å¿˜è®°æˆ–æ˜¯ä»å†…å­˜ä¸­åˆ é™¤ä¸€ä¸ªå€¼;
æ¯å½“å‡½æ•°å®Œæˆå, å…¶ä¸­å£°æ˜çš„æ‰€æœ‰å€¼éƒ½å°†è¢«åˆ é™¤æˆ–æ˜¯è‡ªåŠ¨æ¸…é™¤;

å¥½å§, è¿™å¹¶ä¸æ˜¯çœŸçš„;
å¦‚æœæˆ‘ä»¬å†æ¬¡è€ƒè™‘å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°,
å°±çŸ¥é“, æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å­—ç¬¦ä¸²åœ¨é•¿åº¦å‡½æ•°å®Œæˆæ—¶å°±è¢«å®Œå…¨é—å¿˜/åˆ é™¤;
å’Œè¿½åŠ  hello å‡½æ•°ç›¸åŒ;
åœ¨è¿™äº›æƒ…å†µä¸­, åªä¼šæ¸…é™¤å¯¹è¯¥å€¼çš„å¼•ç”¨,
ä½†æ˜¯,ä¸ä¼šåˆ é™¤å®é™…å€¼;

é‚£ä¹ˆ, å°†æˆ‘ä»¬å‘ HashMap ä¸­æ’å…¥ä¸€äº›ä¸œè¥¿æ—¶åˆå¦‚ä½•?
åœ¨è¿™ç§åœºæ™¯ä¸­,
æˆ‘ä»¬å¸Œæœ›ç»™å®šçš„å­—ç¬¦ä¸²è¾“å…¥æˆä¸º HashMap çš„ä¸€éƒ¨åˆ†;
å¸Œæœ›è¯¥å€¼ç°åœ¨ç”± HashMap æ‹¥æœ‰;

æƒ³è±¡ä¸€ä¸ªå°å­©èµ é€ä»–ä»¬çš„ç©å…·ä¹‹ä¸€æ—¶è¯´:
"ç»™, ä½ å¯ä»¥æ‹¿æ¥ä½œä»»ä½•ä½ æƒ³ä½œçš„äº‹å„¿,æˆ‘ä¸éœ€è¦æ‹¿å›æ¥äº†,
äº«å—å§!"
(å³ä¾¿æ˜¯æƒ³è±¡ä¸­çš„å­©å­, ä¹Ÿéœ€è¦ç›¸å½“æˆç†Ÿæˆåƒå¯èƒ½ä»¤æ­¤åœºæ™¯å¯ä¿¡å“ª...)


### å¼•ç”¨è®¡æ•°æŒ‡é’ˆ (Rc å’Œ Arc)

æˆ‘ä»¬åœ¨ Rust ä¸­è¿˜æœ‰å¦å¤–ä¸¤ç§å€¼ç±»å‹æ˜¯ Rc å’Œ Arc;

å¯¹äº Rc, æƒ³è±¡å­©å­ç”Ÿæ—¥æ´¾å¯¹ä¸Šçš„è£…é¥°å“,
ä¾‹å¦‚æ°”çƒ;
å½“æ‰€æœ‰äººéƒ½å–ä¿¡åœ¨é‚£é‡Œæ—¶,
æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªäººéƒ½çœ‹ç€, ä½†æ˜¯ä¸è¦è§¦æ‘¸è£…é¥°å“;
æˆ‘ä»¬å¸Œæœ›è£…é¥°å“ä¸€ç›´ä¿æŒåˆ°æœ€åä¸€ä¸ªå­©å­ç¦»å¼€æ—¶;
ä½†æ˜¯, å˜¦æœ€åä¸€ä¸ªç†Šå­©å­ç¦»å¼€,
æˆ‘ä»¬å°±å¯ä»¥ç«‹å³å¼€å§‹æ¸…ç†è£…é¥°å“;
è¿™å°±æ˜¯ä¸€ä¸ª Rc æˆ–æ˜¯å¼•ç”¨è®¡æ•°æŒ‡é’ˆ;

Rc è·Ÿè¸ªæœ‰å¤šå°‘äºº(æˆ–æ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†)
æ­£åœ¨æŸ¥çœ‹, å¹¶ä¿æŒè¯¥å€¼, ç›´åˆ°æœ€åä¸€ä¸ªå¼•ç”¨è¢«åˆ é™¤çš„é‚£ä¸€åˆ»;

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å¼‚æ­¥æˆ–æ˜¯å¤šçº¿ç¨‹ä»£ç ,
ä½ å°†ä½¿ç”¨ Arc æˆ–æ˜¯åŸå­å¼•ç”¨è®¡æ•°æŒ‡é’ˆ,
ä½†æ˜¯, å’Œ Rc çš„æƒ³æ³•ç›¸åŒ;

æ•ˆæœä¹Ÿæ˜¯: å¤§å®¶çœ‹çœ‹è£…é¥°å“,
æ™šä¼šä¸€ç»“æŸæˆ‘ä»¬å°±æ”¶æ‹¾å¹²å‡€;

### ç»“è®º
ä½œä¸ºæœ€åçš„æ€»ç»“,
ä½ å¯ä»¥æ ¹æ®ä»¥ä¸‹é—®é¢˜, æ¥å†³ç­–åº”è¯¥ä½¿ç”¨é‚£ç§ç±»å‹çš„å€¼:

![Conclusion](https://framerusercontent.com/images/mH73ms5JxUOiNWhWMA8UKtAX7Y.jpg)



|                  |    &var\n(ä¸å¯å˜å¼•)     | &mut var\n(å¯å˜å¼•ç”¨) |               var\n(æ‹¥æœ‰å€¼)                |             Rc             |                          |
| \n(å¼•ç”¨è®¡æ•°æŒ‡é’ˆ) | Arc\n(åŸå­å¼•ç”¨è®¡æ•°æŒ‡é’ˆ) |                      |                                            |                            |                          |
| ---------------- | ----------------------- | -------------------- | ------------------------------------------ | -------------------------- | ------------------------ |
| å¯è¯»?            | âœ”ï¸                      | âœ”ï¸                   | âœ”ï¸                                         | âœ”ï¸                         | âœ”ï¸                       |
| å¯å†™?            | âœ˜                       | âœ”ï¸                   | âœ”ï¸                                         | ä»…å½“åŒ…è£…ä¸º Cell/RefCell    | Oä»…å½“åŒ…è£…ä¸º Mutex/RwLock |
| å‡½æ•°ç»“æŸæ—¶ä¸¢å¼ƒ?  | âœ˜                       | âœ˜                    | âœ”ï¸                                         | ä»…åœ¨ Rc æœ€åçš„å…‹éš†è¢«ä¸¢å¼ƒå | ä»…å½“ Arc çš„å…‹éš†è¢«ä¸¢å¼ƒå  |
| å¤šçº¿ç¨‹å¯ç”¨?      | âœ˜ æ³¨1                   | âœ˜                    | å€¼å¯ä»¥åœ¨çº¿ç¨‹é—´ç§»åŠ¨\nä½†ä¸åŒçº¿ç¨‹ä¸å¯åŒæ—¶è®¿é—® | âœ˜                          | âœ”ï¸                       |



> æ³¨1: (é™¤éæœ‰ä¸€ä¸ª 'static ç”Ÿå‘½å‘¨æœŸ, è¿™æ„å‘³ç€åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­å­˜åœ¨,æˆ–æ˜¯åœ¨çº¿ç¨‹ä½œç”¨åŸŸä¸­ä½¿ç”¨)


åœ¨ä» Typescript ç­‰é«˜çº§è¯­è¨€è½¬åˆ° Rust æ—¶,
& ç¬¦å·æ˜¯æœ€å¯æ€•æˆ–æ˜¯æœ€ä¸ç†Ÿæ‚‰çš„éƒ¨åˆ†ä¹‹ä¸€;
ä½†æ˜¯, èƒ½ä¿è¯çš„æ˜¯, ç»è¿‡ä¸€äº›ç»ƒä¹ , åœ¨ç¼–å†™ä»£ç æ—¶,
çŸ¥é“ä¸€ä¸ªå‡½æ•°åº”è¯¥é‡‡ç”¨å¯å˜å¼•ç”¨è¿˜æ˜¯ä¸å¯å˜å¼•ç”¨,
åˆæˆ–æ˜¯çŸ¥é“å…¶å®ƒåº“çš„å‡½æ•°æ˜¯å¦å¯èƒ½éœ€è¦å¼•ç”¨æˆ–æ˜¯æ‹¥æœ‰å€¼,
æ„Ÿè§‰ä¼šæ›´åŠ ç›´è§‚;
ä¹Ÿå°±æ— éœ€ `"& é©±åŠ¨å¼€å‘"` äº†;

æœ‰å…³è¯¦æƒ…, å€¼å¾—æŸ¥é˜… Rust è¯­è¨€æ–‡æ¡£:
[References and Borrowing](https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html)
ä»¥åŠ:
 [What is Ownership?](https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html)
 
è¿˜æœ‰ [Evan Schwartz](https://github.com/emschwartz)
æ˜¯ Fiberplane çš„é¦–å¸­ Rust å·¥ç¨‹å¸ˆ;
ä¹Ÿæ˜¯ [Autometrics](https://github.com/autometrics-dev/autometrics-rs)
çš„åˆ›é€ è€…,
ä¸€ä¸ªå…¨æ–°çš„ crate, 
å¯ä»¥è®©ä½ è½»æ¾äº†è§£ä»£ç ä¸­ä»»ä½•å‡½æ•°çš„é”™è¯¯ç‡/å»¶è¿Ÿå’Œç”Ÿäº§ä½¿ç”¨æƒ…å†µ.

## refer.

... TBD



```
          _~`+âˆ½~_
      \/ /  = â—¶  \ (/
        '_   ğŸ‚   _'
        | '-----' /

...act by ferris-actor v0.2.4 (built on 23.0303.201916)
```
